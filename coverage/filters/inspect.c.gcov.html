<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - filters/inspect.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">filters</a> - inspect.c<span style="font-size: 80%;"> (source / <a href="inspect.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1210</td>
            <td class="headerCovTableEntry">2208</td>
            <td class="headerCovTableEntryLo">54.8 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2021-04-29 23:48:07</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">32</td>
            <td class="headerCovTableEntry">37</td>
            <td class="headerCovTableEntryMed">86.5 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<span class="lineNum">       2 </span>            :  *                      GPAC - Multimedia Framework C SDK
<span class="lineNum">       3 </span>            :  *
<span class="lineNum">       4 </span>            :  *                      Authors: Jean Le Feuvre
<span class="lineNum">       5 </span>            :  *                      Copyright (c) Telecom ParisTech 2017-2021
<span class="lineNum">       6 </span>            :  *                                      All rights reserved
<span class="lineNum">       7 </span>            :  *
<span class="lineNum">       8 </span>            :  *  This file is part of GPAC / inspection filter
<span class="lineNum">       9 </span>            :  *
<span class="lineNum">      10 </span>            :  *  GPAC is free software; you can redistribute it and/or modify
<span class="lineNum">      11 </span>            :  *  it under the terms of the GNU Lesser General Public License as published by
<span class="lineNum">      12 </span>            :  *  the Free Software Foundation; either version 2, or (at your option)
<span class="lineNum">      13 </span>            :  *  any later version.
<span class="lineNum">      14 </span>            :  *
<span class="lineNum">      15 </span>            :  *  GPAC is distributed in the hope that it will be useful,
<span class="lineNum">      16 </span>            :  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
<span class="lineNum">      17 </span>            :  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<span class="lineNum">      18 </span>            :  *  GNU Lesser General Public License for more details.
<span class="lineNum">      19 </span>            :  *
<span class="lineNum">      20 </span>            :  *  You should have received a copy of the GNU Lesser General Public
<span class="lineNum">      21 </span>            :  *  License along with this library; see the file COPYING.  If not, write to
<span class="lineNum">      22 </span>            :  *  the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
<span class="lineNum">      23 </span>            :  *
<span class="lineNum">      24 </span>            :  */
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            : #include &lt;gpac/filters.h&gt;
<span class="lineNum">      27 </span>            : #include &lt;gpac/constants.h&gt;
<span class="lineNum">      28 </span>            : #include &lt;gpac/list.h&gt;
<span class="lineNum">      29 </span>            : #include &lt;gpac/xml.h&gt;
<span class="lineNum">      30 </span>            : #include &lt;gpac/internal/media_dev.h&gt;
<span class="lineNum">      31 </span>            : 
<span class="lineNum">      32 </span>            : typedef struct
<span class="lineNum">      33 </span>            : {
<span class="lineNum">      34 </span>            :         GF_FilterPid *src_pid;
<span class="lineNum">      35 </span>            :         FILE *tmp;
<span class="lineNum">      36 </span>            :         u64 pck_num;
<span class="lineNum">      37 </span>            :         u32 idx;
<span class="lineNum">      38 </span>            :         u8 dump_pid; //0: no, 1: configure/reconfig, 2: info update
<span class="lineNum">      39 </span>            :         u8 init_pid_config_done;
<span class="lineNum">      40 </span>            :         u64 pck_for_config;
<span class="lineNum">      41 </span>            :         u64 prev_dts, prev_cts, init_ts;
<span class="lineNum">      42 </span>            :         u32 codec_id;
<span class="lineNum">      43 </span>            :         u32 stream_type;
<span class="lineNum">      44 </span>            : 
<span class="lineNum">      45 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">      46 </span>            :         HEVCState *hevc_state;
<span class="lineNum">      47 </span>            :         AVCState *avc_state;
<span class="lineNum">      48 </span>            :         VVCState *vvc_state;
<span class="lineNum">      49 </span>            :         AV1State *av1_state;
<span class="lineNum">      50 </span>            :         GF_M4VParser *mv124_state;
<span class="lineNum">      51 </span>            :         GF_M4VDecSpecInfo dsi;
<span class="lineNum">      52 </span>            : #endif
<span class="lineNum">      53 </span>            :         GF_VPConfig *vpcc;
<span class="lineNum">      54 </span>            : 
<span class="lineNum">      55 </span>            :         //for analyzing
<span class="lineNum">      56 </span>            :         GF_BitStream *bs;
<span class="lineNum">      57 </span>            : 
<span class="lineNum">      58 </span>            :         Bool has_svcc;
<span class="lineNum">      59 </span>            :         u32 nalu_size_length;
<span class="lineNum">      60 </span>            :         Bool is_adobe_protected;
<span class="lineNum">      61 </span>            :         Bool is_cenc_protected;
<span class="lineNum">      62 </span>            :         Bool aborted;
<span class="lineNum">      63 </span>            : 
<span class="lineNum">      64 </span>            :         GF_Fraction tmcd_rate;
<span class="lineNum">      65 </span>            :         u32 tmcd_flags;
<span class="lineNum">      66 </span>            :         u32 tmcd_fpt;
<span class="lineNum">      67 </span>            : 
<span class="lineNum">      68 </span>            :         u32 csize;
<span class="lineNum">      69 </span>            :         Bool buffer_done, no_analysis;
<span class="lineNum">      70 </span>            : } PidCtx;
<span class="lineNum">      71 </span>            : 
<span class="lineNum">      72 </span>            : enum
<span class="lineNum">      73 </span>            : {
<span class="lineNum">      74 </span>            :         INSPECT_MODE_PCK=0,
<span class="lineNum">      75 </span>            :         INSPECT_MODE_BLOCK,
<span class="lineNum">      76 </span>            :         INSPECT_MODE_REFRAME,
<span class="lineNum">      77 </span>            :         INSPECT_MODE_RAW
<span class="lineNum">      78 </span>            : };
<span class="lineNum">      79 </span>            : 
<span class="lineNum">      80 </span>            : enum
<span class="lineNum">      81 </span>            : {
<span class="lineNum">      82 </span>            :         INSPECT_TEST_NO=0,
<span class="lineNum">      83 </span>            :         INSPECT_TEST_NOPROP,
<span class="lineNum">      84 </span>            :         INSPECT_TEST_NETWORK,
<span class="lineNum">      85 </span>            :         INSPECT_TEST_NETX,
<span class="lineNum">      86 </span>            :         INSPECT_TEST_ENCODE,
<span class="lineNum">      87 </span>            :         INSPECT_TEST_ENCX,
<span class="lineNum">      88 </span>            :         INSPECT_TEST_NOCRC,
<span class="lineNum">      89 </span>            :         INSPECT_TEST_NOBR
<span class="lineNum">      90 </span>            : };
<span class="lineNum">      91 </span>            : 
<span class="lineNum">      92 </span>            : enum
<span class="lineNum">      93 </span>            : {
<span class="lineNum">      94 </span>            :         INSPECT_ANALYZE_OFF=0,
<span class="lineNum">      95 </span>            :         INSPECT_ANALYZE_ON,
<span class="lineNum">      96 </span>            :         INSPECT_ANALYZE_BS,
<span class="lineNum">      97 </span>            :         INSPECT_ANALYZE_BS_BITS,
<span class="lineNum">      98 </span>            : };
<span class="lineNum">      99 </span>            : 
<span class="lineNum">     100 </span>            : typedef struct
<span class="lineNum">     101 </span>            : {
<span class="lineNum">     102 </span>            :         u32 mode;
<span class="lineNum">     103 </span>            :         Bool interleave;
<span class="lineNum">     104 </span>            :         Bool dump_data;
<span class="lineNum">     105 </span>            :         Bool deep;
<span class="lineNum">     106 </span>            :         char *log;
<span class="lineNum">     107 </span>            :         char *fmt;
<span class="lineNum">     108 </span>            :         u32 analyze;
<span class="lineNum">     109 </span>            :         Bool props, hdr, allp, info, pcr, xml;
<span class="lineNum">     110 </span>            :         Double speed, start;
<span class="lineNum">     111 </span>            :         u32 test;
<span class="lineNum">     112 </span>            :         GF_Fraction dur;
<span class="lineNum">     113 </span>            :         Bool crc, dtype;
<span class="lineNum">     114 </span>            :         Bool fftmcd;
<span class="lineNum">     115 </span>            :         u32 buffer;
<span class="lineNum">     116 </span>            : 
<span class="lineNum">     117 </span>            :         FILE *dump;
<span class="lineNum">     118 </span>            : 
<span class="lineNum">     119 </span>            :         GF_List *src_pids;
<span class="lineNum">     120 </span>            : 
<span class="lineNum">     121 </span>            :         Bool is_prober, probe_done, hdr_done, dump_pck;
<span class="lineNum">     122 </span>            :         Bool args_updated;
<span class="lineNum">     123 </span>            :         Bool has_seen_eos;
<span class="lineNum">     124 </span>            : } GF_InspectCtx;
<span class="lineNum">     125 </span>            : 
<span class="lineNum">     126 </span>            : 
<span class="lineNum">     127 </span>            : GF_Err gf_bs_set_logger(GF_BitStream *bs, void (*on_bs_log)(void *udta, const char *field_name, u32 nb_bits, u64 field_val, s32 idx1, s32 idx2, s32 idx3), void *udta);
<span class="lineNum">     128 </span>            : 
<span class="lineNum">     129 </span>            : 
<span class="lineNum">     130 </span>            : #define DUMP_ATT_STR(_name, _val) if (ctx-&gt;xml) { \
<span class="lineNum">     131 </span>            :                 gf_fprintf(dump, &quot; %s=\&quot;%s\&quot;&quot;, _name, _val); \
<span class="lineNum">     132 </span>            :         } else { \
<span class="lineNum">     133 </span>            :                 gf_fprintf(dump, &quot; %s %s&quot;, _name, _val); \
<span class="lineNum">     134 </span>            :         }
<span class="lineNum">     135 </span>            : 
<span class="lineNum">     136 </span>            : #define DUMP_ATT_LLU(_name, _val) if (ctx-&gt;xml) { \
<span class="lineNum">     137 </span>            :                 gf_fprintf(dump, &quot; %s=\&quot;&quot;LLU&quot;\&quot;&quot;, _name, _val);\
<span class="lineNum">     138 </span>            :         } else {\
<span class="lineNum">     139 </span>            :                 gf_fprintf(dump, &quot; %s &quot;LLU, _name, _val);\
<span class="lineNum">     140 </span>            :         }
<span class="lineNum">     141 </span>            : 
<span class="lineNum">     142 </span>            : #define DUMP_ATT_U(_name, _val) if (ctx-&gt;xml) { \
<span class="lineNum">     143 </span>            :                 gf_fprintf(dump, &quot; %s=\&quot;%u\&quot;&quot;, _name, _val);\
<span class="lineNum">     144 </span>            :         } else {\
<span class="lineNum">     145 </span>            :                 gf_fprintf(dump, &quot; %s %u&quot;, _name, _val);\
<span class="lineNum">     146 </span>            :         }
<span class="lineNum">     147 </span>            : 
<span class="lineNum">     148 </span>            : #define DUMP_ATT_D(_name, _val) if (ctx-&gt;xml) { \
<span class="lineNum">     149 </span>            :                 gf_fprintf(dump, &quot; %s=\&quot;%d\&quot;&quot;, _name, _val);\
<span class="lineNum">     150 </span>            :         } else {\
<span class="lineNum">     151 </span>            :                 gf_fprintf(dump, &quot; %s %d&quot;, _name, _val);\
<span class="lineNum">     152 </span>            :         }
<span class="lineNum">     153 </span>            : 
<span class="lineNum">     154 </span>            : #define DUMP_ATT_X(_name, _val)  if (ctx-&gt;xml) { \
<span class="lineNum">     155 </span>            :                 gf_fprintf(dump, &quot; %s=\&quot;0x%08X\&quot;&quot;, _name, _val);\
<span class="lineNum">     156 </span>            :         } else {\
<span class="lineNum">     157 </span>            :                 gf_fprintf(dump, &quot; %s 0x%08X&quot;, _name, _val);\
<span class="lineNum">     158 </span>            :         }
<span class="lineNum">     159 </span>            : 
<span class="lineNum">     160 </span>            : #define DUMP_ATT_F(_name, _val)  if (ctx-&gt;xml) { \
<span class="lineNum">     161 </span>            :                 gf_fprintf(dump, &quot; %s=\&quot;%f\&quot;&quot;, _name, _val);\
<span class="lineNum">     162 </span>            :         } else {\
<span class="lineNum">     163 </span>            :                 gf_fprintf(dump, &quot; %s %f&quot;, _name, _val);\
<span class="lineNum">     164 </span>            :         }
<span class="lineNum">     165 </span>            : 
<span class="lineNum">     166 </span>            : 
<span class="lineNum">     167 </span>            : 
<span class="lineNum">     168 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">     169 </span>            : static u32 inspect_get_nal_size(char *ptr, u32 nalh_size)
<span class="lineNum">     170 </span>            : {
<span class="lineNum">     171 </span>            :         u32 nal_size=0;
<span class="lineNum">     172 </span>            :         u32 v = nalh_size;
<span class="lineNum">     173 </span><span class="lineCov">      34750 :         while (v) {</span>
<span class="lineNum">     174 </span><span class="lineCov">      27800 :                 nal_size |= (u8) *ptr;</span>
<span class="lineNum">     175 </span><span class="lineCov">      27800 :                 ptr++;</span>
<span class="lineNum">     176 </span><span class="lineCov">      27800 :                 v-=1;</span>
<span class="lineNum">     177 </span><span class="lineCov">      27800 :                 if (v) nal_size &lt;&lt;= 8;</span>
<span class="lineNum">     178 </span>            :         }
<span class="lineNum">     179 </span>            :         return nal_size;
<a name="180"><span class="lineNum">     180 </span>            : }</a>
<span class="lineNum">     181 </span>            : 
<span class="lineNum">     182 </span><span class="lineCov">       1790 : static const char *get_sei_name(u32 sei_type, u32 is_hevc)</span>
<span class="lineNum">     183 </span>            : {
<span class="lineNum">     184 </span><span class="lineCov">       1790 :         switch (sei_type) {</span>
<span class="lineNum">     185 </span>            :         case 0: return &quot;buffering_period&quot;;
<span class="lineNum">     186 </span><span class="lineCov">        502 :         case 1: return &quot;pic_timing&quot;;</span>
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :         case 2: return &quot;pan_scan_rect&quot;;</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :         case 3: return &quot;filler_payload&quot;;</span>
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :         case 4: return &quot;itu_t_t35&quot;;</span>
<span class="lineNum">     190 </span><span class="lineCov">          6 :         case 5: return &quot;user_data_unregistered&quot;;</span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :         case 6: return &quot;recovery_point&quot;;</span>
<span class="lineNum">     192 </span><span class="lineNoCov">          0 :         case 7: return &quot;dec_ref_pic_marking_repetition&quot;;</span>
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :         case 8: return &quot;spare_pic&quot;;</span>
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :         case 9: return &quot;scene_info&quot;;</span>
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :         case 10: return &quot;sub_seq_info&quot;;</span>
<span class="lineNum">     196 </span><span class="lineNoCov">          0 :         case 11: return &quot;sub_seq_layer_characteristics&quot;;</span>
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :         case 12: return &quot;sub_seq_characteristics&quot;;</span>
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :         case 13: return &quot;full_frame_freeze&quot;;</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :         case 14: return &quot;full_frame_freeze_release&quot;;</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :         case 15: return &quot;picture_snapshot&quot;;</span>
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :         case 16: return &quot;progressive_refinement_segment_start&quot;;</span>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :         case 17: return &quot;progressive_refinement_segment_end&quot;;</span>
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :         case 18: return &quot;motion_constrained_slice_group_set&quot;;</span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :         case 19: return &quot;film_grain_characteristics&quot;;</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :         case 20: return &quot;deblocking_filter_display_preference&quot;;</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :         case 21: return &quot;stereo_video_info&quot;;</span>
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :         case 22: return &quot;post_filter_hint&quot;;</span>
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :         case 23: return &quot;tone_mapping_info&quot;;</span>
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span><span class="lineCov">         12 :         case 24: return &quot;scalability_info&quot;;</span>
<span class="lineNum">     211 </span><span class="lineNoCov">          0 :         case 25: return &quot;sub_pic_scalable_layer&quot;;</span>
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :         case 26: return &quot;non_required_layer_rep&quot;;</span>
<span class="lineNum">     213 </span><span class="lineNoCov">          0 :         case 27: return &quot;priority_layer_info&quot;;</span>
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :         case 28: return &quot;layers_not_present&quot;;</span>
<span class="lineNum">     215 </span><span class="lineNoCov">          0 :         case 29: return &quot;layer_dependency_change&quot;;</span>
<span class="lineNum">     216 </span><span class="lineNoCov">          0 :         case 30: return &quot;scalable_nesting&quot;;</span>
<span class="lineNum">     217 </span><span class="lineNoCov">          0 :         case 31: return &quot;base_layer_temporal_hrd&quot;;</span>
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :         case 32: return &quot;quality_layer_integrity_check&quot;;</span>
<span class="lineNum">     219 </span><span class="lineNoCov">          0 :         case 33: return &quot;redundant_pic_property&quot;;</span>
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :         case 34: return &quot;tl0_dep_rep_index&quot;;</span>
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :         case 35: return &quot;tl_switching_point&quot;;</span>
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :         case 36: return &quot;parallel_decoding_info&quot;;</span>
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :         case 37: return &quot;mvc_scalable_nesting&quot;;</span>
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :         case 38: return &quot;view_scalability_info&quot;;</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :         case 39: return &quot;multiview_scene_info&quot;;</span>
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :         case 40: return &quot;multiview_acquisition_info&quot;;</span>
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :         case 41: return &quot;non_required_view_component&quot;;</span>
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :         case 42: return &quot;view_dependency_change&quot;;</span>
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :         case 43: return &quot;operation_points_not_present&quot;;</span>
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :         case 44: return &quot;base_view_temporal_hrd&quot;;</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :         case 45: return &quot;frame_packing_arrangement&quot;;</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :         case 47: return &quot;display_orientation&quot;;</span>
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :         case 56: return &quot;green_metadata&quot;;</span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :         case 128: return &quot;structure_of_pictures_info&quot;;</span>
<span class="lineNum">     235 </span><span class="lineCov">          1 :         case 129: return &quot;active_parameter_sets&quot;;</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :         case 130: return &quot;decoding_unit_info&quot;;</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :         case 131: return &quot;temporal_sub_layer_zero_index&quot;;</span>
<span class="lineNum">     238 </span><span class="lineCov">       1256 :         case 132: return &quot;decoded_picture_hash&quot;;</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :         case 133: return &quot;scalable_nesting&quot;;</span>
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :         case 134: return &quot;region_refresh_info&quot;;</span>
<span class="lineNum">     241 </span><span class="lineNoCov">          0 :         case 135: return &quot;no_display&quot;;</span>
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :         case 136: return &quot;time_code&quot;;</span>
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :         case 137: return &quot;mastering_display_colour_volume&quot;;</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :         case 138: return &quot;segmented_rect_frame_packing_arrangement&quot;;</span>
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :         case 140: return &quot;temporal_motion_constrained_tile_sets&quot;;</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :         case 141: return &quot;knee_function_info&quot;;</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :         case 142: return &quot;colour_remapping_info&quot;;</span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :         case 143: return &quot;deinterlaced_field_identification&quot;;</span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :         case 144: return &quot;content_light_level_info&quot;;</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :         case 145: return &quot;dependent_rap_indication&quot;;</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :         case 146: return &quot;coded_region_completion&quot;;</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :         case 147: return &quot;alternative_transfer_characteristics&quot;;</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :         case 148: return &quot;ambient_viewing_environment&quot;;</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :         case 160: return &quot;layers_not_present&quot;;</span>
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :         case 161: return &quot;inter_layer_constrained_tile_sets&quot;;</span>
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :         case 162: return &quot;bsp_nesting&quot;;</span>
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :         case 163: return &quot;bsp_initial_arrival_time&quot;;</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :         case 164: return &quot;sub_bitstream_property&quot;;</span>
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :         case 165: return &quot;alpha_channel_info&quot;;</span>
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :         case 166: return &quot;overlay_info&quot;;</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :         case 167: return &quot;temporal_mv_prediction_constraints&quot;;</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :         case 168: return &quot;frame_field_info&quot;;</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :         case 176: return &quot;three_dimensional_reference_displays_info&quot;;</span>
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :         case 177: return &quot;depth_representation_info&quot;;</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :         case 178: return &quot;multiview_scene_info&quot;;</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :         case 179: return &quot;multiview_acquisition_info&quot;;</span>
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :         case 180: return &quot;multiview_view_position&quot;;</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :         case 181: return &quot;alternative_depth_info&quot;;</span>
<span class="lineNum">     269 </span>            :         }
<span class="lineNum">     270 </span>            :         return &quot;Unknown&quot;;
<span class="lineNum">     271 </span>            : }
<span class="lineNum">     272 </span>            : 
<span class="lineNum">     273 </span>            : typedef struct
<span class="lineNum">     274 </span>            : {
<span class="lineNum">     275 </span>            :         FILE *dump;
<span class="lineNum">     276 </span>            :         Bool dump_bits;
<a name="277"><span class="lineNum">     277 </span>            : } InspectLogCbk;</a>
<span class="lineNum">     278 </span>            : 
<span class="lineNum">     279 </span><span class="lineCov">      50475 : static void inspect_log_bs(Bool is_nalu, void *udta, const char *field_name, u32 nb_bits, u64 field_val, s32 idx1, s32 idx2, s32 idx3)</span>
<span class="lineNum">     280 </span>            : {
<span class="lineNum">     281 </span>            :         InspectLogCbk *cbk = (InspectLogCbk*)udta;
<span class="lineNum">     282 </span>            : 
<span class="lineNum">     283 </span><span class="lineCov">      50475 :         if (!nb_bits)</span>
<span class="lineNum">     284 </span>            :                 return;
<span class="lineNum">     285 </span>            : 
<span class="lineNum">     286 </span><span class="lineCov">      48215 :         if (is_nalu)</span>
<span class="lineNum">     287 </span><span class="lineCov">       2499 :                 gf_fprintf(cbk-&gt;dump, &quot;\&quot;&quot;);</span>
<span class="lineNum">     288 </span>            : 
<span class="lineNum">     289 </span><span class="lineCov">      48215 :         gf_fprintf(cbk-&gt;dump, &quot; %s&quot;, field_name);</span>
<span class="lineNum">     290 </span><span class="lineCov">      48215 :         if (idx1&gt;=0) {</span>
<span class="lineNum">     291 </span><span class="lineCov">       5750 :                 gf_fprintf(cbk-&gt;dump, &quot;_%d&quot;, idx1);</span>
<span class="lineNum">     292 </span><span class="lineCov">       5750 :                 if (idx2&gt;=0) {</span>
<span class="lineNum">     293 </span><span class="lineCov">         44 :                         gf_fprintf(cbk-&gt;dump, &quot;_%d&quot;, idx2);</span>
<span class="lineNum">     294 </span><span class="lineCov">         44 :                         if (idx3&gt;=0) {</span>
<span class="lineNum">     295 </span><span class="lineNoCov">          0 :                                 gf_fprintf(cbk-&gt;dump, &quot;_%d&quot;, idx3);</span>
<span class="lineNum">     296 </span>            :                         }
<span class="lineNum">     297 </span>            :                 }
<span class="lineNum">     298 </span>            :         }
<span class="lineNum">     299 </span><span class="lineCov">      48215 :         gf_fprintf(cbk-&gt;dump, &quot;=\&quot;&quot;LLD, field_val);</span>
<span class="lineNum">     300 </span><span class="lineCov">      48215 :         if (cbk-&gt;dump_bits &amp;&amp; ((s32) nb_bits &gt; 1) )</span>
<span class="lineNum">     301 </span><span class="lineCov">      27522 :                 gf_fprintf(cbk-&gt;dump, &quot;(%u)&quot;, nb_bits);</span>
<span class="lineNum">     302 </span>            : 
<span class="lineNum">     303 </span><span class="lineCov">      48215 :         if (!is_nalu)</span>
<span class="lineNum">     304 </span><span class="lineCov">      45716 :                 gf_fprintf(cbk-&gt;dump, &quot;\&quot;&quot;);</span>
<a name="305"><span class="lineNum">     305 </span>            : }</a>
<span class="lineNum">     306 </span>            : 
<span class="lineNum">     307 </span><span class="lineCov">       2499 : static void shifted_bs_log(void *udta, const char *field_name, u32 nb_bits, u64 field_val, s32 idx1, s32 idx2, s32 idx3)</span>
<span class="lineNum">     308 </span>            : {
<a name="309"><span class="lineNum">     309 </span><span class="lineCov">       2499 :         inspect_log_bs(GF_TRUE, udta, field_name, nb_bits, field_val, idx1, idx2, idx3);</span></a>
<span class="lineNum">     310 </span><span class="lineCov">       2499 : }</span>
<span class="lineNum">     311 </span><span class="lineCov">      47976 : static void regular_bs_log(void *udta, const char *field_name, u32 nb_bits, u64 field_val, s32 idx1, s32 idx2, s32 idx3)</span>
<span class="lineNum">     312 </span>            : {
<span class="lineNum">     313 </span><span class="lineCov">      47976 :         inspect_log_bs(GF_FALSE, udta, field_name, nb_bits, field_val, idx1, idx2, idx3);</span>
<span class="lineNum">     314 </span><span class="lineCov">      47976 : }</span>
<a name="315"><span class="lineNum">     315 </span>            : </a>
<span class="lineNum">     316 </span>            : 
<span class="lineNum">     317 </span><span class="lineCov">       1778 : static void dump_sei(FILE *dump, GF_BitStream *bs, Bool is_hevc)</span>
<span class="lineNum">     318 </span>            : {
<span class="lineNum">     319 </span>            :         u32 i;
<span class="lineNum">     320 </span><span class="lineCov">       1778 :         gf_bs_enable_emulation_byte_removal(bs, GF_TRUE);</span>
<span class="lineNum">     321 </span>            : 
<span class="lineNum">     322 </span>            :         //skip nal header
<span class="lineNum">     323 </span><span class="lineCov">       1778 :         gf_bs_read_int(bs, is_hevc ? 16 : 8);</span>
<span class="lineNum">     324 </span>            : 
<span class="lineNum">     325 </span><span class="lineCov">       3568 :         while (gf_bs_available(bs) ) {</span>
<span class="lineNum">     326 </span>            :                 u32 sei_type = 0;
<span class="lineNum">     327 </span>            :                 u32 sei_size = 0;
<span class="lineNum">     328 </span><span class="lineCov">       1790 :                 while (gf_bs_peek_bits(bs, 8, 0) == 0xFF) {</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :                         sei_type += 255;</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :                         gf_bs_read_int(bs, 8);</span>
<span class="lineNum">     331 </span>            :                 }
<span class="lineNum">     332 </span><span class="lineCov">       1790 :                 sei_type += gf_bs_read_int(bs, 8);</span>
<span class="lineNum">     333 </span><span class="lineCov">       3583 :                 while (gf_bs_peek_bits(bs, 8, 0) == 0xFF) {</span>
<span class="lineNum">     334 </span><span class="lineCov">          3 :                         sei_size += 255;</span>
<span class="lineNum">     335 </span><span class="lineCov">          3 :                         gf_bs_read_int(bs, 8);</span>
<span class="lineNum">     336 </span>            :                 }
<span class="lineNum">     337 </span><span class="lineCov">       1790 :                 sei_size += gf_bs_read_int(bs, 8);</span>
<span class="lineNum">     338 </span>            :                 i=0;
<span class="lineNum">     339 </span><span class="lineCov">      46388 :                 while (i &lt; sei_size) {</span>
<span class="lineNum">     340 </span><span class="lineCov">      42808 :                         gf_bs_read_u8(bs);</span>
<span class="lineNum">     341 </span><span class="lineCov">      42808 :                         i++;</span>
<span class="lineNum">     342 </span>            :                 }
<span class="lineNum">     343 </span>            : 
<span class="lineNum">     344 </span><span class="lineCov">       1790 :                 gf_fprintf(dump, &quot;    &lt;SEIMessage ptype=\&quot;%u\&quot; psize=\&quot;%u\&quot; type=\&quot;%s\&quot;/&gt;\n&quot;, sei_type, sei_size, get_sei_name(sei_type, is_hevc) );</span>
<span class="lineNum">     345 </span><span class="lineCov">       1790 :                 if (gf_bs_peek_bits(bs, 8, 0) == 0x80) {</span>
<span class="lineNum">     346 </span>            :                         break;
<span class="lineNum">     347 </span>            :                 }
<span class="lineNum">     348 </span>            :         }
<span class="lineNum">     349 </span><span class="lineCov">       1778 : }</span>
<a name="350"><span class="lineNum">     350 </span>            : </a>
<span class="lineNum">     351 </span>            : 
<span class="lineNum">     352 </span><span class="lineCov">      12529 : static void gf_inspect_dump_nalu_internal(FILE *dump, u8 *ptr, u32 ptr_size, Bool is_svc, HEVCState *hevc, AVCState *avc, VVCState *vvc, u32 nalh_size, Bool dump_crc, Bool is_encrypted, u32 full_bs_dump, PidCtx *pctx)</span>
<span class="lineNum">     353 </span>            : {
<span class="lineNum">     354 </span>            :         s32 res = 0;
<span class="lineNum">     355 </span>            :         u8 type, nal_ref_idc;
<span class="lineNum">     356 </span>            :         u8 dependency_id, quality_id, temporal_id;
<span class="lineNum">     357 </span>            :         u8 track_ref_index;
<span class="lineNum">     358 </span>            :         s8 sample_offset;
<span class="lineNum">     359 </span>            :         u32 data_offset, data_size;
<span class="lineNum">     360 </span>            :         s32 idx;
<span class="lineNum">     361 </span>            :         InspectLogCbk lcbk;
<span class="lineNum">     362 </span>            :         GF_BitStream *bs = NULL;
<span class="lineNum">     363 </span>            : 
<span class="lineNum">     364 </span>            : 
<span class="lineNum">     365 </span><span class="lineCov">      12529 :         if (full_bs_dump&lt;INSPECT_ANALYZE_BS)</span>
<span class="lineNum">     366 </span>            :                 full_bs_dump = 0;
<span class="lineNum">     367 </span>            :         else {
<span class="lineNum">     368 </span><span class="lineCov">       2723 :                 lcbk.dump = dump;</span>
<span class="lineNum">     369 </span><span class="lineCov">       2723 :                 lcbk.dump_bits = full_bs_dump==INSPECT_ANALYZE_BS_BITS ? GF_TRUE : GF_FALSE;</span>
<span class="lineNum">     370 </span>            :         }
<span class="lineNum">     371 </span>            : 
<span class="lineNum">     372 </span><span class="lineCov">      12529 :         if (!ptr_size) {</span>
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;error=\&quot;invalid nal size 0\&quot;/&gt;\n&quot;);</span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">     375 </span>            :         }
<span class="lineNum">     376 </span>            : 
<span class="lineNum">     377 </span><span class="lineCov">      12529 :         if (dump_crc) gf_fprintf(dump, &quot;crc=\&quot;%u\&quot; &quot;, gf_crc_32(ptr, ptr_size) );</span>
<span class="lineNum">     378 </span>            : 
<span class="lineNum">     379 </span><span class="lineCov">      12529 :         if (hevc) {</span>
<span class="lineNum">     380 </span>            : #ifndef GPAC_DISABLE_HEVC
<span class="lineNum">     381 </span>            : 
<span class="lineNum">     382 </span><span class="lineCov">       9126 :                 if (ptr_size==1) {</span>
<span class="lineNum">     383 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;error=\&quot;invalid nal size 1\&quot;/&gt;\n&quot;);</span>
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">     385 </span>            :                 }
<span class="lineNum">     386 </span>            : 
<span class="lineNum">     387 </span><span class="lineCov">       9126 :                 if (full_bs_dump) {</span>
<span class="lineNum">     388 </span><span class="lineCov">       2545 :                         if (pctx) {</span>
<span class="lineNum">     389 </span><span class="lineCov">       2545 :                                 if (!pctx-&gt;bs)</span>
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :                                         pctx-&gt;bs = gf_bs_new(ptr, ptr_size, GF_BITSTREAM_READ);</span>
<span class="lineNum">     391 </span>            :                                 else
<span class="lineNum">     392 </span><span class="lineCov">       2545 :                                         gf_bs_reassign_buffer(pctx-&gt;bs, ptr, ptr_size);</span>
<span class="lineNum">     393 </span><span class="lineCov">       2545 :                                 bs = pctx-&gt;bs;</span>
<span class="lineNum">     394 </span>            :                         } else {
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :                                 bs = gf_bs_new(ptr, ptr_size, GF_BITSTREAM_READ);</span>
<span class="lineNum">     396 </span>            :                         }
<span class="lineNum">     397 </span><span class="lineCov">       2545 :                         gf_bs_set_logger(bs, regular_bs_log, &amp;lcbk);</span>
<span class="lineNum">     398 </span><span class="lineCov">       2545 :                         res = gf_hevc_parse_nalu_bs(bs, hevc, &amp;type, &amp;temporal_id, &amp;quality_id);</span>
<span class="lineNum">     399 </span>            :                 } else {
<span class="lineNum">     400 </span>            :                         bs = NULL;
<span class="lineNum">     401 </span><span class="lineCov">       6581 :                         res = gf_hevc_parse_nalu(ptr, ptr_size, hevc, &amp;type, &amp;temporal_id, &amp;quality_id);</span>
<span class="lineNum">     402 </span><span class="lineCov">       6581 :                         gf_fprintf(dump, &quot;code=\&quot;%d\&quot;&quot;, type);</span>
<span class="lineNum">     403 </span>            :                 }
<span class="lineNum">     404 </span>            : 
<span class="lineNum">     405 </span><span class="lineCov">       9126 :                 if (res==-1) {</span>
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; status=\&quot;error parsing\&quot;&quot;, type);</span>
<span class="lineNum">     407 </span>            :                 }
<span class="lineNum">     408 </span><span class="lineCov">       9126 :                 gf_fprintf(dump, &quot; type=\&quot;&quot;, type);</span>
<span class="lineNum">     409 </span>            : 
<span class="lineNum">     410 </span><span class="lineCov">       9126 :                 switch (type) {</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_SLICE_TRAIL_N:</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;TRAIL_N slice segment&quot;, dump);</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     414 </span><span class="lineCov">       6483 :                 case GF_HEVC_NALU_SLICE_TRAIL_R:</span>
<span class="lineNum">     415 </span><span class="lineCov">       6483 :                         gf_fputs(&quot;TRAIL_R slice segment&quot;, dump);</span>
<span class="lineNum">     416 </span><span class="lineCov">       6483 :                         break;</span>
<span class="lineNum">     417 </span><span class="lineCov">        368 :                 case GF_HEVC_NALU_SLICE_TSA_N:</span>
<span class="lineNum">     418 </span><span class="lineCov">        368 :                         gf_fputs(&quot;TSA_N slice segment&quot;, dump);</span>
<span class="lineNum">     419 </span><span class="lineCov">        368 :                         break;</span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_SLICE_TSA_R:</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;TSA_R slice segment&quot;, dump);</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_SLICE_STSA_N:</span>
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;STSA_N slice segment&quot;, dump);</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     426 </span><span class="lineCov">         53 :                 case GF_HEVC_NALU_SLICE_STSA_R:</span>
<span class="lineNum">     427 </span><span class="lineCov">         53 :                         gf_fputs(&quot;STSA_R slice segment&quot;, dump);</span>
<span class="lineNum">     428 </span><span class="lineCov">         53 :                         break;</span>
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_SLICE_RADL_N:</span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;RADL_N slice segment&quot;, dump);</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_SLICE_RADL_R:</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;RADL_R slice segment&quot;, dump);</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     435 </span><span class="lineCov">         70 :                 case GF_HEVC_NALU_SLICE_RASL_N:</span>
<span class="lineNum">     436 </span><span class="lineCov">         70 :                         gf_fputs(&quot;RASL_N slice segment&quot;, dump);</span>
<span class="lineNum">     437 </span><span class="lineCov">         70 :                         break;</span>
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_SLICE_RASL_R:</span>
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;RASL_R slice segment&quot;, dump);</span>
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_SLICE_BLA_W_LP:</span>
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;Broken link access slice (W LP)&quot;, dump);</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_SLICE_BLA_W_DLP:</span>
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;Broken link access slice (W DLP)&quot;, dump);</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_SLICE_BLA_N_LP:</span>
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;Broken link access slice (N LP)&quot;, dump);</span>
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     450 </span><span class="lineCov">        299 :                 case GF_HEVC_NALU_SLICE_IDR_W_DLP:</span>
<span class="lineNum">     451 </span><span class="lineCov">        299 :                         gf_fputs(&quot;IDR slice (W DLP)&quot;, dump);</span>
<span class="lineNum">     452 </span><span class="lineCov">        299 :                         break;</span>
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_SLICE_IDR_N_LP:</span>
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;IDR slice (N LP)&quot;, dump);</span>
<span class="lineNum">     455 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     456 </span><span class="lineCov">         10 :                 case GF_HEVC_NALU_SLICE_CRA:</span>
<span class="lineNum">     457 </span><span class="lineCov">         10 :                         gf_fputs(&quot;CRA slice&quot;, dump);</span>
<span class="lineNum">     458 </span><span class="lineCov">         10 :                         break;</span>
<span class="lineNum">     459 </span>            : 
<span class="lineNum">     460 </span><span class="lineCov">         25 :                 case GF_HEVC_NALU_VID_PARAM:</span>
<span class="lineNum">     461 </span><span class="lineCov">         25 :                         gf_fputs(&quot;Video Parameter Set&quot;, dump);</span>
<span class="lineNum">     462 </span><span class="lineCov">         25 :                         if (full_bs_dump) break;</span>
<span class="lineNum">     463 </span><span class="lineCov">         14 :                         idx = gf_hevc_read_vps(ptr, ptr_size, hevc);</span>
<span class="lineNum">     464 </span><span class="lineCov">         14 :                         if (idx&lt;0) gf_fprintf(dump, &quot;\&quot; vps_id=\&quot;PARSING FAILURE&quot;);</span>
<span class="lineNum">     465 </span><span class="lineCov">         14 :                         else gf_fprintf(dump, &quot;\&quot; vps_id=\&quot;%d&quot;, idx);</span>
<span class="lineNum">     466 </span>            :                         break;
<span class="lineNum">     467 </span><span class="lineCov">         26 :                 case GF_HEVC_NALU_SEQ_PARAM:</span>
<span class="lineNum">     468 </span><span class="lineCov">         26 :                         gf_fputs(&quot;Sequence Parameter Set&quot;, dump);</span>
<span class="lineNum">     469 </span><span class="lineCov">         26 :                         if (full_bs_dump) break;</span>
<span class="lineNum">     470 </span><span class="lineCov">         15 :                         idx = gf_hevc_read_sps(ptr, ptr_size, hevc);</span>
<span class="lineNum">     471 </span><span class="lineCov">         15 :                         if (idx&lt;0) {</span>
<span class="lineNum">     472 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; sps_id=\&quot;PARSING FAILURE&quot;);</span>
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">     474 </span>            :                         }
<span class="lineNum">     475 </span>            :                         {
<span class="lineNum">     476 </span>            :                         HEVC_SPS *sps= &amp;hevc-&gt;sps[idx];
<span class="lineNum">     477 </span><span class="lineCov">         15 :                         gf_fprintf(dump, &quot;\&quot; sps_id=\&quot;%d&quot;, idx);</span>
<span class="lineNum">     478 </span><span class="lineCov">         15 :                         if (gf_sys_is_test_mode()) break;</span>
<span class="lineNum">     479 </span>            : 
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; aspect_ratio_info_present_flag=\&quot;%d&quot;, sps-&gt;aspect_ratio_info_present_flag);</span>
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; bit_depth_chroma=\&quot;%d&quot;, sps-&gt;bit_depth_chroma);</span>
<span class="lineNum">     482 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; bit_depth_luma=\&quot;%d&quot;, sps-&gt;bit_depth_luma);</span>
<span class="lineNum">     483 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; chroma_format_idc=\&quot;%d&quot;, sps-&gt;chroma_format_idc);</span>
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; colour_description_present_flag=\&quot;%d&quot;, sps-&gt;colour_description_present_flag);</span>
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; colour_primaries=\&quot;%d&quot;, sps-&gt;colour_primaries);</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; cw_flag=\&quot;%d&quot;, sps-&gt;cw_flag);</span>
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :                         if (sps-&gt;cw_flag) {</span>
<span class="lineNum">     488 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; cw_bottom=\&quot;%d&quot;, sps-&gt;cw_bottom);</span>
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; cw_top=\&quot;%d&quot;, sps-&gt;cw_top);</span>
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; cw_left=\&quot;%d&quot;, sps-&gt;cw_left);</span>
<span class="lineNum">     491 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; cw_right=\&quot;%d&quot;, sps-&gt;cw_right);</span>
<span class="lineNum">     492 </span>            :                         }
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; height=\&quot;%d&quot;, sps-&gt;height);</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; width=\&quot;%d&quot;, sps-&gt;width);</span>
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; log2_max_pic_order_cnt_lsb=\&quot;%d&quot;, sps-&gt;log2_max_pic_order_cnt_lsb);</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; long_term_ref_pics_present_flag=\&quot;%d&quot;, sps-&gt;long_term_ref_pics_present_flag);</span>
<span class="lineNum">     497 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; matrix_coeffs=\&quot;%d&quot;, sps-&gt;matrix_coeffs);</span>
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; max_CU_depth=\&quot;%d&quot;, sps-&gt;max_CU_depth);</span>
<span class="lineNum">     499 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; max_CU_width=\&quot;%d&quot;, sps-&gt;max_CU_width);</span>
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; max_CU_height=\&quot;%d&quot;, sps-&gt;max_CU_height);</span>
<span class="lineNum">     501 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; num_long_term_ref_pic_sps=\&quot;%d&quot;, sps-&gt;num_long_term_ref_pic_sps);</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; num_short_term_ref_pic_sets=\&quot;%d&quot;, sps-&gt;num_short_term_ref_pic_sets);</span>
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; has_timing_info=\&quot;%d&quot;, sps-&gt;has_timing_info);</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :                         if (sps-&gt;has_timing_info) {</span>
<span class="lineNum">     505 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; time_scale=\&quot;%d&quot;, sps-&gt;time_scale);</span>
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; num_ticks_poc_diff_one_minus1=\&quot;%d&quot;, sps-&gt;num_ticks_poc_diff_one_minus1);</span>
<span class="lineNum">     507 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; num_units_in_tick=\&quot;%d&quot;, sps-&gt;num_units_in_tick);</span>
<span class="lineNum">     508 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; poc_proportional_to_timing_flag=\&quot;%d&quot;, sps-&gt;poc_proportional_to_timing_flag);</span>
<span class="lineNum">     509 </span>            :                         }
<span class="lineNum">     510 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; rep_format_idx=\&quot;%d&quot;, sps-&gt;rep_format_idx);</span>
<span class="lineNum">     511 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; sample_adaptive_offset_enabled_flag=\&quot;%d&quot;, sps-&gt;sample_adaptive_offset_enabled_flag);</span>
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; sar_idc=\&quot;%d&quot;, sps-&gt;sar_idc);</span>
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; separate_colour_plane_flag=\&quot;%d&quot;, sps-&gt;separate_colour_plane_flag);</span>
<span class="lineNum">     514 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; temporal_mvp_enable_flag=\&quot;%d&quot;, sps-&gt;temporal_mvp_enable_flag);</span>
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; transfer_characteristic=\&quot;%d&quot;, sps-&gt;transfer_characteristic);</span>
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; video_full_range_flag=\&quot;%d&quot;, sps-&gt;video_full_range_flag);</span>
<span class="lineNum">     517 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; sps_ext_or_max_sub_layers_minus1=\&quot;%d&quot;, sps-&gt;sps_ext_or_max_sub_layers_minus1);</span>
<span class="lineNum">     518 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; max_sub_layers_minus1=\&quot;%d&quot;, sps-&gt;max_sub_layers_minus1);</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; update_rep_format_flag=\&quot;%d&quot;, sps-&gt;update_rep_format_flag);</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; sub_layer_ordering_info_present_flag=\&quot;%d&quot;, sps-&gt;sub_layer_ordering_info_present_flag);</span>
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; scaling_list_enable_flag=\&quot;%d&quot;, sps-&gt;scaling_list_enable_flag);</span>
<span class="lineNum">     522 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; infer_scaling_list_flag=\&quot;%d&quot;, sps-&gt;infer_scaling_list_flag);</span>
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; scaling_list_ref_layer_id=\&quot;%d&quot;, sps-&gt;scaling_list_ref_layer_id);</span>
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; scaling_list_data_present_flag=\&quot;%d&quot;, sps-&gt;scaling_list_data_present_flag);</span>
<span class="lineNum">     525 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; asymmetric_motion_partitions_enabled_flag=\&quot;%d&quot;, sps-&gt;asymmetric_motion_partitions_enabled_flag);</span>
<span class="lineNum">     526 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; pcm_enabled_flag=\&quot;%d&quot;, sps-&gt;pcm_enabled_flag);</span>
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; strong_intra_smoothing_enable_flag=\&quot;%d&quot;, sps-&gt;strong_intra_smoothing_enable_flag);</span>
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; vui_parameters_present_flag=\&quot;%d&quot;, sps-&gt;vui_parameters_present_flag);</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; log2_diff_max_min_luma_coding_block_size=\&quot;%d&quot;, sps-&gt;log2_diff_max_min_luma_coding_block_size);</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; log2_min_transform_block_size=\&quot;%d&quot;, sps-&gt;log2_min_transform_block_size);</span>
<span class="lineNum">     531 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; log2_min_luma_coding_block_size=\&quot;%d&quot;, sps-&gt;log2_min_luma_coding_block_size);</span>
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; log2_max_transform_block_size=\&quot;%d&quot;, sps-&gt;log2_max_transform_block_size);</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; max_transform_hierarchy_depth_inter=\&quot;%d&quot;, sps-&gt;max_transform_hierarchy_depth_inter);</span>
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; max_transform_hierarchy_depth_intra=\&quot;%d&quot;, sps-&gt;max_transform_hierarchy_depth_intra);</span>
<span class="lineNum">     535 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; pcm_sample_bit_depth_luma_minus1=\&quot;%d&quot;, sps-&gt;pcm_sample_bit_depth_luma_minus1);</span>
<span class="lineNum">     536 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; pcm_sample_bit_depth_chroma_minus1=\&quot;%d&quot;, sps-&gt;pcm_sample_bit_depth_chroma_minus1);</span>
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; pcm_loop_filter_disable_flag=\&quot;%d&quot;, sps-&gt;pcm_loop_filter_disable_flag);</span>
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; log2_min_pcm_luma_coding_block_size_minus3=\&quot;%d&quot;, sps-&gt;log2_min_pcm_luma_coding_block_size_minus3);</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; log2_diff_max_min_pcm_luma_coding_block_size=\&quot;%d&quot;, sps-&gt;log2_diff_max_min_pcm_luma_coding_block_size);</span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; overscan_info_present=\&quot;%d&quot;, sps-&gt;overscan_info_present);</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; overscan_appropriate=\&quot;%d&quot;, sps-&gt;overscan_appropriate);</span>
<span class="lineNum">     542 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; video_signal_type_present_flag=\&quot;%d&quot;, sps-&gt;video_signal_type_present_flag);</span>
<span class="lineNum">     543 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; video_format=\&quot;%d&quot;, sps-&gt;video_format);</span>
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; chroma_loc_info_present_flag=\&quot;%d&quot;, sps-&gt;chroma_loc_info_present_flag);</span>
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; chroma_sample_loc_type_top_field=\&quot;%d&quot;, sps-&gt;chroma_sample_loc_type_top_field);</span>
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; chroma_sample_loc_type_bottom_field=\&quot;%d&quot;, sps-&gt;chroma_sample_loc_type_bottom_field);</span>
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; neutra_chroma_indication_flag=\&quot;%d&quot;, sps-&gt;neutra_chroma_indication_flag);</span>
<span class="lineNum">     548 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; field_seq_flag=\&quot;%d&quot;, sps-&gt;field_seq_flag);</span>
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; frame_field_info_present_flag=\&quot;%d&quot;, sps-&gt;frame_field_info_present_flag);</span>
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; default_display_window_flag=\&quot;%d&quot;, sps-&gt;default_display_window_flag);</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; left_offset=\&quot;%d&quot;, sps-&gt;left_offset);</span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; right_offset=\&quot;%d&quot;, sps-&gt;right_offset);</span>
<span class="lineNum">     553 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; top_offset=\&quot;%d&quot;, sps-&gt;top_offset);</span>
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; bottom_offset=\&quot;%d&quot;, sps-&gt;bottom_offset);</span>
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; hrd_parameters_present_flag=\&quot;%d&quot;, sps-&gt;hrd_parameters_present_flag);</span>
<span class="lineNum">     556 </span>            :                         }
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     558 </span><span class="lineCov">         26 :                 case GF_HEVC_NALU_PIC_PARAM:</span>
<span class="lineNum">     559 </span><span class="lineCov">         26 :                         gf_fputs(&quot;Picture Parameter Set&quot;, dump);</span>
<span class="lineNum">     560 </span><span class="lineCov">         26 :                         if (full_bs_dump) break;</span>
<span class="lineNum">     561 </span><span class="lineCov">         15 :                         idx = gf_hevc_read_pps(ptr, ptr_size, hevc);</span>
<span class="lineNum">     562 </span><span class="lineCov">         15 :                         if (idx&lt;0) {</span>
<span class="lineNum">     563 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; pps_id=\&quot;PARSING FAILURE&quot;);</span>
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">     565 </span>            :                         }
<span class="lineNum">     566 </span>            :                         {
<span class="lineNum">     567 </span>            :                         HEVC_PPS *pps= &amp;hevc-&gt;pps[idx];
<span class="lineNum">     568 </span><span class="lineCov">         15 :                         gf_fprintf(dump, &quot;\&quot; pps_id=\&quot;%d&quot;, idx);</span>
<span class="lineNum">     569 </span>            : 
<span class="lineNum">     570 </span><span class="lineCov">         15 :                         if (gf_sys_is_test_mode()) break;</span>
<span class="lineNum">     571 </span>            : 
<span class="lineNum">     572 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; cabac_init_present_flag=\&quot;%d&quot;, pps-&gt;cabac_init_present_flag);</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; dependent_slice_segments_enabled_flag=\&quot;%d&quot;, pps-&gt;dependent_slice_segments_enabled_flag);</span>
<span class="lineNum">     574 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; entropy_coding_sync_enabled_flag=\&quot;%d&quot;, pps-&gt;entropy_coding_sync_enabled_flag);</span>
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; lists_modification_present_flag=\&quot;%d&quot;, pps-&gt;lists_modification_present_flag);</span>
<span class="lineNum">     576 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; loop_filter_across_slices_enabled_flag=\&quot;%d&quot;, pps-&gt;loop_filter_across_slices_enabled_flag);</span>
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; loop_filter_across_tiles_enabled_flag=\&quot;%d&quot;, pps-&gt;loop_filter_across_tiles_enabled_flag);</span>
<span class="lineNum">     578 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; num_extra_slice_header_bits=\&quot;%d&quot;, pps-&gt;num_extra_slice_header_bits);</span>
<span class="lineNum">     579 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; num_ref_idx_l0_default_active=\&quot;%d&quot;, pps-&gt;num_ref_idx_l0_default_active);</span>
<span class="lineNum">     580 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; num_ref_idx_l1_default_active=\&quot;%d&quot;, pps-&gt;num_ref_idx_l1_default_active);</span>
<span class="lineNum">     581 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; tiles_enabled_flag=\&quot;%d&quot;, pps-&gt;tiles_enabled_flag);</span>
<span class="lineNum">     582 </span><span class="lineNoCov">          0 :                         if (pps-&gt;tiles_enabled_flag) {</span>
<span class="lineNum">     583 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; uniform_spacing_flag=\&quot;%d&quot;, pps-&gt;uniform_spacing_flag);</span>
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :                                 if (!pps-&gt;uniform_spacing_flag) {</span>
<span class="lineNum">     585 </span>            :                                         u32 k;
<span class="lineNum">     586 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;\&quot; num_tile_columns=\&quot;%d&quot;, pps-&gt;num_tile_columns);</span>
<span class="lineNum">     587 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;\&quot; num_tile_rows=\&quot;%d&quot;, pps-&gt;num_tile_rows);</span>
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;\&quot; colomns_width=\&quot;&quot;);</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :                                         for (k=0; k&lt;pps-&gt;num_tile_columns-1; k++)</span>
<span class="lineNum">     590 </span><span class="lineNoCov">          0 :                                                 gf_fprintf(dump, &quot;%d &quot;, pps-&gt;column_width[k]);</span>
<span class="lineNum">     591 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;\&quot; rows_height=\&quot;&quot;);</span>
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :                                         for (k=0; k&lt;pps-&gt;num_tile_rows-1; k++)</span>
<span class="lineNum">     593 </span><span class="lineNoCov">          0 :                                                 gf_fprintf(dump, &quot;%d &quot;, pps-&gt;row_height[k]);</span>
<span class="lineNum">     594 </span>            :                                 }
<span class="lineNum">     595 </span>            :                         }
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; output_flag_present_flag=\&quot;%d&quot;, pps-&gt;output_flag_present_flag);</span>
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; pic_init_qp_minus26=\&quot;%d&quot;, pps-&gt;pic_init_qp_minus26);</span>
<span class="lineNum">     598 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; slice_chroma_qp_offsets_present_flag=\&quot;%d&quot;, pps-&gt;slice_chroma_qp_offsets_present_flag);</span>
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; slice_segment_header_extension_present_flag=\&quot;%d&quot;, pps-&gt;slice_segment_header_extension_present_flag);</span>
<span class="lineNum">     600 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; weighted_pred_flag=\&quot;%d&quot;, pps-&gt;weighted_pred_flag);</span>
<span class="lineNum">     601 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; weighted_bipred_flag=\&quot;%d&quot;, pps-&gt;weighted_bipred_flag);</span>
<span class="lineNum">     602 </span>            : 
<span class="lineNum">     603 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; sign_data_hiding_flag=\&quot;%d&quot;, pps-&gt;sign_data_hiding_flag);</span>
<span class="lineNum">     604 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; constrained_intra_pred_flag=\&quot;%d&quot;, pps-&gt;constrained_intra_pred_flag);</span>
<span class="lineNum">     605 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; transform_skip_enabled_flag=\&quot;%d&quot;, pps-&gt;transform_skip_enabled_flag);</span>
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; cu_qp_delta_enabled_flag=\&quot;%d&quot;, pps-&gt;cu_qp_delta_enabled_flag);</span>
<span class="lineNum">     607 </span><span class="lineNoCov">          0 :                         if (pps-&gt;cu_qp_delta_enabled_flag)</span>
<span class="lineNum">     608 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; diff_cu_qp_delta_depth=\&quot;%d&quot;, pps-&gt;diff_cu_qp_delta_depth);</span>
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; transquant_bypass_enable_flag=\&quot;%d&quot;, pps-&gt;transquant_bypass_enable_flag);</span>
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; pic_cb_qp_offset=\&quot;%d&quot;, pps-&gt;pic_cb_qp_offset);</span>
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; pic_cr_qp_offset=\&quot;%d&quot;, pps-&gt;pic_cr_qp_offset);</span>
<span class="lineNum">     612 </span>            : 
<span class="lineNum">     613 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; deblocking_filter_control_present_flag=\&quot;%d&quot;, pps-&gt;deblocking_filter_control_present_flag);</span>
<span class="lineNum">     614 </span><span class="lineNoCov">          0 :                         if (pps-&gt;deblocking_filter_control_present_flag) {</span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; deblocking_filter_override_enabled_flag=\&quot;%d&quot;, pps-&gt;deblocking_filter_override_enabled_flag);</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; pic_disable_deblocking_filter_flag=\&quot;%d&quot;, pps-&gt;pic_disable_deblocking_filter_flag);</span>
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; beta_offset_div2=\&quot;%d&quot;, pps-&gt;beta_offset_div2);</span>
<span class="lineNum">     618 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; tc_offset_div2=\&quot;%d&quot;, pps-&gt;tc_offset_div2);</span>
<span class="lineNum">     619 </span>            :                         }
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; pic_scaling_list_data_present_flag=\&quot;%d&quot;, pps-&gt;pic_scaling_list_data_present_flag);</span>
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; log2_parallel_merge_level_minus2=\&quot;%d&quot;, pps-&gt;log2_parallel_merge_level_minus2);</span>
<span class="lineNum">     622 </span>            :                         }
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     624 </span><span class="lineCov">          1 :                 case GF_HEVC_NALU_ACCESS_UNIT:</span>
<span class="lineNum">     625 </span><span class="lineCov">          1 :                         gf_fputs(&quot;AU Delimiter&quot;, dump);</span>
<span class="lineNum">     626 </span><span class="lineCov">          1 :                         gf_fprintf(dump, &quot;\&quot; primary_pic_type=\&quot;%d&quot;, ptr[2] &gt;&gt; 5);</span>
<span class="lineNum">     627 </span><span class="lineCov">          1 :                         break;</span>
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_END_OF_SEQ:</span>
<span class="lineNum">     629 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;End of Sequence&quot;, dump);</span>
<span class="lineNum">     630 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_END_OF_STREAM:</span>
<span class="lineNum">     632 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;End of Stream&quot;, dump);</span>
<span class="lineNum">     633 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :                 case GF_HEVC_NALU_FILLER_DATA:</span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;Filler Data&quot;, dump);</span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     637 </span><span class="lineCov">          6 :                 case GF_HEVC_NALU_SEI_PREFIX:</span>
<span class="lineNum">     638 </span><span class="lineCov">          6 :                         gf_fputs(&quot;SEI Prefix&quot;, dump);</span>
<span class="lineNum">     639 </span><span class="lineCov">          6 :                         break;</span>
<span class="lineNum">     640 </span><span class="lineCov">       1256 :                 case GF_HEVC_NALU_SEI_SUFFIX:</span>
<span class="lineNum">     641 </span><span class="lineCov">       1256 :                         gf_fputs(&quot;SEI Suffix&quot;, dump);</span>
<span class="lineNum">     642 </span><span class="lineCov">       1256 :                         break;</span>
<span class="lineNum">     643 </span><span class="lineNoCov">          0 :                 case 48:</span>
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :                         gf_fputs(&quot;HEVCAggregator&quot;, dump);</span>
<span class="lineNum">     645 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     646 </span><span class="lineCov">        502 :                 case 49:</span>
<span class="lineNum">     647 </span>            :                 {
<span class="lineNum">     648 </span><span class="lineCov">        502 :                         u32 remain = ptr_size-2;</span>
<span class="lineNum">     649 </span><span class="lineCov">        502 :                         char *s = ptr+2;</span>
<span class="lineNum">     650 </span>            : 
<span class="lineNum">     651 </span><span class="lineCov">        502 :                         gf_fputs(&quot;HEVCExtractor &quot;, dump);</span>
<span class="lineNum">     652 </span>            : 
<span class="lineNum">     653 </span><span class="lineCov">       1506 :                         while (remain) {</span>
<span class="lineNum">     654 </span><span class="lineCov">        502 :                                 u32 mode = s[0];</span>
<span class="lineNum">     655 </span><span class="lineCov">        502 :                                 remain -= 1;</span>
<span class="lineNum">     656 </span><span class="lineCov">        502 :                                 s += 1;</span>
<span class="lineNum">     657 </span><span class="lineCov">        502 :                                 if (mode) {</span>
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :                                         u32 len = s[0];</span>
<span class="lineNum">     659 </span><span class="lineNoCov">          0 :                                         if (len+1&gt;remain) {</span>
<span class="lineNum">     660 </span><span class="lineNoCov">          0 :                                                 gf_fprintf(dump, &quot;error=\&quot;invalid inband data extractor size: %d vs %d remaining\&quot;/&gt;\n&quot;, len, remain);</span>
<span class="lineNum">     661 </span><span class="lineNoCov">          0 :                                                 return;</span>
<span class="lineNum">     662 </span>            :                                         }
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :                                         remain -= len+1;</span>
<span class="lineNum">     664 </span><span class="lineNoCov">          0 :                                         s += len+1;</span>
<span class="lineNum">     665 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;\&quot; inband_size=\&quot;%d&quot;, len);</span>
<span class="lineNum">     666 </span>            :                                 } else {
<span class="lineNum">     667 </span><span class="lineCov">        502 :                                         if (remain &lt; 2 + 2*nalh_size) {</span>
<span class="lineNum">     668 </span><span class="lineNoCov">          0 :                                                 gf_fprintf(dump, &quot;error=\&quot;invalid ref data extractor size: %d vs %d remaining\&quot;/&gt;\n&quot;, 2 + 2*nalh_size, remain);</span>
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :                                                 return;</span>
<span class="lineNum">     670 </span>            :                                         }
<span class="lineNum">     671 </span><span class="lineCov">        502 :                                         track_ref_index = (u8) s[0];</span>
<span class="lineNum">     672 </span><span class="lineCov">        502 :                                         sample_offset = (s8) s[1];</span>
<span class="lineNum">     673 </span><span class="lineCov">        502 :                                         data_offset = inspect_get_nal_size(&amp;s[2], nalh_size);</span>
<span class="lineNum">     674 </span><span class="lineCov">        502 :                                         data_size = inspect_get_nal_size(&amp;s[2+nalh_size], nalh_size);</span>
<span class="lineNum">     675 </span><span class="lineCov">        502 :                                         gf_fprintf(dump, &quot;\&quot; track_ref_index=\&quot;%d\&quot; sample_offset=\&quot;%d\&quot; data_offset=\&quot;%d\&quot; data_size=\&quot;%d&quot;, track_ref_index, sample_offset, data_offset, data_size);</span>
<span class="lineNum">     676 </span>            : 
<span class="lineNum">     677 </span><span class="lineCov">        502 :                                         remain -= 2 + 2*nalh_size;</span>
<span class="lineNum">     678 </span><span class="lineCov">        502 :                                         s += 2 + 2*nalh_size;</span>
<span class="lineNum">     679 </span>            :                                 }
<span class="lineNum">     680 </span>            :                         }
<span class="lineNum">     681 </span>            :                 }
<span class="lineNum">     682 </span>            :                         break;
<span class="lineNum">     683 </span><span class="lineCov">          1 :                 default:</span>
<span class="lineNum">     684 </span><span class="lineCov">          1 :                         gf_fprintf(dump, &quot;UNKNOWN (parsing return %d)&quot;, res);</span>
<span class="lineNum">     685 </span><span class="lineCov">          1 :                         break;</span>
<span class="lineNum">     686 </span>            :                 }
<span class="lineNum">     687 </span><span class="lineCov">       9189 :                 gf_fputs(&quot;\&quot;&quot;, dump);</span>
<span class="lineNum">     688 </span>            : 
<span class="lineNum">     689 </span><span class="lineCov">       9126 :                 if (!full_bs_dump &amp;&amp; (type &lt; GF_HEVC_NALU_VID_PARAM)) {</span>
<span class="lineNum">     690 </span><span class="lineCov">       5023 :                         gf_fprintf(dump, &quot; slice=\&quot;%s\&quot; poc=\&quot;%d\&quot;&quot;, (hevc-&gt;s_info.slice_type==GF_HEVC_SLICE_TYPE_I) ? &quot;I&quot; : (hevc-&gt;s_info.slice_type==GF_HEVC_SLICE_TYPE_P) ? &quot;P&quot; : (hevc-&gt;s_info.slice_type==GF_HEVC_SLICE_TYPE_B) ? &quot;B&quot; : &quot;Unknown&quot;, hevc-&gt;s_info.poc);</span>
<span class="lineNum">     691 </span><span class="lineCov">       5023 :                         gf_fprintf(dump, &quot; first_slice_in_pic=\&quot;%d\&quot;&quot;, hevc-&gt;s_info.first_slice_segment_in_pic_flag);</span>
<span class="lineNum">     692 </span><span class="lineCov">       5023 :                         gf_fprintf(dump, &quot; dependent_slice_segment=\&quot;%d\&quot;&quot;, hevc-&gt;s_info.dependent_slice_segment_flag);</span>
<span class="lineNum">     693 </span>            : 
<span class="lineNum">     694 </span><span class="lineCov">       5023 :                         if (!gf_sys_is_test_mode()) {</span>
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; redundant_pic_cnt=\&quot;%d\&quot;&quot;, hevc-&gt;s_info.redundant_pic_cnt);</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; slice_qp_delta=\&quot;%d\&quot;&quot;, hevc-&gt;s_info.slice_qp_delta);</span>
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; slice_segment_address=\&quot;%d\&quot;&quot;, hevc-&gt;s_info.slice_segment_address);</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; slice_type=\&quot;%d\&quot;&quot;, hevc-&gt;s_info.slice_type);</span>
<span class="lineNum">     699 </span>            :                         }
<span class="lineNum">     700 </span>            :                 }
<span class="lineNum">     701 </span><span class="lineCov">       9126 :                 if (!full_bs_dump)</span>
<span class="lineNum">     702 </span><span class="lineCov">       6581 :                         gf_fprintf(dump, &quot; layer_id=\&quot;%d\&quot; temporal_id=\&quot;%d\&quot;&quot;, quality_id, temporal_id);</span>
<span class="lineNum">     703 </span>            : 
<span class="lineNum">     704 </span><span class="lineCov">       9126 :                 if (bs) {</span>
<span class="lineNum">     705 </span><span class="lineCov">       2545 :                         if (!pctx)</span>
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :                                 gf_bs_del(bs);</span>
<span class="lineNum">     707 </span>            :                         else
<span class="lineNum">     708 </span><span class="lineCov">       2545 :                                 gf_bs_set_logger(bs, NULL, NULL);</span>
<span class="lineNum">     709 </span>            :                 }
<span class="lineNum">     710 </span>            : 
<span class="lineNum">     711 </span><span class="lineCov">       9126 :                 if ((type == GF_HEVC_NALU_SEI_PREFIX) || (type == GF_HEVC_NALU_SEI_SUFFIX)) {</span>
<span class="lineNum">     712 </span><span class="lineCov">       1262 :                         gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">     713 </span><span class="lineCov">       1262 :                         if (pctx) {</span>
<span class="lineNum">     714 </span><span class="lineCov">        504 :                                 if (!pctx-&gt;bs)</span>
<span class="lineNum">     715 </span><span class="lineNoCov">          0 :                                         pctx-&gt;bs = gf_bs_new(ptr, ptr_size, GF_BITSTREAM_READ);</span>
<span class="lineNum">     716 </span>            :                                 else
<span class="lineNum">     717 </span><span class="lineCov">        504 :                                         gf_bs_reassign_buffer(pctx-&gt;bs, ptr, ptr_size);</span>
<span class="lineNum">     718 </span><span class="lineCov">        504 :                                 bs = pctx-&gt;bs;</span>
<span class="lineNum">     719 </span>            :                         } else {
<span class="lineNum">     720 </span><span class="lineCov">        758 :                                 bs = gf_bs_new(ptr, ptr_size, GF_BITSTREAM_READ);</span>
<span class="lineNum">     721 </span>            :                         }
<span class="lineNum">     722 </span><span class="lineCov">       1262 :                         dump_sei(dump, bs, GF_TRUE);</span>
<span class="lineNum">     723 </span><span class="lineCov">       1262 :                         if (!pctx) gf_bs_del(bs);</span>
<span class="lineNum">     724 </span><span class="lineCov">       1262 :                         gf_fprintf(dump, &quot;   &lt;/NALU&gt;\n&quot;);</span>
<span class="lineNum">     725 </span>            :                 } else {
<span class="lineNum">     726 </span><span class="lineCov">       7864 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">     727 </span>            :                 }
<span class="lineNum">     728 </span>            : 
<span class="lineNum">     729 </span>            : #else
<span class="lineNum">     730 </span>            :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);
<span class="lineNum">     731 </span>            : #endif //GPAC_DISABLE_HEVC
<span class="lineNum">     732 </span>            :                 return;
<span class="lineNum">     733 </span>            :         }
<span class="lineNum">     734 </span>            : 
<span class="lineNum">     735 </span><span class="lineCov">       3403 :         if (vvc) {</span>
<span class="lineNum">     736 </span>            :                 u8 lid, tid;
<span class="lineNum">     737 </span>            : 
<span class="lineNum">     738 </span><span class="lineNoCov">          0 :                 if (full_bs_dump) {</span>
<span class="lineNum">     739 </span><span class="lineNoCov">          0 :                         if (pctx) {</span>
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :                                 if (!pctx-&gt;bs)</span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 :                                         pctx-&gt;bs = gf_bs_new(ptr, ptr_size, GF_BITSTREAM_READ);</span>
<span class="lineNum">     742 </span>            :                                 else
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :                                         gf_bs_reassign_buffer(pctx-&gt;bs, ptr, ptr_size);</span>
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :                                 bs = pctx-&gt;bs;</span>
<span class="lineNum">     745 </span>            :                         } else {
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :                                 bs = gf_bs_new(ptr, ptr_size, GF_BITSTREAM_READ);</span>
<span class="lineNum">     747 </span>            :                         }
<span class="lineNum">     748 </span><span class="lineNoCov">          0 :                         gf_bs_set_logger(bs, regular_bs_log, &amp;lcbk);</span>
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :                         res = gf_media_vvc_parse_nalu_bs(bs, vvc, &amp;type, &amp;lid, &amp;tid);</span>
<span class="lineNum">     750 </span>            :                 } else {
<span class="lineNum">     751 </span>            :                         bs = NULL;
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :                         u32 forb_zero = (ptr[0] &amp; 0x80) ? 1 : 0;</span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :                         u32 res_zero = (ptr[0] &amp; 0x40) ? 1 : 0;</span>
<span class="lineNum">     754 </span><span class="lineNoCov">          0 :                         lid = (ptr[0] &amp; 0x3F);</span>
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :                         tid = (ptr[1] &amp; 0x7);</span>
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :                         if (forb_zero || res_zero || !tid) {</span>
<span class="lineNum">     757 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;error=\&quot;invalid header (forb %d res_zero %d tid %d)\&quot;/&gt;\n&quot;, forb_zero, res_zero, tid);</span>
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :                                 return;</span>
<span class="lineNum">     759 </span>            :                         }
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :                         tid -= 1;</span>
<span class="lineNum">     761 </span><span class="lineNoCov">          0 :                         type = ptr[1]&gt;&gt;3;</span>
<span class="lineNum">     762 </span>            : 
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :                         res = gf_media_vvc_parse_nalu(ptr, ptr_size, vvc, &amp;type, &amp;lid, &amp;tid);</span>
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;code=\&quot;%d\&quot; temporalid=\&quot;%d\&quot; layerid=\&quot;%d\&quot;&quot;, type, tid, lid);</span>
<span class="lineNum">     765 </span>            :                 }
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :                 if (res==-1) {</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; status=\&quot;error parsing\&quot;&quot;, type);</span>
<span class="lineNum">     768 </span>            :                 }
<span class="lineNum">     769 </span>            : 
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; type=\&quot;&quot;);</span>
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :                 switch (type) {</span>
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_SLICE_TRAIL:</span>
<span class="lineNum">     773 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;Slice_TRAIL&quot;);</span>
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_SLICE_STSA:</span>
<span class="lineNum">     776 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;Slice_STSA&quot;);</span>
<span class="lineNum">     777 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_SLICE_RADL:</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;Slice_RADL&quot;);</span>
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_SLICE_RASL:</span>
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;Slice_RASL&quot;);</span>
<span class="lineNum">     783 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_SLICE_IDR_W_RADL:</span>
<span class="lineNum">     785 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;IDR_RADL&quot;);</span>
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_SLICE_IDR_N_LP:</span>
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;IDR&quot;);</span>
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_SLICE_CRA:</span>
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;CRA&quot;);</span>
<span class="lineNum">     792 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_SLICE_GDR:</span>
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;GDR&quot;);</span>
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_OPI:</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;OperationPointInfo&quot;);</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     799 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_DEC_PARAM:</span>
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;DecodeParameterSet&quot;);</span>
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_VID_PARAM:</span>
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;VideoParameterSet&quot;);</span>
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :                         if ((res&gt;=0) &amp;&amp; !full_bs_dump) {</span>
<span class="lineNum">     805 </span>            :                                 u32 j;
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :                                 VVC_VPS *vps = &amp;vvc-&gt;vps[vvc-&gt;last_parsed_vps_id];</span>
<span class="lineNum">     807 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; id=\&quot;%d\&quot; num_ptl=\&quot;%d\&quot; max_layers=\&quot;%d\&quot; max_sublayers=\&quot;%d&quot;, vps-&gt;id, vps-&gt;num_ptl, vps-&gt;max_layers, vps-&gt;max_sub_layers);</span>
<span class="lineNum">     808 </span><span class="lineNoCov">          0 :                                 if (vps-&gt;max_layers&gt;1) {</span>
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;\&quot; max_layer_id=\&quot;%d\&quot; all_layers_independent=\&quot;%d\&quot; each_layer_is_ols=\&quot;%d&quot;, vps-&gt;max_layer_id, vps-&gt;all_layers_independent, vps-&gt;each_layer_is_ols);</span>
<span class="lineNum">     810 </span>            :                                 }
<span class="lineNum">     811 </span><span class="lineNoCov">          0 :                                 for (j=0; j&lt;vps-&gt;num_ptl; j++) {</span>
<span class="lineNum">     812 </span>            :                                         VVC_ProfileTierLevel *ptl = &amp;vps-&gt;ptl[j];
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;\&quot; general_level_idc=\&quot;%d\&quot; frame_only_constraint=\&quot;%d\&quot; multilayer_enabled=\&quot;%d\&quot; max_tid=\&quot;%d&quot;, ptl-&gt;general_level_idc, ptl-&gt;frame_only_constraint, ptl-&gt;multilayer_enabled, ptl-&gt;ptl_max_tid);</span>
<span class="lineNum">     814 </span>            : 
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :                                         if (ptl-&gt;pt_present) {</span>
<span class="lineNum">     816 </span><span class="lineNoCov">          0 :                                                 gf_fprintf(dump, &quot;\&quot; general_profile_idc=\&quot;%d\&quot; general_tier_flag=\&quot;%d\&quot; gci_present=\&quot;%d&quot;, ptl-&gt;general_profile_idc, ptl-&gt;general_tier_flag, ptl-&gt;gci_present);</span>
<span class="lineNum">     817 </span>            :                                         }
<span class="lineNum">     818 </span>            :                                 }
<span class="lineNum">     819 </span>            :                         }
<span class="lineNum">     820 </span>            :                         res = -2;
<span class="lineNum">     821 </span>            :                         break;
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_SEQ_PARAM:</span>
<span class="lineNum">     823 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;SequenceParameterSet&quot;);</span>
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :                         if ((res&gt;=0) &amp;&amp; !full_bs_dump) {</span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :                                 VVC_SPS *sps = &amp;vvc-&gt;sps[vvc-&gt;last_parsed_sps_id];</span>
<span class="lineNum">     826 </span>            : 
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; id=\&quot;%d\&quot; vps_id=\&quot;%d\&quot; max_sublayers=\&quot;%d\&quot; chroma_idc=\&quot;%d\&quot; bit_depth=\&quot;%d\&quot; CTBsizeY=\&quot;%d\&quot; gdr_enabled=\&quot;%d\&quot; ref_pic_sampling=\&quot;%d\&quot; subpic_info_present=\&quot;%d\&quot; poc_msb_cycle_flag=\&quot;%d&quot;, sps-&gt;id, sps-&gt;vps_id, sps-&gt;max_sublayers, sps-&gt;chroma_format_idc, sps-&gt;bitdepth, 1&lt;&lt;sps-&gt;log2_ctu_size, sps-&gt;gdr_enabled, sps-&gt;ref_pic_resampling, sps-&gt;subpic_info_present, sps-&gt;poc_msb_cycle_flag);</span>
<span class="lineNum">     828 </span><span class="lineNoCov">          0 :                                 if (sps-&gt;ref_pic_resampling) {</span>
<span class="lineNum">     829 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;\&quot; res_change_in_clvs=\&quot;%d&quot;, sps-&gt;res_change_in_clvs);</span>
<span class="lineNum">     830 </span>            :                                 }
<span class="lineNum">     831 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; width=\&quot;%d\&quot; height=\&quot;%d&quot;, sps-&gt;width, sps-&gt;height);</span>
<span class="lineNum">     832 </span><span class="lineNoCov">          0 :                                 if (!sps-&gt;vps_id) {</span>
<span class="lineNum">     833 </span>            :                                         VVC_ProfileTierLevel *ptl = &amp;vvc-&gt;vps[0].ptl[0];
<span class="lineNum">     834 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;\&quot; general_level_idc=\&quot;%d\&quot; frame_only_constraint=\&quot;%d\&quot; multilayer_enabled=\&quot;%d\&quot; max_tid=\&quot;%d&quot;, ptl-&gt;general_level_idc, ptl-&gt;frame_only_constraint, ptl-&gt;multilayer_enabled, ptl-&gt;ptl_max_tid);</span>
<span class="lineNum">     835 </span>            : 
<span class="lineNum">     836 </span><span class="lineNoCov">          0 :                                         if (ptl-&gt;pt_present) {</span>
<span class="lineNum">     837 </span><span class="lineNoCov">          0 :                                                 gf_fprintf(dump, &quot;\&quot; general_profile_idc=\&quot;%d\&quot; general_tier_flag=\&quot;%d\&quot; gci_present=\&quot;%d&quot;, ptl-&gt;general_profile_idc, ptl-&gt;general_tier_flag, ptl-&gt;gci_present);</span>
<span class="lineNum">     838 </span>            :                                         }
<span class="lineNum">     839 </span>            :                                 }
<span class="lineNum">     840 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; conf_window=\&quot;%d&quot;, sps-&gt;conf_window);</span>
<span class="lineNum">     841 </span><span class="lineNoCov">          0 :                                 if (sps-&gt;conf_window) {</span>
<span class="lineNum">     842 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;\&quot; cw_left=\&quot;%d\&quot; cw_right=\&quot;%d\&quot; cw_top=\&quot;%d\&quot; cw_bottom=\&quot;%d&quot;, sps-&gt;cw_left, sps-&gt;cw_right, sps-&gt;cw_top, sps-&gt;cw_bottom);</span>
<span class="lineNum">     843 </span>            :                                 }
<span class="lineNum">     844 </span>            :                         }
<span class="lineNum">     845 </span>            :                         res=-2;
<span class="lineNum">     846 </span>            :                         break;
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_PIC_PARAM:</span>
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;PictureParameterSet&quot;);</span>
<span class="lineNum">     849 </span><span class="lineNoCov">          0 :                         if ((res&gt;=0) &amp;&amp; !full_bs_dump) {</span>
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :                                 VVC_PPS *pps = &amp;vvc-&gt;pps[vvc-&gt;last_parsed_pps_id];</span>
<span class="lineNum">     851 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; id=\&quot;%d\&quot; sps_id=\&quot;%d\&quot; width=\&quot;%d\&quot; height=\&quot;%d\&quot; mixed_nal_types=\&quot;%d\&quot; conf_window=\&quot;%d&quot;, pps-&gt;id, pps-&gt;sps_id, pps-&gt;width, pps-&gt;height, pps-&gt;mixed_nal_types, pps-&gt;conf_window);</span>
<span class="lineNum">     852 </span>            : 
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :                                 if (pps-&gt;conf_window) {</span>
<span class="lineNum">     854 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;\&quot; cw_left=\&quot;%d\&quot; cw_right=\&quot;%d\&quot; cw_top=\&quot;%d\&quot; cw_bottom=\&quot;%d&quot;, pps-&gt;cw_left, pps-&gt;cw_right, pps-&gt;cw_top, pps-&gt;cw_bottom);</span>
<span class="lineNum">     855 </span>            :                                 }
<span class="lineNum">     856 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot; output_flag_present_flag=\&quot;%d\&quot; no_pic_partition_flag=\&quot;%d\&quot; subpic_id_mapping_present_flag=\&quot;%d&quot;, pps-&gt;output_flag_present_flag, pps-&gt;no_pic_partition_flag, pps-&gt;subpic_id_mapping_present_flag);</span>
<span class="lineNum">     857 </span>            :                         }
<span class="lineNum">     858 </span>            :                         res=-2;
<span class="lineNum">     859 </span>            :                         break;
<span class="lineNum">     860 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_APS_PREFIX:</span>
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;AdaptationParameterSet_Prefix&quot;);</span>
<span class="lineNum">     862 </span>            :                         res=-2;
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     864 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_APS_SUFFIX:</span>
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;AdaptationParameterSet_Suffix&quot;);</span>
<span class="lineNum">     866 </span>            :                         res=-2;
<span class="lineNum">     867 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_ACCESS_UNIT:</span>
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;AUDelimiter&quot;);</span>
<span class="lineNum">     870 </span>            :                         res=-2;
<span class="lineNum">     871 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     872 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_END_OF_SEQ:</span>
<span class="lineNum">     873 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;EOS&quot;);</span>
<span class="lineNum">     874 </span>            :                         res=-2;
<span class="lineNum">     875 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_END_OF_STREAM:</span>
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;EOB&quot;);</span>
<span class="lineNum">     878 </span>            :                         res=-2;
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_FILLER_DATA:</span>
<span class="lineNum">     881 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;FillerData&quot;);</span>
<span class="lineNum">     882 </span>            :                         res=-2;
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_SEI_PREFIX:</span>
<span class="lineNum">     885 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;SEI_Prefix&quot;);</span>
<span class="lineNum">     886 </span>            :                         res=-2;
<span class="lineNum">     887 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     888 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_SEI_SUFFIX:</span>
<span class="lineNum">     889 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;SEI_Suffix&quot;);</span>
<span class="lineNum">     890 </span>            :                         res=-2;
<span class="lineNum">     891 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :                 case GF_VVC_NALU_PIC_HEADER:</span>
<span class="lineNum">     893 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;PictureHeader&quot;);</span>
<span class="lineNum">     894 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :                 default:</span>
<span class="lineNum">     896 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;Unknwon&quot;);</span>
<span class="lineNum">     897 </span>            :                         res = -2;
<span class="lineNum">     898 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     899 </span>            :                 }
<span class="lineNum">     900 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot;&quot;);</span>
<span class="lineNum">     901 </span>            : 
<span class="lineNum">     902 </span>            :                 //picture header or slice
<span class="lineNum">     903 </span><span class="lineNoCov">          0 :                 if ((res&gt;=0) &amp;&amp; !full_bs_dump) {</span>
<span class="lineNum">     904 </span><span class="lineNoCov">          0 :                         if (type!=GF_VVC_NALU_PIC_HEADER)</span>
<span class="lineNum">     905 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; picture_header_in_slice_header_flag=\&quot;%d\&quot;&quot;, vvc-&gt;s_info.picture_header_in_slice_header_flag);</span>
<span class="lineNum">     906 </span>            : 
<span class="lineNum">     907 </span><span class="lineNoCov">          0 :                         if ((type==GF_VVC_NALU_PIC_HEADER) || vvc-&gt;s_info.picture_header_in_slice_header_flag) {</span>
<span class="lineNum">     908 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; pps_id=\&quot;%d\&quot; poc=\&quot;%d\&quot; irap_or_gdr_pic=\&quot;%d\&quot; non_ref_pic=\&quot;%d\&quot; inter_slice_allowed_flag=\&quot;%d\&quot; poc_lsb=\&quot;%d\&quot;&quot;, vvc-&gt;s_info.pps-&gt;id, vvc-&gt;s_info.poc, vvc-&gt;s_info.irap_or_gdr_pic, vvc-&gt;s_info.non_ref_pic, vvc-&gt;s_info.inter_slice_allowed_flag, vvc-&gt;s_info.poc_lsb);</span>
<span class="lineNum">     909 </span><span class="lineNoCov">          0 :                                 if (vvc-&gt;s_info.irap_or_gdr_pic)</span>
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot; gdr_pic=\&quot;%d\&quot; gdr_recovery_count=\&quot;%d\&quot;&quot;, vvc-&gt;s_info.gdr_pic, vvc-&gt;s_info.gdr_recovery_count);</span>
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :                                 if (vvc-&gt;s_info.inter_slice_allowed_flag)</span>
<span class="lineNum">     912 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot; intra_slice_allowed_flag=\&quot;%d\&quot;&quot;, vvc-&gt;s_info.intra_slice_allowed_flag);</span>
<span class="lineNum">     913 </span><span class="lineNoCov">          0 :                                 if (vvc-&gt;s_info.sps-&gt;poc_msb_cycle_flag &amp;&amp; vvc-&gt;s_info.poc_msb_cycle_present_flag)</span>
<span class="lineNum">     914 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot; poc_msb_cycle=\&quot;%d\&quot;&quot;, vvc-&gt;s_info.poc_msb_cycle);</span>
<span class="lineNum">     915 </span>            :                         }
<span class="lineNum">     916 </span><span class="lineNoCov">          0 :                         if (type!=GF_VVC_NALU_PIC_HEADER)</span>
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; slice_type=\&quot;%d\&quot;&quot;, vvc-&gt;s_info.slice_type);</span>
<span class="lineNum">     918 </span>            :                 }
<span class="lineNum">     919 </span>            : 
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :                 if (bs) {</span>
<span class="lineNum">     921 </span><span class="lineNoCov">          0 :                         if (!pctx)</span>
<span class="lineNum">     922 </span><span class="lineNoCov">          0 :                                 gf_bs_del(bs);</span>
<span class="lineNum">     923 </span>            :                         else
<span class="lineNum">     924 </span><span class="lineNoCov">          0 :                                 gf_bs_set_logger(bs, NULL, NULL);</span>
<span class="lineNum">     925 </span>            :                 }
<span class="lineNum">     926 </span>            : 
<span class="lineNum">     927 </span><span class="lineNoCov">          0 :                 if ((type == GF_VVC_NALU_SEI_PREFIX) || (type == GF_VVC_NALU_SEI_SUFFIX)) {</span>
<span class="lineNum">     928 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">     929 </span><span class="lineNoCov">          0 :                         if (pctx) {</span>
<span class="lineNum">     930 </span><span class="lineNoCov">          0 :                                 if (!pctx-&gt;bs)</span>
<span class="lineNum">     931 </span><span class="lineNoCov">          0 :                                         pctx-&gt;bs = gf_bs_new(ptr, ptr_size, GF_BITSTREAM_READ);</span>
<span class="lineNum">     932 </span>            :                                 else
<span class="lineNum">     933 </span><span class="lineNoCov">          0 :                                         gf_bs_reassign_buffer(pctx-&gt;bs, ptr, ptr_size);</span>
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :                                 bs = pctx-&gt;bs;</span>
<span class="lineNum">     935 </span>            :                         } else {
<span class="lineNum">     936 </span><span class="lineNoCov">          0 :                                 bs = gf_bs_new(ptr, ptr_size, GF_BITSTREAM_READ);</span>
<span class="lineNum">     937 </span>            :                         }
<span class="lineNum">     938 </span><span class="lineNoCov">          0 :                         dump_sei(dump, bs, GF_TRUE);</span>
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :                         if (!pctx) gf_bs_del(bs);</span>
<span class="lineNum">     940 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;   &lt;/NALU&gt;\n&quot;);</span>
<span class="lineNum">     941 </span>            :                 } else {
<span class="lineNum">     942 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">     943 </span>            :                 }
<span class="lineNum">     944 </span>            :                 return;
<span class="lineNum">     945 </span>            :         }
<span class="lineNum">     946 </span>            : 
<span class="lineNum">     947 </span>            :         //avc
<span class="lineNum">     948 </span><span class="lineCov">       3403 :         type = ptr[0] &amp; 0x1F;</span>
<span class="lineNum">     949 </span>            :         nal_ref_idc = ptr[0] &amp; 0x60;
<span class="lineNum">     950 </span><span class="lineCov">       3403 :         nal_ref_idc&gt;&gt;=5;</span>
<span class="lineNum">     951 </span><span class="lineCov">       3403 :         if (! full_bs_dump)</span>
<span class="lineNum">     952 </span><span class="lineCov">       3225 :                 gf_fprintf(dump, &quot;code=\&quot;%d\&quot; &quot;, type);</span>
<span class="lineNum">     953 </span>            : 
<span class="lineNum">     954 </span><span class="lineCov">       3403 :         gf_fprintf(dump, &quot;type=\&quot;&quot;);</span>
<span class="lineNum">     955 </span>            :         res = -2;
<span class="lineNum">     956 </span>            : 
<span class="lineNum">     957 </span><span class="lineCov">       3403 :         if (pctx) {</span>
<span class="lineNum">     958 </span><span class="lineCov">        356 :                 if (!pctx-&gt;bs)</span>
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :                         pctx-&gt;bs = gf_bs_new(ptr, ptr_size, GF_BITSTREAM_READ);</span>
<span class="lineNum">     960 </span>            :                 else
<span class="lineNum">     961 </span><span class="lineCov">        356 :                         gf_bs_reassign_buffer(pctx-&gt;bs, ptr, ptr_size);</span>
<span class="lineNum">     962 </span><span class="lineCov">        356 :                 bs = pctx-&gt;bs;</span>
<span class="lineNum">     963 </span>            :         } else {
<span class="lineNum">     964 </span><span class="lineCov">       3047 :                 bs = gf_bs_new(ptr, ptr_size, GF_BITSTREAM_READ);</span>
<span class="lineNum">     965 </span>            :         }
<span class="lineNum">     966 </span>            : 
<span class="lineNum">     967 </span><span class="lineCov">       3403 :         if (full_bs_dump)</span>
<span class="lineNum">     968 </span><span class="lineCov">        178 :                 gf_bs_set_logger(bs, shifted_bs_log, &amp;lcbk);</span>
<span class="lineNum">     969 </span>            : 
<span class="lineNum">     970 </span><span class="lineCov">       3403 :         switch (type) {</span>
<span class="lineNum">     971 </span><span class="lineCov">       1327 :         case GF_AVC_NALU_NON_IDR_SLICE:</span>
<span class="lineNum">     972 </span><span class="lineCov">       1327 :                 gf_fputs(&quot;Non IDR slice&quot;, dump);</span>
<span class="lineNum">     973 </span><span class="lineCov">       1327 :                 if (is_encrypted) break;</span>
<span class="lineNum">     974 </span><span class="lineCov">       1327 :                 res = gf_avc_parse_nalu(bs, avc);</span>
<span class="lineNum">     975 </span><span class="lineCov">       1327 :                 break;</span>
<span class="lineNum">     976 </span><span class="lineNoCov">          0 :         case GF_AVC_NALU_DP_A_SLICE:</span>
<span class="lineNum">     977 </span><span class="lineNoCov">          0 :                 gf_fputs(&quot;DP Type A slice&quot;, dump);</span>
<span class="lineNum">     978 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">     979 </span><span class="lineNoCov">          0 :         case GF_AVC_NALU_DP_B_SLICE:</span>
<span class="lineNum">     980 </span><span class="lineNoCov">          0 :                 gf_fputs(&quot;DP Type B slice&quot;, dump);</span>
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">     982 </span><span class="lineNoCov">          0 :         case GF_AVC_NALU_DP_C_SLICE:</span>
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :                 gf_fputs(&quot;DP Type C slice&quot;, dump);</span>
<span class="lineNum">     984 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">     985 </span><span class="lineCov">         38 :         case GF_AVC_NALU_IDR_SLICE:</span>
<span class="lineNum">     986 </span><span class="lineCov">         38 :                 gf_fputs(&quot;IDR slice&quot;, dump);</span>
<span class="lineNum">     987 </span><span class="lineCov">         38 :                 if (is_encrypted) break;</span>
<span class="lineNum">     988 </span><span class="lineCov">         38 :                 res = gf_avc_parse_nalu(bs, avc);</span>
<span class="lineNum">     989 </span><span class="lineCov">         38 :                 break;</span>
<span class="lineNum">     990 </span><span class="lineCov">        516 :         case GF_AVC_NALU_SEI:</span>
<span class="lineNum">     991 </span><span class="lineCov">        516 :                 gf_fputs(&quot;SEI Message&quot;, dump);</span>
<span class="lineNum">     992 </span><span class="lineCov">        516 :                 break;</span>
<span class="lineNum">     993 </span><span class="lineCov">          9 :         case GF_AVC_NALU_SEQ_PARAM:</span>
<span class="lineNum">     994 </span><span class="lineCov">          9 :                 gf_fputs(&quot;SequenceParameterSet&quot;, dump);</span>
<span class="lineNum">     995 </span><span class="lineCov">          9 :                 if (is_encrypted) break;</span>
<span class="lineNum">     996 </span><span class="lineCov">          9 :                 idx = gf_avc_read_sps_bs(bs, avc, 0, NULL);</span>
<span class="lineNum">     997 </span><span class="lineCov">          9 :                 if (idx&lt;0) {</span>
<span class="lineNum">     998 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; sps_id=\&quot;PARSING FAILURE&quot;);</span>
<span class="lineNum">     999 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1000 </span>            :                 }
<span class="lineNum">    1001 </span><span class="lineCov">          9 :                 if (full_bs_dump) break;</span>
<span class="lineNum">    1002 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; sps_id=\&quot;%d&quot;, idx);</span>
<span class="lineNum">    1003 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; frame_mbs_only_flag=\&quot;%d&quot;, avc-&gt;sps-&gt;frame_mbs_only_flag);</span>
<span class="lineNum">    1004 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; mb_adaptive_frame_field_flag=\&quot;%d&quot;, avc-&gt;sps-&gt;mb_adaptive_frame_field_flag);</span>
<span class="lineNum">    1005 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; vui_parameters_present_flag=\&quot;%d&quot;, avc-&gt;sps-&gt;vui_parameters_present_flag);</span>
<span class="lineNum">    1006 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; max_num_ref_frames=\&quot;%d&quot;, avc-&gt;sps-&gt;max_num_ref_frames);</span>
<span class="lineNum">    1007 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; gaps_in_frame_num_value_allowed_flag=\&quot;%d&quot;, avc-&gt;sps-&gt;gaps_in_frame_num_value_allowed_flag);</span>
<span class="lineNum">    1008 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; chroma_format_idc=\&quot;%d&quot;, avc-&gt;sps-&gt;chroma_format);</span>
<span class="lineNum">    1009 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; bit_depth_luma_minus8=\&quot;%d&quot;, avc-&gt;sps-&gt;luma_bit_depth_m8);</span>
<span class="lineNum">    1010 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; bit_depth_chroma_minus8=\&quot;%d&quot;, avc-&gt;sps-&gt;chroma_bit_depth_m8);</span>
<span class="lineNum">    1011 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; width=\&quot;%d&quot;, avc-&gt;sps-&gt;width);</span>
<span class="lineNum">    1012 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; height=\&quot;%d&quot;, avc-&gt;sps-&gt;height);</span>
<span class="lineNum">    1013 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; crop_top=\&quot;%d&quot;, avc-&gt;sps-&gt;crop.top);</span>
<span class="lineNum">    1014 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; crop_left=\&quot;%d&quot;, avc-&gt;sps-&gt;crop.left);</span>
<span class="lineNum">    1015 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; crop_bottom=\&quot;%d&quot;, avc-&gt;sps-&gt;crop.bottom);</span>
<span class="lineNum">    1016 </span><span class="lineCov">          7 :                 gf_fprintf(dump, &quot;\&quot; crop_right=\&quot;%d&quot;, avc-&gt;sps-&gt;crop.right);</span>
<span class="lineNum">    1017 </span><span class="lineCov">          7 :                 if (avc-&gt;sps-&gt;vui_parameters_present_flag) {</span>
<span class="lineNum">    1018 </span><span class="lineCov">          5 :                         gf_fprintf(dump, &quot;\&quot; vui_video_full_range_flag=\&quot;%d&quot;, avc-&gt;sps-&gt;vui.video_full_range_flag);</span>
<span class="lineNum">    1019 </span><span class="lineCov">          5 :                         gf_fprintf(dump, &quot;\&quot; vui_video_signal_type_present_flag=\&quot;%d&quot;, avc-&gt;sps-&gt;vui.video_signal_type_present_flag);</span>
<span class="lineNum">    1020 </span><span class="lineCov">          5 :                         gf_fprintf(dump, &quot;\&quot; vui_aspect_ratio_info_present_flag=\&quot;%d&quot;, avc-&gt;sps-&gt;vui.aspect_ratio_info_present_flag);</span>
<span class="lineNum">    1021 </span><span class="lineCov">          5 :                         gf_fprintf(dump, &quot;\&quot; vui_aspect_ratio_num=\&quot;%d&quot;, avc-&gt;sps-&gt;vui.par_num);</span>
<span class="lineNum">    1022 </span><span class="lineCov">          5 :                         gf_fprintf(dump, &quot;\&quot; vui_aspect_ratio_den=\&quot;%d&quot;, avc-&gt;sps-&gt;vui.par_den);</span>
<span class="lineNum">    1023 </span><span class="lineCov">          5 :                         gf_fprintf(dump, &quot;\&quot; vui_overscan_info_present_flag=\&quot;%d&quot;, avc-&gt;sps-&gt;vui.overscan_info_present_flag);</span>
<span class="lineNum">    1024 </span><span class="lineCov">          5 :                         gf_fprintf(dump, &quot;\&quot; vui_colour_description_present_flag=\&quot;%d&quot;, avc-&gt;sps-&gt;vui.colour_description_present_flag);</span>
<span class="lineNum">    1025 </span><span class="lineCov">          5 :                         gf_fprintf(dump, &quot;\&quot; vui_colour_primaries=\&quot;%d&quot;, avc-&gt;sps-&gt;vui.colour_primaries);</span>
<span class="lineNum">    1026 </span><span class="lineCov">          5 :                         gf_fprintf(dump, &quot;\&quot; vui_transfer_characteristics=\&quot;%d&quot;, avc-&gt;sps-&gt;vui.transfer_characteristics);</span>
<span class="lineNum">    1027 </span><span class="lineCov">          5 :                         gf_fprintf(dump, &quot;\&quot; vui_matrix_coefficients=\&quot;%d&quot;, avc-&gt;sps-&gt;vui.matrix_coefficients);</span>
<span class="lineNum">    1028 </span><span class="lineCov">          5 :                         gf_fprintf(dump, &quot;\&quot; vui_low_delay_hrd_flag=\&quot;%d&quot;, avc-&gt;sps-&gt;vui.low_delay_hrd_flag);</span>
<span class="lineNum">    1029 </span>            :                 }
<span class="lineNum">    1030 </span><span class="lineCov">          7 :                 if (gf_sys_is_test_mode()) break;</span>
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; log2_max_poc_lsb=\&quot;%d&quot;, avc-&gt;sps-&gt;log2_max_poc_lsb);</span>
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; log2_max_frame_num=\&quot;%d&quot;, avc-&gt;sps-&gt;log2_max_frame_num);</span>
<span class="lineNum">    1033 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; delta_pic_order_always_zero_flag=\&quot;%d&quot;, avc-&gt;sps-&gt;delta_pic_order_always_zero_flag);</span>
<span class="lineNum">    1034 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; offset_for_non_ref_pic=\&quot;%d&quot;, avc-&gt;sps-&gt;offset_for_non_ref_pic);</span>
<span class="lineNum">    1035 </span>            : 
<span class="lineNum">    1036 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1037 </span><span class="lineCov">         11 :         case GF_AVC_NALU_PIC_PARAM:</span>
<span class="lineNum">    1038 </span><span class="lineCov">         11 :                 gf_fputs(&quot;PictureParameterSet&quot;, dump);</span>
<span class="lineNum">    1039 </span><span class="lineCov">         11 :                 if (is_encrypted) break;</span>
<span class="lineNum">    1040 </span><span class="lineCov">         11 :                 idx = gf_avc_read_pps_bs(bs, avc);</span>
<span class="lineNum">    1041 </span><span class="lineCov">         11 :                 if (idx&lt;0) {</span>
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot; pps_id=\&quot;PARSING FAILURE\&quot; &quot;);</span>
<span class="lineNum">    1043 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1044 </span>            :                 }
<span class="lineNum">    1045 </span><span class="lineCov">         11 :                 if (full_bs_dump) break;</span>
<span class="lineNum">    1046 </span><span class="lineCov">          9 :                 gf_fprintf(dump, &quot;\&quot; pps_id=\&quot;%d\&quot; sps_id=\&quot;%d&quot;, idx, avc-&gt;pps[idx].sps_id);</span>
<span class="lineNum">    1047 </span><span class="lineCov">          9 :                 gf_fprintf(dump, &quot;\&quot; entropy_coding_mode_flag=\&quot;%d&quot;, avc-&gt;pps[idx].entropy_coding_mode_flag);</span>
<span class="lineNum">    1048 </span><span class="lineCov">          9 :                 if (gf_sys_is_test_mode()) break;</span>
<span class="lineNum">    1049 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; deblocking_filter_control_present_flag=\&quot;%d&quot;, avc-&gt;pps[idx].deblocking_filter_control_present_flag);</span>
<span class="lineNum">    1050 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; mb_slice_group_map_type=\&quot;%d&quot;, avc-&gt;pps[idx].mb_slice_group_map_type);</span>
<span class="lineNum">    1051 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; num_ref_idx_l0_default_active_minus1=\&quot;%d&quot;, avc-&gt;pps[idx].num_ref_idx_l0_default_active_minus1);</span>
<span class="lineNum">    1052 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; num_ref_idx_l1_default_active_minus1=\&quot;%d&quot;, avc-&gt;pps[idx].num_ref_idx_l1_default_active_minus1);</span>
<span class="lineNum">    1053 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; pic_order_present=\&quot;%d&quot;, avc-&gt;pps[idx].pic_order_present);</span>
<span class="lineNum">    1054 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; pic_size_in_map_units_minus1=\&quot;%d&quot;, avc-&gt;pps[idx].pic_size_in_map_units_minus1);</span>
<span class="lineNum">    1055 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; redundant_pic_cnt_present=\&quot;%d&quot;, avc-&gt;pps[idx].redundant_pic_cnt_present);</span>
<span class="lineNum">    1056 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; slice_group_change_rate_minus1=\&quot;%d&quot;, avc-&gt;pps[idx].slice_group_change_rate_minus1);</span>
<span class="lineNum">    1057 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; slice_group_count=\&quot;%d&quot;, avc-&gt;pps[idx].slice_group_count);</span>
<span class="lineNum">    1058 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; weighted_pred_flag=\&quot;%d&quot;, avc-&gt;pps[idx].weighted_pred_flag);</span>
<span class="lineNum">    1059 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; weighted_bipred_idc=\&quot;%d&quot;, avc-&gt;pps[idx].weighted_bipred_idc);</span>
<span class="lineNum">    1060 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1061 </span><span class="lineNoCov">          0 :         case GF_AVC_NALU_ACCESS_UNIT:</span>
<span class="lineNum">    1062 </span><span class="lineNoCov">          0 :                 gf_fputs(&quot;AccessUnit delimiter&quot;, dump);</span>
<span class="lineNum">    1063 </span><span class="lineNoCov">          0 :                 if (is_encrypted) break;</span>
<span class="lineNum">    1064 </span><span class="lineNoCov">          0 :                 if (full_bs_dump) break;</span>
<span class="lineNum">    1065 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\&quot; primary_pic_type=\&quot;%d&quot;, gf_bs_read_u8(bs) &gt;&gt; 5);</span>
<span class="lineNum">    1066 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :         case GF_AVC_NALU_END_OF_SEQ:</span>
<span class="lineNum">    1068 </span><span class="lineNoCov">          0 :                 gf_fputs(&quot;EndOfSequence&quot;, dump);</span>
<span class="lineNum">    1069 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 :         case GF_AVC_NALU_END_OF_STREAM:</span>
<span class="lineNum">    1071 </span><span class="lineNoCov">          0 :                 gf_fputs(&quot;EndOfStream&quot;, dump);</span>
<span class="lineNum">    1072 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1073 </span><span class="lineNoCov">          0 :         case GF_AVC_NALU_FILLER_DATA:</span>
<span class="lineNum">    1074 </span><span class="lineNoCov">          0 :                 gf_fputs(&quot;Filler data&quot;, dump);</span>
<span class="lineNum">    1075 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1076 </span><span class="lineNoCov">          0 :         case GF_AVC_NALU_SEQ_PARAM_EXT:</span>
<span class="lineNum">    1077 </span><span class="lineNoCov">          0 :                 gf_fputs(&quot;SequenceParameterSetExtension&quot;, dump);</span>
<span class="lineNum">    1078 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1079 </span><span class="lineCov">        501 :         case GF_AVC_NALU_SVC_PREFIX_NALU:</span>
<span class="lineNum">    1080 </span><span class="lineCov">        501 :                 gf_fputs(&quot;SVCPrefix&quot;, dump);</span>
<span class="lineNum">    1081 </span><span class="lineCov">        501 :                 break;</span>
<span class="lineNum">    1082 </span><span class="lineCov">          2 :         case GF_AVC_NALU_SVC_SUBSEQ_PARAM:</span>
<span class="lineNum">    1083 </span><span class="lineCov">          2 :                 gf_fputs(&quot;SVCSubsequenceParameterSet&quot;, dump);</span>
<span class="lineNum">    1084 </span><span class="lineCov">          2 :                 if (is_encrypted) break;</span>
<span class="lineNum">    1085 </span><span class="lineCov">          2 :                 idx = gf_avc_read_sps_bs(bs, avc, 1, NULL);</span>
<span class="lineNum">    1086 </span>            :                 assert (idx &gt;= 0);
<span class="lineNum">    1087 </span><span class="lineCov">          2 :                 if (full_bs_dump) break;</span>
<span class="lineNum">    1088 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot;\&quot; sps_id=\&quot;%d&quot;, idx - GF_SVC_SSPS_ID_SHIFT);</span>
<span class="lineNum">    1089 </span><span class="lineCov">          2 :                 break;</span>
<span class="lineNum">    1090 </span><span class="lineNoCov">          0 :         case GF_AVC_NALU_SLICE_AUX:</span>
<span class="lineNum">    1091 </span><span class="lineNoCov">          0 :                 gf_fputs(&quot;Auxiliary Slice&quot;, dump);</span>
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1093 </span>            : 
<span class="lineNum">    1094 </span><span class="lineCov">        749 :         case GF_AVC_NALU_SVC_SLICE:</span>
<span class="lineNum">    1095 </span><span class="lineCov">        749 :                 gf_fputs(is_svc ? &quot;SVCSlice&quot; : &quot;CodedSliceExtension&quot;, dump);</span>
<span class="lineNum">    1096 </span><span class="lineCov">        749 :                 if (is_encrypted) break;</span>
<span class="lineNum">    1097 </span><span class="lineCov">        749 :                 gf_avc_parse_nalu(bs, avc);</span>
<span class="lineNum">    1098 </span><span class="lineCov">        749 :                 dependency_id = (ptr[2] &amp; 0x70) &gt;&gt; 4;</span>
<span class="lineNum">    1099 </span><span class="lineCov">        749 :                 quality_id = (ptr[2] &amp; 0x0F);</span>
<span class="lineNum">    1100 </span><span class="lineCov">        749 :                 temporal_id = (ptr[3] &amp; 0xE0) &gt;&gt; 5;</span>
<span class="lineNum">    1101 </span><span class="lineCov">        749 :                 gf_fprintf(dump, &quot;\&quot; dependency_id=\&quot;%d\&quot; quality_id=\&quot;%d\&quot; temporal_id=\&quot;%d&quot;, dependency_id, quality_id, temporal_id);</span>
<span class="lineNum">    1102 </span><span class="lineCov">        749 :                 gf_fprintf(dump, &quot;\&quot; poc=\&quot;%d&quot;, avc-&gt;s_info.poc);</span>
<span class="lineNum">    1103 </span><span class="lineCov">        749 :                 break;</span>
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :         case 30:</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :                 gf_fputs(&quot;SVCAggregator&quot;, dump);</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1107 </span><span class="lineCov">        250 :         case 31:</span>
<span class="lineNum">    1108 </span><span class="lineCov">        250 :                 gf_fputs(&quot;SVCExtractor&quot;, dump);</span>
<span class="lineNum">    1109 </span><span class="lineCov">        250 :                 if (is_encrypted) break;</span>
<span class="lineNum">    1110 </span><span class="lineCov">        250 :                 track_ref_index = (u8) ptr[4];</span>
<span class="lineNum">    1111 </span><span class="lineCov">        250 :                 sample_offset = (s8) ptr[5];</span>
<span class="lineNum">    1112 </span><span class="lineCov">        250 :                 data_offset = inspect_get_nal_size(&amp;ptr[6], nalh_size);</span>
<span class="lineNum">    1113 </span><span class="lineCov">        250 :                 data_size = inspect_get_nal_size(&amp;ptr[6+nalh_size], nalh_size);</span>
<span class="lineNum">    1114 </span><span class="lineCov">        250 :                 gf_fprintf(dump, &quot;\&quot; track_ref_index=\&quot;%d\&quot; sample_offset=\&quot;%d\&quot; data_offset=\&quot;%d\&quot; data_size=\&quot;%d\&quot;&quot;, track_ref_index, sample_offset, data_offset, data_size);</span>
<span class="lineNum">    1115 </span><span class="lineCov">        250 :                 break;</span>
<span class="lineNum">    1116 </span>            : 
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :         default:</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :                 gf_fputs(&quot;UNKNOWN&quot;, dump);</span>
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1120 </span>            :         }
<span class="lineNum">    1121 </span><span class="lineCov">       3423 :         gf_fputs(&quot;\&quot;&quot;, dump);</span>
<span class="lineNum">    1122 </span>            : 
<span class="lineNum">    1123 </span><span class="lineCov">       3403 :         if (!full_bs_dump) {</span>
<span class="lineNum">    1124 </span><span class="lineCov">       3225 :                 if (nal_ref_idc) {</span>
<span class="lineNum">    1125 </span><span class="lineCov">       1246 :                         gf_fprintf(dump, &quot; nal_ref_idc=\&quot;%d\&quot;&quot;, nal_ref_idc);</span>
<span class="lineNum">    1126 </span>            :                 }
<span class="lineNum">    1127 </span><span class="lineCov">       3225 :                 if (res&gt;=0) {</span>
<span class="lineNum">    1128 </span><span class="lineCov">       1192 :                         gf_fprintf(dump, &quot; poc=\&quot;%d\&quot; pps_id=\&quot;%d\&quot; field_pic_flag=\&quot;%d\&quot;&quot;, avc-&gt;s_info.poc, avc-&gt;s_info.pps-&gt;id, (int)avc-&gt;s_info.field_pic_flag);</span>
<span class="lineNum">    1129 </span>            :                 }
<span class="lineNum">    1130 </span>            :         }
<span class="lineNum">    1131 </span>            : 
<span class="lineNum">    1132 </span><span class="lineCov">       3403 :         if (res == -1)</span>
<span class="lineNum">    1133 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; status=\&quot;error decoding slice\&quot;&quot;);</span>
<span class="lineNum">    1134 </span>            : 
<span class="lineNum">    1135 </span><span class="lineCov">       3403 :         if (!is_encrypted &amp;&amp; (type == GF_AVC_NALU_SEI)) {</span>
<span class="lineNum">    1136 </span><span class="lineCov">        516 :                 gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    1137 </span><span class="lineCov">        516 :                 gf_bs_set_logger(bs, NULL, NULL);</span>
<span class="lineNum">    1138 </span><span class="lineCov">        516 :                 dump_sei(dump, bs, GF_FALSE);</span>
<span class="lineNum">    1139 </span><span class="lineCov">        516 :                 gf_fprintf(dump, &quot;   &lt;/NALU&gt;\n&quot;);</span>
<span class="lineNum">    1140 </span>            :         } else {
<span class="lineNum">    1141 </span><span class="lineCov">       2887 :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    1142 </span>            :         }
<span class="lineNum">    1143 </span>            : 
<span class="lineNum">    1144 </span><span class="lineCov">       3403 :         if (bs) {</span>
<span class="lineNum">    1145 </span><span class="lineCov">       3403 :                 if (!pctx)</span>
<span class="lineNum">    1146 </span><span class="lineCov">       3047 :                         gf_bs_del(bs);</span>
<span class="lineNum">    1147 </span>            :                 else
<span class="lineNum">    1148 </span><span class="lineCov">        356 :                         gf_bs_set_logger(bs, NULL, NULL);</span>
<span class="lineNum">    1149 </span>            :         }
<span class="lineNum">    1150 </span>            : }
<a name="1151"><span class="lineNum">    1151 </span>            : </a>
<span class="lineNum">    1152 </span>            : GF_EXPORT
<span class="lineNum">    1153 </span><span class="lineCov">       7083 : void gf_inspect_dump_nalu(FILE *dump, u8 *ptr, u32 ptr_size, Bool is_svc, HEVCState *hevc, AVCState *avc, VVCState *vvc, u32 nalh_size, Bool dump_crc, Bool is_encrypted)</span>
<span class="lineNum">    1154 </span>            : {
<span class="lineNum">    1155 </span><span class="lineCov">       7083 :         gf_inspect_dump_nalu_internal(dump, ptr, ptr_size, is_svc, hevc, avc, vvc, nalh_size, dump_crc, is_encrypted, 0, NULL);</span>
<span class="lineNum">    1156 </span><span class="lineCov">       7083 : }</span>
<span class="lineNum">    1157 </span>            : 
<span class="lineNum">    1158 </span>            : static void av1_dump_tile(FILE *dump, u32 idx, AV1Tile *tile)
<span class="lineNum">    1159 </span>            : {
<span class="lineNum">    1160 </span><span class="lineCov">      78185 :         gf_fprintf(dump, &quot;     &lt;Tile number=\&quot;%d\&quot; start=\&quot;%d\&quot; size=\&quot;%d\&quot;/&gt;\n&quot;, idx, tile-&gt;obu_start_offset, tile-&gt;size);</span>
<a name="1161"><span class="lineNum">    1161 </span>            : }</a>
<span class="lineNum">    1162 </span>            : 
<span class="lineNum">    1163 </span><span class="lineCov">      26903 : static u64 gf_inspect_dump_obu_internal(FILE *dump, AV1State *av1, u8 *obu, u64 obu_length, ObuType obu_type, u64 obu_size, u32 hdr_size, Bool dump_crc, PidCtx *pctx, u32 full_dump)</span>
<span class="lineNum">    1164 </span>            : {
<span class="lineNum">    1165 </span><span class="lineCov">      26903 :         if (pctx) {</span>
<span class="lineNum">    1166 </span>            :                 InspectLogCbk lcbk;
<span class="lineNum">    1167 </span>            : 
<span class="lineNum">    1168 </span><span class="lineCov">        384 :                 if (full_dump&gt;=INSPECT_ANALYZE_BS) {</span>
<span class="lineNum">    1169 </span><span class="lineCov">        192 :                         lcbk.dump = dump;</span>
<span class="lineNum">    1170 </span><span class="lineCov">        192 :                         lcbk.dump_bits = (full_dump==INSPECT_ANALYZE_BS_BITS) ? GF_TRUE : GF_FALSE;</span>
<span class="lineNum">    1171 </span><span class="lineCov">        192 :                         gf_bs_set_logger(pctx-&gt;bs, regular_bs_log, &amp;lcbk);</span>
<span class="lineNum">    1172 </span>            : 
<span class="lineNum">    1173 </span><span class="lineCov">        192 :                         gf_fprintf(dump, &quot;   &lt;OBU&quot;);</span>
<span class="lineNum">    1174 </span>            :                 }
<span class="lineNum">    1175 </span><span class="lineCov">        384 :                 gf_av1_parse_obu(pctx-&gt;bs, &amp;obu_type, &amp;obu_size, &amp;hdr_size, pctx-&gt;av1_state);</span>
<span class="lineNum">    1176 </span>            : 
<span class="lineNum">    1177 </span>            : 
<span class="lineNum">    1178 </span><span class="lineCov">        384 :                 if (full_dump&gt;=INSPECT_ANALYZE_BS) {</span>
<span class="lineNum">    1179 </span><span class="lineCov">        192 :                         gf_bs_set_logger(pctx-&gt;bs, NULL, NULL);</span>
<span class="lineNum">    1180 </span>            :                 } else {
<span class="lineNum">    1181 </span>            :                         full_dump = 0;
<span class="lineNum">    1182 </span>            :                 }
<span class="lineNum">    1183 </span>            :         }
<span class="lineNum">    1184 </span>            : 
<span class="lineNum">    1185 </span><span class="lineCov">      26711 :         if (!full_dump) {</span>
<span class="lineNum">    1186 </span><span class="lineCov">      26711 :                 gf_fprintf(dump, &quot;   &lt;OBU&quot;);</span>
<span class="lineNum">    1187 </span>            :         }
<span class="lineNum">    1188 </span>            : 
<span class="lineNum">    1189 </span>            : 
<span class="lineNum">    1190 </span>            : #define DUMP_OBU_INT(_v) gf_fprintf(dump, #_v&quot;=\&quot;%d\&quot; &quot;, av1-&gt;_v);
<span class="lineNum">    1191 </span>            : #define DUMP_OBU_INT2(_n, _v) gf_fprintf(dump, _n&quot;=\&quot;%d\&quot; &quot;, _v);
<span class="lineNum">    1192 </span>            : 
<span class="lineNum">    1193 </span><span class="lineCov">      26903 :         gf_fprintf(dump, &quot; size=\&quot;&quot;LLU&quot;\&quot; type=\&quot;%s\&quot; header_size=\&quot;%d\&quot; &quot;, obu_size, gf_av1_get_obu_name(obu_type), hdr_size);</span>
<span class="lineNum">    1194 </span>            : 
<span class="lineNum">    1195 </span><span class="lineCov">      26903 :         if (!full_dump) {</span>
<span class="lineNum">    1196 </span><span class="lineCov">      26711 :                 gf_fprintf(dump, &quot;has_size_field=\&quot;%d\&quot; has_ext=\&quot;%d\&quot; temporalID=\&quot;%d\&quot; spatialID=\&quot;%d\&quot; &quot;, av1-&gt;obu_has_size_field, av1-&gt;obu_extension_flag, av1-&gt;temporal_id , av1-&gt;spatial_id);</span>
<span class="lineNum">    1197 </span>            :         }
<span class="lineNum">    1198 </span>            : 
<span class="lineNum">    1199 </span><span class="lineCov">      26903 :         if (dump_crc &amp;&amp; (obu_length&lt;0xFFFFFFFFUL))</span>
<span class="lineNum">    1200 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;crc=\&quot;%u\&quot; &quot;, gf_crc_32(obu, (u32) obu_length) );</span>
<span class="lineNum">    1201 </span><span class="lineCov">      26903 :         switch (obu_type) {</span>
<span class="lineNum">    1202 </span><span class="lineCov">        177 :         case OBU_SEQUENCE_HEADER:</span>
<span class="lineNum">    1203 </span><span class="lineCov">        177 :                 if (full_dump) break;</span>
<span class="lineNum">    1204 </span><span class="lineCov">        175 :                 DUMP_OBU_INT(sequence_width)</span>
<span class="lineNum">    1205 </span><span class="lineCov">        175 :                 DUMP_OBU_INT(sequence_height)</span>
<span class="lineNum">    1206 </span><span class="lineCov">        175 :                 DUMP_OBU_INT(bit_depth)</span>
<span class="lineNum">    1207 </span><span class="lineCov">        175 :                 DUMP_OBU_INT(still_picture)</span>
<span class="lineNum">    1208 </span><span class="lineCov">        175 :                 DUMP_OBU_INT(OperatingPointIdc)</span>
<span class="lineNum">    1209 </span><span class="lineCov">        175 :                 DUMP_OBU_INT(color_range)</span>
<span class="lineNum">    1210 </span><span class="lineCov">        175 :                 DUMP_OBU_INT(color_description_present_flag)</span>
<span class="lineNum">    1211 </span><span class="lineCov">        175 :                 DUMP_OBU_INT(color_primaries)</span>
<span class="lineNum">    1212 </span><span class="lineCov">        175 :                 DUMP_OBU_INT(transfer_characteristics)</span>
<span class="lineNum">    1213 </span><span class="lineCov">        175 :                 DUMP_OBU_INT(matrix_coefficients)</span>
<span class="lineNum">    1214 </span><span class="lineCov">        175 :                 DUMP_OBU_INT2(&quot;profile&quot;, av1-&gt;config-&gt;seq_profile)</span>
<span class="lineNum">    1215 </span><span class="lineCov">        175 :                 DUMP_OBU_INT2(&quot;level&quot;, av1-&gt;config-&gt;seq_level_idx_0)</span>
<span class="lineNum">    1216 </span><span class="lineCov">        175 :                 break;</span>
<span class="lineNum">    1217 </span><span class="lineCov">      26686 :         case OBU_FRAME_HEADER:</span>
<span class="lineNum">    1218 </span>            :         case OBU_FRAME:
<span class="lineNum">    1219 </span><span class="lineCov">      26686 :                 if (!full_dump) {</span>
<span class="lineNum">    1220 </span><span class="lineCov">      26496 :                         if (av1-&gt;frame_id_numbers_present_flag) {</span>
<span class="lineNum">    1221 </span><span class="lineNoCov">          0 :                                 DUMP_OBU_INT2(&quot;delta_frame_id_length_minus_2&quot;, av1-&gt;delta_frame_id_length_minus_2)</span>
<span class="lineNum">    1222 </span>            :                         }
<span class="lineNum">    1223 </span><span class="lineCov">      26496 :                         if (av1-&gt;reduced_still_picture_header) {</span>
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :                                 DUMP_OBU_INT(reduced_still_picture_header)</span>
<span class="lineNum">    1225 </span>            :                         }
<span class="lineNum">    1226 </span><span class="lineCov">      26496 :                         DUMP_OBU_INT2(&quot;uncompressed_header_bytes&quot;, av1-&gt;frame_state.uncompressed_header_bytes);</span>
<span class="lineNum">    1227 </span><span class="lineCov">      26496 :                         if (av1-&gt;frame_state.uncompressed_header_bytes) {</span>
<span class="lineNum">    1228 </span><span class="lineCov">      26496 :                                 if (av1-&gt;frame_state.frame_type==AV1_KEY_FRAME) gf_fprintf(dump, &quot;frame_type=\&quot;key\&quot; &quot;);</span>
<span class="lineNum">    1229 </span><span class="lineCov">      26330 :                                 else if (av1-&gt;frame_state.frame_type==AV1_INTER_FRAME) gf_fprintf(dump, &quot;frame_type=\&quot;inter\&quot; &quot;);</span>
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :                                 else if (av1-&gt;frame_state.frame_type==AV1_INTRA_ONLY_FRAME) gf_fprintf(dump, &quot;frame_type=\&quot;intra_only\&quot; &quot;);</span>
<span class="lineNum">    1231 </span><span class="lineNoCov">          0 :                                 else if (av1-&gt;frame_state.frame_type==AV1_SWITCH_FRAME) gf_fprintf(dump, &quot;frame_type=\&quot;switch\&quot; &quot;);</span>
<span class="lineNum">    1232 </span><span class="lineCov">      26496 :                                 gf_fprintf(dump, &quot;refresh_frame_flags=\&quot;%d\&quot; &quot;, av1-&gt;frame_state.refresh_frame_flags);</span>
<span class="lineNum">    1233 </span>            : 
<span class="lineNum">    1234 </span><span class="lineCov">      26496 :                                 DUMP_OBU_INT2(&quot;show_frame&quot;, av1-&gt;frame_state.show_frame);</span>
<span class="lineNum">    1235 </span><span class="lineCov">      26496 :                                 DUMP_OBU_INT2(&quot;show_existing_frame&quot;, av1-&gt;frame_state.show_existing_frame);</span>
<span class="lineNum">    1236 </span><span class="lineCov">      26496 :                                 DUMP_OBU_INT(width);</span>
<span class="lineNum">    1237 </span><span class="lineCov">      26496 :                                 DUMP_OBU_INT(height);</span>
<span class="lineNum">    1238 </span>            :                         }
<span class="lineNum">    1239 </span><span class="lineCov">      26496 :                         if (obu_type==OBU_FRAME_HEADER)</span>
<span class="lineNum">    1240 </span>            :                                 break;
<span class="lineNum">    1241 </span>            :                 }
<span class="lineNum">    1242 </span>            : 
<span class="lineNum">    1243 </span>            :         case OBU_TILE_GROUP:
<span class="lineNum">    1244 </span><span class="lineCov">      20012 :                 if (av1-&gt;frame_state.nb_tiles_in_obu) {</span>
<span class="lineNum">    1245 </span>            :                         u32 i;
<span class="lineNum">    1246 </span><span class="lineCov">      20012 :                         DUMP_OBU_INT2(&quot;nb_tiles&quot;, av1-&gt;frame_state.nb_tiles_in_obu)</span>
<span class="lineNum">    1247 </span>            :                         fprintf(dump, &quot;&gt;\n&quot;);
<span class="lineNum">    1248 </span><span class="lineCov">      98197 :                         for (i = 0; i &lt; av1-&gt;frame_state.nb_tiles_in_obu; i++) {</span>
<span class="lineNum">    1249 </span>            :                                 av1_dump_tile(dump, i, &amp;av1-&gt;frame_state.tiles[i]);
<span class="lineNum">    1250 </span>            :                         }
<span class="lineNum">    1251 </span>            :                 } else {
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;nb_tiles=\&quot;unknown\&quot;&gt;\n&quot;);</span>
<span class="lineNum">    1253 </span>            :                 }
<span class="lineNum">    1254 </span><span class="lineCov">      20012 :                 gf_fprintf(dump, &quot;   &lt;/OBU&gt;\n&quot;);</span>
<span class="lineNum">    1255 </span><span class="lineCov">      20012 :                 break;</span>
<span class="lineNum">    1256 </span>            :         default:
<span class="lineNum">    1257 </span>            :                 break;
<span class="lineNum">    1258 </span>            : 
<span class="lineNum">    1259 </span>            :         }
<span class="lineNum">    1260 </span><span class="lineCov">      33619 :         if (obu_type != OBU_TILE_GROUP &amp;&amp; obu_type != OBU_FRAME)</span>
<span class="lineNum">    1261 </span><span class="lineCov">       6891 :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    1262 </span>            : 
<span class="lineNum">    1263 </span><span class="lineCov">      26903 :         return obu_size;</span>
<span class="lineNum">    1264 </span>            : }
<a name="1265"><span class="lineNum">    1265 </span>            : </a>
<span class="lineNum">    1266 </span>            : GF_EXPORT
<span class="lineNum">    1267 </span><span class="lineCov">      26519 : void gf_inspect_dump_obu(FILE *dump, AV1State *av1, u8 *obu, u64 obu_length, ObuType obu_type, u64 obu_size, u32 hdr_size, Bool dump_crc)</span>
<span class="lineNum">    1268 </span>            : {
<span class="lineNum">    1269 </span><span class="lineCov">      26519 :         gf_inspect_dump_obu_internal(dump, av1, obu, obu_length, obu_type, obu_size, hdr_size, dump_crc, NULL, 0);</span>
<a name="1270"><span class="lineNum">    1270 </span><span class="lineCov">      26519 : }</span></a>
<span class="lineNum">    1271 </span>            : 
<span class="lineNum">    1272 </span><span class="lineCov">         31 : static void gf_inspect_dump_prores_internal(FILE *dump, u8 *ptr, u64 frame_size, Bool dump_crc, PidCtx *pctx)</span>
<span class="lineNum">    1273 </span>            : {
<span class="lineNum">    1274 </span>            :         GF_ProResFrameInfo prores_frame;
<span class="lineNum">    1275 </span>            :         GF_Err e;
<span class="lineNum">    1276 </span>            :         GF_BitStream *bs;
<span class="lineNum">    1277 </span><span class="lineCov">         31 :         if (pctx) {</span>
<span class="lineNum">    1278 </span><span class="lineNoCov">          0 :                 gf_bs_reassign_buffer(pctx-&gt;bs, ptr, frame_size);</span>
<span class="lineNum">    1279 </span><span class="lineNoCov">          0 :                 bs = pctx-&gt;bs;</span>
<span class="lineNum">    1280 </span>            :         } else {
<span class="lineNum">    1281 </span><span class="lineCov">         31 :                 bs = gf_bs_new(ptr, frame_size, GF_BITSTREAM_READ);</span>
<span class="lineNum">    1282 </span>            :         }
<span class="lineNum">    1283 </span><span class="lineCov">         31 :         e = gf_media_prores_parse_bs(bs, &amp;prores_frame);</span>
<span class="lineNum">    1284 </span><span class="lineCov">         31 :         if (!pctx) gf_bs_del(bs);</span>
<span class="lineNum">    1285 </span>            : 
<span class="lineNum">    1286 </span><span class="lineCov">         31 :         if (e) {</span>
<span class="lineNum">    1287 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;   &lt;!-- Error reading frame %s --&gt;\n&quot;, gf_error_to_string(e) );</span>
<span class="lineNum">    1288 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">    1289 </span>            :         }
<span class="lineNum">    1290 </span><span class="lineCov">         31 :         gf_fprintf(dump, &quot;   &lt;ProResFrame framesize=\&quot;%d\&quot; frameID=\&quot;%s\&quot; version=\&quot;%d\&quot;&quot;</span>
<span class="lineNum">    1291 </span>            :                 , prores_frame.frame_size
<span class="lineNum">    1292 </span>            :                 , gf_4cc_to_str(prores_frame.frame_identifier)
<span class="lineNum">    1293 </span><span class="lineCov">         31 :                 , prores_frame.version</span>
<span class="lineNum">    1294 </span>            :         );
<span class="lineNum">    1295 </span><span class="lineCov">         62 :         gf_fprintf(dump, &quot; encoderID=\&quot;%s\&quot; width=\&quot;%d\&quot; height=\&quot;%d\&quot;&quot;</span>
<span class="lineNum">    1296 </span>            :                 , gf_4cc_to_str(prores_frame.encoder_id)
<span class="lineNum">    1297 </span><span class="lineCov">         31 :                 , prores_frame.width</span>
<span class="lineNum">    1298 </span><span class="lineCov">         31 :                 , prores_frame.height</span>
<span class="lineNum">    1299 </span>            :         );
<span class="lineNum">    1300 </span><span class="lineCov">         31 :         switch (prores_frame.chroma_format) {</span>
<span class="lineNum">    1301 </span><span class="lineNoCov">          0 :         case 0: gf_fprintf(dump, &quot; chromaFormat=\&quot;reserved(0)\&quot;&quot;); break;</span>
<span class="lineNum">    1302 </span><span class="lineNoCov">          0 :         case 1: gf_fprintf(dump, &quot; chromaFormat=\&quot;reserved(1)\&quot;&quot;); break;</span>
<span class="lineNum">    1303 </span><span class="lineCov">         31 :         case 2: gf_fprintf(dump, &quot; chromaFormat=\&quot;4:2:2\&quot;&quot;); break;</span>
<span class="lineNum">    1304 </span><span class="lineNoCov">          0 :         case 3: gf_fprintf(dump, &quot; chromaFormat=\&quot;4:4:4\&quot;&quot;); break;</span>
<span class="lineNum">    1305 </span>            :         }
<span class="lineNum">    1306 </span><span class="lineCov">         31 :         switch (prores_frame.interlaced_mode) {</span>
<span class="lineNum">    1307 </span><span class="lineNoCov">          0 :         case 0: gf_fprintf(dump, &quot; interlacedMode=\&quot;progressive\&quot;&quot;); break;</span>
<span class="lineNum">    1308 </span><span class="lineNoCov">          0 :         case 1: gf_fprintf(dump, &quot; interlacedMode=\&quot;interlaced_top_first\&quot;&quot;); break;</span>
<span class="lineNum">    1309 </span><span class="lineCov">         31 :         case 2: gf_fprintf(dump, &quot; interlacedMode=\&quot;interlaced_bottom_first\&quot;&quot;); break;</span>
<span class="lineNum">    1310 </span><span class="lineNoCov">          0 :         case 3: gf_fprintf(dump, &quot; interlacedMode=\&quot;reserved\&quot;&quot;); break;</span>
<span class="lineNum">    1311 </span>            :         }
<span class="lineNum">    1312 </span><span class="lineCov">         31 :         switch (prores_frame.aspect_ratio_information) {</span>
<span class="lineNum">    1313 </span><span class="lineCov">         31 :         case 0: gf_fprintf(dump, &quot; aspectRatio=\&quot;unknown\&quot;&quot;); break;</span>
<span class="lineNum">    1314 </span><span class="lineNoCov">          0 :         case 1: gf_fprintf(dump, &quot; aspectRatio=\&quot;1:1\&quot;&quot;); break;</span>
<span class="lineNum">    1315 </span><span class="lineNoCov">          0 :         case 2: gf_fprintf(dump, &quot; aspectRatio=\&quot;4:3\&quot;&quot;); break;</span>
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :         case 3: gf_fprintf(dump, &quot; aspectRatio=\&quot;16:9\&quot;&quot;); break;</span>
<span class="lineNum">    1317 </span><span class="lineNoCov">          0 :         default: gf_fprintf(dump, &quot; aspectRatio=\&quot;reserved(%d)\&quot;&quot;, prores_frame.aspect_ratio_information); break;</span>
<span class="lineNum">    1318 </span>            :         }
<span class="lineNum">    1319 </span><span class="lineCov">         31 :         switch (prores_frame.framerate_code) {</span>
<span class="lineNum">    1320 </span><span class="lineCov">         31 :         case 0: gf_fprintf(dump, &quot; framerate=\&quot;unknown\&quot;&quot;); break;</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :         case 1: gf_fprintf(dump, &quot; framerate=\&quot;23.976\&quot;&quot;); break;</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">          0 :         case 2: gf_fprintf(dump, &quot; framerate=\&quot;24\&quot;&quot;); break;</span>
<span class="lineNum">    1323 </span><span class="lineNoCov">          0 :         case 3: gf_fprintf(dump, &quot; framerate=\&quot;25\&quot;&quot;); break;</span>
<span class="lineNum">    1324 </span><span class="lineNoCov">          0 :         case 4: gf_fprintf(dump, &quot; framerate=\&quot;29.97\&quot;&quot;); break;</span>
<span class="lineNum">    1325 </span><span class="lineNoCov">          0 :         case 5: gf_fprintf(dump, &quot; framerate=\&quot;30\&quot;&quot;); break;</span>
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :         case 6: gf_fprintf(dump, &quot; framerate=\&quot;50\&quot;&quot;); break;</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 :         case 7: gf_fprintf(dump, &quot; framerate=\&quot;59.94\&quot;&quot;); break;</span>
<span class="lineNum">    1328 </span><span class="lineNoCov">          0 :         case 8: gf_fprintf(dump, &quot; framerate=\&quot;60\&quot;&quot;); break;</span>
<span class="lineNum">    1329 </span><span class="lineNoCov">          0 :         case 9: gf_fprintf(dump, &quot; framerate=\&quot;100\&quot;&quot;); break;</span>
<span class="lineNum">    1330 </span><span class="lineNoCov">          0 :         case 10: gf_fprintf(dump, &quot; framerate=\&quot;119.88\&quot;&quot;); break;</span>
<span class="lineNum">    1331 </span><span class="lineNoCov">          0 :         case 11: gf_fprintf(dump, &quot; framerate=\&quot;120\&quot;&quot;); break;</span>
<span class="lineNum">    1332 </span><span class="lineNoCov">          0 :         default: gf_fprintf(dump, &quot; framerate=\&quot;reserved(%d)\&quot;&quot;, prores_frame.framerate_code); break;</span>
<span class="lineNum">    1333 </span>            :         }
<span class="lineNum">    1334 </span><span class="lineCov">         31 :         switch (prores_frame.color_primaries) {</span>
<span class="lineNum">    1335 </span><span class="lineCov">         31 :         case 0: case 2: gf_fprintf(dump, &quot; colorPrimaries=\&quot;unknown\&quot;&quot;); break;</span>
<span class="lineNum">    1336 </span><span class="lineNoCov">          0 :         case 1: gf_fprintf(dump, &quot; colorPrimaries=\&quot;BT.709\&quot;&quot;); break;</span>
<span class="lineNum">    1337 </span><span class="lineNoCov">          0 :         case 5: gf_fprintf(dump, &quot; colorPrimaries=\&quot;BT.601-625\&quot;&quot;); break;</span>
<span class="lineNum">    1338 </span><span class="lineNoCov">          0 :         case 6: gf_fprintf(dump, &quot; colorPrimaries=\&quot;BT.601-525\&quot;&quot;); break;</span>
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 :         case 9: gf_fprintf(dump, &quot; colorPrimaries=\&quot;BT.2020\&quot;&quot;); break;</span>
<span class="lineNum">    1340 </span><span class="lineNoCov">          0 :         case 11: gf_fprintf(dump, &quot; colorPrimaries=\&quot;P3\&quot;&quot;); break;</span>
<span class="lineNum">    1341 </span><span class="lineNoCov">          0 :         case 12: gf_fprintf(dump, &quot; colorPrimaries=\&quot;P3-D65\&quot;&quot;); break;</span>
<span class="lineNum">    1342 </span><span class="lineNoCov">          0 :         default: gf_fprintf(dump, &quot; colorPrimaries=\&quot;reserved(%d)\&quot;&quot;, prores_frame.color_primaries); break;</span>
<span class="lineNum">    1343 </span>            :         }
<span class="lineNum">    1344 </span><span class="lineCov">         31 :         switch (prores_frame.matrix_coefficients) {</span>
<span class="lineNum">    1345 </span><span class="lineNoCov">          0 :         case 0: case 2: gf_fprintf(dump, &quot; matrixCoefficients=\&quot;unknown\&quot;&quot;); break;</span>
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :         case 1: gf_fprintf(dump, &quot; matrixCoefficients=\&quot;BT.709\&quot;&quot;); break;</span>
<span class="lineNum">    1347 </span><span class="lineCov">         31 :         case 6: gf_fprintf(dump, &quot; matrixCoefficients=\&quot;BT.601\&quot;&quot;); break;</span>
<span class="lineNum">    1348 </span><span class="lineNoCov">          0 :         case 9: gf_fprintf(dump, &quot; matrixCoefficients=\&quot;BT.2020\&quot;&quot;); break;</span>
<span class="lineNum">    1349 </span><span class="lineNoCov">          0 :         default: gf_fprintf(dump, &quot; matrixCoefficients=\&quot;reserved(%d)\&quot;&quot;, prores_frame.matrix_coefficients); break;</span>
<span class="lineNum">    1350 </span>            :         }
<span class="lineNum">    1351 </span><span class="lineCov">         31 :         switch (prores_frame.transfer_characteristics) {</span>
<span class="lineNum">    1352 </span><span class="lineNoCov">          0 :         case 0: gf_fprintf(dump, &quot; transferCharacteristics=\&quot;unknown\&quot;&quot;); break;</span>
<span class="lineNum">    1353 </span><span class="lineNoCov">          0 :         case 1: gf_fprintf(dump, &quot; transferCharacteristics=\&quot;BT-709\&quot;&quot;); break;</span>
<span class="lineNum">    1354 </span><span class="lineNoCov">          0 :         case 16: gf_fprintf(dump, &quot; transferCharacteristics=\&quot;ST-2084\&quot;&quot;); break;</span>
<span class="lineNum">    1355 </span><span class="lineNoCov">          0 :         case 18: gf_fprintf(dump, &quot; transferCharacteristics=\&quot;STD-B67\&quot;&quot;); break;</span>
<span class="lineNum">    1356 </span><span class="lineCov">         31 :         case 2:</span>
<span class="lineNum">    1357 </span>            :         default:
<span class="lineNum">    1358 </span><span class="lineCov">         31 :                 gf_fprintf(dump, &quot; transferCharacteristics=\&quot;unspecified\&quot;&quot;); break;</span>
<span class="lineNum">    1359 </span>            :         }
<span class="lineNum">    1360 </span><span class="lineCov">         31 :         switch (prores_frame.alpha_channel_type) {</span>
<span class="lineNum">    1361 </span><span class="lineCov">         31 :         case 0: gf_fprintf(dump, &quot; alphaChannel=\&quot;none\&quot;&quot;); break;</span>
<span class="lineNum">    1362 </span><span class="lineNoCov">          0 :         case 1: gf_fprintf(dump, &quot; alphaChannel=\&quot;8bits\&quot;&quot;); break;</span>
<span class="lineNum">    1363 </span><span class="lineNoCov">          0 :         case 2: gf_fprintf(dump, &quot; alphaChannel=\&quot;16bits\&quot;&quot;); break;</span>
<span class="lineNum">    1364 </span><span class="lineNoCov">          0 :         default: gf_fprintf(dump, &quot; alphaChannel=\&quot;reserved(%d)\&quot;&quot;, prores_frame.alpha_channel_type); break;</span>
<span class="lineNum">    1365 </span>            :         }
<span class="lineNum">    1366 </span><span class="lineCov">         31 :         gf_fprintf(dump, &quot; numPictures=\&quot;%d\&quot;&quot; , prores_frame.transfer_characteristics, prores_frame.nb_pic);</span>
<span class="lineNum">    1367 </span>            : 
<span class="lineNum">    1368 </span><span class="lineCov">         31 :         if (dump_crc) {</span>
<span class="lineNum">    1369 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; crc=\&quot;%d\&quot;&quot; , gf_crc_32(ptr, (u32) frame_size) );</span>
<span class="lineNum">    1370 </span>            :         }
<span class="lineNum">    1371 </span><span class="lineCov">         31 :         if (!prores_frame.load_luma_quant_matrix &amp;&amp; !prores_frame.load_chroma_quant_matrix) {</span>
<span class="lineNum">    1372 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    1373 </span>            :         } else {
<span class="lineNum">    1374 </span>            :                 u32 j, k;
<span class="lineNum">    1375 </span><span class="lineCov">         31 :                 gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    1376 </span><span class="lineCov">         31 :                 if (prores_frame.load_luma_quant_matrix) {</span>
<span class="lineNum">    1377 </span><span class="lineCov">         31 :                         gf_fprintf(dump, &quot;    &lt;LumaQuantMatrix coefs=\&quot;&quot;);</span>
<span class="lineNum">    1378 </span><span class="lineCov">        279 :                         for (j=0; j&lt;8; j++) {</span>
<span class="lineNum">    1379 </span><span class="lineCov">       1984 :                                 for (k=0; k&lt;8; k++) {</span>
<span class="lineNum">    1380 </span><span class="lineCov">       1984 :                                         gf_fprintf(dump, &quot; %02X&quot;, prores_frame.luma_quant_matrix[j][k]);</span>
<span class="lineNum">    1381 </span>            :                                 }
<span class="lineNum">    1382 </span>            :                         }
<span class="lineNum">    1383 </span><span class="lineCov">         31 :                         gf_fprintf(dump, &quot;\&quot;&gt;\n&quot;);</span>
<span class="lineNum">    1384 </span>            :                 }
<span class="lineNum">    1385 </span><span class="lineCov">         31 :                 if (prores_frame.load_chroma_quant_matrix) {</span>
<span class="lineNum">    1386 </span><span class="lineCov">         31 :                         gf_fprintf(dump, &quot;    &lt;ChromaQuantMatrix coefs=\&quot;&quot;);</span>
<span class="lineNum">    1387 </span><span class="lineCov">        279 :                         for (j=0; j&lt;8; j++) {</span>
<span class="lineNum">    1388 </span><span class="lineCov">       1984 :                                 for (k=0; k&lt;8; k++) {</span>
<span class="lineNum">    1389 </span><span class="lineCov">       1984 :                                         gf_fprintf(dump, &quot; %02X&quot;, prores_frame.chroma_quant_matrix[j][k]);</span>
<span class="lineNum">    1390 </span>            :                                 }
<span class="lineNum">    1391 </span>            :                         }
<span class="lineNum">    1392 </span><span class="lineCov">         31 :                         gf_fprintf(dump, &quot;\&quot;&gt;\n&quot;);</span>
<span class="lineNum">    1393 </span>            :                 }
<span class="lineNum">    1394 </span><span class="lineCov">         31 :                 gf_fprintf(dump, &quot;   &lt;/ProResFrame&gt;\n&quot;);</span>
<span class="lineNum">    1395 </span>            :         }
<span class="lineNum">    1396 </span>            : }
<a name="1397"><span class="lineNum">    1397 </span>            : </a>
<span class="lineNum">    1398 </span>            : GF_EXPORT
<span class="lineNum">    1399 </span><span class="lineCov">         31 : void gf_inspect_dump_prores(FILE *dump, u8 *ptr, u64 frame_size, Bool dump_crc)</span>
<span class="lineNum">    1400 </span>            : {
<span class="lineNum">    1401 </span><span class="lineCov">         31 :         gf_inspect_dump_prores_internal(dump, ptr, frame_size, dump_crc, NULL);</span>
<span class="lineNum">    1402 </span><span class="lineCov">         31 : }</span>
<span class="lineNum">    1403 </span>            : enum {
<span class="lineNum">    1404 </span>            :         MHAS_FILLER = 0,
<span class="lineNum">    1405 </span>            :         MHAS_CONFIG,
<span class="lineNum">    1406 </span>            :         MHAS_FRAME,
<span class="lineNum">    1407 </span>            :         MHAS_SCENE_INFO,
<span class="lineNum">    1408 </span>            :         MHAS_RES4,
<span class="lineNum">    1409 </span>            :         MHAS_RES5,
<span class="lineNum">    1410 </span>            :         MHAS_SYNC,
<span class="lineNum">    1411 </span>            :         MHAS_SYNC_GAP,
<span class="lineNum">    1412 </span>            :         MHAS_MARKER,
<span class="lineNum">    1413 </span>            :         MHAS_CRC16,
<span class="lineNum">    1414 </span>            :         MHAS_CRC32,
<span class="lineNum">    1415 </span>            :         MHAS_DESCRIPTOR,
<span class="lineNum">    1416 </span>            :         MHAS_INTERACTION,
<span class="lineNum">    1417 </span>            :         MHAS_LOUDNESS_CRC,
<span class="lineNum">    1418 </span>            :         MHAS_BUFFER_INFO,
<span class="lineNum">    1419 </span>            :         MHAS_GLOBAL_CRC16,
<span class="lineNum">    1420 </span>            :         MHAS_GLOBAL_CRC32,
<span class="lineNum">    1421 </span>            :         MHAS_AUDIO_TRUNCATION,
<span class="lineNum">    1422 </span>            :         MHAS_GEN_DATA,
<span class="lineNum">    1423 </span>            : };
<span class="lineNum">    1424 </span>            : static struct {
<span class="lineNum">    1425 </span>            :         u32 type;
<span class="lineNum">    1426 </span>            :         const char *name;
<span class="lineNum">    1427 </span>            : } mhas_pack_types[] =
<span class="lineNum">    1428 </span>            : {
<span class="lineNum">    1429 </span>            :         {MHAS_FILLER, &quot;filler&quot;},
<span class="lineNum">    1430 </span>            :         {MHAS_CONFIG, &quot;config&quot;},
<span class="lineNum">    1431 </span>            :         {MHAS_FRAME, &quot;frame&quot;},
<span class="lineNum">    1432 </span>            :         {MHAS_SCENE_INFO, &quot;scene_info&quot;},
<span class="lineNum">    1433 </span>            :         {MHAS_SYNC, &quot;sync&quot;},
<span class="lineNum">    1434 </span>            :         {MHAS_SYNC_GAP, &quot;sync_gap&quot;},
<span class="lineNum">    1435 </span>            :         {MHAS_MARKER, &quot;marker&quot;},
<span class="lineNum">    1436 </span>            :         {MHAS_CRC16, &quot;crc16&quot;},
<span class="lineNum">    1437 </span>            :         {MHAS_CRC32, &quot;crc32&quot;},
<span class="lineNum">    1438 </span>            :         {MHAS_DESCRIPTOR, &quot;descriptor&quot;},
<span class="lineNum">    1439 </span>            :         {MHAS_INTERACTION, &quot;interaction&quot;},
<span class="lineNum">    1440 </span>            :         {MHAS_LOUDNESS_CRC, &quot;loudness_drc&quot;},
<span class="lineNum">    1441 </span>            :         {MHAS_BUFFER_INFO, &quot;buffer_info&quot;},
<span class="lineNum">    1442 </span>            :         {MHAS_GLOBAL_CRC16, &quot;global_crc16&quot;},
<span class="lineNum">    1443 </span>            :         {MHAS_GLOBAL_CRC32, &quot;global_crc32&quot;},
<span class="lineNum">    1444 </span>            :         {MHAS_AUDIO_TRUNCATION, &quot;audio_truncation&quot;},
<span class="lineNum">    1445 </span>            :         {MHAS_GEN_DATA, &quot;gen_data&quot;},
<a name="1446"><span class="lineNum">    1446 </span>            : };</a>
<span class="lineNum">    1447 </span>            : 
<span class="lineNum">    1448 </span><span class="lineNoCov">          0 : static void dump_mha_config(FILE *dump, GF_BitStream *bs, const char *indent)</span>
<span class="lineNum">    1449 </span>            : {
<span class="lineNum">    1450 </span>            :         u32 val;
<span class="lineNum">    1451 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot;%s&lt;MPEGHConfig&quot;, indent);</span>
<span class="lineNum">    1452 </span><span class="lineNoCov">          0 :         val = gf_bs_read_int(bs, 8);</span>
<span class="lineNum">    1453 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot; ProfileLevelIndication=\&quot;%d\&quot;&quot;, val);</span>
<span class="lineNum">    1454 </span><span class="lineNoCov">          0 :         val = gf_bs_read_int(bs, 5);</span>
<span class="lineNum">    1455 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot; usacSamplerateIndex=\&quot;%d\&quot;&quot;, val);</span>
<span class="lineNum">    1456 </span><span class="lineNoCov">          0 :         if (val==0x1f) {</span>
<span class="lineNum">    1457 </span><span class="lineNoCov">          0 :                 val = gf_bs_read_int(bs, 24);</span>
<span class="lineNum">    1458 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; usacSamplerate=\&quot;%d\&quot;&quot;, val);</span>
<span class="lineNum">    1459 </span>            :         }
<span class="lineNum">    1460 </span><span class="lineNoCov">          0 :         val = gf_bs_read_int(bs, 3);</span>
<span class="lineNum">    1461 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot; coreSbrFrameLengthIndex=\&quot;%d\&quot;&quot;, val);</span>
<span class="lineNum">    1462 </span><span class="lineNoCov">          0 :         gf_bs_read_int(bs, 1);</span>
<span class="lineNum">    1463 </span><span class="lineNoCov">          0 :         val = gf_bs_read_int(bs, 1);</span>
<span class="lineNum">    1464 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot; receiverDelayCompensation=\&quot;%d\&quot;&quot;, val);</span>
<a name="1465"><span class="lineNum">    1465 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span></a>
<span class="lineNum">    1466 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1467 </span><span class="lineNoCov">          0 : static void gf_inspect_dump_mha_frame(FILE *dump, GF_BitStream *bs, const char *indent)</span>
<span class="lineNum">    1468 </span>            : {
<span class="lineNum">    1469 </span>            :         u32 val;
<span class="lineNum">    1470 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot;%s&lt;MPEGHFrame&quot;, indent);</span>
<span class="lineNum">    1471 </span><span class="lineNoCov">          0 :         val = gf_bs_read_int(bs, 1);</span>
<span class="lineNum">    1472 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot; usacIndependencyFlag=\&quot;%d\&quot;&quot;, val);</span>
<a name="1473"><span class="lineNum">    1473 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span></a>
<span class="lineNum">    1474 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1475 </span><span class="lineNoCov">          0 : static void gf_inspect_dump_mhas(FILE *dump, u8 *ptr, u64 frame_size, Bool dump_crc, PidCtx *pctx)</span>
<span class="lineNum">    1476 </span>            : {
<span class="lineNum">    1477 </span>            :         u64 gf_mpegh_escaped_value(GF_BitStream *bs, u32 nBits1, u32 nBits2, u32 nBits3);
<span class="lineNum">    1478 </span><span class="lineNoCov">          0 :         gf_bs_reassign_buffer(pctx-&gt;bs, ptr, frame_size);</span>
<span class="lineNum">    1479 </span><span class="lineNoCov">          0 :         GF_BitStream *bs = pctx-&gt;bs;</span>
<span class="lineNum">    1480 </span>            : 
<span class="lineNum">    1481 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot;   &lt;MHASFrame&gt;\n&quot;);</span>
<span class="lineNum">    1482 </span>            : 
<span class="lineNum">    1483 </span><span class="lineNoCov">          0 :         while (gf_bs_available(bs)) {</span>
<span class="lineNum">    1484 </span>            :                 u32 i, count;
<span class="lineNum">    1485 </span>            :                 const char *type_name=&quot;uknown&quot;;
<span class="lineNum">    1486 </span>            :                 u64 pos;
<span class="lineNum">    1487 </span><span class="lineNoCov">          0 :                 u32 type = (u32) gf_mpegh_escaped_value(bs, 3, 8, 8);</span>
<span class="lineNum">    1488 </span><span class="lineNoCov">          0 :                 u64 label = gf_mpegh_escaped_value(bs, 2, 8, 32);</span>
<span class="lineNum">    1489 </span><span class="lineNoCov">          0 :                 u64 size = gf_mpegh_escaped_value(bs, 11, 24, 24);</span>
<span class="lineNum">    1490 </span>            : 
<span class="lineNum">    1491 </span>            :                 count = GF_ARRAY_LENGTH(mhas_pack_types);
<span class="lineNum">    1492 </span><span class="lineNoCov">          0 :                 for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    1493 </span><span class="lineNoCov">          0 :                         if (mhas_pack_types[i].type==type) {</span>
<span class="lineNum">    1494 </span><span class="lineNoCov">          0 :                                 type_name = mhas_pack_types[i].name;</span>
<span class="lineNum">    1495 </span>            :                                 break;
<span class="lineNum">    1496 </span>            :                         }
<span class="lineNum">    1497 </span>            :                 }
<span class="lineNum">    1498 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;    &lt;MHASPacket type=\&quot;%s\&quot; label=\&quot;&quot;LLU&quot;\&quot; size=\&quot;&quot;LLU&quot;\&quot;&quot;, type_name, label, size);</span>
<span class="lineNum">    1499 </span>            : 
<span class="lineNum">    1500 </span><span class="lineNoCov">          0 :                 pos = gf_bs_get_position(bs);</span>
<span class="lineNum">    1501 </span><span class="lineNoCov">          0 :                 switch (type) {</span>
<span class="lineNum">    1502 </span><span class="lineNoCov">          0 :                 case MHAS_CONFIG:</span>
<span class="lineNum">    1503 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    1504 </span><span class="lineNoCov">          0 :                         dump_mha_config(dump, bs, &quot;     &quot;);</span>
<span class="lineNum">    1505 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;    &lt;/MHASPacket&gt;\n&quot;);</span>
<span class="lineNum">    1506 </span>            :                         break;
<span class="lineNum">    1507 </span><span class="lineNoCov">          0 :                 case MHAS_FRAME:</span>
<span class="lineNum">    1508 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    1509 </span><span class="lineNoCov">          0 :                         gf_inspect_dump_mha_frame(dump, bs, &quot;     &quot;);</span>
<span class="lineNum">    1510 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;    &lt;/MHASPacket&gt;\n&quot;);</span>
<span class="lineNum">    1511 </span>            :                         break;
<span class="lineNum">    1512 </span><span class="lineNoCov">          0 :                 case MHAS_BUFFER_INFO:</span>
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 :                         if (gf_bs_read_int(bs, 1)) {</span>
<span class="lineNum">    1514 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; buffer_fullness_present=\&quot;1\&quot; buffer_fullness=\&quot;&quot;LLU&quot;\&quot;&quot;, gf_mpegh_escaped_value(bs, 15,24,32) );</span>
<span class="lineNum">    1515 </span>            :                         } else {
<span class="lineNum">    1516 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; buffer_fullness_present=\&quot;0\&quot;&quot;);</span>
<span class="lineNum">    1517 </span>            : 
<span class="lineNum">    1518 </span>            :                         }
<span class="lineNum">    1519 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    1520 </span>            :                         break;
<span class="lineNum">    1521 </span><span class="lineNoCov">          0 :                 case MHAS_SYNC:</span>
<span class="lineNum">    1522 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; sync=\&quot;0x%02X\&quot;/&gt;\n&quot;, gf_bs_read_u8(bs) );</span>
<span class="lineNum">    1523 </span>            :                         break;
<span class="lineNum">    1524 </span><span class="lineNoCov">          0 :                 case MHAS_SYNC_GAP:</span>
<span class="lineNum">    1525 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; syncSpacingLength=\&quot;0x%02&quot; LLX_SUF &quot;\&quot;/&gt;\n&quot;, gf_mpegh_escaped_value(bs, 16, 24, 24) );</span>
<span class="lineNum">    1526 </span>            :                         break;
<span class="lineNum">    1527 </span><span class="lineNoCov">          0 :                 case MHAS_MARKER:</span>
<span class="lineNum">    1528 </span>            :                 case MHAS_DESCRIPTOR:
<span class="lineNum">    1529 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; %s=\&quot;0x&quot;, (type==MHAS_MARKER) ? &quot;markers&quot; : &quot;descriptors&quot;);</span>
<span class="lineNum">    1530 </span><span class="lineNoCov">          0 :                         for (i=0; i&lt;size; i++)</span>
<span class="lineNum">    1531 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;%02X&quot;, gf_bs_read_u8(bs) );</span>
<span class="lineNum">    1532 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot;/&gt;\n&quot;);</span>
<span class="lineNum">    1533 </span>            :                         break;
<span class="lineNum">    1534 </span><span class="lineNoCov">          0 :                 default:</span>
<span class="lineNum">    1535 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    1536 </span>            :                         break;
<span class="lineNum">    1537 </span>            :                 }
<span class="lineNum">    1538 </span><span class="lineNoCov">          0 :                 gf_bs_align(bs);</span>
<span class="lineNum">    1539 </span><span class="lineNoCov">          0 :                 pos = gf_bs_get_position(bs) - pos;</span>
<span class="lineNum">    1540 </span><span class="lineNoCov">          0 :                 if (pos &lt; size)</span>
<span class="lineNum">    1541 </span><span class="lineNoCov">          0 :                         gf_bs_skip_bytes(bs, size - pos);</span>
<span class="lineNum">    1542 </span>            : 
<span class="lineNum">    1543 </span>            :         }
<span class="lineNum">    1544 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot;   &lt;/MHASFrame&gt;\n&quot;);</span>
<span class="lineNum">    1545 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1546 </span>            : 
<span class="lineNum">    1547 </span>            : #endif
<a name="1548"><span class="lineNum">    1548 </span>            : </a>
<span class="lineNum">    1549 </span>            : 
<span class="lineNum">    1550 </span><span class="lineCov">       1392 : static void finalize_dump(GF_InspectCtx *ctx, u32 streamtype, Bool concat)</span>
<span class="lineNum">    1551 </span>            : {
<span class="lineNum">    1552 </span>            :         char szLine[1025];
<span class="lineNum">    1553 </span><span class="lineCov">       1392 :         u32 i, count = gf_list_count(ctx-&gt;src_pids);</span>
<span class="lineNum">    1554 </span><span class="lineCov">       3534 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    1555 </span><span class="lineCov">       2142 :                 PidCtx *pctx = gf_list_get(ctx-&gt;src_pids, i);</span>
<span class="lineNum">    1556 </span>            :                 //already done
<span class="lineNum">    1557 </span><span class="lineCov">       2142 :                 if (!pctx-&gt;tmp) continue;</span>
<span class="lineNum">    1558 </span>            :                 //not our streamtype
<span class="lineNum">    1559 </span><span class="lineCov">        607 :                 if (streamtype &amp;&amp; (pctx-&gt;stream_type!=streamtype)) continue;</span>
<span class="lineNum">    1560 </span>            : 
<span class="lineNum">    1561 </span><span class="lineCov">        290 :                 if (concat) {</span>
<span class="lineNum">    1562 </span><span class="lineCov">        290 :                         gf_fseek(pctx-&gt;tmp, 0, SEEK_SET);</span>
<span class="lineNum">    1563 </span><span class="lineCov">      21402 :                         while (!gf_feof(pctx-&gt;tmp)) {</span>
<span class="lineNum">    1564 </span><span class="lineCov">      20822 :                                 u32 read = (u32) gf_fread(szLine, 1024, pctx-&gt;tmp);</span>
<span class="lineNum">    1565 </span><span class="lineCov">      20822 :                                 gf_fwrite(szLine, read, ctx-&gt;dump);</span>
<span class="lineNum">    1566 </span>            :                         }
<span class="lineNum">    1567 </span>            :                 }
<span class="lineNum">    1568 </span><span class="lineCov">        290 :                 gf_fclose(pctx-&gt;tmp);</span>
<span class="lineNum">    1569 </span><span class="lineCov">        290 :                 if (ctx-&gt;xml)</span>
<span class="lineNum">    1570 </span><span class="lineNoCov">          0 :                         gf_fprintf(ctx-&gt;dump, &quot;&lt;/PIDInspect&gt;\n&quot;);</span>
<span class="lineNum">    1571 </span><span class="lineCov">        290 :                 pctx-&gt;tmp = NULL;</span>
<span class="lineNum">    1572 </span>            :         }
<a name="1573"><span class="lineNum">    1573 </span><span class="lineCov">       1392 : }</span></a>
<span class="lineNum">    1574 </span>            : 
<span class="lineNum">    1575 </span><span class="lineCov">        437 : static void inspect_finalize(GF_Filter *filter)</span>
<span class="lineNum">    1576 </span>            : {
<span class="lineNum">    1577 </span>            :         Bool concat=GF_FALSE;
<span class="lineNum">    1578 </span><span class="lineCov">        437 :         GF_InspectCtx *ctx = (GF_InspectCtx *) gf_filter_get_udta(filter);</span>
<span class="lineNum">    1579 </span>            : 
<span class="lineNum">    1580 </span><span class="lineCov">        437 :         if (ctx-&gt;dump) {</span>
<span class="lineNum">    1581 </span><span class="lineCov">        374 :                 if ((ctx-&gt;dump!=stderr) &amp;&amp; (ctx-&gt;dump!=stdout)) concat=GF_TRUE;</span>
<span class="lineNum">    1582 </span><span class="lineCov">         23 :                 else if (!ctx-&gt;interleave) concat=GF_TRUE;</span>
<span class="lineNum">    1583 </span>            :         }
<span class="lineNum">    1584 </span><span class="lineCov">        437 :         if (!ctx-&gt;interleave) {</span>
<span class="lineNum">    1585 </span><span class="lineCov">        232 :                 finalize_dump(ctx, GF_STREAM_AUDIO, concat);</span>
<span class="lineNum">    1586 </span><span class="lineCov">        232 :                 finalize_dump(ctx, GF_STREAM_VISUAL, concat);</span>
<span class="lineNum">    1587 </span><span class="lineCov">        232 :                 finalize_dump(ctx, GF_STREAM_SCENE, concat);</span>
<span class="lineNum">    1588 </span><span class="lineCov">        232 :                 finalize_dump(ctx, GF_STREAM_OD, concat);</span>
<span class="lineNum">    1589 </span><span class="lineCov">        232 :                 finalize_dump(ctx, GF_STREAM_TEXT, concat);</span>
<span class="lineNum">    1590 </span><span class="lineCov">        232 :                 finalize_dump(ctx, 0, concat);</span>
<span class="lineNum">    1591 </span>            :         }
<span class="lineNum">    1592 </span>            : 
<span class="lineNum">    1593 </span><span class="lineCov">       1004 :         while (gf_list_count(ctx-&gt;src_pids)) {</span>
<span class="lineNum">    1594 </span><span class="lineCov">        567 :                 PidCtx *pctx = gf_list_pop_front(ctx-&gt;src_pids);</span>
<span class="lineNum">    1595 </span>            : 
<span class="lineNum">    1596 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    1597 </span><span class="lineCov">        567 :                 if (pctx-&gt;avc_state) gf_free(pctx-&gt;avc_state);</span>
<span class="lineNum">    1598 </span><span class="lineCov">        567 :                 if (pctx-&gt;hevc_state) gf_free(pctx-&gt;hevc_state);</span>
<span class="lineNum">    1599 </span><span class="lineCov">        567 :                 if (pctx-&gt;vvc_state) gf_free(pctx-&gt;vvc_state);</span>
<span class="lineNum">    1600 </span><span class="lineCov">        567 :                 if (pctx-&gt;av1_state) {</span>
<span class="lineNum">    1601 </span><span class="lineCov">          2 :                         if (pctx-&gt;av1_state-&gt;config) gf_odf_av1_cfg_del(pctx-&gt;av1_state-&gt;config);</span>
<span class="lineNum">    1602 </span><span class="lineCov">          2 :                         gf_av1_reset_state(pctx-&gt;av1_state, GF_TRUE);</span>
<span class="lineNum">    1603 </span><span class="lineCov">          2 :                         gf_free(pctx-&gt;av1_state);</span>
<span class="lineNum">    1604 </span>            :                 }
<span class="lineNum">    1605 </span>            : #endif
<span class="lineNum">    1606 </span><span class="lineCov">        567 :                 if (pctx-&gt;vpcc) gf_odf_vp_cfg_del(pctx-&gt;vpcc);</span>
<span class="lineNum">    1607 </span><span class="lineCov">        567 :                 if (pctx-&gt;bs) gf_bs_del(pctx-&gt;bs);</span>
<span class="lineNum">    1608 </span><span class="lineCov">        567 :                 gf_free(pctx);</span>
<span class="lineNum">    1609 </span>            :         }
<span class="lineNum">    1610 </span><span class="lineCov">        437 :         gf_list_del(ctx-&gt;src_pids);</span>
<span class="lineNum">    1611 </span>            : 
<span class="lineNum">    1612 </span><span class="lineCov">        437 :         if (ctx-&gt;dump) {</span>
<span class="lineNum">    1613 </span><span class="lineCov">        374 :                 if (ctx-&gt;xml) gf_fprintf(ctx-&gt;dump, &quot;&lt;/GPACInspect&gt;\n&quot;);</span>
<span class="lineNum">    1614 </span><span class="lineCov">        374 :                 if ((ctx-&gt;dump!=stderr) &amp;&amp; (ctx-&gt;dump!=stdout)) {</span>
<span class="lineNum">    1615 </span>            : 
<span class="lineNum">    1616 </span>            : #ifdef GPAC_ENABLE_COVERAGE
<span class="lineNum">    1617 </span><span class="lineCov">        351 :                         if (gf_sys_is_cov_mode()) {</span>
<span class="lineNum">    1618 </span><span class="lineCov">        351 :                                 gf_fflush(ctx-&gt;dump);</span>
<span class="lineNum">    1619 </span><span class="lineCov">        351 :                                 gf_ferror(ctx-&gt;dump);</span>
<span class="lineNum">    1620 </span>            :                         }
<span class="lineNum">    1621 </span>            : #endif
<span class="lineNum">    1622 </span><span class="lineCov">        351 :                         gf_fclose(ctx-&gt;dump);</span>
<span class="lineNum">    1623 </span>            :                 }
<span class="lineNum">    1624 </span>            :         }
<span class="lineNum">    1625 </span>            : 
<a name="1626"><span class="lineNum">    1626 </span><span class="lineCov">        437 : }</span></a>
<span class="lineNum">    1627 </span>            : 
<span class="lineNum">    1628 </span><span class="lineCov">         41 : static void dump_temi_loc(GF_InspectCtx *ctx, PidCtx *pctx, FILE *dump, const char *pname, const GF_PropertyValue *att)</span>
<span class="lineNum">    1629 </span>            : {
<span class="lineNum">    1630 </span>            :         u32 val;
<span class="lineNum">    1631 </span>            :         Double dval;
<span class="lineNum">    1632 </span><span class="lineCov">         41 :         if (ctx-&gt;xml) {</span>
<span class="lineNum">    1633 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; &lt;TEMILocation&quot;);</span>
<span class="lineNum">    1634 </span>            :         } else {
<span class="lineNum">    1635 </span><span class="lineCov">         41 :                 gf_fprintf(dump, &quot; TEMILocation&quot;);</span>
<span class="lineNum">    1636 </span>            :         }
<span class="lineNum">    1637 </span><span class="lineCov">         41 :         if (!pctx-&gt;bs)</span>
<span class="lineNum">    1638 </span><span class="lineCov">          3 :                 pctx-&gt;bs = gf_bs_new(att-&gt;value.data.ptr, att-&gt;value.data.size, GF_BITSTREAM_READ);</span>
<span class="lineNum">    1639 </span>            :         else
<span class="lineNum">    1640 </span><span class="lineCov">         38 :                 gf_bs_reassign_buffer(pctx-&gt;bs, att-&gt;value.data.ptr, att-&gt;value.data.size);</span>
<span class="lineNum">    1641 </span>            : 
<span class="lineNum">    1642 </span>            :         while (1) {
<span class="lineNum">    1643 </span><span class="lineCov">        738 :                 u8 achar =  gf_bs_read_u8(pctx-&gt;bs);</span>
<span class="lineNum">    1644 </span><span class="lineCov">        738 :                 if (!achar) break;</span>
<span class="lineNum">    1645 </span>            :         }
<span class="lineNum">    1646 </span>            : 
<span class="lineNum">    1647 </span><span class="lineCov">         82 :         val = atoi(pname+7);</span>
<span class="lineNum">    1648 </span>            : 
<span class="lineNum">    1649 </span><span class="lineCov">         41 :         DUMP_ATT_D(&quot;timeline&quot;, val)</span>
<span class="lineNum">    1650 </span><span class="lineCov">         41 :         DUMP_ATT_STR(&quot;url&quot;, att-&gt;value.data.ptr)</span>
<span class="lineNum">    1651 </span><span class="lineCov">         41 :         if (gf_bs_read_int(pctx-&gt;bs, 1)) {</span>
<span class="lineNum">    1652 </span><span class="lineNoCov">          0 :                 DUMP_ATT_D(&quot;announce&quot;, 1)</span>
<span class="lineNum">    1653 </span>            :         }
<span class="lineNum">    1654 </span><span class="lineCov">         41 :         if (gf_bs_read_int(pctx-&gt;bs, 1)) {</span>
<span class="lineNum">    1655 </span><span class="lineNoCov">          0 :                 DUMP_ATT_D(&quot;splicing&quot;, 1)</span>
<span class="lineNum">    1656 </span>            :         }
<span class="lineNum">    1657 </span><span class="lineCov">         41 :         if (gf_bs_read_int(pctx-&gt;bs, 1)) {</span>
<span class="lineNum">    1658 </span><span class="lineNoCov">          0 :                 DUMP_ATT_D(&quot;reload&quot;, 1)</span>
<span class="lineNum">    1659 </span>            :         }
<span class="lineNum">    1660 </span><span class="lineCov">         41 :         gf_bs_read_int(pctx-&gt;bs, 5);</span>
<span class="lineNum">    1661 </span><span class="lineCov">         41 :         dval =  gf_bs_read_double(pctx-&gt;bs);</span>
<span class="lineNum">    1662 </span><span class="lineCov">         41 :         if (dval) {</span>
<span class="lineNum">    1663 </span><span class="lineNoCov">          0 :                 DUMP_ATT_F(&quot;splice_start&quot;, dval)</span>
<span class="lineNum">    1664 </span>            :         }
<span class="lineNum">    1665 </span><span class="lineCov">         41 :         dval =  gf_bs_read_double(pctx-&gt;bs);</span>
<span class="lineNum">    1666 </span><span class="lineCov">         41 :         if (dval) {</span>
<span class="lineNum">    1667 </span><span class="lineNoCov">          0 :                 DUMP_ATT_F(&quot;splice_end&quot;, dval)</span>
<span class="lineNum">    1668 </span>            :         }
<span class="lineNum">    1669 </span><span class="lineCov">         41 :         if (ctx-&gt;xml) {</span>
<span class="lineNum">    1670 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    1671 </span>            :         } else {
<span class="lineNum">    1672 </span><span class="lineCov">         41 :                 gf_fprintf(dump, &quot;\n&quot;);</span>
<span class="lineNum">    1673 </span>            :         }
<a name="1674"><span class="lineNum">    1674 </span><span class="lineCov">         41 : }</span></a>
<span class="lineNum">    1675 </span>            : 
<span class="lineNum">    1676 </span><span class="lineCov">       1351 : static void dump_temi_time(GF_InspectCtx *ctx, PidCtx *pctx, FILE *dump, const char *pname, const GF_PropertyValue *att)</span>
<span class="lineNum">    1677 </span>            : {
<span class="lineNum">    1678 </span>            :         u32 val;
<span class="lineNum">    1679 </span>            :         u64 lval;
<span class="lineNum">    1680 </span><span class="lineCov">       1351 :         if (ctx-&gt;xml) {</span>
<span class="lineNum">    1681 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; &lt;TEMITiming&quot;);</span>
<span class="lineNum">    1682 </span>            :         } else {
<span class="lineNum">    1683 </span><span class="lineCov">       1351 :                 gf_fprintf(dump, &quot; TEMITiming&quot;);</span>
<span class="lineNum">    1684 </span>            :         }
<span class="lineNum">    1685 </span><span class="lineCov">       2702 :         val = atoi(pname+7);</span>
<span class="lineNum">    1686 </span><span class="lineCov">       1351 :         if (!pctx-&gt;bs)</span>
<span class="lineNum">    1687 </span><span class="lineCov">          3 :                 pctx-&gt;bs = gf_bs_new(att-&gt;value.data.ptr, att-&gt;value.data.size, GF_BITSTREAM_READ);</span>
<span class="lineNum">    1688 </span>            :         else
<span class="lineNum">    1689 </span><span class="lineCov">       1348 :                 gf_bs_reassign_buffer(pctx-&gt;bs, att-&gt;value.data.ptr, att-&gt;value.data.size);</span>
<span class="lineNum">    1690 </span>            : 
<span class="lineNum">    1691 </span><span class="lineCov">       1351 :         DUMP_ATT_D(&quot;timeline&quot;, val)</span>
<span class="lineNum">    1692 </span><span class="lineCov">       1351 :         val = gf_bs_read_u32(pctx-&gt;bs);</span>
<span class="lineNum">    1693 </span><span class="lineCov">       1351 :         DUMP_ATT_D(&quot;media_timescale&quot;, val)</span>
<span class="lineNum">    1694 </span><span class="lineCov">       1351 :         lval = gf_bs_read_u64(pctx-&gt;bs);</span>
<span class="lineNum">    1695 </span><span class="lineCov">       1351 :         DUMP_ATT_LLU(&quot;media_timestamp&quot;, lval)</span>
<span class="lineNum">    1696 </span><span class="lineCov">       1351 :         lval = gf_bs_read_u64(pctx-&gt;bs);</span>
<span class="lineNum">    1697 </span><span class="lineCov">       1351 :         DUMP_ATT_LLU(&quot;media_pts&quot;, lval)</span>
<span class="lineNum">    1698 </span>            : 
<span class="lineNum">    1699 </span><span class="lineCov">       1351 :         if (gf_bs_read_int(pctx-&gt;bs, 1)) {</span>
<span class="lineNum">    1700 </span><span class="lineNoCov">          0 :                 DUMP_ATT_D(&quot;reload&quot;, 1)</span>
<span class="lineNum">    1701 </span>            :         }
<span class="lineNum">    1702 </span><span class="lineCov">       1351 :         if (gf_bs_read_int(pctx-&gt;bs, 1)) {</span>
<span class="lineNum">    1703 </span><span class="lineNoCov">          0 :                 DUMP_ATT_D(&quot;paused&quot;, 1)</span>
<span class="lineNum">    1704 </span>            :         }
<span class="lineNum">    1705 </span><span class="lineCov">       1351 :         if (gf_bs_read_int(pctx-&gt;bs, 1)) {</span>
<span class="lineNum">    1706 </span><span class="lineNoCov">          0 :                 DUMP_ATT_D(&quot;discontinuity&quot;, 1)</span>
<span class="lineNum">    1707 </span>            :         }
<span class="lineNum">    1708 </span><span class="lineCov">       1351 :         val = gf_bs_read_int(pctx-&gt;bs, 1);</span>
<span class="lineNum">    1709 </span><span class="lineCov">       1351 :         gf_bs_read_int(pctx-&gt;bs, 4);</span>
<span class="lineNum">    1710 </span>            : 
<span class="lineNum">    1711 </span><span class="lineCov">       1351 :         if (val) {</span>
<span class="lineNum">    1712 </span><span class="lineNoCov">          0 :                 lval = gf_bs_read_u64(pctx-&gt;bs);</span>
<span class="lineNum">    1713 </span><span class="lineNoCov">          0 :                 DUMP_ATT_LLU(&quot;ntp&quot;, lval)</span>
<span class="lineNum">    1714 </span>            :         }
<span class="lineNum">    1715 </span><span class="lineCov">       1351 :         if (ctx-&gt;xml) {</span>
<span class="lineNum">    1716 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    1717 </span>            :         } else {
<span class="lineNum">    1718 </span><span class="lineCov">       1351 :                 gf_fprintf(dump, &quot;\n&quot;);</span>
<span class="lineNum">    1719 </span>            :         }
<a name="1720"><span class="lineNum">    1720 </span><span class="lineCov">       1351 : }</span></a>
<span class="lineNum">    1721 </span>            : 
<span class="lineNum">    1722 </span><span class="lineNoCov">          0 : static void gf_inspect_dump_truehd_frame(FILE *dump, GF_BitStream *bs)</span>
<span class="lineNum">    1723 </span>            : {
<span class="lineNum">    1724 </span>            :         u8 nibble;
<span class="lineNum">    1725 </span>            :         u16 frame_size, timing;
<span class="lineNum">    1726 </span>            :         u32 sync;
<span class="lineNum">    1727 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot; &lt;TrueHDAudioFrame&quot;);</span>
<span class="lineNum">    1728 </span><span class="lineNoCov">          0 :         nibble = gf_bs_read_int(bs, 4);</span>
<span class="lineNum">    1729 </span><span class="lineNoCov">          0 :         frame_size = gf_bs_read_int(bs, 12);</span>
<span class="lineNum">    1730 </span><span class="lineNoCov">          0 :         timing = gf_bs_read_u16(bs);</span>
<span class="lineNum">    1731 </span><span class="lineNoCov">          0 :         sync = gf_bs_read_u32(bs);</span>
<span class="lineNum">    1732 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot; nibble=\&quot;%u\&quot; size=\&quot;%u\&quot; timing=\&quot;%u\&quot;&quot;, nibble, frame_size, timing);</span>
<span class="lineNum">    1733 </span><span class="lineNoCov">          0 :         if (sync != 0xF8726FBA) {</span>
<span class="lineNum">    1734 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; major_sync=\&quot;no\&quot;/&gt;\n&quot;);</span>
<span class="lineNum">    1735 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">    1736 </span>            :         }
<span class="lineNum">    1737 </span><span class="lineNoCov">          0 :         u32 fmt = gf_bs_read_u32(bs);</span>
<span class="lineNum">    1738 </span><span class="lineNoCov">          0 :         u32 sig = gf_bs_read_u16(bs);</span>
<span class="lineNum">    1739 </span><span class="lineNoCov">          0 :         u32 flags = gf_bs_read_u16(bs);</span>
<span class="lineNum">    1740 </span><span class="lineNoCov">          0 :         gf_bs_read_u16(bs);</span>
<span class="lineNum">    1741 </span><span class="lineNoCov">          0 :         Bool vrate = gf_bs_read_int(bs, 1);</span>
<span class="lineNum">    1742 </span><span class="lineNoCov">          0 :         u32 prate = gf_bs_read_int(bs, 15);</span>
<span class="lineNum">    1743 </span><span class="lineNoCov">          0 :         u32 nb_substreams = gf_bs_read_int(bs, 4);</span>
<span class="lineNum">    1744 </span><span class="lineNoCov">          0 :         gf_bs_read_int(bs, 2);</span>
<span class="lineNum">    1745 </span><span class="lineNoCov">          0 :         u32 ext_substream_info = gf_bs_read_int(bs, 2);</span>
<span class="lineNum">    1746 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot; major_sync=\&quot;yes\&quot; format=\&quot;%u\&quot; signature=\&quot;%u\&quot; flags=\&quot;0x%04X\&quot; vrate=\&quot;%u\&quot; peak_data_rate=\&quot;%u\&quot; substreams=\&quot;%u\&quot; extended_substream_info=\&quot;%u\&quot; &quot;, fmt, sig, flags, vrate, prate, nb_substreams, ext_substream_info);</span>
<span class="lineNum">    1747 </span>            : 
<span class="lineNum">    1748 </span><span class="lineNoCov">          0 :         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<a name="1749"><span class="lineNum">    1749 </span>            : }</a>
<span class="lineNum">    1750 </span>            : 
<span class="lineNum">    1751 </span><span class="lineCov">      20602 : static void inspect_dump_property(GF_InspectCtx *ctx, FILE *dump, u32 p4cc, const char *pname, const GF_PropertyValue *att, PidCtx *pctx)</span>
<span class="lineNum">    1752 </span>            : {
<span class="lineNum">    1753 </span>            :         char szDump[GF_PROP_DUMP_ARG_SIZE];
<span class="lineNum">    1754 </span>            : 
<span class="lineNum">    1755 </span><span class="lineCov">      20602 :         if (!pname)</span>
<span class="lineNum">    1756 </span><span class="lineCov">      17721 :                 pname = gf_props_4cc_get_name(p4cc);</span>
<span class="lineNum">    1757 </span>            :         else {
<span class="lineNum">    1758 </span>            :                 //all properties starting with __ are not dumped
<span class="lineNum">    1759 </span><span class="lineCov">       2881 :                 if (!strncmp(pname, &quot;__&quot;, 2))</span>
<span class="lineNum">    1760 </span><span class="lineCov">       1808 :                         return;</span>
<span class="lineNum">    1761 </span><span class="lineCov">       2881 :                 if (!strcmp(pname, &quot;isom_force_ctts&quot;))</span>
<span class="lineNum">    1762 </span>            :                         return;
<span class="lineNum">    1763 </span>            :         }
<span class="lineNum">    1764 </span>            : 
<span class="lineNum">    1765 </span><span class="lineCov">      20572 :         if (p4cc==GF_PROP_PID_DOWNLOAD_SESSION)</span>
<span class="lineNum">    1766 </span>            :                 return;
<span class="lineNum">    1767 </span>            : 
<span class="lineNum">    1768 </span><span class="lineCov">      20523 :         if (p4cc==GF_PROP_PID_CENC_KEY_INFO) {</span>
<span class="lineNum">    1769 </span>            :                 u32 i, nb_keys, kpos;
<span class="lineNum">    1770 </span>            :                 u8 *data;
<span class="lineNum">    1771 </span><span class="lineCov">         33 :                 if (ctx-&gt;xml) {</span>
<span class="lineNum">    1772 </span><span class="lineNoCov">          0 :                         if (ctx-&gt;dtype)</span>
<span class="lineNum">    1773 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; type=\&quot;%s\&quot;&quot;, gf_props_get_type_name(att-&gt;type) );</span>
<span class="lineNum">    1774 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; %s=\&quot;&quot;, pname);</span>
<span class="lineNum">    1775 </span>            :                 } else {
<span class="lineNum">    1776 </span><span class="lineCov">         33 :                         if (ctx-&gt;dtype) {</span>
<span class="lineNum">    1777 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\t%s (%s): &quot;, pname, gf_props_get_type_name(att-&gt;type));</span>
<span class="lineNum">    1778 </span>            :                         } else {
<span class="lineNum">    1779 </span><span class="lineCov">         33 :                                 gf_fprintf(dump, &quot;\t%s: &quot;, pname);</span>
<span class="lineNum">    1780 </span>            :                         }
<span class="lineNum">    1781 </span>            :                 }
<span class="lineNum">    1782 </span><span class="lineCov">         33 :                 data = att-&gt;value.data.ptr;</span>
<span class="lineNum">    1783 </span>            :                 nb_keys = 1;
<span class="lineNum">    1784 </span><span class="lineCov">         33 :                 if (data[0]) {</span>
<span class="lineNum">    1785 </span><span class="lineNoCov">          0 :                         nb_keys = data[1];</span>
<span class="lineNum">    1786 </span><span class="lineNoCov">          0 :                         nb_keys &lt;&lt;= 8;</span>
<span class="lineNum">    1787 </span><span class="lineNoCov">          0 :                         nb_keys |= data[2];</span>
<span class="lineNum">    1788 </span>            :                 }
<span class="lineNum">    1789 </span><span class="lineNoCov">          0 :                 if (nb_keys&gt;1) gf_fprintf(dump, &quot;[&quot;);</span>
<span class="lineNum">    1790 </span>            :                 kpos = 3;
<span class="lineNum">    1791 </span><span class="lineCov">         66 :                 for (i=0; i&lt;nb_keys; i++) {</span>
<span class="lineNum">    1792 </span>            :                         u32 j;
<span class="lineNum">    1793 </span>            :                         bin128 KID;
<span class="lineNum">    1794 </span><span class="lineCov">         33 :                         u8 iv_size = data[kpos];</span>
<span class="lineNum">    1795 </span><span class="lineCov">         33 :                         memcpy(KID, data+kpos+1, 16);</span>
<span class="lineNum">    1796 </span><span class="lineCov">         33 :                         gf_fprintf(dump, &quot;IV_size:%d,KID:0x&quot;, iv_size);</span>
<span class="lineNum">    1797 </span><span class="lineCov">        561 :                         for (j=0; j&lt;16; j++) {</span>
<span class="lineNum">    1798 </span><span class="lineCov">        528 :                                 gf_fprintf(dump, &quot;%02X&quot;, (unsigned char) data[kpos + 1 + j]);</span>
<span class="lineNum">    1799 </span>            :                         }
<span class="lineNum">    1800 </span><span class="lineCov">         33 :                         kpos+=17;</span>
<span class="lineNum">    1801 </span><span class="lineCov">         33 :                         if (!iv_size) {</span>
<span class="lineNum">    1802 </span><span class="lineNoCov">          0 :                                 iv_size = data[kpos];</span>
<span class="lineNum">    1803 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;,const_IV_size:%d&quot;, iv_size);</span>
<span class="lineNum">    1804 </span><span class="lineNoCov">          0 :                                 if (iv_size) {</span>
<span class="lineNum">    1805 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;,const_IV:0x&quot;);</span>
<span class="lineNum">    1806 </span><span class="lineNoCov">          0 :                                         for (j=0; j&lt;iv_size; j++) {</span>
<span class="lineNum">    1807 </span><span class="lineNoCov">          0 :                                                 gf_fprintf(dump, &quot;%02X&quot;, (unsigned char) data[kpos + 1 + j]);</span>
<span class="lineNum">    1808 </span>            :                                         }
<span class="lineNum">    1809 </span>            :                                 }
<span class="lineNum">    1810 </span><span class="lineNoCov">          0 :                                 kpos += iv_size+1;</span>
<span class="lineNum">    1811 </span>            :                         }
<span class="lineNum">    1812 </span>            :                 }
<span class="lineNum">    1813 </span>            : 
<span class="lineNum">    1814 </span><span class="lineCov">         33 :                 if (nb_keys&gt;1) gf_fprintf(dump, &quot;]&quot;);</span>
<span class="lineNum">    1815 </span><span class="lineCov">         33 :                 if (ctx-&gt;xml) {</span>
<span class="lineNum">    1816 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot;&quot;);</span>
<span class="lineNum">    1817 </span>            :                 } else {
<span class="lineNum">    1818 </span><span class="lineCov">         33 :                         gf_fprintf(dump, &quot;\n&quot;);</span>
<span class="lineNum">    1819 </span>            :                 }
<span class="lineNum">    1820 </span>            : 
<span class="lineNum">    1821 </span>            :                 return;
<span class="lineNum">    1822 </span>            :         }
<span class="lineNum">    1823 </span>            : 
<span class="lineNum">    1824 </span><span class="lineCov">      20490 :         if (gf_sys_is_test_mode() || ctx-&gt;test) {</span>
<span class="lineNum">    1825 </span><span class="lineCov">      20132 :                 switch (p4cc) {</span>
<span class="lineNum">    1826 </span>            :                 case GF_PROP_PID_FILEPATH:
<span class="lineNum">    1827 </span>            :                 case GF_PROP_PID_URL:
<span class="lineNum">    1828 </span>            :                 case GF_PROP_PID_MUX_SRC:
<span class="lineNum">    1829 </span>            :                         return;
<span class="lineNum">    1830 </span><span class="lineCov">        812 :                 case GF_PROP_PID_FILE_CACHED:</span>
<span class="lineNum">    1831 </span>            :                 case GF_PROP_PID_DURATION:
<span class="lineNum">    1832 </span><span class="lineCov">        812 :                         if ((ctx-&gt;test==INSPECT_TEST_NETWORK) || (ctx-&gt;test==INSPECT_TEST_NETX))</span>
<span class="lineNum">    1833 </span>            :                                 return;
<span class="lineNum">    1834 </span>            :                         break;
<span class="lineNum">    1835 </span><span class="lineCov">        889 :                 case GF_PROP_PID_DECODER_CONFIG:</span>
<span class="lineNum">    1836 </span>            :                 case GF_PROP_PID_DECODER_CONFIG_ENHANCEMENT:
<span class="lineNum">    1837 </span>            :                 case GF_PROP_PID_DOWN_SIZE:
<span class="lineNum">    1838 </span><span class="lineCov">        889 :                         if (ctx-&gt;test&gt;=INSPECT_TEST_ENCODE)</span>
<span class="lineNum">    1839 </span>            :                                 return;
<span class="lineNum">    1840 </span>            :                         break;
<span class="lineNum">    1841 </span><span class="lineCov">        236 :                 case GF_PROP_PID_BITRATE:</span>
<span class="lineNum">    1842 </span><span class="lineCov">        236 :                         if (ctx-&gt;test==INSPECT_TEST_NOBR)</span>
<span class="lineNum">    1843 </span>            :                                 return;
<span class="lineNum">    1844 </span>            :                 case GF_PROP_PID_MEDIA_DATA_SIZE:
<span class="lineNum">    1845 </span>            :                 case GF_PROP_PID_MAXRATE:
<span class="lineNum">    1846 </span>            :                 case GF_PROP_PID_AVG_FRAME_SIZE:
<span class="lineNum">    1847 </span>            :                 case GF_PROP_PID_MAX_FRAME_SIZE:
<span class="lineNum">    1848 </span>            :                 case GF_PROP_PID_DBSIZE:
<span class="lineNum">    1849 </span><span class="lineCov">       1117 :                         if (ctx-&gt;test==INSPECT_TEST_ENCX)</span>
<span class="lineNum">    1850 </span>            :                                 return;
<span class="lineNum">    1851 </span>            :                         break;
<span class="lineNum">    1852 </span>            : 
<span class="lineNum">    1853 </span><span class="lineCov">        586 :                 case GF_PROP_PID_ISOM_TRACK_TEMPLATE:</span>
<span class="lineNum">    1854 </span>            :                 case GF_PROP_PID_ISOM_MOVIE_TIME:
<span class="lineNum">    1855 </span><span class="lineCov">        586 :                         if (ctx-&gt;test==INSPECT_TEST_NETX)</span>
<span class="lineNum">    1856 </span>            :                                 return;
<span class="lineNum">    1857 </span>            :                         break;
<span class="lineNum">    1858 </span>            : 
<span class="lineNum">    1859 </span><span class="lineCov">        479 :                 case GF_PROP_PID_ISOM_TREX_TEMPLATE:</span>
<span class="lineNum">    1860 </span>            :                 case GF_PROP_PID_ISOM_STSD_TEMPLATE:
<span class="lineNum">    1861 </span>            :                         //TODO once all OK: remove this test and regenerate all hashes
<span class="lineNum">    1862 </span><span class="lineCov">        479 :                         if (gf_sys_is_test_mode())</span>
<span class="lineNum">    1863 </span>            :                                 return;
<span class="lineNum">    1864 </span>            :                 default:
<span class="lineNum">    1865 </span><span class="lineCov">      15128 :                         if (gf_sys_is_test_mode() &amp;&amp; (att-&gt;type==GF_PROP_POINTER) )</span>
<span class="lineNum">    1866 </span>            :                                 return;
<span class="lineNum">    1867 </span>            :                         break;
<span class="lineNum">    1868 </span>            :                 }
<span class="lineNum">    1869 </span><span class="lineCov">        358 :         }</span>
<span class="lineNum">    1870 </span>            : 
<span class="lineNum">    1871 </span><span class="lineCov">      18794 :         if (ctx-&gt;xml) {</span>
<span class="lineNum">    1872 </span><span class="lineCov">        240 :                 if (ctx-&gt;dtype)</span>
<span class="lineNum">    1873 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; type=\&quot;%s\&quot;&quot;, gf_props_get_type_name(att-&gt;type) );</span>
<span class="lineNum">    1874 </span>            :                         
<span class="lineNum">    1875 </span><span class="lineCov">        243 :                 if (pname &amp;&amp; (strchr(pname, ' ') || strchr(pname, ':'))) {</span>
<span class="lineNum">    1876 </span>            :                         u32 i=0, k;
<span class="lineNum">    1877 </span><span class="lineCov">          3 :                         char *pname_no_space = gf_strdup(pname);</span>
<span class="lineNum">    1878 </span><span class="lineCov">         50 :                         while (pname_no_space[i]) {</span>
<span class="lineNum">    1879 </span><span class="lineCov">         44 :                                 if (pname_no_space[i]==' ') pname_no_space[i]='_';</span>
<span class="lineNum">    1880 </span><span class="lineCov">         44 :                                 if (pname_no_space[i]==':') pname_no_space[i]='_';</span>
<span class="lineNum">    1881 </span><span class="lineCov">         44 :                                 i++;</span>
<span class="lineNum">    1882 </span>            :                         }
<span class="lineNum">    1883 </span>            : 
<span class="lineNum">    1884 </span><span class="lineCov">          3 :                         if ((att-&gt;type==GF_PROP_UINT_LIST) || (att-&gt;type==GF_PROP_4CC_LIST)) {</span>
<span class="lineNum">    1885 </span><span class="lineNoCov">          0 :                                 for (k=0; k &lt; att-&gt;value.uint_list.nb_items; k++) {</span>
<span class="lineNum">    1886 </span><span class="lineNoCov">          0 :                                         if (k) gf_fprintf(dump, &quot;, &quot;);</span>
<span class="lineNum">    1887 </span><span class="lineNoCov">          0 :                                         if ((att-&gt;type==GF_PROP_4CC_LIST) &amp;&amp; ! gf_sys_is_test_mode()) {</span>
<span class="lineNum">    1888 </span><span class="lineNoCov">          0 :                                                 gf_fprintf(dump, &quot;%s&quot;, gf_4cc_to_str(att-&gt;value.uint_list.vals[k]) );</span>
<span class="lineNum">    1889 </span>            :                                         } else {
<span class="lineNum">    1890 </span><span class="lineNoCov">          0 :                                                 gf_fprintf(dump, &quot;%d&quot;, att-&gt;value.uint_list.vals[k]);</span>
<span class="lineNum">    1891 </span>            :                                         }
<span class="lineNum">    1892 </span>            :                                 }
<span class="lineNum">    1893 </span><span class="lineCov">          3 :                         } else if (att-&gt;type==GF_PROP_STRING_LIST) {</span>
<span class="lineNum">    1894 </span><span class="lineNoCov">          0 :                                 for (k=0; k &lt; att-&gt;value.string_list.nb_items; k++) {</span>
<span class="lineNum">    1895 </span><span class="lineNoCov">          0 :                                         if (k) gf_fprintf(dump, &quot;, &quot;);</span>
<span class="lineNum">    1896 </span><span class="lineNoCov">          0 :                                         gf_xml_dump_string(dump, NULL, (char *) att-&gt;value.string_list.vals[k], NULL);</span>
<span class="lineNum">    1897 </span>            :                                 }
<span class="lineNum">    1898 </span><span class="lineCov">          3 :                         } else if ((att-&gt;type==GF_PROP_STRING) || (att-&gt;type==GF_PROP_STRING_NO_COPY)) {</span>
<span class="lineNum">    1899 </span><span class="lineNoCov">          0 :                                 gf_xml_dump_string(dump, NULL, att-&gt;value.string, NULL);</span>
<span class="lineNum">    1900 </span>            :                         } else {
<span class="lineNum">    1901 </span><span class="lineCov">          3 :                                 gf_fprintf(dump, &quot; %s=\&quot;%s\&quot;&quot;, pname_no_space, gf_props_dump(p4cc, att, szDump, (GF_PropDumDataMode) ctx-&gt;dump_data));</span>
<span class="lineNum">    1902 </span>            :                         }
<span class="lineNum">    1903 </span><span class="lineCov">          3 :                         gf_free(pname_no_space);</span>
<span class="lineNum">    1904 </span>            :                 } else {
<span class="lineNum">    1905 </span><span class="lineCov">        237 :                         gf_fprintf(dump, &quot; %s=\&quot;%s\&quot;&quot;, pname ? pname : gf_4cc_to_str(p4cc), gf_props_dump(p4cc, att, szDump, (GF_PropDumDataMode) ctx-&gt;dump_data));</span>
<span class="lineNum">    1906 </span>            :                 }
<span class="lineNum">    1907 </span>            :         } else {
<span class="lineNum">    1908 </span><span class="lineCov">      18554 :                 if (ctx-&gt;dtype) {</span>
<span class="lineNum">    1909 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\t%s (%s): &quot;, pname ? pname : gf_4cc_to_str(p4cc), gf_props_get_type_name(att-&gt;type));</span>
<span class="lineNum">    1910 </span>            :                 } else {
<span class="lineNum">    1911 </span><span class="lineCov">      18554 :                         if (!p4cc &amp;&amp; !strncmp(pname, &quot;temi_l&quot;, 6))</span>
<span class="lineNum">    1912 </span><span class="lineCov">         41 :                                 dump_temi_loc(ctx, pctx, dump, pname, att);</span>
<span class="lineNum">    1913 </span><span class="lineCov">      18513 :                         else if (!p4cc &amp;&amp; !strncmp(pname, &quot;temi_t&quot;, 6))</span>
<span class="lineNum">    1914 </span><span class="lineCov">       1351 :                                 dump_temi_time(ctx, pctx, dump, pname, att);</span>
<span class="lineNum">    1915 </span>            :                         else
<span class="lineNum">    1916 </span><span class="lineCov">      17162 :                                 gf_fprintf(dump, &quot;\t%s: &quot;, pname ? pname : gf_4cc_to_str(p4cc));</span>
<span class="lineNum">    1917 </span>            :                 }
<span class="lineNum">    1918 </span>            : 
<span class="lineNum">    1919 </span><span class="lineCov">      18554 :                 if ((att-&gt;type==GF_PROP_UINT_LIST) || (att-&gt;type==GF_PROP_4CC_LIST)) {</span>
<span class="lineNum">    1920 </span>            :                         u32 k;
<span class="lineNum">    1921 </span><span class="lineCov">        742 :                         for (k=0; k &lt; att-&gt;value.uint_list.nb_items; k++) {</span>
<span class="lineNum">    1922 </span><span class="lineCov">        742 :                                 if (k) gf_fprintf(dump, &quot;, &quot;);</span>
<span class="lineNum">    1923 </span><span class="lineCov">        742 :                                 if ((att-&gt;type==GF_PROP_4CC_LIST) &amp;&amp; ! gf_sys_is_test_mode()) {</span>
<span class="lineNum">    1924 </span><span class="lineCov">         18 :                                         gf_fprintf(dump, &quot;%s&quot;, gf_4cc_to_str(att-&gt;value.uint_list.vals[k]) );</span>
<span class="lineNum">    1925 </span>            :                                 } else {
<span class="lineNum">    1926 </span><span class="lineCov">        724 :                                         gf_fprintf(dump, &quot;%d&quot;, att-&gt;value.uint_list.vals[k]);</span>
<span class="lineNum">    1927 </span>            :                                 }
<span class="lineNum">    1928 </span>            :                         }
<span class="lineNum">    1929 </span><span class="lineCov">      18226 :                 } else if (att-&gt;type==GF_PROP_STRING_LIST) {</span>
<span class="lineNum">    1930 </span>            :                         u32 k;
<span class="lineNum">    1931 </span><span class="lineCov">          1 :                         for (k=0; k &lt; att-&gt;value.string_list.nb_items; k++) {</span>
<span class="lineNum">    1932 </span><span class="lineCov">          1 :                                 if (k) gf_fprintf(dump, &quot;, &quot;);</span>
<span class="lineNum">    1933 </span><span class="lineCov">          1 :                                 gf_fprintf(dump, &quot;%s&quot;, (const char *) att-&gt;value.string_list.vals[k]);</span>
<span class="lineNum">    1934 </span>            :                         }
<span class="lineNum">    1935 </span>            :                 }else{
<span class="lineNum">    1936 </span><span class="lineCov">      18225 :                         gf_fprintf(dump, &quot;%s&quot;, gf_props_dump(p4cc, att, szDump, (GF_PropDumDataMode) ctx-&gt;dump_data) );</span>
<span class="lineNum">    1937 </span>            :                 }
<span class="lineNum">    1938 </span><span class="lineCov">      18554 :                 gf_fprintf(dump, &quot;\n&quot;);</span>
<span class="lineNum">    1939 </span>            :         }
<a name="1940"><span class="lineNum">    1940 </span>            : }</a>
<span class="lineNum">    1941 </span>            : 
<span class="lineNum">    1942 </span><span class="lineCov">      18746 : static void inspect_dump_packet_fmt(GF_InspectCtx *ctx, FILE *dump, GF_FilterPacket *pck, PidCtx *pctx, u64 pck_num)</span>
<span class="lineNum">    1943 </span>            : {
<span class="lineNum">    1944 </span>            :         char szDump[GF_PROP_DUMP_ARG_SIZE];
<span class="lineNum">    1945 </span><span class="lineCov">      18746 :         u32 size=0;</span>
<span class="lineNum">    1946 </span>            :         const char *data=NULL;
<span class="lineNum">    1947 </span><span class="lineCov">      18746 :         char *str = ctx-&gt;fmt;</span>
<span class="lineNum">    1948 </span><span class="lineCov">      18746 :         if (!dump) return;</span>
<span class="lineNum">    1949 </span>            :         assert(str);
<span class="lineNum">    1950 </span>            : 
<span class="lineNum">    1951 </span><span class="lineCov">      18746 :         if (pck) {</span>
<span class="lineNum">    1952 </span><span class="lineCov">      18630 :                 data = gf_filter_pck_get_data(pck, &amp;size);</span>
<span class="lineNum">    1953 </span><span class="lineCov">      18630 :                 pctx-&gt;csize += size;</span>
<span class="lineNum">    1954 </span>            :         }
<span class="lineNum">    1955 </span>            : 
<span class="lineNum">    1956 </span><span class="lineCov">     123676 :         while (str) {</span>
<span class="lineNum">    1957 </span>            :                 char csep;
<span class="lineNum">    1958 </span>            :                 char *sep, *key;
<span class="lineNum">    1959 </span><span class="lineCov">     123676 :                 if (!str[0]) break;</span>
<span class="lineNum">    1960 </span>            : 
<span class="lineNum">    1961 </span><span class="lineCov">     104930 :                 if ((str[0] != '$') &amp;&amp; (str[0] != '%') &amp;&amp; (str[0] != '@')) {</span>
<span class="lineNum">    1962 </span><span class="lineCov">      33719 :                         gf_fprintf(dump, &quot;%c&quot;, str[0]);</span>
<span class="lineNum">    1963 </span><span class="lineCov">      33719 :                         str = str+1;</span>
<span class="lineNum">    1964 </span><span class="lineCov">      33719 :                         continue;</span>
<span class="lineNum">    1965 </span>            :                 }
<span class="lineNum">    1966 </span>            :                 csep = str[0];
<span class="lineNum">    1967 </span><span class="lineCov">      71211 :                 if (str[1] == csep) {</span>
<span class="lineNum">    1968 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;%c&quot;, str[0]);</span>
<span class="lineNum">    1969 </span><span class="lineNoCov">          0 :                         str = str+2;</span>
<span class="lineNum">    1970 </span><span class="lineNoCov">          0 :                         continue;</span>
<span class="lineNum">    1971 </span>            :                 }
<span class="lineNum">    1972 </span><span class="lineCov">      71211 :                 sep = strchr(str+1, csep);</span>
<span class="lineNum">    1973 </span><span class="lineCov">      71211 :                 if (!sep) {</span>
<span class="lineNum">    1974 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;%c&quot;, str[0]);</span>
<span class="lineNum">    1975 </span>            :                         str = str+1;
<span class="lineNum">    1976 </span><span class="lineNoCov">          0 :                         continue;</span>
<span class="lineNum">    1977 </span>            :                 }
<span class="lineNum">    1978 </span><span class="lineCov">      71211 :                 sep[0] = 0;</span>
<span class="lineNum">    1979 </span>            :                 key = str+1;
<span class="lineNum">    1980 </span>            : 
<span class="lineNum">    1981 </span><span class="lineCov">      71211 :                 if (!pck) {</span>
<span class="lineNum">    1982 </span><span class="lineCov">        435 :                         if (!strcmp(key, &quot;lf&quot;)) gf_fprintf(dump, &quot;\n&quot; );</span>
<span class="lineNum">    1983 </span><span class="lineCov">        319 :                         else if (!strcmp(key, &quot;cr&quot;)) gf_fprintf(dump, &quot;\r&quot; );</span>
<span class="lineNum">    1984 </span><span class="lineCov">        319 :                         else if (!strcmp(key, &quot;t&quot;)) gf_fprintf(dump, &quot;\t&quot; );</span>
<span class="lineNum">    1985 </span><span class="lineCov">        319 :                         else if (!strncmp(key, &quot;pid.&quot;, 4)) gf_fprintf(dump, &quot;%s&quot;, key+4);</span>
<span class="lineNum">    1986 </span><span class="lineCov">        319 :                         else gf_fprintf(dump, &quot;%s&quot;, key);</span>
<span class="lineNum">    1987 </span><span class="lineCov">        435 :                         sep[0] = csep;</span>
<span class="lineNum">    1988 </span><span class="lineCov">        435 :                         str = sep+1;</span>
<span class="lineNum">    1989 </span><span class="lineCov">        435 :                         continue;</span>
<span class="lineNum">    1990 </span>            :                 }
<span class="lineNum">    1991 </span>            : 
<span class="lineNum">    1992 </span><span class="lineCov">      70776 :                 if (!strcmp(key, &quot;pn&quot;)) gf_fprintf(dump, LLU, pck_num);</span>
<span class="lineNum">    1993 </span><span class="lineCov">      64441 :                 else if (!strcmp(key, &quot;dts&quot;)) {</span>
<span class="lineNum">    1994 </span><span class="lineCov">      14034 :                         u64 ts = gf_filter_pck_get_dts(pck);</span>
<span class="lineNum">    1995 </span><span class="lineCov">      14034 :                         if (ts==GF_FILTER_NO_TS) gf_fprintf(dump, &quot;N/A&quot;);</span>
<span class="lineNum">    1996 </span><span class="lineCov">      13951 :                         else gf_fprintf(dump, LLU, ts );</span>
<span class="lineNum">    1997 </span>            :                 }
<span class="lineNum">    1998 </span><span class="lineCov">      50407 :                 else if (!strcmp(key, &quot;cts&quot;)) {</span>
<span class="lineNum">    1999 </span><span class="lineCov">      17140 :                         u64 ts = gf_filter_pck_get_cts(pck);</span>
<span class="lineNum">    2000 </span><span class="lineCov">      17140 :                         if (ts==GF_FILTER_NO_TS) gf_fprintf(dump, &quot;N/A&quot;);</span>
<span class="lineNum">    2001 </span><span class="lineCov">      16287 :                         else gf_fprintf(dump, LLU, ts );</span>
<span class="lineNum">    2002 </span>            :                 }
<span class="lineNum">    2003 </span><span class="lineCov">      33267 :                 else if (!strcmp(key, &quot;ddts&quot;)) {</span>
<span class="lineNum">    2004 </span><span class="lineNoCov">          0 :                         u64 ts = gf_filter_pck_get_dts(pck);</span>
<span class="lineNum">    2005 </span><span class="lineNoCov">          0 :                         if ((ts==GF_FILTER_NO_TS) || (pctx-&gt;prev_dts==GF_FILTER_NO_TS)) gf_fprintf(dump, &quot;N/A&quot;);</span>
<span class="lineNum">    2006 </span><span class="lineNoCov">          0 :                         else if (pctx-&gt;pck_num&lt;=1) gf_fprintf(dump, &quot;N/A&quot;);</span>
<span class="lineNum">    2007 </span>            :                         else {
<span class="lineNum">    2008 </span>            :                                 s64 diff = ts;
<span class="lineNum">    2009 </span><span class="lineNoCov">          0 :                                 diff -= pctx-&gt;prev_dts;</span>
<span class="lineNum">    2010 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, LLD, diff);</span>
<span class="lineNum">    2011 </span>            :                         }
<span class="lineNum">    2012 </span><span class="lineNoCov">          0 :                         pctx-&gt;prev_dts = ts;</span>
<span class="lineNum">    2013 </span>            :                 }
<span class="lineNum">    2014 </span><span class="lineCov">      33267 :                 else if (!strcmp(key, &quot;dcts&quot;)) {</span>
<span class="lineNum">    2015 </span><span class="lineNoCov">          0 :                         u64 ts = gf_filter_pck_get_cts(pck);</span>
<span class="lineNum">    2016 </span><span class="lineNoCov">          0 :                         if ((ts==GF_FILTER_NO_TS) || (pctx-&gt;prev_cts==GF_FILTER_NO_TS)) gf_fprintf(dump, &quot;N/A&quot;);</span>
<span class="lineNum">    2017 </span><span class="lineNoCov">          0 :                         else if (pctx-&gt;pck_num&lt;=1) gf_fprintf(dump, &quot;N/A&quot;);</span>
<span class="lineNum">    2018 </span>            :                         else {
<span class="lineNum">    2019 </span>            :                                 s64 diff = ts;
<span class="lineNum">    2020 </span><span class="lineNoCov">          0 :                                 diff -= pctx-&gt;prev_cts;</span>
<span class="lineNum">    2021 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, LLD, diff);</span>
<span class="lineNum">    2022 </span>            :                         }
<span class="lineNum">    2023 </span><span class="lineNoCov">          0 :                         pctx-&gt;prev_cts = ts;</span>
<span class="lineNum">    2024 </span>            :                 }
<span class="lineNum">    2025 </span><span class="lineCov">      33267 :                 else if (!strcmp(key, &quot;ctso&quot;)) {</span>
<span class="lineNum">    2026 </span><span class="lineNoCov">          0 :                         u64 dts = gf_filter_pck_get_dts(pck);</span>
<span class="lineNum">    2027 </span><span class="lineNoCov">          0 :                         u64 cts = gf_filter_pck_get_cts(pck);</span>
<span class="lineNum">    2028 </span><span class="lineNoCov">          0 :                         if (dts==GF_FILTER_NO_TS) dts = cts;</span>
<span class="lineNum">    2029 </span><span class="lineNoCov">          0 :                         if (cts==GF_FILTER_NO_TS) gf_fprintf(dump, &quot;N/A&quot;);</span>
<span class="lineNum">    2030 </span><span class="lineNoCov">          0 :                         else gf_fprintf(dump, LLD, ((s64)cts) - ((s64)dts) );</span>
<span class="lineNum">    2031 </span>            :                 }
<span class="lineNum">    2032 </span>            : 
<span class="lineNum">    2033 </span><span class="lineCov">      33267 :                 else if (!strcmp(key, &quot;dur&quot;)) gf_fprintf(dump, &quot;%u&quot;, gf_filter_pck_get_duration(pck) );</span>
<span class="lineNum">    2034 </span><span class="lineCov">      33267 :                 else if (!strcmp(key, &quot;frame&quot;)) {</span>
<span class="lineNum">    2035 </span>            :                         Bool start, end;
<span class="lineNum">    2036 </span><span class="lineNoCov">          0 :                         gf_filter_pck_get_framing(pck, &amp;start, &amp;end);</span>
<span class="lineNum">    2037 </span><span class="lineNoCov">          0 :                         if (start &amp;&amp; end) gf_fprintf(dump, &quot;frame_full&quot;);</span>
<span class="lineNum">    2038 </span><span class="lineNoCov">          0 :                         else if (start) gf_fprintf(dump, &quot;frame_start&quot;);</span>
<span class="lineNum">    2039 </span><span class="lineNoCov">          0 :                         else if (end) gf_fprintf(dump, &quot;frame_end&quot;);</span>
<span class="lineNum">    2040 </span><span class="lineNoCov">          0 :                         else gf_fprintf(dump, &quot;frame_cont&quot;);</span>
<span class="lineNum">    2041 </span>            :                 }
<span class="lineNum">    2042 </span><span class="lineCov">      33267 :                 else if (!strcmp(key, &quot;sap&quot;) || !strcmp(key, &quot;rap&quot;)) {</span>
<span class="lineNum">    2043 </span><span class="lineCov">      10041 :                         u32 sap = gf_filter_pck_get_sap(pck);</span>
<span class="lineNum">    2044 </span><span class="lineCov">      10041 :                         if (sap==GF_FILTER_SAP_4_PROL) {</span>
<span class="lineNum">    2045 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;4 (prol)&quot;);</span>
<span class="lineNum">    2046 </span>            :                         } else {
<span class="lineNum">    2047 </span><span class="lineCov">      10041 :                                 gf_fprintf(dump, &quot;%u&quot;, sap );</span>
<span class="lineNum">    2048 </span>            :                         }
<span class="lineNum">    2049 </span>            :                 }
<span class="lineNum">    2050 </span><span class="lineCov">      23226 :                 else if (!strcmp(key, &quot;ilace&quot;)) gf_fprintf(dump, &quot;%d&quot;, gf_filter_pck_get_interlaced(pck) );</span>
<span class="lineNum">    2051 </span><span class="lineCov">      23226 :                 else if (!strcmp(key, &quot;corr&quot;)) gf_fprintf(dump, &quot;%d&quot;, gf_filter_pck_get_corrupted(pck) );</span>
<span class="lineNum">    2052 </span><span class="lineCov">      23226 :                 else if (!strcmp(key, &quot;seek&quot;)) gf_fprintf(dump, &quot;%d&quot;, gf_filter_pck_get_seek_flag(pck) );</span>
<span class="lineNum">    2053 </span><span class="lineCov">      23226 :                 else if (!strcmp(key, &quot;bo&quot;)) {</span>
<span class="lineNum">    2054 </span><span class="lineCov">        774 :                         u64 bo = gf_filter_pck_get_byte_offset(pck);</span>
<span class="lineNum">    2055 </span><span class="lineCov">        774 :                         if (bo==GF_FILTER_NO_BO) gf_fprintf(dump, &quot;N/A&quot;);</span>
<span class="lineNum">    2056 </span><span class="lineCov">        774 :                         else gf_fprintf(dump, LLU, bo);</span>
<span class="lineNum">    2057 </span>            :                 }
<span class="lineNum">    2058 </span><span class="lineCov">      22452 :                 else if (!strcmp(key, &quot;roll&quot;)) gf_fprintf(dump, &quot;%d&quot;, gf_filter_pck_get_roll_info(pck) );</span>
<span class="lineNum">    2059 </span><span class="lineCov">      22452 :                 else if (!strcmp(key, &quot;crypt&quot;)) gf_fprintf(dump, &quot;%d&quot;, gf_filter_pck_get_crypt_flags(pck) );</span>
<span class="lineNum">    2060 </span><span class="lineCov">      22452 :                 else if (!strcmp(key, &quot;vers&quot;)) gf_fprintf(dump, &quot;%d&quot;, gf_filter_pck_get_carousel_version(pck) );</span>
<span class="lineNum">    2061 </span><span class="lineCov">      22452 :                 else if (!strcmp(key, &quot;size&quot;)) gf_fprintf(dump, &quot;%d&quot;, size );</span>
<span class="lineNum">    2062 </span><span class="lineCov">      18630 :                 else if (!strcmp(key, &quot;csize&quot;)) gf_fprintf(dump, &quot;%d&quot;, pctx-&gt;csize);</span>
<span class="lineNum">    2063 </span><span class="lineCov">      18630 :                 else if (!strcmp(key, &quot;crc&quot;)) gf_fprintf(dump, &quot;0x%08X&quot;, gf_crc_32(data, size) );</span>
<span class="lineNum">    2064 </span><span class="lineCov">      18630 :                 else if (!strcmp(key, &quot;lf&quot;)) gf_fprintf(dump, &quot;\n&quot; );</span>
<span class="lineNum">    2065 </span><span class="lineNoCov">          0 :                 else if (!strcmp(key, &quot;cr&quot;)) gf_fprintf(dump, &quot;\r&quot; );</span>
<span class="lineNum">    2066 </span><span class="lineNoCov">          0 :                 else if (!strcmp(key, &quot;t&quot;)) gf_fprintf(dump, &quot;\t&quot; );</span>
<span class="lineNum">    2067 </span><span class="lineNoCov">          0 :                 else if (!strcmp(key, &quot;data&quot;)) {</span>
<span class="lineNum">    2068 </span>            :                         u32 i;
<span class="lineNum">    2069 </span><span class="lineNoCov">          0 :                         for (i=0; i&lt;size; i++) {</span>
<span class="lineNum">    2070 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;%02X&quot;, (unsigned char) data[i]);</span>
<span class="lineNum">    2071 </span>            :                         }
<span class="lineNum">    2072 </span>            :                 }
<span class="lineNum">    2073 </span><span class="lineNoCov">          0 :                 else if (!strcmp(key, &quot;lp&quot;)) {</span>
<span class="lineNum">    2074 </span><span class="lineNoCov">          0 :                         u8 flags = gf_filter_pck_get_dependency_flags(pck);</span>
<span class="lineNum">    2075 </span><span class="lineNoCov">          0 :                         flags &gt;&gt;= 6;</span>
<span class="lineNum">    2076 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;%u&quot;, flags);</span>
<span class="lineNum">    2077 </span>            :                 }
<span class="lineNum">    2078 </span><span class="lineNoCov">          0 :                 else if (!strcmp(key, &quot;depo&quot;)) {</span>
<span class="lineNum">    2079 </span><span class="lineNoCov">          0 :                         u8 flags = gf_filter_pck_get_dependency_flags(pck);</span>
<span class="lineNum">    2080 </span><span class="lineNoCov">          0 :                         flags &gt;&gt;= 4;</span>
<span class="lineNum">    2081 </span><span class="lineNoCov">          0 :                         flags &amp;= 0x3;</span>
<span class="lineNum">    2082 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;%u&quot;, flags);</span>
<span class="lineNum">    2083 </span>            :                 }
<span class="lineNum">    2084 </span><span class="lineNoCov">          0 :                 else if (!strcmp(key, &quot;depf&quot;)) {</span>
<span class="lineNum">    2085 </span><span class="lineNoCov">          0 :                         u8 flags = gf_filter_pck_get_dependency_flags(pck);</span>
<span class="lineNum">    2086 </span><span class="lineNoCov">          0 :                         flags &gt;&gt;= 2;</span>
<span class="lineNum">    2087 </span><span class="lineNoCov">          0 :                         flags &amp;= 0x3;</span>
<span class="lineNum">    2088 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;%u&quot;, flags);</span>
<span class="lineNum">    2089 </span>            :                 }
<span class="lineNum">    2090 </span><span class="lineNoCov">          0 :                 else if (!strcmp(key, &quot;red&quot;)) {</span>
<span class="lineNum">    2091 </span><span class="lineNoCov">          0 :                         u8 flags = gf_filter_pck_get_dependency_flags(pck);</span>
<span class="lineNum">    2092 </span><span class="lineNoCov">          0 :                         flags &amp;= 0x3;</span>
<span class="lineNum">    2093 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;%u&quot;, flags);</span>
<span class="lineNum">    2094 </span>            :                 }
<span class="lineNum">    2095 </span><span class="lineNoCov">          0 :                 else if (!strcmp(key, &quot;ck&quot;)) gf_fprintf(dump, &quot;%d&quot;, gf_filter_pck_get_clock_type(pck) );</span>
<span class="lineNum">    2096 </span><span class="lineNoCov">          0 :                 else if (!strncmp(key, &quot;pid.&quot;, 4)) {</span>
<span class="lineNum">    2097 </span>            :                         const GF_PropertyValue *prop = NULL;
<span class="lineNum">    2098 </span>            :                         u32 prop_4cc=0;
<span class="lineNum">    2099 </span><span class="lineNoCov">          0 :                         const char *pkey = key+4;</span>
<span class="lineNum">    2100 </span><span class="lineNoCov">          0 :                         prop_4cc = gf_props_get_id(pkey);</span>
<span class="lineNum">    2101 </span><span class="lineNoCov">          0 :                         if (!prop_4cc &amp;&amp; strlen(pkey)==4) prop_4cc = GF_4CC(pkey[0],pkey[1],pkey[2],pkey[3]);</span>
<span class="lineNum">    2102 </span>            : 
<span class="lineNum">    2103 </span><span class="lineNoCov">          0 :                         if (prop_4cc) {</span>
<span class="lineNum">    2104 </span><span class="lineNoCov">          0 :                                 prop = gf_filter_pid_get_property(pctx-&gt;src_pid, prop_4cc);</span>
<span class="lineNum">    2105 </span>            :                         }
<span class="lineNum">    2106 </span><span class="lineNoCov">          0 :                         if (!prop) prop = gf_filter_pid_get_property_str(pctx-&gt;src_pid, key);</span>
<span class="lineNum">    2107 </span>            : 
<span class="lineNum">    2108 </span><span class="lineNoCov">          0 :                         if (prop) {</span>
<span class="lineNum">    2109 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;%s&quot;, gf_props_dump(prop_4cc, prop, szDump, (GF_PropDumDataMode) ctx-&gt;dump_data) );</span>
<span class="lineNum">    2110 </span>            :                         }
<span class="lineNum">    2111 </span>            :                 }
<span class="lineNum">    2112 </span>            :                 else {
<span class="lineNum">    2113 </span>            :                         const GF_PropertyValue *prop = NULL;
<span class="lineNum">    2114 </span><span class="lineNoCov">          0 :                         u32 prop_4cc = gf_props_get_id(key);</span>
<span class="lineNum">    2115 </span><span class="lineNoCov">          0 :                         if (!prop_4cc &amp;&amp; strlen(key)==4) prop_4cc = GF_4CC(key[0],key[1],key[2],key[3]);</span>
<span class="lineNum">    2116 </span>            : 
<span class="lineNum">    2117 </span><span class="lineNoCov">          0 :                         if (prop_4cc) {</span>
<span class="lineNum">    2118 </span><span class="lineNoCov">          0 :                                 prop = gf_filter_pck_get_property(pck, prop_4cc);</span>
<span class="lineNum">    2119 </span>            :                         }
<span class="lineNum">    2120 </span><span class="lineNoCov">          0 :                         if (!prop) prop = gf_filter_pck_get_property_str(pck, key);</span>
<span class="lineNum">    2121 </span>            : 
<span class="lineNum">    2122 </span><span class="lineNoCov">          0 :                         if (prop) {</span>
<span class="lineNum">    2123 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;%s&quot;, gf_props_dump(prop_4cc, prop, szDump, (GF_PropDumDataMode) ctx-&gt;dump_data) );</span>
<span class="lineNum">    2124 </span>            :                         }
<span class="lineNum">    2125 </span>            :                 }
<span class="lineNum">    2126 </span>            : 
<span class="lineNum">    2127 </span><span class="lineCov">      70776 :                 sep[0] = csep;</span>
<span class="lineNum">    2128 </span><span class="lineCov">      70776 :                 str = sep+1;</span>
<span class="lineNum">    2129 </span>            :         }
<span class="lineNum">    2130 </span>            : }
<span class="lineNum">    2131 </span>            : 
<span class="lineNum">    2132 </span>            : void gf_m4v_parser_set_inspect(GF_M4VParser *m4v);
<span class="lineNum">    2133 </span>            : u32 gf_m4v_parser_get_obj_type(GF_M4VParser *m4v);
<a name="2134"><span class="lineNum">    2134 </span>            : </a>
<span class="lineNum">    2135 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    2136 </span><span class="lineCov">        251 : static void inspect_dump_mpeg124(PidCtx *pctx, char *data, u32 size, FILE *dump)</span>
<span class="lineNum">    2137 </span>            : {
<span class="lineNum">    2138 </span>            :         u8 ftype;
<span class="lineNum">    2139 </span>            :         u32 tinc, o_type;
<span class="lineNum">    2140 </span>            :         u64 fsize, start;
<span class="lineNum">    2141 </span><span class="lineCov">        251 :         Bool is_coded, is_m4v=(pctx-&gt;codec_id==GF_CODECID_MPEG4_PART2) ? GF_TRUE : GF_FALSE;</span>
<span class="lineNum">    2142 </span>            :         GF_Err e;
<span class="lineNum">    2143 </span><span class="lineCov">        251 :         GF_M4VParser *m4v = gf_m4v_parser_new(data, size, !is_m4v);</span>
<span class="lineNum">    2144 </span>            : 
<span class="lineNum">    2145 </span><span class="lineCov">        251 :         gf_m4v_parser_set_inspect(m4v);</span>
<span class="lineNum">    2146 </span>            :         while (1) {
<span class="lineNum">    2147 </span><span class="lineCov">        507 :                 ftype = 0;</span>
<span class="lineNum">    2148 </span><span class="lineCov">        507 :                 is_coded = GF_FALSE;</span>
<span class="lineNum">    2149 </span><span class="lineCov">        507 :                 e = gf_m4v_parse_frame(m4v, &amp;pctx-&gt;dsi, &amp;ftype, &amp;tinc, &amp;fsize, &amp;start, &amp;is_coded);</span>
<span class="lineNum">    2150 </span><span class="lineCov">        507 :                 if (e)</span>
<span class="lineNum">    2151 </span>            :                         break;
<span class="lineNum">    2152 </span>            : 
<span class="lineNum">    2153 </span><span class="lineCov">        256 :                 o_type = gf_m4v_parser_get_obj_type(m4v);</span>
<span class="lineNum">    2154 </span><span class="lineCov">        256 :                 if (is_m4v) {</span>
<span class="lineNum">    2155 </span><span class="lineCov">        256 :                         gf_fprintf(dump, &quot;&lt;MPEG4P2VideoObj type=\&quot;0x%02X\&quot;&quot;, o_type);</span>
<span class="lineNum">    2156 </span><span class="lineCov">        256 :                         switch (o_type) {</span>
<span class="lineNum">    2157 </span>            :                         /*vosh*/
<span class="lineNum">    2158 </span><span class="lineCov">          1 :                         case M4V_VOS_START_CODE:</span>
<span class="lineNum">    2159 </span><span class="lineCov">          1 :                                 gf_fprintf(dump, &quot; name=\&quot;VOS\&quot; PL=\&quot;%d\&quot;&quot;, pctx-&gt;dsi.VideoPL);</span>
<span class="lineNum">    2160 </span><span class="lineCov">          1 :                                 break;</span>
<span class="lineNum">    2161 </span><span class="lineCov">          1 :                         case M4V_VOL_START_CODE:</span>
<span class="lineNum">    2162 </span><span class="lineCov">          1 :                                 gf_fprintf(dump, &quot; name=\&quot;VOL\&quot; RAPStream=\&quot;%d\&quot; objectType=\&quot;%d\&quot; par=\&quot;%d/%d\&quot; hasShape=\&quot;%d\&quot;&quot;, pctx-&gt;dsi.RAP_stream, pctx-&gt;dsi.objectType, pctx-&gt;dsi.par_num, pctx-&gt;dsi.par_den, pctx-&gt;dsi.has_shape);</span>
<span class="lineNum">    2163 </span><span class="lineCov">          1 :                                 if (pctx-&gt;dsi.clock_rate)</span>
<span class="lineNum">    2164 </span><span class="lineCov">          1 :                                         gf_fprintf(dump, &quot; clockRate=\&quot;%d\&quot;&quot;, pctx-&gt;dsi.clock_rate);</span>
<span class="lineNum">    2165 </span><span class="lineCov">          1 :                                 if (pctx-&gt;dsi.time_increment)</span>
<span class="lineNum">    2166 </span><span class="lineCov">          1 :                                         gf_fprintf(dump, &quot; timeIncrement=\&quot;%d\&quot;&quot;, pctx-&gt;dsi.time_increment);</span>
<span class="lineNum">    2167 </span><span class="lineCov">          1 :                                 if (!pctx-&gt;dsi.has_shape)</span>
<span class="lineNum">    2168 </span><span class="lineCov">          1 :                                         gf_fprintf(dump, &quot; width=\&quot;%d\&quot; height=\&quot;%d\&quot;&quot;, pctx-&gt;dsi.width, pctx-&gt;dsi.height);</span>
<span class="lineNum">    2169 </span>            : 
<span class="lineNum">    2170 </span>            :                                 break;
<span class="lineNum">    2171 </span>            : 
<span class="lineNum">    2172 </span><span class="lineCov">        250 :                         case M4V_VOP_START_CODE:</span>
<span class="lineNum">    2173 </span><span class="lineCov">        250 :                                 gf_fprintf(dump, &quot; name=\&quot;VOP\&quot; RAP=\&quot;%d\&quot; frameType=\&quot;%d\&quot; timeInc=\&quot;%d\&quot; isCoded=\&quot;%d\&quot;&quot;, (ftype==0) ? 1 : 0, ftype, tinc, is_coded);</span>
<span class="lineNum">    2174 </span><span class="lineCov">        250 :                                 break;</span>
<span class="lineNum">    2175 </span><span class="lineNoCov">          0 :                         case M4V_GOV_START_CODE:</span>
<span class="lineNum">    2176 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; name=\&quot;GOV\&quot;&quot;);</span>
<span class="lineNum">    2177 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    2178 </span>            :                         /*don't interest us*/
<span class="lineNum">    2179 </span><span class="lineCov">          2 :                         case M4V_UDTA_START_CODE:</span>
<span class="lineNum">    2180 </span><span class="lineCov">          2 :                                 gf_fprintf(dump, &quot; name=\&quot;UDTA\&quot;&quot;);</span>
<span class="lineNum">    2181 </span><span class="lineCov">          2 :                                 break;</span>
<span class="lineNum">    2182 </span>            : 
<span class="lineNum">    2183 </span><span class="lineCov">          1 :                         case M4V_VO_START_CODE:</span>
<span class="lineNum">    2184 </span><span class="lineCov">          1 :                                 gf_fprintf(dump, &quot; name=\&quot;VO\&quot;&quot;);</span>
<span class="lineNum">    2185 </span><span class="lineCov">          1 :                                 break;</span>
<span class="lineNum">    2186 </span><span class="lineCov">          1 :                         case M4V_VISOBJ_START_CODE:</span>
<span class="lineNum">    2187 </span><span class="lineCov">          1 :                                 gf_fprintf(dump, &quot; name=\&quot;VisObj\&quot;&quot;);</span>
<span class="lineNum">    2188 </span><span class="lineCov">          1 :                                 break;</span>
<span class="lineNum">    2189 </span>            :                         default:
<span class="lineNum">    2190 </span>            :                                 break;
<span class="lineNum">    2191 </span>            :                         }
<span class="lineNum">    2192 </span><span class="lineCov">        256 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    2193 </span>            :                 } else {
<span class="lineNum">    2194 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;&lt;MPEG12VideoObj type=\&quot;0x%02X\&quot;&quot;, o_type);</span>
<span class="lineNum">    2195 </span><span class="lineNoCov">          0 :                         switch (o_type) {</span>
<span class="lineNum">    2196 </span><span class="lineNoCov">          0 :                         case M2V_SEQ_START_CODE:</span>
<span class="lineNum">    2197 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; name=\&quot;SeqStart\&quot; width=\&quot;%d\&quot; height=\&quot;%d\&quot; sar=\&quot;%d/%d\&quot; fps=\&quot;%f\&quot;&quot;, pctx-&gt;dsi.width, pctx-&gt;dsi.height, pctx-&gt;dsi.par_num, pctx-&gt;dsi.par_den, pctx-&gt;dsi.fps);</span>
<span class="lineNum">    2198 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    2199 </span>            : 
<span class="lineNum">    2200 </span><span class="lineNoCov">          0 :                         case M2V_EXT_START_CODE:</span>
<span class="lineNum">    2201 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; name=\&quot;SeqStartEXT\&quot; width=\&quot;%d\&quot; height=\&quot;%d\&quot; PL=\&quot;%d\&quot;&quot;, pctx-&gt;dsi.width, pctx-&gt;dsi.height, pctx-&gt;dsi.VideoPL);</span>
<span class="lineNum">    2202 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    2203 </span><span class="lineNoCov">          0 :                         case M2V_PIC_START_CODE:</span>
<span class="lineNum">    2204 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; name=\&quot;PicStart\&quot; frameType=\&quot;%d\&quot; isCoded=\&quot;%d\&quot;&quot;, ftype, is_coded);</span>
<span class="lineNum">    2205 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    2206 </span><span class="lineNoCov">          0 :                         case M2V_GOP_START_CODE:</span>
<span class="lineNum">    2207 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; name=\&quot;GOPStart\&quot;&quot;);</span>
<span class="lineNum">    2208 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    2209 </span>            :                         default:
<span class="lineNum">    2210 </span>            :                                 break;
<span class="lineNum">    2211 </span>            :                         }
<span class="lineNum">    2212 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    2213 </span>            :                 }
<span class="lineNum">    2214 </span>            :         }
<span class="lineNum">    2215 </span><span class="lineCov">        251 :         gf_m4v_parser_del(m4v);</span>
<span class="lineNum">    2216 </span><span class="lineCov">        251 : }</span>
<a name="2217"><span class="lineNum">    2217 </span>            : #endif</a>
<span class="lineNum">    2218 </span>            : 
<span class="lineNum">    2219 </span><span class="lineCov">          2 : static void inspect_format_tmcd_internal(const u8 *data, u32 size, u32 tmcd_flags, u32 tc_num, u32 tc_den, u32 tmcd_fpt, char szFmt[100], GF_BitStream *bs, Bool force_ff, FILE *dump)</span>
<span class="lineNum">    2220 </span>            : {
<span class="lineNum">    2221 </span>            :         u32 h, m, s, f, value;
<span class="lineNum">    2222 </span>            :         Bool neg=GF_FALSE;
<span class="lineNum">    2223 </span>            :         u32 parse_fmt = 1;
<span class="lineNum">    2224 </span>            :         Bool is_drop = GF_FALSE;
<span class="lineNum">    2225 </span>            :         GF_BitStream *loc_bs = NULL;
<span class="lineNum">    2226 </span>            : 
<span class="lineNum">    2227 </span><span class="lineCov">          2 :         if (szFmt)</span>
<span class="lineNum">    2228 </span><span class="lineCov">          1 :                 szFmt[0] = 0;</span>
<span class="lineNum">    2229 </span>            : 
<span class="lineNum">    2230 </span><span class="lineCov">          2 :         if (!tc_num || !tc_den)</span>
<span class="lineNum">    2231 </span>            :                 return;
<span class="lineNum">    2232 </span>            : 
<span class="lineNum">    2233 </span><span class="lineCov">          2 :         if (!bs) {</span>
<span class="lineNum">    2234 </span><span class="lineCov">          1 :                 loc_bs = gf_bs_new(data, size, GF_BITSTREAM_READ);</span>
<span class="lineNum">    2235 </span>            :                 bs = loc_bs;
<span class="lineNum">    2236 </span>            :         } else {
<span class="lineNum">    2237 </span><span class="lineCov">          1 :                 gf_bs_reassign_buffer(bs, data, size);</span>
<span class="lineNum">    2238 </span>            :         }
<span class="lineNum">    2239 </span>            : 
<span class="lineNum">    2240 </span><span class="lineCov">          2 :         value = gf_bs_read_u32(bs);</span>
<span class="lineNum">    2241 </span><span class="lineCov">          2 :         gf_bs_seek(bs, 0);</span>
<span class="lineNum">    2242 </span>            : 
<span class="lineNum">    2243 </span><span class="lineCov">          2 :         if (tmcd_flags &amp; 0x00000001)</span>
<span class="lineNum">    2244 </span>            :                 is_drop = GF_TRUE;
<span class="lineNum">    2245 </span>            : 
<span class="lineNum">    2246 </span><span class="lineCov">          2 :         if (tmcd_flags &amp; 0x00000004)</span>
<span class="lineNum">    2247 </span>            :                 neg = GF_TRUE;
<span class="lineNum">    2248 </span>            : 
<span class="lineNum">    2249 </span><span class="lineCov">          2 :         if (dump)</span>
<span class="lineNum">    2250 </span><span class="lineCov">          1 :                 gf_fprintf(dump, &quot;&lt;TimeCode&quot;);</span>
<span class="lineNum">    2251 </span>            : 
<span class="lineNum">    2252 </span><span class="lineCov">          2 :         if (!force_ff &amp;&amp; !(tmcd_flags &amp; 0x00000008)) {</span>
<span class="lineNum">    2253 </span><span class="lineCov">          2 :                 h = gf_bs_read_u8(bs);</span>
<span class="lineNum">    2254 </span><span class="lineCov">          2 :                 neg = gf_bs_read_int(bs, 1);</span>
<span class="lineNum">    2255 </span><span class="lineCov">          2 :                 m = gf_bs_read_int(bs, 7);</span>
<span class="lineNum">    2256 </span><span class="lineCov">          2 :                 s = gf_bs_read_u8(bs);</span>
<span class="lineNum">    2257 </span><span class="lineCov">          2 :                 f = gf_bs_read_u8(bs);</span>
<span class="lineNum">    2258 </span>            : 
<span class="lineNum">    2259 </span><span class="lineCov">          2 :                 if (tmcd_fpt &amp;&amp; (f &gt; tmcd_fpt))</span>
<span class="lineNum">    2260 </span>            :                         parse_fmt = 2;
<span class="lineNum">    2261 </span><span class="lineNoCov">          0 :                 else if ((m&gt;=60) || (s&gt;=60))</span>
<span class="lineNum">    2262 </span>            :                         parse_fmt = 2;
<span class="lineNum">    2263 </span>            :                 else
<span class="lineNum">    2264 </span>            :                         parse_fmt = 0;
<span class="lineNum">    2265 </span>            :         }
<span class="lineNum">    2266 </span>            : 
<span class="lineNum">    2267 </span><span class="lineCov">          2 :         if (parse_fmt) {</span>
<span class="lineNum">    2268 </span><span class="lineCov">          2 :                 u64 nb_secs, nb_frames = value;</span>
<span class="lineNum">    2269 </span>            :                 neg = GF_FALSE;
<span class="lineNum">    2270 </span><span class="lineCov">          2 :                 if (parse_fmt==2) force_ff = GF_TRUE;</span>
<span class="lineNum">    2271 </span>            : 
<span class="lineNum">    2272 </span><span class="lineCov">          2 :                 if (!force_ff &amp;&amp; tmcd_fpt)</span>
<span class="lineNum">    2273 </span><span class="lineNoCov">          0 :                         nb_frames *= tmcd_fpt;</span>
<span class="lineNum">    2274 </span>            : 
<span class="lineNum">    2275 </span><span class="lineCov">          2 :                 if (is_drop &amp;&amp; tc_num) {</span>
<span class="lineNum">    2276 </span>            :                         u32 tc_drop_frames, min_10;
<span class="lineNum">    2277 </span>            : 
<span class="lineNum">    2278 </span>            :                         nb_secs = nb_frames;
<span class="lineNum">    2279 </span><span class="lineCov">          2 :                         nb_secs *= tc_den;</span>
<span class="lineNum">    2280 </span><span class="lineCov">          2 :                         nb_secs /= tc_num;</span>
<span class="lineNum">    2281 </span>            : 
<span class="lineNum">    2282 </span><span class="lineCov">          2 :                         m = (u32) (nb_secs/60);</span>
<span class="lineNum">    2283 </span>            : 
<span class="lineNum">    2284 </span><span class="lineCov">          2 :                         min_10 = m / 10;</span>
<span class="lineNum">    2285 </span><span class="lineCov">          2 :                         m-= min_10;</span>
<span class="lineNum">    2286 </span>            : 
<span class="lineNum">    2287 </span><span class="lineCov">          2 :                         tc_drop_frames = m*2;</span>
<span class="lineNum">    2288 </span><span class="lineCov">          2 :                         nb_frames += tc_drop_frames;</span>
<span class="lineNum">    2289 </span>            :                 }
<span class="lineNum">    2290 </span>            : 
<span class="lineNum">    2291 </span><span class="lineCov">          2 :                 if (!tmcd_fpt) tmcd_fpt = 30;</span>
<span class="lineNum">    2292 </span>            : 
<span class="lineNum">    2293 </span><span class="lineCov">          2 :                 nb_secs = nb_frames / tmcd_fpt;</span>
<span class="lineNum">    2294 </span><span class="lineCov">          2 :                 h = (u32) nb_secs/3600;</span>
<span class="lineNum">    2295 </span><span class="lineCov">          2 :                 m = (u32) (nb_secs/60 - h*60);</span>
<span class="lineNum">    2296 </span><span class="lineCov">          2 :                 s = (u32) (nb_secs - m*60 - h*3600);</span>
<span class="lineNum">    2297 </span>            : 
<span class="lineNum">    2298 </span><span class="lineCov">          2 :                 nb_secs *= tmcd_fpt;</span>
<span class="lineNum">    2299 </span>            : 
<span class="lineNum">    2300 </span><span class="lineCov">          2 :                 f = (u32) (nb_frames - nb_secs);</span>
<span class="lineNum">    2301 </span><span class="lineCov">          2 :                 if (tmcd_fpt &amp;&amp; (f==tmcd_fpt)) {</span>
<span class="lineNum">    2302 </span>            :                         f = 0;
<span class="lineNum">    2303 </span><span class="lineNoCov">          0 :                         s++;</span>
<span class="lineNum">    2304 </span><span class="lineNoCov">          0 :                         if (s==60) {</span>
<span class="lineNum">    2305 </span>            :                                 s = 0;
<span class="lineNum">    2306 </span><span class="lineNoCov">          0 :                                 m++;</span>
<span class="lineNum">    2307 </span><span class="lineNoCov">          0 :                                 if (m==60) {</span>
<span class="lineNum">    2308 </span>            :                                         m = 0;
<span class="lineNum">    2309 </span><span class="lineNoCov">          0 :                                         h++;</span>
<span class="lineNum">    2310 </span>            :                                 }
<span class="lineNum">    2311 </span>            :                         }
<span class="lineNum">    2312 </span>            :                 }
<span class="lineNum">    2313 </span>            :         }
<span class="lineNum">    2314 </span><span class="lineCov">          2 :         if (dump)</span>
<span class="lineNum">    2315 </span><span class="lineCov">          1 :                 gf_fprintf(dump, &quot; time=\&quot;%s%02d:%02d:%02d%c%02d\&quot;/&gt;\n&quot;, neg ? &quot;-&quot; : &quot;&quot;, h, m, s, is_drop ? ';' : ':', f);</span>
<span class="lineNum">    2316 </span><span class="lineCov">          1 :         else if (szFmt)</span>
<span class="lineNum">    2317 </span><span class="lineCov">          1 :                 sprintf(szFmt, &quot;%s%02d:%02d:%02d%c%02d&quot;, neg ? &quot;-&quot; : &quot;&quot;, h, m, s, is_drop ? ';' : ':', f);</span>
<span class="lineNum">    2318 </span>            : 
<span class="lineNum">    2319 </span><span class="lineCov">          2 :         if (loc_bs) gf_bs_del(loc_bs);</span>
<span class="lineNum">    2320 </span>            : }
<span class="lineNum">    2321 </span>            : 
<a name="2322"><span class="lineNum">    2322 </span>            : </a>
<span class="lineNum">    2323 </span>            : GF_EXPORT
<span class="lineNum">    2324 </span><span class="lineCov">          1 : void gf_inspect_format_timecode(const u8 *data, u32 size, u32 tmcd_flags, u32 tc_num, u32 tc_den, u32 tmcd_fpt, char szFmt[100])</span>
<span class="lineNum">    2325 </span>            : {
<span class="lineNum">    2326 </span><span class="lineCov">          1 :         inspect_format_tmcd_internal(data, size, tmcd_flags, tc_num, tc_den, tmcd_fpt, szFmt, NULL, GF_FALSE, NULL);</span>
<a name="2327"><span class="lineNum">    2327 </span><span class="lineCov">          1 : }</span></a>
<span class="lineNum">    2328 </span>            : 
<span class="lineNum">    2329 </span><span class="lineCov">          1 : static void inspect_dump_tmcd(GF_InspectCtx *ctx, PidCtx *pctx, const u8 *data, u32 size, FILE *dump)</span>
<span class="lineNum">    2330 </span>            : {
<span class="lineNum">    2331 </span><span class="lineCov">          1 :         inspect_format_tmcd_internal(data, size, pctx-&gt;tmcd_flags, pctx-&gt;tmcd_rate.num, pctx-&gt;tmcd_rate.den, pctx-&gt;tmcd_fpt, NULL, pctx-&gt;bs, ctx-&gt;fftmcd, dump);</span>
<a name="2332"><span class="lineNum">    2332 </span><span class="lineCov">          1 : }</span></a>
<span class="lineNum">    2333 </span>            : 
<span class="lineNum">    2334 </span><span class="lineCov">        348 : static void inspect_dump_vpx(GF_InspectCtx *ctx, FILE *dump, u8 *ptr, u64 frame_size, Bool dump_crc, PidCtx *pctx, u32 vpversion)</span>
<span class="lineNum">    2335 </span>            : {
<span class="lineNum">    2336 </span>            :         GF_Err e;
<span class="lineNum">    2337 </span><span class="lineCov">        348 :         Bool key_frame = GF_FALSE;</span>
<span class="lineNum">    2338 </span><span class="lineCov">        348 :         u32 width = 0, height = 0, renderWidth, renderHeight;</span>
<span class="lineNum">    2339 </span><span class="lineCov">        348 :         u32 num_frames_in_superframe = 0, superframe_index_size = 0, i = 0;</span>
<span class="lineNum">    2340 </span>            :         u32 frame_sizes[VP9_MAX_FRAMES_IN_SUPERFRAME];
<span class="lineNum">    2341 </span><span class="lineCov">        348 :         gf_bs_reassign_buffer(pctx-&gt;bs, ptr, frame_size);</span>
<span class="lineNum">    2342 </span>            :         InspectLogCbk lcbk;
<span class="lineNum">    2343 </span>            : 
<span class="lineNum">    2344 </span><span class="lineCov">        348 :         if (ctx-&gt;analyze&gt;=INSPECT_ANALYZE_BS) {</span>
<span class="lineNum">    2345 </span><span class="lineCov">        174 :                 lcbk.dump = dump;</span>
<span class="lineNum">    2346 </span><span class="lineCov">        174 :                 lcbk.dump_bits = ctx-&gt;analyze==INSPECT_ANALYZE_BS_BITS ? GF_TRUE : GF_FALSE;</span>
<span class="lineNum">    2347 </span><span class="lineCov">        174 :                 gf_bs_set_logger(pctx-&gt;bs, regular_bs_log, &amp;lcbk);</span>
<span class="lineNum">    2348 </span>            :         }
<span class="lineNum">    2349 </span>            : 
<span class="lineNum">    2350 </span>            :         /*check if it is a superframe*/
<span class="lineNum">    2351 </span><span class="lineCov">        348 :         e = gf_media_vp9_parse_superframe(pctx-&gt;bs, frame_size, &amp;num_frames_in_superframe, frame_sizes, &amp;superframe_index_size);</span>
<span class="lineNum">    2352 </span>            : 
<span class="lineNum">    2353 </span><span class="lineCov">        348 :         gf_fprintf(dump, &quot;&lt;VP%d%sFrame&quot;, vpversion, superframe_index_size ? &quot;Super&quot; : &quot;&quot;);</span>
<span class="lineNum">    2354 </span><span class="lineCov">        348 :         if (e) {</span>
<span class="lineNum">    2355 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; status=\&quot;error parsing superframe\&quot;/&gt;\n&quot;);</span>
<span class="lineNum">    2356 </span><span class="lineNoCov">          0 :                 gf_bs_set_logger(pctx-&gt;bs, NULL, NULL);</span>
<span class="lineNum">    2357 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">    2358 </span>            :         }
<span class="lineNum">    2359 </span><span class="lineCov">        348 :         if (superframe_index_size)</span>
<span class="lineNum">    2360 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; nb_frames=\&quot;%u\&quot; index_size=\&quot;%u\&quot;&gt;\n&quot;, num_frames_in_superframe, superframe_index_size);</span>
<span class="lineNum">    2361 </span>            :         else {
<span class="lineNum">    2362 </span>            :                 assert(num_frames_in_superframe==1);
<span class="lineNum">    2363 </span>            :         }
<span class="lineNum">    2364 </span><span class="lineCov">        348 :         for (i = 0; i &lt; num_frames_in_superframe; ++i) {</span>
<span class="lineNum">    2365 </span><span class="lineCov">        348 :                 u64 pos2 = gf_bs_get_position(pctx-&gt;bs);</span>
<span class="lineNum">    2366 </span>            : 
<span class="lineNum">    2367 </span><span class="lineCov">        348 :                 if (superframe_index_size)</span>
<span class="lineNum">    2368 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;&lt;VP%dFrame&quot;, vpversion);</span>
<span class="lineNum">    2369 </span>            : 
<span class="lineNum">    2370 </span><span class="lineCov">        348 :                 gf_fprintf(dump, &quot; size=\&quot;%u\&quot;&quot;, frame_sizes[i]);</span>
<span class="lineNum">    2371 </span><span class="lineCov">        348 :                 if (gf_media_vp9_parse_sample(pctx-&gt;bs, pctx-&gt;vpcc, &amp;key_frame, &amp;width, &amp;height, &amp;renderWidth, &amp;renderHeight) != GF_OK) {</span>
<span class="lineNum">    2372 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; status=\&quot;error parsing frame\&quot;/&gt;\n&quot;);</span>
<span class="lineNum">    2373 </span>            :                         goto exit;
<span class="lineNum">    2374 </span>            :                 }
<span class="lineNum">    2375 </span><span class="lineCov">        348 :                 gf_fprintf(dump, &quot; key_frame=\&quot;%u\&quot; width=\&quot;%u\&quot; height=\&quot;%u\&quot; renderWidth=\&quot;%u\&quot; renderHeight=\&quot;%u\&quot;&quot;, key_frame, width, height, renderWidth, renderHeight);</span>
<span class="lineNum">    2376 </span><span class="lineCov">        348 :                 e = gf_bs_seek(pctx-&gt;bs, pos2 + frame_sizes[i]);</span>
<span class="lineNum">    2377 </span><span class="lineCov">        348 :                 if (e) {</span>
<span class="lineNum">    2378 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; status=\&quot;error seeking %s (offset &quot;LLU&quot;)\&quot;/&gt;\n&quot;, gf_error_to_string(e), pos2 + frame_sizes[i]);</span>
<span class="lineNum">    2379 </span>            :                         goto exit;
<span class="lineNum">    2380 </span>            :                 }
<span class="lineNum">    2381 </span>            : 
<span class="lineNum">    2382 </span><span class="lineCov">        348 :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    2383 </span>            :         }
<span class="lineNum">    2384 </span>            : 
<span class="lineNum">    2385 </span><span class="lineCov">        348 : exit:</span>
<span class="lineNum">    2386 </span><span class="lineCov">        348 :         if (superframe_index_size)</span>
<span class="lineNum">    2387 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;&lt;/VP%dSuperFrame&gt;\n&quot;, vpversion);</span>
<span class="lineNum">    2388 </span><span class="lineCov">        348 :         gf_bs_set_logger(pctx-&gt;bs, NULL, NULL);</span>
<a name="2389"><span class="lineNum">    2389 </span>            : }</a>
<span class="lineNum">    2390 </span>            : 
<span class="lineNum">    2391 </span><span class="lineCov">       1724 : static void inspect_dump_ac3_eac3(GF_InspectCtx *ctx, FILE *dump, u8 *ptr, u64 frame_size, Bool dump_crc, PidCtx *pctx, Bool is_ec3)</span>
<span class="lineNum">    2392 </span>            : {
<span class="lineNum">    2393 </span>            :         GF_AC3Header hdr;
<span class="lineNum">    2394 </span>            :         InspectLogCbk lcbk;
<span class="lineNum">    2395 </span>            : 
<span class="lineNum">    2396 </span><span class="lineCov">       1724 :         if (!pctx-&gt;bs) pctx-&gt;bs = gf_bs_new(ptr, frame_size, GF_BITSTREAM_READ);</span>
<span class="lineNum">    2397 </span><span class="lineCov">       1724 :         else gf_bs_reassign_buffer(pctx-&gt;bs, ptr, frame_size);</span>
<span class="lineNum">    2398 </span>            : 
<span class="lineNum">    2399 </span><span class="lineCov">       1724 :         if (ctx-&gt;analyze&gt;=INSPECT_ANALYZE_BS) {</span>
<span class="lineNum">    2400 </span><span class="lineCov">        862 :                 lcbk.dump = dump;</span>
<span class="lineNum">    2401 </span><span class="lineCov">        862 :                 lcbk.dump_bits = ctx-&gt;analyze==INSPECT_ANALYZE_BS_BITS ? GF_TRUE : GF_FALSE;</span>
<span class="lineNum">    2402 </span><span class="lineCov">        862 :                 gf_bs_set_logger(pctx-&gt;bs, regular_bs_log, &amp;lcbk);</span>
<span class="lineNum">    2403 </span>            :         }
<span class="lineNum">    2404 </span><span class="lineCov">       1724 :         gf_fprintf(dump, &quot;&lt;%sSample &quot;, is_ec3 ? &quot;EC3&quot; : &quot;AC3&quot;);</span>
<span class="lineNum">    2405 </span>            :         memset(&amp;hdr, 0, sizeof(GF_AC3Header));
<span class="lineNum">    2406 </span><span class="lineCov">       1724 :         gf_ac3_parser_bs(pctx-&gt;bs, &amp;hdr, GF_TRUE);</span>
<span class="lineNum">    2407 </span><span class="lineCov">       1724 :         if (ctx-&gt;analyze&lt;INSPECT_ANALYZE_BS) {</span>
<span class="lineNum">    2408 </span><span class="lineCov">        862 :                 gf_fprintf(dump, &quot;bitrate=\&quot;%u\&quot; channels=\&quot;%u\&quot; framesize=\&quot;%u\&quot;&quot;, hdr.bitrate, hdr.channels, hdr.framesize);</span>
<span class="lineNum">    2409 </span><span class="lineCov">        862 :                 if (hdr.is_ec3) {</span>
<span class="lineNum">    2410 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; nb_streams=\&quot;%u\&quot; &quot;, hdr.nb_streams);</span>
<span class="lineNum">    2411 </span>            :                 }
<span class="lineNum">    2412 </span>            :         }
<span class="lineNum">    2413 </span>            : 
<span class="lineNum">    2414 </span><span class="lineCov">       1724 :         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    2415 </span><span class="lineCov">       1724 :         gf_bs_set_logger(pctx-&gt;bs, NULL, NULL);</span>
<a name="2416"><span class="lineNum">    2416 </span><span class="lineCov">       1724 : }</span></a>
<span class="lineNum">    2417 </span>            : 
<span class="lineNum">    2418 </span><span class="lineCov">     138427 : static void inspect_dump_packet(GF_InspectCtx *ctx, FILE *dump, GF_FilterPacket *pck, u32 pid_idx, u64 pck_num, PidCtx *pctx)</span>
<span class="lineNum">    2419 </span>            : {
<span class="lineNum">    2420 </span><span class="lineCov">     138427 :         u32 idx=0, size, sap;</span>
<span class="lineNum">    2421 </span>            :         u64 ts;
<span class="lineNum">    2422 </span>            :         u8 dflags = 0;
<span class="lineNum">    2423 </span>            :         GF_FilterClockType ck_type;
<span class="lineNum">    2424 </span>            :         GF_FilterFrameInterface *fifce=NULL;
<span class="lineNum">    2425 </span>            :         Bool start, end;
<span class="lineNum">    2426 </span>            :         u8 *data;
<span class="lineNum">    2427 </span><span class="lineCov">     272290 :         if (!dump) return;</span>
<span class="lineNum">    2428 </span>            : 
<span class="lineNum">    2429 </span><span class="lineCov">     138427 :         if (!ctx-&gt;deep &amp;&amp; !ctx-&gt;fmt) return;</span>
<span class="lineNum">    2430 </span>            : 
<span class="lineNum">    2431 </span><span class="lineCov">     138427 :         data = (u8 *) gf_filter_pck_get_data(pck, &amp;size);</span>
<span class="lineNum">    2432 </span><span class="lineCov">     138427 :         gf_filter_pck_get_framing(pck, &amp;start, &amp;end);</span>
<span class="lineNum">    2433 </span>            : 
<span class="lineNum">    2434 </span><span class="lineCov">     138427 :         ck_type = ctx-&gt;pcr ? gf_filter_pck_get_clock_type(pck) : 0;</span>
<span class="lineNum">    2435 </span><span class="lineCov">     138427 :         if (!size &amp;&amp; !ck_type) {</span>
<span class="lineNum">    2436 </span><span class="lineCov">        607 :                 fifce = gf_filter_pck_get_frame_interface(pck);</span>
<span class="lineNum">    2437 </span><span class="lineCov">        607 :                 if (!fifce) return;</span>
<span class="lineNum">    2438 </span>            :         }
<span class="lineNum">    2439 </span>            : 
<span class="lineNum">    2440 </span><span class="lineCov">     138425 :         if (ctx-&gt;xml) {</span>
<span class="lineNum">    2441 </span><span class="lineCov">       4564 :                 gf_fprintf(dump, &quot;&lt;Packet number=\&quot;&quot;LLU&quot;\&quot;&quot;, pck_num);</span>
<span class="lineNum">    2442 </span><span class="lineCov">       4564 :                 if (ctx-&gt;interleave)</span>
<span class="lineNum">    2443 </span><span class="lineCov">       4564 :                         gf_fprintf(dump, &quot; PID=\&quot;%d\&quot;&quot;, pid_idx);</span>
<span class="lineNum">    2444 </span>            :         } else {
<span class="lineNum">    2445 </span><span class="lineCov">     133861 :                 gf_fprintf(dump, &quot;PID %d PCK &quot;LLU&quot; - &quot;, pid_idx, pck_num);</span>
<span class="lineNum">    2446 </span>            :         }
<span class="lineNum">    2447 </span><span class="lineCov">     138425 :         if (ck_type) {</span>
<span class="lineNum">    2448 </span><span class="lineCov">       3503 :                 ts = gf_filter_pck_get_cts(pck);</span>
<span class="lineNum">    2449 </span><span class="lineCov">       3503 :                 if (ctx-&gt;xml) {</span>
<span class="lineNum">    2450 </span><span class="lineNoCov">          0 :                         if (ts==GF_FILTER_NO_TS) gf_fprintf(dump, &quot; PCR=\&quot;N/A\&quot;&quot;);</span>
<span class="lineNum">    2451 </span><span class="lineNoCov">          0 :                         else gf_fprintf(dump, &quot; PCR=\&quot;&quot;LLU&quot;\&quot; &quot;, ts );</span>
<span class="lineNum">    2452 </span><span class="lineNoCov">          0 :                         if (ck_type!=GF_FILTER_CLOCK_PCR) gf_fprintf(dump, &quot; discontinuity=\&quot;true\&quot;&quot;);</span>
<span class="lineNum">    2453 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;&quot;);</span>
<span class="lineNum">    2454 </span>            :                 } else {
<span class="lineNum">    2455 </span><span class="lineCov">       3503 :                         if (ts==GF_FILTER_NO_TS) gf_fprintf(dump, &quot; PCR N/A&quot;);</span>
<span class="lineNum">    2456 </span><span class="lineCov">       3503 :                         else gf_fprintf(dump, &quot; PCR%s &quot;LLU&quot;\n&quot;, (ck_type==GF_FILTER_CLOCK_PCR) ? &quot;&quot; : &quot; discontinuity&quot;, ts );</span>
<span class="lineNum">    2457 </span>            :                 }
<span class="lineNum">    2458 </span>            :                 return;
<span class="lineNum">    2459 </span>            :         }
<span class="lineNum">    2460 </span><span class="lineCov">     134922 :         if (ctx-&gt;xml) {</span>
<span class="lineNum">    2461 </span><span class="lineCov">       4564 :                 if (fifce) gf_fprintf(dump, &quot; framing=\&quot;interface\&quot;&quot;);</span>
<span class="lineNum">    2462 </span><span class="lineCov">       4564 :                 else if (start &amp;&amp; end) gf_fprintf(dump, &quot; framing=\&quot;complete\&quot;&quot;);</span>
<span class="lineNum">    2463 </span><span class="lineNoCov">          0 :                 else if (start) gf_fprintf(dump, &quot; framing=\&quot;start\&quot;&quot;);</span>
<span class="lineNum">    2464 </span><span class="lineNoCov">          0 :                 else if (end) gf_fprintf(dump, &quot; framing=\&quot;end\&quot;&quot;);</span>
<span class="lineNum">    2465 </span><span class="lineNoCov">          0 :                 else gf_fprintf(dump, &quot; framing=\&quot;continuation\&quot;&quot;);</span>
<span class="lineNum">    2466 </span>            :         } else {
<span class="lineNum">    2467 </span><span class="lineCov">     130358 :                 if (fifce) gf_fprintf(dump, &quot;interface&quot;);</span>
<span class="lineNum">    2468 </span><span class="lineCov">     129753 :                 else if (start &amp;&amp; end) gf_fprintf(dump, &quot;full frame&quot;);</span>
<span class="lineNum">    2469 </span><span class="lineCov">          4 :                 else if (start) gf_fprintf(dump, &quot;frame start&quot;);</span>
<span class="lineNum">    2470 </span><span class="lineCov">          2 :                 else if (end) gf_fprintf(dump, &quot;frame end&quot;);</span>
<span class="lineNum">    2471 </span><span class="lineNoCov">          0 :                 else gf_fprintf(dump, &quot;frame continuation&quot;);</span>
<span class="lineNum">    2472 </span>            :         }
<span class="lineNum">    2473 </span><span class="lineCov">     134922 :         ts = gf_filter_pck_get_dts(pck);</span>
<span class="lineNum">    2474 </span><span class="lineCov">     134922 :         if (ts==GF_FILTER_NO_TS) DUMP_ATT_STR(&quot;dts&quot;, &quot;N/A&quot;)</span>
<span class="lineNum">    2475 </span><span class="lineCov">     134919 :         else DUMP_ATT_LLU(&quot;dts&quot;, ts )</span>
<span class="lineNum">    2476 </span>            : 
<span class="lineNum">    2477 </span><span class="lineCov">     134922 :         ts = gf_filter_pck_get_cts(pck);</span>
<span class="lineNum">    2478 </span><span class="lineCov">     134922 :         if (ts==GF_FILTER_NO_TS) DUMP_ATT_STR(&quot;cts&quot;, &quot;N/A&quot;)</span>
<span class="lineNum">    2479 </span><span class="lineCov">     134919 :         else DUMP_ATT_LLU(&quot;cts&quot;, ts )</span>
<span class="lineNum">    2480 </span>            : 
<span class="lineNum">    2481 </span><span class="lineCov">     134922 :         DUMP_ATT_U(&quot;dur&quot;, gf_filter_pck_get_duration(pck) )</span>
<span class="lineNum">    2482 </span><span class="lineCov">     134922 :         sap = gf_filter_pck_get_sap(pck);</span>
<span class="lineNum">    2483 </span><span class="lineCov">     134922 :         if (sap==GF_FILTER_SAP_4_PROL) {</span>
<span class="lineNum">    2484 </span><span class="lineNoCov">          0 :                 DUMP_ATT_STR(sap, &quot;4 (prol)&quot;);</span>
<span class="lineNum">    2485 </span>            :         } else {
<span class="lineNum">    2486 </span><span class="lineCov">     134922 :                 DUMP_ATT_U(&quot;sap&quot;, gf_filter_pck_get_sap(pck) )</span>
<span class="lineNum">    2487 </span>            :         }
<span class="lineNum">    2488 </span><span class="lineCov">     134922 :         DUMP_ATT_D(&quot;ilace&quot;, gf_filter_pck_get_interlaced(pck) )</span>
<span class="lineNum">    2489 </span><span class="lineCov">     134922 :         DUMP_ATT_D(&quot;corr&quot;, gf_filter_pck_get_corrupted(pck) )</span>
<span class="lineNum">    2490 </span><span class="lineCov">     134922 :         DUMP_ATT_D(&quot;seek&quot;, gf_filter_pck_get_seek_flag(pck) )</span>
<span class="lineNum">    2491 </span>            : 
<span class="lineNum">    2492 </span><span class="lineCov">     134922 :         ts = gf_filter_pck_get_byte_offset(pck);</span>
<span class="lineNum">    2493 </span><span class="lineCov">     134922 :         if (ts==GF_FILTER_NO_BO) DUMP_ATT_STR(&quot;bo&quot;, &quot;N/A&quot;)</span>
<span class="lineNum">    2494 </span><span class="lineCov">       5470 :         else DUMP_ATT_LLU(&quot;bo&quot;, ts )</span>
<span class="lineNum">    2495 </span>            : 
<span class="lineNum">    2496 </span><span class="lineCov">     134922 :         DUMP_ATT_U(&quot;roll&quot;, gf_filter_pck_get_roll_info(pck) )</span>
<span class="lineNum">    2497 </span><span class="lineCov">     134922 :         DUMP_ATT_U(&quot;crypt&quot;, gf_filter_pck_get_crypt_flags(pck) )</span>
<span class="lineNum">    2498 </span><span class="lineCov">     134922 :         DUMP_ATT_U(&quot;vers&quot;, gf_filter_pck_get_carousel_version(pck) )</span>
<span class="lineNum">    2499 </span>            : 
<span class="lineNum">    2500 </span><span class="lineCov">     134922 :         if (!fifce) {</span>
<span class="lineNum">    2501 </span><span class="lineCov">     134317 :                 DUMP_ATT_U(&quot;size&quot;, size )</span>
<span class="lineNum">    2502 </span>            :         }
<span class="lineNum">    2503 </span><span class="lineCov">     134922 :         dflags = gf_filter_pck_get_dependency_flags(pck);</span>
<span class="lineNum">    2504 </span><span class="lineCov">     134922 :         DUMP_ATT_U(&quot;lp&quot;, (dflags&gt;&gt;6) &amp; 0x3 )</span>
<span class="lineNum">    2505 </span><span class="lineCov">     134922 :         DUMP_ATT_U(&quot;depo&quot;, (dflags&gt;&gt;4) &amp; 0x3 )</span>
<span class="lineNum">    2506 </span><span class="lineCov">     134922 :         DUMP_ATT_U(&quot;depf&quot;, (dflags&gt;&gt;2) &amp; 0x3 )</span>
<span class="lineNum">    2507 </span><span class="lineCov">     134922 :         DUMP_ATT_U(&quot;red&quot;, (dflags) &amp; 0x3 )</span>
<span class="lineNum">    2508 </span>            : 
<span class="lineNum">    2509 </span><span class="lineCov">     134922 :         if (!data) size = 0;</span>
<span class="lineNum">    2510 </span><span class="lineCov">     134922 :         if (ctx-&gt;dump_data) {</span>
<span class="lineNum">    2511 </span>            :                 u32 i;
<span class="lineNum">    2512 </span><span class="lineNoCov">          0 :                 DUMP_ATT_STR(&quot;data&quot;, &quot;&quot;)</span>
<span class="lineNum">    2513 </span><span class="lineNoCov">          0 :                 for (i=0; i&lt;size; i++) {</span>
<span class="lineNum">    2514 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;%02X&quot;, (unsigned char) data[i]);</span>
<span class="lineNum">    2515 </span>            :                 }
<span class="lineNum">    2516 </span><span class="lineNoCov">          0 :                 if (ctx-&gt;xml) gf_fprintf(dump, &quot;\&quot;&quot;);</span>
<span class="lineNum">    2517 </span><span class="lineCov">     134922 :         } else if (fifce) {</span>
<span class="lineNum">    2518 </span>            :                 u32 i;
<span class="lineNum">    2519 </span><span class="lineCov">        605 :                 char *name = fifce-&gt;get_gl_texture ? &quot;Interface_GLTexID&quot; : &quot;Interface_NumPlanes&quot;;</span>
<span class="lineNum">    2520 </span><span class="lineCov">        605 :                 if (ctx-&gt;xml) {</span>
<span class="lineNum">    2521 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; %s=\&quot;&quot;, name);</span>
<span class="lineNum">    2522 </span>            :                 } else {
<span class="lineNum">    2523 </span><span class="lineCov">        605 :                         gf_fprintf(dump, &quot; %s &quot;, name);</span>
<span class="lineNum">    2524 </span>            :                 }
<span class="lineNum">    2525 </span><span class="lineCov">        605 :                 for (i=0; i&lt;4; i++) {</span>
<span class="lineNum">    2526 </span><span class="lineCov">       1210 :                         if (fifce-&gt;get_gl_texture) {</span>
<span class="lineNum">    2527 </span>            :                                 GF_Matrix mx;
<span class="lineNum">    2528 </span><span class="lineCov">       1210 :                                 gf_mx_init(mx);</span>
<span class="lineNum">    2529 </span>            :                                 u32 gl_tex_format, gl_tex_id;
<span class="lineNum">    2530 </span><span class="lineCov">       1210 :                                 if (fifce-&gt;get_gl_texture(fifce, i, &amp;gl_tex_format, &amp;gl_tex_id, &amp;mx) != GF_OK)</span>
<span class="lineNum">    2531 </span>            :                                         break;
<span class="lineNum">    2532 </span><span class="lineCov">        605 :                                 if (i) gf_fprintf(dump, &quot;,&quot;);</span>
<span class="lineNum">    2533 </span><span class="lineCov">        605 :                                 gf_fprintf(dump, &quot;%d&quot;, gl_tex_id);</span>
<span class="lineNum">    2534 </span>            :                         } else {
<span class="lineNum">    2535 </span>            :                                 u32 stride;
<span class="lineNum">    2536 </span>            :                                 const u8 *plane;
<span class="lineNum">    2537 </span><span class="lineNoCov">          0 :                                 if (fifce-&gt;get_plane(fifce, i, &amp;plane, &amp;stride) != GF_OK)</span>
<span class="lineNum">    2538 </span>            :                                         break;
<span class="lineNum">    2539 </span>            :                         }
<span class="lineNum">    2540 </span>            :                 }
<span class="lineNum">    2541 </span><span class="lineCov">        605 :                 if (!fifce-&gt;get_gl_texture) {</span>
<span class="lineNum">    2542 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;%d&quot;, i);</span>
<span class="lineNum">    2543 </span>            :                 }
<span class="lineNum">    2544 </span>            : 
<span class="lineNum">    2545 </span><span class="lineCov">        605 :                 if (ctx-&gt;xml) {</span>
<span class="lineNum">    2546 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;\&quot;&quot;);</span>
<span class="lineNum">    2547 </span>            :                 }
<span class="lineNum">    2548 </span><span class="lineCov">     134317 :         } else if (data &amp;&amp; (ctx-&gt;test!=INSPECT_TEST_NOCRC) ) {</span>
<span class="lineNum">    2549 </span><span class="lineCov">     134227 :                 DUMP_ATT_X(&quot;CRC32&quot;, gf_crc_32(data, size) )</span>
<span class="lineNum">    2550 </span>            :         }
<span class="lineNum">    2551 </span><span class="lineCov">     134922 :         if (ctx-&gt;xml) {</span>
<span class="lineNum">    2552 </span><span class="lineCov">       4564 :                 if (!ctx-&gt;props) goto props_done;</span>
<span class="lineNum">    2553 </span>            : 
<span class="lineNum">    2554 </span>            :         } else {
<span class="lineNum">    2555 </span><span class="lineCov">     130358 :                 gf_fprintf(dump, &quot;\n&quot;);</span>
<span class="lineNum">    2556 </span>            :         }
<span class="lineNum">    2557 </span>            : 
<span class="lineNum">    2558 </span><span class="lineCov">     134922 :         if (!ctx-&gt;props) return;</span>
<span class="lineNum">    2559 </span><span class="lineCov">       5072 :         while (1) {</span>
<span class="lineNum">    2560 </span>            :                 u32 prop_4cc;
<span class="lineNum">    2561 </span>            :                 const char *prop_name;
<span class="lineNum">    2562 </span><span class="lineCov">     139994 :                 const GF_PropertyValue * p = gf_filter_pck_enum_properties(pck, &amp;idx, &amp;prop_4cc, &amp;prop_name);</span>
<span class="lineNum">    2563 </span><span class="lineCov">     139994 :                 if (!p) break;</span>
<span class="lineNum">    2564 </span><span class="lineCov">       5072 :                 if (idx==0) gf_fprintf(dump, &quot;properties:\n&quot;);</span>
<span class="lineNum">    2565 </span>            : 
<span class="lineNum">    2566 </span><span class="lineCov">       5072 :                 inspect_dump_property(ctx, dump, prop_4cc, prop_name, p, pctx);</span>
<span class="lineNum">    2567 </span>            :         }
<span class="lineNum">    2568 </span>            : 
<span class="lineNum">    2569 </span>            : 
<span class="lineNum">    2570 </span><span class="lineCov">     134922 : props_done:</span>
<span class="lineNum">    2571 </span><span class="lineCov">     134922 :         if (!ctx-&gt;analyze) {</span>
<span class="lineNum">    2572 </span><span class="lineCov">     130358 :                 if (ctx-&gt;xml) {</span>
<span class="lineNum">    2573 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    2574 </span>            :                 }
<span class="lineNum">    2575 </span>            :                 return;
<span class="lineNum">    2576 </span>            :         }
<span class="lineNum">    2577 </span><span class="lineCov">       4564 :         gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    2578 </span>            : 
<span class="lineNum">    2579 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    2580 </span><span class="lineCov">       4564 :         if (pctx-&gt;hevc_state || pctx-&gt;avc_state || pctx-&gt;vvc_state) {</span>
<span class="lineNum">    2581 </span><span class="lineCov">        850 :                 idx=1;</span>
<span class="lineNum">    2582 </span>            : 
<span class="lineNum">    2583 </span><span class="lineCov">        850 :                 if (pctx-&gt;is_adobe_protected &amp;&amp; size) {</span>
<span class="lineNum">    2584 </span><span class="lineNoCov">          0 :                         u8 encrypted_au = data[0];</span>
<span class="lineNum">    2585 </span><span class="lineNoCov">          0 :                         if (encrypted_au) {</span>
<span class="lineNum">    2586 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;   &lt;!-- Packet is an Adobe's protected frame and can not be dumped --&gt;\n&quot;);</span>
<span class="lineNum">    2587 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;&lt;/Packet&gt;\n&quot;);</span>
<span class="lineNum">    2588 </span><span class="lineNoCov">          0 :                                 return;</span>
<span class="lineNum">    2589 </span>            :                         }
<span class="lineNum">    2590 </span>            :                         else {
<span class="lineNum">    2591 </span><span class="lineNoCov">          0 :                                 data++;</span>
<span class="lineNum">    2592 </span><span class="lineNoCov">          0 :                                 size--;</span>
<span class="lineNum">    2593 </span>            :                         }
<span class="lineNum">    2594 </span>            :                 }
<span class="lineNum">    2595 </span><span class="lineCov">       6296 :                 while (size) {</span>
<span class="lineNum">    2596 </span><span class="lineCov">       5446 :                         u32 nal_size = inspect_get_nal_size((char*)data, pctx-&gt;nalu_size_length);</span>
<span class="lineNum">    2597 </span><span class="lineCov">       5446 :                         data += pctx-&gt;nalu_size_length;</span>
<span class="lineNum">    2598 </span>            : 
<span class="lineNum">    2599 </span><span class="lineCov">       5446 :                         if (pctx-&gt;nalu_size_length + nal_size &gt; size) {</span>
<span class="lineNum">    2600 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;   &lt;!-- NALU is corrupted: size is %d but only %d remains --&gt;\n&quot;, nal_size, size);</span>
<span class="lineNum">    2601 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    2602 </span>            :                         } else {
<span class="lineNum">    2603 </span><span class="lineCov">       5446 :                                 gf_fprintf(dump, &quot;   &lt;NALU size=\&quot;%d\&quot; &quot;, nal_size);</span>
<span class="lineNum">    2604 </span><span class="lineCov">       5446 :                                 gf_inspect_dump_nalu_internal(dump, data, nal_size, pctx-&gt;has_svcc ? 1 : 0, pctx-&gt;hevc_state, pctx-&gt;avc_state, pctx-&gt;vvc_state, pctx-&gt;nalu_size_length, ctx-&gt;crc, pctx-&gt;is_cenc_protected, ctx-&gt;analyze, pctx);</span>
<span class="lineNum">    2605 </span>            :                         }
<span class="lineNum">    2606 </span><span class="lineCov">       5446 :                         idx++;</span>
<span class="lineNum">    2607 </span><span class="lineCov">       5446 :                         data += nal_size;</span>
<span class="lineNum">    2608 </span><span class="lineCov">       5446 :                         size -= nal_size + pctx-&gt;nalu_size_length;</span>
<span class="lineNum">    2609 </span>            :                 }
<span class="lineNum">    2610 </span><span class="lineCov">       3714 :         } else if (pctx-&gt;av1_state) {</span>
<span class="lineNum">    2611 </span><span class="lineCov">        346 :                 gf_bs_reassign_buffer(pctx-&gt;bs, data, size);</span>
<span class="lineNum">    2612 </span><span class="lineCov">       1074 :                 while (size) {</span>
<span class="lineNum">    2613 </span>            :                         ObuType obu_type = 0;
<span class="lineNum">    2614 </span>            :                         u64 obu_size = 0;
<span class="lineNum">    2615 </span>            :                         u32 hdr_size = 0;
<span class="lineNum">    2616 </span>            : 
<span class="lineNum">    2617 </span>            : 
<span class="lineNum">    2618 </span><span class="lineCov">        382 :                         obu_size = gf_inspect_dump_obu_internal(dump, pctx-&gt;av1_state, (char *) data, obu_size, obu_type, obu_size, hdr_size, ctx-&gt;crc, pctx, ctx-&gt;analyze);</span>
<span class="lineNum">    2619 </span>            : 
<span class="lineNum">    2620 </span><span class="lineCov">        382 :                         if (obu_size &gt; size) {</span>
<span class="lineNum">    2621 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;   &lt;!-- OBU is corrupted: size is %d but only %d remains --&gt;\n&quot;, (u32) obu_size, size);</span>
<span class="lineNum">    2622 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    2623 </span>            :                         }
<span class="lineNum">    2624 </span><span class="lineCov">        382 :                         data += obu_size;</span>
<span class="lineNum">    2625 </span><span class="lineCov">        382 :                         size -= (u32)obu_size;</span>
<span class="lineNum">    2626 </span><span class="lineCov">        382 :                         idx++;</span>
<span class="lineNum">    2627 </span>            :                 }
<span class="lineNum">    2628 </span>            :         } else {
<span class="lineNum">    2629 </span>            :                 u32 hdr, pos, fsize, i;
<span class="lineNum">    2630 </span><span class="lineCov">       3368 :                 switch (pctx-&gt;codec_id) {</span>
<span class="lineNum">    2631 </span><span class="lineCov">        250 :                 case GF_CODECID_MPEG1:</span>
<span class="lineNum">    2632 </span>            :                 case GF_CODECID_MPEG2_422:
<span class="lineNum">    2633 </span>            :                 case GF_CODECID_MPEG2_SNR:
<span class="lineNum">    2634 </span>            :                 case GF_CODECID_MPEG2_HIGH:
<span class="lineNum">    2635 </span>            :                 case GF_CODECID_MPEG2_MAIN:
<span class="lineNum">    2636 </span>            :                 case GF_CODECID_MPEG4_PART2:
<span class="lineNum">    2637 </span><span class="lineCov">        250 :                         inspect_dump_mpeg124(pctx, (char *) data, size, dump);</span>
<span class="lineNum">    2638 </span><span class="lineCov">        250 :                         break;</span>
<span class="lineNum">    2639 </span><span class="lineCov">        385 :                 case GF_CODECID_MPEG_AUDIO:</span>
<span class="lineNum">    2640 </span>            :                 case GF_CODECID_MPEG2_PART3:
<span class="lineNum">    2641 </span><span class="lineCov">        385 :                         pos = 0;</span>
<span class="lineNum">    2642 </span><span class="lineCov">       1155 :                         while (size) {</span>
<span class="lineNum">    2643 </span><span class="lineCov">        385 :                                 hdr = gf_mp3_get_next_header_mem(data, size, &amp;pos);</span>
<span class="lineNum">    2644 </span><span class="lineCov">        385 :                                 fsize = gf_mp3_frame_size(hdr);</span>
<span class="lineNum">    2645 </span><span class="lineCov">        385 :                                 gf_fprintf(dump, &quot;&lt;MPEGAudioFrame size=\&quot;%d\&quot; layer=\&quot;%d\&quot; version=\&quot;%d\&quot; bitrate=\&quot;%d\&quot; channels=\&quot;%d\&quot; samplesPerFrame=\&quot;%d\&quot; samplerate=\&quot;%d\&quot;/&gt;\n&quot;, fsize, gf_mp3_layer(hdr), gf_mp3_version(hdr), gf_mp3_bit_rate(hdr), gf_mp3_num_channels(hdr), gf_mp3_window_size(hdr), gf_mp3_sampling_rate(hdr));</span>
<span class="lineNum">    2646 </span><span class="lineCov">        385 :                                 if (size&lt;pos+fsize) break;</span>
<span class="lineNum">    2647 </span><span class="lineCov">        385 :                                 data += pos + fsize;</span>
<span class="lineNum">    2648 </span><span class="lineCov">        385 :                                 size -= pos + fsize;</span>
<span class="lineNum">    2649 </span>            :                         }
<span class="lineNum">    2650 </span>            :                         break;
<span class="lineNum">    2651 </span><span class="lineCov">          1 :                 case GF_CODECID_TMCD:</span>
<span class="lineNum">    2652 </span><span class="lineCov">          1 :                         inspect_dump_tmcd(ctx, pctx, (char *) data, size, dump);</span>
<span class="lineNum">    2653 </span><span class="lineCov">          1 :                         break;</span>
<span class="lineNum">    2654 </span><span class="lineNoCov">          0 :                 case GF_CODECID_SUBS_TEXT:</span>
<span class="lineNum">    2655 </span>            :                 case GF_CODECID_META_TEXT:
<span class="lineNum">    2656 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;&lt;![CDATA[&quot;);</span>
<span class="lineNum">    2657 </span><span class="lineNoCov">          0 :                         for (i=0; i&lt;size; i++) {</span>
<span class="lineNum">    2658 </span><span class="lineNoCov">          0 :                                 gf_fputc(data[i], dump);</span>
<span class="lineNum">    2659 </span>            :                         }
<span class="lineNum">    2660 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;]]&gt;\n&quot;);</span>
<span class="lineNum">    2661 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    2662 </span>            :                 case GF_CODECID_SUBS_XML:
<span class="lineNum">    2663 </span>            :                 case GF_CODECID_META_XML:
<span class="lineNum">    2664 </span><span class="lineNoCov">          0 :                         for (i=0; i&lt;size; i++) {</span>
<span class="lineNum">    2665 </span><span class="lineNoCov">          0 :                                 gf_fputc(data[i], dump);</span>
<span class="lineNum">    2666 </span>            :                         }
<span class="lineNum">    2667 </span>            :                         break;
<span class="lineNum">    2668 </span><span class="lineNoCov">          0 :                 case GF_CODECID_APCH:</span>
<span class="lineNum">    2669 </span>            :                 case GF_CODECID_APCO:
<span class="lineNum">    2670 </span>            :                 case GF_CODECID_APCN:
<span class="lineNum">    2671 </span>            :                 case GF_CODECID_APCS:
<span class="lineNum">    2672 </span>            :                 case GF_CODECID_AP4X:
<span class="lineNum">    2673 </span>            :                 case GF_CODECID_AP4H:
<span class="lineNum">    2674 </span><span class="lineNoCov">          0 :                         gf_inspect_dump_prores_internal(dump, (char *) data, size, ctx-&gt;crc, pctx);</span>
<span class="lineNum">    2675 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    2676 </span>            : 
<span class="lineNum">    2677 </span><span class="lineNoCov">          0 :                 case GF_CODECID_MPHA:</span>
<span class="lineNum">    2678 </span><span class="lineNoCov">          0 :                         gf_bs_reassign_buffer(pctx-&gt;bs, data, size);</span>
<span class="lineNum">    2679 </span><span class="lineNoCov">          0 :                         gf_inspect_dump_mha_frame(dump, pctx-&gt;bs, &quot;&quot;);</span>
<span class="lineNum">    2680 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    2681 </span>            : 
<span class="lineNum">    2682 </span><span class="lineNoCov">          0 :                 case GF_CODECID_MHAS:</span>
<span class="lineNum">    2683 </span><span class="lineNoCov">          0 :                         gf_inspect_dump_mhas(dump, (char *) data, size, ctx-&gt;crc, pctx);</span>
<span class="lineNum">    2684 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    2685 </span><span class="lineNoCov">          0 :                 case GF_CODECID_VP8:</span>
<span class="lineNum">    2686 </span><span class="lineNoCov">          0 :                         inspect_dump_vpx(ctx, dump, (char *) data, size, ctx-&gt;crc, pctx, 8);</span>
<span class="lineNum">    2687 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    2688 </span><span class="lineCov">        348 :                 case GF_CODECID_VP9:</span>
<span class="lineNum">    2689 </span><span class="lineCov">        348 :                         inspect_dump_vpx(ctx, dump, (char *) data, size, ctx-&gt;crc, pctx, 9);</span>
<span class="lineNum">    2690 </span><span class="lineCov">        348 :                         break;</span>
<span class="lineNum">    2691 </span><span class="lineCov">       1724 :                 case GF_CODECID_AC3:</span>
<span class="lineNum">    2692 </span><span class="lineCov">       1724 :                         inspect_dump_ac3_eac3(ctx, dump, (char *) data, size, ctx-&gt;crc, pctx, 0);</span>
<span class="lineNum">    2693 </span><span class="lineCov">       1724 :                         break;</span>
<span class="lineNum">    2694 </span><span class="lineNoCov">          0 :                 case GF_CODECID_EAC3:</span>
<span class="lineNum">    2695 </span><span class="lineNoCov">          0 :                         inspect_dump_ac3_eac3(ctx, dump, (char *) data, size, ctx-&gt;crc, pctx, 1);</span>
<span class="lineNum">    2696 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    2697 </span><span class="lineNoCov">          0 :                 case GF_CODECID_TRUEHD:</span>
<span class="lineNum">    2698 </span><span class="lineNoCov">          0 :                         gf_bs_reassign_buffer(pctx-&gt;bs, data, size);</span>
<span class="lineNum">    2699 </span><span class="lineNoCov">          0 :                         gf_inspect_dump_truehd_frame(dump, pctx-&gt;bs);</span>
<span class="lineNum">    2700 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    2701 </span>            :                 }
<span class="lineNum">    2702 </span>            :         }
<span class="lineNum">    2703 </span>            : #endif
<span class="lineNum">    2704 </span><span class="lineCov">       4564 :         gf_fprintf(dump, &quot;&lt;/Packet&gt;\n&quot;);</span>
<span class="lineNum">    2705 </span>            : }
<span class="lineNum">    2706 </span>            : 
<span class="lineNum">    2707 </span>            : #define DUMP_ARRAY(arr, name, loc, _is_svc)\
<span class="lineNum">    2708 </span>            :         if (arr &amp;&amp; gf_list_count(arr)) {\
<span class="lineNum">    2709 </span>            :                 gf_fprintf(dump, &quot;  &lt;%sArray location=\&quot;%s\&quot;&gt;\n&quot;, name, loc);\
<span class="lineNum">    2710 </span>            :                 for (i=0; i&lt;gf_list_count(arr); i++) {\
<span class="lineNum">    2711 </span>            :                         slc = gf_list_get(arr, i);\
<span class="lineNum">    2712 </span>            :                         gf_fprintf(dump, &quot;   &lt;NALU size=\&quot;%d\&quot; &quot;, slc-&gt;size);\
<span class="lineNum">    2713 </span>            :                         gf_inspect_dump_nalu_internal(dump, slc-&gt;data, slc-&gt;size, _is_svc, pctx-&gt;hevc_state, pctx-&gt;avc_state, pctx-&gt;vvc_state, nalh_size, ctx-&gt;crc, GF_FALSE, ctx-&gt;analyze, pctx);\
<span class="lineNum">    2714 </span>            :                 }\
<span class="lineNum">    2715 </span>            :                 gf_fprintf(dump, &quot;  &lt;/%sArray&gt;\n&quot;, name);\
<span class="lineNum">    2716 </span>            :         }\
<span class="lineNum">    2717 </span>            : 
<a name="2718"><span class="lineNum">    2718 </span>            : </a>
<span class="lineNum">    2719 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    2720 </span><span class="lineCov">          9 : static void inspect_reset_parsers(PidCtx *pctx, void *keep_parser_address)</span>
<span class="lineNum">    2721 </span>            : {
<span class="lineNum">    2722 </span><span class="lineCov">          9 :         if ((&amp;pctx-&gt;hevc_state != keep_parser_address) &amp;&amp; pctx-&gt;hevc_state) {</span>
<span class="lineNum">    2723 </span><span class="lineNoCov">          0 :                 gf_free(pctx-&gt;hevc_state);</span>
<span class="lineNum">    2724 </span><span class="lineNoCov">          0 :                 pctx-&gt;hevc_state = NULL;</span>
<span class="lineNum">    2725 </span>            :         }
<span class="lineNum">    2726 </span><span class="lineCov">          9 :         if ((&amp;pctx-&gt;avc_state != keep_parser_address) &amp;&amp; pctx-&gt;avc_state) {</span>
<span class="lineNum">    2727 </span><span class="lineNoCov">          0 :                 gf_free(pctx-&gt;avc_state);</span>
<span class="lineNum">    2728 </span><span class="lineNoCov">          0 :                 pctx-&gt;avc_state = NULL;</span>
<span class="lineNum">    2729 </span>            :         }
<span class="lineNum">    2730 </span><span class="lineCov">          9 :         if ((&amp;pctx-&gt;vvc_state != keep_parser_address) &amp;&amp; pctx-&gt;vvc_state) {</span>
<span class="lineNum">    2731 </span><span class="lineNoCov">          0 :                 gf_free(pctx-&gt;vvc_state);</span>
<span class="lineNum">    2732 </span><span class="lineNoCov">          0 :                 pctx-&gt;vvc_state = NULL;</span>
<span class="lineNum">    2733 </span>            :         }
<span class="lineNum">    2734 </span><span class="lineCov">          9 :         if ((&amp;pctx-&gt;av1_state != keep_parser_address) &amp;&amp; pctx-&gt;av1_state) {</span>
<span class="lineNum">    2735 </span><span class="lineNoCov">          0 :                 if (pctx-&gt;av1_state-&gt;config) gf_odf_av1_cfg_del(pctx-&gt;av1_state-&gt;config);</span>
<span class="lineNum">    2736 </span><span class="lineNoCov">          0 :                 gf_free(pctx-&gt;av1_state);</span>
<span class="lineNum">    2737 </span><span class="lineNoCov">          0 :                 pctx-&gt;av1_state = NULL;</span>
<span class="lineNum">    2738 </span>            :         }
<span class="lineNum">    2739 </span><span class="lineCov">          9 :         if ((&amp;pctx-&gt;mv124_state != keep_parser_address) &amp;&amp; pctx-&gt;mv124_state) {</span>
<span class="lineNum">    2740 </span><span class="lineNoCov">          0 :                 gf_m4v_parser_del(pctx-&gt;mv124_state);</span>
<span class="lineNum">    2741 </span><span class="lineNoCov">          0 :                 pctx-&gt;mv124_state = NULL;</span>
<span class="lineNum">    2742 </span>            :         }
<span class="lineNum">    2743 </span><span class="lineCov">          9 :         if (pctx-&gt;vpcc) gf_odf_vp_cfg_del(pctx-&gt;vpcc);</span>
<span class="lineNum">    2744 </span><span class="lineCov">          9 : }</span>
<a name="2745"><span class="lineNum">    2745 </span>            : #endif</a>
<span class="lineNum">    2746 </span>            : 
<span class="lineNum">    2747 </span><span class="lineCov">        671 : static void inspect_dump_pid(GF_InspectCtx *ctx, FILE *dump, GF_FilterPid *pid, u32 pid_idx, Bool is_connect, Bool is_remove, u64 pck_for_config, Bool is_info, PidCtx *pctx)</span>
<span class="lineNum">    2748 </span>            : {
<span class="lineNum">    2749 </span><span class="lineCov">        671 :         u32 idx=0, nalh_size;</span>
<span class="lineNum">    2750 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    2751 </span>            :         u32 i;
<span class="lineNum">    2752 </span>            :         GF_NALUFFParam *slc;
<span class="lineNum">    2753 </span>            : #endif
<span class="lineNum">    2754 </span>            :         GF_AVCConfig *avcc, *svcc;
<span class="lineNum">    2755 </span>            :         GF_HEVCConfig *hvcc, *lhcc;
<span class="lineNum">    2756 </span>            :         GF_VVCConfig *vvcC;
<span class="lineNum">    2757 </span>            :         Bool is_enh = GF_FALSE;
<span class="lineNum">    2758 </span>            :         Bool is_svc=GF_FALSE;
<span class="lineNum">    2759 </span>            :         char *elt_name = NULL;
<span class="lineNum">    2760 </span>            :         const GF_PropertyValue *p, *dsi, *dsi_enh;
<span class="lineNum">    2761 </span>            : 
<span class="lineNum">    2762 </span><span class="lineCov">       1331 :         if (!ctx-&gt;dump) return;</span>
<span class="lineNum">    2763 </span><span class="lineCov">        671 :         if (ctx-&gt;test==INSPECT_TEST_NOPROP) return;</span>
<span class="lineNum">    2764 </span>            : 
<span class="lineNum">    2765 </span>            :         //disconnect of src pid (not yet supported)
<span class="lineNum">    2766 </span><span class="lineCov">        615 :         if (ctx-&gt;xml) {</span>
<span class="lineNum">    2767 </span><span class="lineCov">         15 :                 if (is_info) {</span>
<span class="lineNum">    2768 </span>            :                         elt_name = &quot;PIDInfoUpdate&quot;;
<span class="lineNum">    2769 </span><span class="lineCov">         15 :                 } else if (is_remove) {</span>
<span class="lineNum">    2770 </span>            :                         elt_name = &quot;PIDRemove&quot;;
<span class="lineNum">    2771 </span>            :                 } else {
<span class="lineNum">    2772 </span><span class="lineCov">         15 :                         elt_name = is_connect ? &quot;PIDConfigure&quot; : &quot;PIDReconfigure&quot;;</span>
<span class="lineNum">    2773 </span>            :                 }
<span class="lineNum">    2774 </span><span class="lineCov">         15 :                 gf_fprintf(dump, &quot;&lt;%s PID=\&quot;%d\&quot; name=\&quot;%s\&quot;&quot;,elt_name, pid_idx, gf_filter_pid_get_name(pid) );</span>
<span class="lineNum">    2775 </span>            : 
<span class="lineNum">    2776 </span><span class="lineCov">         15 :                 if (pck_for_config)</span>
<span class="lineNum">    2777 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; packetsSinceLastConfig=\&quot;&quot;LLU&quot;\&quot;&quot;, pck_for_config);</span>
<span class="lineNum">    2778 </span>            :         } else {
<span class="lineNum">    2779 </span><span class="lineCov">        600 :                 if (is_info) {</span>
<span class="lineNum">    2780 </span><span class="lineCov">         30 :                         gf_fprintf(dump, &quot;PID %d name %s info update\n&quot;, pid_idx, gf_filter_pid_get_name(pid) );</span>
<span class="lineNum">    2781 </span><span class="lineCov">        570 :                 } else if (is_remove) {</span>
<span class="lineNum">    2782 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;PID %d name %s delete\n&quot;, pid_idx, gf_filter_pid_get_name(pid) );</span>
<span class="lineNum">    2783 </span>            :                 } else {
<span class="lineNum">    2784 </span><span class="lineCov">        570 :                         gf_fprintf(dump, &quot;PID %d name %s %sonfigure&quot;, pid_idx, gf_filter_pid_get_name(pid), is_connect ? &quot;C&quot; : &quot;Rec&quot; );</span>
<span class="lineNum">    2785 </span><span class="lineCov">        570 :                         if (pck_for_config)</span>
<span class="lineNum">    2786 </span><span class="lineCov">        130 :                                 gf_fprintf(dump, &quot; after &quot;LLU&quot; packets&quot;, pck_for_config);</span>
<span class="lineNum">    2787 </span><span class="lineCov">        570 :                         gf_fprintf(dump, &quot; - properties:\n&quot;);</span>
<span class="lineNum">    2788 </span>            :                 }
<span class="lineNum">    2789 </span>            :         }
<span class="lineNum">    2790 </span>            : 
<span class="lineNum">    2791 </span><span class="lineCov">        615 :         if (!is_info) {</span>
<span class="lineNum">    2792 </span><span class="lineCov">      15500 :                 while (1) {</span>
<span class="lineNum">    2793 </span>            :                         u32 prop_4cc;
<span class="lineNum">    2794 </span>            :                         const char *prop_name;
<span class="lineNum">    2795 </span><span class="lineCov">      16085 :                         p = gf_filter_pid_enum_properties(pid, &amp;idx, &amp;prop_4cc, &amp;prop_name);</span>
<span class="lineNum">    2796 </span><span class="lineCov">      16085 :                         if (!p) break;</span>
<span class="lineNum">    2797 </span><span class="lineCov">      15500 :                         inspect_dump_property(ctx, dump, prop_4cc, prop_name, p, pctx);</span>
<span class="lineNum">    2798 </span>            : 
<span class="lineNum">    2799 </span><span class="lineCov">      15500 :                         if (prop_name) {</span>
<span class="lineNum">    2800 </span><span class="lineCov">        297 :                                 if (!strcmp(prop_name, &quot;tmcd:flags&quot;))</span>
<span class="lineNum">    2801 </span><span class="lineCov">          2 :                                         pctx-&gt;tmcd_flags = p-&gt;value.uint;</span>
<span class="lineNum">    2802 </span><span class="lineCov">        295 :                                 else if (!strcmp(prop_name, &quot;tmcd:framerate&quot;))</span>
<span class="lineNum">    2803 </span><span class="lineCov">          2 :                                         pctx-&gt;tmcd_rate = p-&gt;value.frac;</span>
<span class="lineNum">    2804 </span><span class="lineCov">        293 :                                 else if (!strcmp(prop_name, &quot;tmcd:frames_per_tick&quot;))</span>
<span class="lineNum">    2805 </span><span class="lineCov">          2 :                                         pctx-&gt;tmcd_fpt = p-&gt;value.uint;</span>
<span class="lineNum">    2806 </span>            : 
<span class="lineNum">    2807 </span>            :                         }
<span class="lineNum">    2808 </span>            :                 }
<span class="lineNum">    2809 </span>            :         } else {
<span class="lineNum">    2810 </span><span class="lineCov">         60 :                 while (ctx-&gt;info) {</span>
<span class="lineNum">    2811 </span>            :                         u32 prop_4cc;
<span class="lineNum">    2812 </span>            :                         const char *prop_name;
<span class="lineNum">    2813 </span><span class="lineCov">         60 :                         p = gf_filter_pid_enum_info(pid, &amp;idx, &amp;prop_4cc, &amp;prop_name);</span>
<span class="lineNum">    2814 </span><span class="lineCov">         60 :                         if (!p) break;</span>
<span class="lineNum">    2815 </span><span class="lineCov">         30 :                         inspect_dump_property(ctx, dump, prop_4cc, prop_name, p, pctx);</span>
<span class="lineNum">    2816 </span>            :                 }
<span class="lineNum">    2817 </span>            :         }
<span class="lineNum">    2818 </span>            : 
<span class="lineNum">    2819 </span><span class="lineCov">        615 :         if (!ctx-&gt;analyze) {</span>
<span class="lineNum">    2820 </span><span class="lineCov">        600 :                 if (ctx-&gt;xml) {</span>
<span class="lineNum">    2821 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    2822 </span>            :                 }
<span class="lineNum">    2823 </span>            :                 return;
<span class="lineNum">    2824 </span>            :         }
<span class="lineNum">    2825 </span>            : 
<span class="lineNum">    2826 </span><span class="lineCov">         15 :         p = gf_filter_pid_get_property(pid, GF_PROP_PID_CODECID);</span>
<span class="lineNum">    2827 </span><span class="lineCov">         15 :         if (!p) {</span>
<span class="lineNum">    2828 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    2829 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">    2830 </span>            :         }
<span class="lineNum">    2831 </span><span class="lineCov">         15 :         pctx-&gt;codec_id = p-&gt;value.uint;</span>
<span class="lineNum">    2832 </span>            : 
<span class="lineNum">    2833 </span><span class="lineCov">         15 :         dsi = gf_filter_pid_get_property(pid, GF_PROP_PID_DECODER_CONFIG);</span>
<span class="lineNum">    2834 </span><span class="lineCov">         15 :         dsi_enh = gf_filter_pid_get_property(pid, GF_PROP_PID_DECODER_CONFIG_ENHANCEMENT);</span>
<span class="lineNum">    2835 </span>            : 
<span class="lineNum">    2836 </span>            :         avcc = NULL;
<span class="lineNum">    2837 </span>            :         svcc = NULL;
<span class="lineNum">    2838 </span>            :         hvcc = NULL;
<span class="lineNum">    2839 </span>            :         lhcc = NULL;
<span class="lineNum">    2840 </span>            :         vvcC = NULL;
<span class="lineNum">    2841 </span><span class="lineCov">         15 :         pctx-&gt;has_svcc = 0;</span>
<span class="lineNum">    2842 </span>            : 
<span class="lineNum">    2843 </span><span class="lineCov">         15 :         switch (pctx-&gt;codec_id) {</span>
<span class="lineNum">    2844 </span><span class="lineNoCov">          0 :         case GF_CODECID_SVC:</span>
<span class="lineNum">    2845 </span>            :         case GF_CODECID_MVC:
<span class="lineNum">    2846 </span><span class="lineNoCov">          0 :                 if (!dsi) is_enh = GF_TRUE;</span>
<span class="lineNum">    2847 </span>            :         case GF_CODECID_AVC:
<span class="lineNum">    2848 </span>            :         case GF_CODECID_AVC_PS:
<span class="lineNum">    2849 </span><span class="lineCov">          2 :                 if (!dsi &amp;&amp; !dsi_enh) {</span>
<span class="lineNum">    2850 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    2851 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">    2852 </span>            :                 }
<span class="lineNum">    2853 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    2854 </span><span class="lineCov">          2 :                 inspect_reset_parsers(pctx, &amp;pctx-&gt;avc_state);</span>
<span class="lineNum">    2855 </span>            : 
<span class="lineNum">    2856 </span><span class="lineCov">          2 :                 if (!pctx-&gt;avc_state) {</span>
<span class="lineNum">    2857 </span><span class="lineCov">          2 :                         GF_SAFEALLOC(pctx-&gt;avc_state, AVCState);</span>
<span class="lineNum">    2858 </span><span class="lineCov">          2 :                         if (!pctx-&gt;avc_state) return;</span>
<span class="lineNum">    2859 </span>            :                 }
<span class="lineNum">    2860 </span>            : #endif
<span class="lineNum">    2861 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    2862 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot;&lt;AVCParameterSets&gt;\n&quot;);</span>
<span class="lineNum">    2863 </span><span class="lineCov">          2 :                 if (dsi) {</span>
<span class="lineNum">    2864 </span><span class="lineCov">          2 :                         if (is_enh) {</span>
<span class="lineNum">    2865 </span><span class="lineNoCov">          0 :                                 svcc = gf_odf_avc_cfg_read(dsi-&gt;value.data.ptr, dsi-&gt;value.data.size);</span>
<span class="lineNum">    2866 </span><span class="lineNoCov">          0 :                                 if (svcc)</span>
<span class="lineNum">    2867 </span><span class="lineNoCov">          0 :                                         pctx-&gt;nalu_size_length = svcc-&gt;nal_unit_size;</span>
<span class="lineNum">    2868 </span>            :                         } else {
<span class="lineNum">    2869 </span><span class="lineCov">          2 :                                 avcc = gf_odf_avc_cfg_read(dsi-&gt;value.data.ptr, dsi-&gt;value.data.size);</span>
<span class="lineNum">    2870 </span><span class="lineCov">          2 :                                 if (avcc)</span>
<span class="lineNum">    2871 </span><span class="lineCov">          2 :                                         pctx-&gt;nalu_size_length = avcc-&gt;nal_unit_size;</span>
<span class="lineNum">    2872 </span>            :                         }
<span class="lineNum">    2873 </span>            :                 }
<span class="lineNum">    2874 </span><span class="lineCov">          2 :                 if (dsi_enh &amp;&amp; !svcc) {</span>
<span class="lineNum">    2875 </span><span class="lineNoCov">          0 :                         svcc = gf_odf_avc_cfg_read(dsi_enh-&gt;value.data.ptr, dsi_enh-&gt;value.data.size);</span>
<span class="lineNum">    2876 </span><span class="lineNoCov">          0 :                         if (svcc)</span>
<span class="lineNum">    2877 </span><span class="lineNoCov">          0 :                                 pctx-&gt;nalu_size_length = svcc-&gt;nal_unit_size;</span>
<span class="lineNum">    2878 </span>            :                 }
<span class="lineNum">    2879 </span><span class="lineCov">          2 :                 nalh_size = pctx-&gt;nalu_size_length;</span>
<span class="lineNum">    2880 </span><span class="lineCov">          2 :                 is_svc = (svcc != NULL) ? 1 : 0;</span>
<span class="lineNum">    2881 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    2882 </span><span class="lineCov">          2 :                 if (avcc) {</span>
<span class="lineNum">    2883 </span><span class="lineCov">          2 :                         DUMP_ARRAY(avcc-&gt;sequenceParameterSets, &quot;AVCSPS&quot;, &quot;decoderConfig&quot;, is_svc)</span>
<span class="lineNum">    2884 </span><span class="lineCov">          2 :                         DUMP_ARRAY(avcc-&gt;pictureParameterSets, &quot;AVCPPS&quot;, &quot;decoderConfig&quot;, is_svc)</span>
<span class="lineNum">    2885 </span><span class="lineCov">          2 :                         DUMP_ARRAY(avcc-&gt;sequenceParameterSetExtensions, &quot;AVCSPSEx&quot;, &quot;decoderConfig&quot;, is_svc)</span>
<span class="lineNum">    2886 </span>            :                 }
<span class="lineNum">    2887 </span><span class="lineCov">          2 :                 if (is_svc) {</span>
<span class="lineNum">    2888 </span><span class="lineNoCov">          0 :                         DUMP_ARRAY(svcc-&gt;sequenceParameterSets, &quot;SVCSPS&quot;, dsi_enh ? &quot;decoderConfigEnhancement&quot; : &quot;decoderConfig&quot;, is_svc)</span>
<span class="lineNum">    2889 </span><span class="lineNoCov">          0 :                         DUMP_ARRAY(svcc-&gt;pictureParameterSets, &quot;SVCPPS&quot;, dsi_enh ? &quot;decoderConfigEnhancement&quot; : &quot;decoderConfig&quot;, is_svc)</span>
<span class="lineNum">    2890 </span><span class="lineNoCov">          0 :                         pctx-&gt;has_svcc = 1;</span>
<span class="lineNum">    2891 </span>            :                 }
<span class="lineNum">    2892 </span>            : #endif
<span class="lineNum">    2893 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot;&lt;/AVCParameterSets&gt;\n&quot;);</span>
<span class="lineNum">    2894 </span><span class="lineCov">          2 :                 break;</span>
<span class="lineNum">    2895 </span><span class="lineNoCov">          0 :         case GF_CODECID_LHVC:</span>
<span class="lineNum">    2896 </span>            :                 is_enh = GF_TRUE;
<span class="lineNum">    2897 </span><span class="lineCov">          2 :         case GF_CODECID_HEVC:</span>
<span class="lineNum">    2898 </span>            :         case GF_CODECID_HEVC_TILES:
<span class="lineNum">    2899 </span><span class="lineCov">          2 :                 if (!dsi &amp;&amp; !dsi_enh) {</span>
<span class="lineNum">    2900 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    2901 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">    2902 </span>            :                 }
<span class="lineNum">    2903 </span>            : 
<span class="lineNum">    2904 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    2905 </span><span class="lineCov">          2 :                 inspect_reset_parsers(pctx, &amp;pctx-&gt;hevc_state);</span>
<span class="lineNum">    2906 </span>            : 
<span class="lineNum">    2907 </span><span class="lineCov">          2 :                 if (!pctx-&gt;hevc_state) {</span>
<span class="lineNum">    2908 </span><span class="lineCov">          2 :                         GF_SAFEALLOC(pctx-&gt;hevc_state, HEVCState);</span>
<span class="lineNum">    2909 </span><span class="lineCov">          2 :                         if (!pctx-&gt;hevc_state) return;</span>
<span class="lineNum">    2910 </span>            :                 }
<span class="lineNum">    2911 </span>            : #endif
<span class="lineNum">    2912 </span>            : 
<span class="lineNum">    2913 </span><span class="lineCov">          2 :                 if (dsi) {</span>
<span class="lineNum">    2914 </span><span class="lineCov">          2 :                         if (is_enh &amp;&amp; !dsi_enh) {</span>
<span class="lineNum">    2915 </span><span class="lineNoCov">          0 :                                 lhcc = gf_odf_hevc_cfg_read(dsi-&gt;value.data.ptr, dsi-&gt;value.data.size, GF_TRUE);</span>
<span class="lineNum">    2916 </span><span class="lineNoCov">          0 :                                 if (lhcc)</span>
<span class="lineNum">    2917 </span><span class="lineNoCov">          0 :                                         pctx-&gt;nalu_size_length = lhcc-&gt;nal_unit_size;</span>
<span class="lineNum">    2918 </span>            :                         } else {
<span class="lineNum">    2919 </span><span class="lineCov">          2 :                                 hvcc = gf_odf_hevc_cfg_read(dsi-&gt;value.data.ptr, dsi-&gt;value.data.size, GF_FALSE);</span>
<span class="lineNum">    2920 </span><span class="lineCov">          2 :                                 if (hvcc)</span>
<span class="lineNum">    2921 </span><span class="lineCov">          2 :                                         pctx-&gt;nalu_size_length = hvcc-&gt;nal_unit_size;</span>
<span class="lineNum">    2922 </span>            :                         }
<span class="lineNum">    2923 </span>            :                 }
<span class="lineNum">    2924 </span><span class="lineCov">          2 :                 if (dsi_enh &amp;&amp; !lhcc) {</span>
<span class="lineNum">    2925 </span><span class="lineNoCov">          0 :                         lhcc = gf_odf_hevc_cfg_read(dsi_enh-&gt;value.data.ptr, dsi_enh-&gt;value.data.size, GF_TRUE);</span>
<span class="lineNum">    2926 </span><span class="lineNoCov">          0 :                         if (lhcc)</span>
<span class="lineNum">    2927 </span><span class="lineNoCov">          0 :                                 pctx-&gt;nalu_size_length = lhcc-&gt;nal_unit_size;</span>
<span class="lineNum">    2928 </span>            :                 }
<span class="lineNum">    2929 </span><span class="lineCov">          2 :                 nalh_size = pctx-&gt;nalu_size_length;</span>
<span class="lineNum">    2930 </span>            : 
<span class="lineNum">    2931 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    2932 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot;&lt;HEVCParameterSets&gt;\n&quot;);</span>
<span class="lineNum">    2933 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    2934 </span><span class="lineCov">          2 :                 if (hvcc) {</span>
<span class="lineNum">    2935 </span><span class="lineCov">          2 :                         for (idx=0; idx&lt;gf_list_count(hvcc-&gt;param_array); idx++) {</span>
<span class="lineNum">    2936 </span><span class="lineNoCov">          0 :                                 GF_NALUFFParamArray *ar = gf_list_get(hvcc-&gt;param_array, idx);</span>
<span class="lineNum">    2937 </span><span class="lineNoCov">          0 :                                 if (ar-&gt;type==GF_HEVC_NALU_SEQ_PARAM) {</span>
<span class="lineNum">    2938 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;HEVCSPS&quot;, &quot;hvcC&quot;, 0)</span>
<span class="lineNum">    2939 </span><span class="lineNoCov">          0 :                                 } else if (ar-&gt;type==GF_HEVC_NALU_PIC_PARAM) {</span>
<span class="lineNum">    2940 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;HEVCPPS&quot;, &quot;hvcC&quot;, 0)</span>
<span class="lineNum">    2941 </span><span class="lineNoCov">          0 :                                 } else if (ar-&gt;type==GF_HEVC_NALU_VID_PARAM) {</span>
<span class="lineNum">    2942 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;HEVCVPS&quot;, &quot;hvcC&quot;, 0)</span>
<span class="lineNum">    2943 </span>            :                                 } else {
<span class="lineNum">    2944 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;HEVCUnknownPS&quot;, &quot;hvcC&quot;, 0)</span>
<span class="lineNum">    2945 </span>            :                                 }
<span class="lineNum">    2946 </span>            :                         }
<span class="lineNum">    2947 </span>            :                 }
<span class="lineNum">    2948 </span><span class="lineCov">          2 :                 if (lhcc) {</span>
<span class="lineNum">    2949 </span><span class="lineNoCov">          0 :                         for (idx=0; idx&lt;gf_list_count(lhcc-&gt;param_array); idx++) {</span>
<span class="lineNum">    2950 </span><span class="lineNoCov">          0 :                                 GF_NALUFFParamArray *ar = gf_list_get(lhcc-&gt;param_array, idx);</span>
<span class="lineNum">    2951 </span><span class="lineNoCov">          0 :                                 if (ar-&gt;type==GF_HEVC_NALU_SEQ_PARAM) {</span>
<span class="lineNum">    2952 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;HEVCSPS&quot;, &quot;lhcC&quot;, 0)</span>
<span class="lineNum">    2953 </span><span class="lineNoCov">          0 :                                 } else if (ar-&gt;type==GF_HEVC_NALU_PIC_PARAM) {</span>
<span class="lineNum">    2954 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;HEVCPPS&quot;, &quot;lhcC&quot;, 0)</span>
<span class="lineNum">    2955 </span><span class="lineNoCov">          0 :                                 } else if (ar-&gt;type==GF_HEVC_NALU_VID_PARAM) {</span>
<span class="lineNum">    2956 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;HEVCVPS&quot;, &quot;lhcC&quot;, 0)</span>
<span class="lineNum">    2957 </span>            :                                 } else {
<span class="lineNum">    2958 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;HEVCUnknownPS&quot;, &quot;lhcC&quot;, 0)</span>
<span class="lineNum">    2959 </span>            :                                 }
<span class="lineNum">    2960 </span>            :                         }
<span class="lineNum">    2961 </span>            :                 }
<span class="lineNum">    2962 </span>            : #endif
<span class="lineNum">    2963 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot;&lt;/HEVCParameterSets&gt;\n&quot;);</span>
<span class="lineNum">    2964 </span><span class="lineCov">          2 :                 break;</span>
<span class="lineNum">    2965 </span>            : 
<span class="lineNum">    2966 </span><span class="lineNoCov">          0 :         case GF_CODECID_VVC:</span>
<span class="lineNum">    2967 </span><span class="lineNoCov">          0 :                 if (!dsi) {</span>
<span class="lineNum">    2968 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    2969 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">    2970 </span>            :                 }
<span class="lineNum">    2971 </span>            : 
<span class="lineNum">    2972 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    2973 </span><span class="lineNoCov">          0 :                 inspect_reset_parsers(pctx, &amp;pctx-&gt;vvc_state);</span>
<span class="lineNum">    2974 </span>            : 
<span class="lineNum">    2975 </span><span class="lineNoCov">          0 :                 if (!pctx-&gt;vvc_state) {</span>
<span class="lineNum">    2976 </span><span class="lineNoCov">          0 :                         GF_SAFEALLOC(pctx-&gt;vvc_state, VVCState);</span>
<span class="lineNum">    2977 </span><span class="lineNoCov">          0 :                         if (!pctx-&gt;vvc_state) return;</span>
<span class="lineNum">    2978 </span>            :                 }
<span class="lineNum">    2979 </span>            : #endif
<span class="lineNum">    2980 </span>            : 
<span class="lineNum">    2981 </span><span class="lineNoCov">          0 :                 vvcC = gf_odf_vvc_cfg_read(dsi-&gt;value.data.ptr, dsi-&gt;value.data.size);</span>
<span class="lineNum">    2982 </span><span class="lineNoCov">          0 :                 if (vvcC)</span>
<span class="lineNum">    2983 </span><span class="lineNoCov">          0 :                         pctx-&gt;nalu_size_length = vvcC-&gt;nal_unit_size;</span>
<span class="lineNum">    2984 </span>            : 
<span class="lineNum">    2985 </span><span class="lineNoCov">          0 :                 nalh_size = pctx-&gt;nalu_size_length;</span>
<span class="lineNum">    2986 </span>            : 
<span class="lineNum">    2987 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    2988 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;&lt;VVCParameterSets&gt;\n&quot;);</span>
<span class="lineNum">    2989 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    2990 </span><span class="lineNoCov">          0 :                 if (vvcC) {</span>
<span class="lineNum">    2991 </span><span class="lineNoCov">          0 :                         for (idx=0; idx&lt;gf_list_count(vvcC-&gt;param_array); idx++) {</span>
<span class="lineNum">    2992 </span><span class="lineNoCov">          0 :                                 GF_NALUFFParamArray *ar = gf_list_get(vvcC-&gt;param_array, idx);</span>
<span class="lineNum">    2993 </span><span class="lineNoCov">          0 :                                 if (ar-&gt;type==GF_VVC_NALU_SEQ_PARAM) {</span>
<span class="lineNum">    2994 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;VVCSPS&quot;, &quot;vvcC&quot;, 0)</span>
<span class="lineNum">    2995 </span><span class="lineNoCov">          0 :                                 } else if (ar-&gt;type==GF_VVC_NALU_PIC_PARAM) {</span>
<span class="lineNum">    2996 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;VVCPPS&quot;, &quot;vvcC&quot;, 0)</span>
<span class="lineNum">    2997 </span><span class="lineNoCov">          0 :                                 } else if (ar-&gt;type==GF_VVC_NALU_VID_PARAM) {</span>
<span class="lineNum">    2998 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;VVCVPS&quot;, &quot;vvcC&quot;, 0)</span>
<span class="lineNum">    2999 </span><span class="lineNoCov">          0 :                                 } else if (ar-&gt;type==GF_VVC_NALU_APS_PREFIX) {</span>
<span class="lineNum">    3000 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;VVCAPS&quot;, &quot;vvcC&quot;, 0)</span>
<span class="lineNum">    3001 </span><span class="lineNoCov">          0 :                                 } else if (ar-&gt;type==GF_VVC_NALU_SEI_PREFIX) {</span>
<span class="lineNum">    3002 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;VVCSEI&quot;, &quot;vvcC&quot;, 0)</span>
<span class="lineNum">    3003 </span><span class="lineNoCov">          0 :                                 } else if (ar-&gt;type==GF_VVC_NALU_DEC_PARAM) {</span>
<span class="lineNum">    3004 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;VVCDCI&quot;, &quot;vvcC&quot;, 0)</span>
<span class="lineNum">    3005 </span>            :                                 } else {
<span class="lineNum">    3006 </span><span class="lineNoCov">          0 :                                         DUMP_ARRAY(ar-&gt;nalus, &quot;VVCUnknownPS&quot;, &quot;vvcC&quot;, 0)</span>
<span class="lineNum">    3007 </span>            :                                 }
<span class="lineNum">    3008 </span>            :                         }
<span class="lineNum">    3009 </span>            :                 }
<span class="lineNum">    3010 </span>            : #endif
<span class="lineNum">    3011 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;&lt;/VVCParameterSets&gt;\n&quot;);</span>
<span class="lineNum">    3012 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    3013 </span>            : 
<span class="lineNum">    3014 </span><span class="lineCov">          2 :         case GF_CODECID_AV1:</span>
<span class="lineNum">    3015 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    3016 </span><span class="lineCov">          2 :                 inspect_reset_parsers(pctx, &amp;pctx-&gt;av1_state);</span>
<span class="lineNum">    3017 </span><span class="lineCov">          2 :                 if (!pctx-&gt;av1_state) {</span>
<span class="lineNum">    3018 </span><span class="lineCov">          2 :                         GF_SAFEALLOC(pctx-&gt;av1_state, AV1State);</span>
<span class="lineNum">    3019 </span><span class="lineCov">          2 :                         if (!pctx-&gt;av1_state) return;</span>
<span class="lineNum">    3020 </span><span class="lineCov">          2 :                         gf_av1_init_state(pctx-&gt;av1_state);</span>
<span class="lineNum">    3021 </span>            :                 }
<span class="lineNum">    3022 </span>            : #endif
<span class="lineNum">    3023 </span><span class="lineCov">          2 :                 if (!dsi) {</span>
<span class="lineNum">    3024 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3025 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">    3026 </span>            :                 }
<span class="lineNum">    3027 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    3028 </span><span class="lineCov">          2 :                 if (pctx-&gt;av1_state-&gt;config) gf_odf_av1_cfg_del(pctx-&gt;av1_state-&gt;config);</span>
<span class="lineNum">    3029 </span><span class="lineCov">          2 :                 pctx-&gt;av1_state-&gt;config = gf_odf_av1_cfg_read(dsi-&gt;value.data.ptr, dsi-&gt;value.data.size);</span>
<span class="lineNum">    3030 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    3031 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot; &lt;OBUConfig&gt;\n&quot;);</span>
<span class="lineNum">    3032 </span>            : 
<span class="lineNum">    3033 </span><span class="lineCov">          2 :                 idx = 1;</span>
<span class="lineNum">    3034 </span><span class="lineCov">          4 :                 for (i=0; i&lt;gf_list_count(pctx-&gt;av1_state-&gt;config-&gt;obu_array); i++) {</span>
<span class="lineNum">    3035 </span>            :                         ObuType obu_type=0;
<span class="lineNum">    3036 </span>            :                         u64 obu_size = 0;
<span class="lineNum">    3037 </span>            :                         u32 hdr_size = 0;
<span class="lineNum">    3038 </span><span class="lineCov">          2 :                         GF_AV1_OBUArrayEntry *obu = gf_list_get(pctx-&gt;av1_state-&gt;config-&gt;obu_array, i);</span>
<span class="lineNum">    3039 </span>            : 
<span class="lineNum">    3040 </span><span class="lineCov">          2 :                         if (!pctx-&gt;bs)</span>
<span class="lineNum">    3041 </span><span class="lineNoCov">          0 :                                 pctx-&gt;bs = gf_bs_new((const u8 *) obu-&gt;obu, (u32) obu-&gt;obu_length, GF_BITSTREAM_READ);</span>
<span class="lineNum">    3042 </span>            :                         else
<span class="lineNum">    3043 </span><span class="lineCov">          2 :                                 gf_bs_reassign_buffer(pctx-&gt;bs, (const u8 *)obu-&gt;obu, (u32) obu-&gt;obu_length);</span>
<span class="lineNum">    3044 </span>            : 
<span class="lineNum">    3045 </span><span class="lineCov">          2 :                         gf_inspect_dump_obu_internal(dump, pctx-&gt;av1_state, (char*)obu-&gt;obu, obu-&gt;obu_length, obu_type, obu_size, hdr_size, ctx-&gt;crc, pctx, ctx-&gt;analyze);</span>
<span class="lineNum">    3046 </span><span class="lineCov">          2 :                         idx++;</span>
<span class="lineNum">    3047 </span>            :                 }
<span class="lineNum">    3048 </span>            : #endif
<span class="lineNum">    3049 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot; &lt;/OBUConfig&gt;\n&quot;);</span>
<span class="lineNum">    3050 </span><span class="lineCov">          2 :                 break;</span>
<span class="lineNum">    3051 </span>            : 
<span class="lineNum">    3052 </span><span class="lineCov">          1 :         case GF_CODECID_MPEG1:</span>
<span class="lineNum">    3053 </span>            :         case GF_CODECID_MPEG2_422:
<span class="lineNum">    3054 </span>            :         case GF_CODECID_MPEG2_SNR:
<span class="lineNum">    3055 </span>            :         case GF_CODECID_MPEG2_HIGH:
<span class="lineNum">    3056 </span>            :         case GF_CODECID_MPEG2_MAIN:
<span class="lineNum">    3057 </span>            :         case GF_CODECID_MPEG4_PART2:
<span class="lineNum">    3058 </span>            : 
<span class="lineNum">    3059 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    3060 </span><span class="lineCov">          1 :                 inspect_reset_parsers(pctx, &amp;pctx-&gt;mv124_state);</span>
<span class="lineNum">    3061 </span>            : #endif
<span class="lineNum">    3062 </span><span class="lineCov">          1 :                 if (!dsi) {</span>
<span class="lineNum">    3063 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3064 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">    3065 </span>            :                 }
<span class="lineNum">    3066 </span><span class="lineCov">          1 :                 gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    3067 </span><span class="lineCov">          1 :                 gf_fprintf(dump, &quot; &lt;MPEGVideoConfig&gt;\n&quot;);</span>
<span class="lineNum">    3068 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    3069 </span><span class="lineCov">          1 :                 inspect_dump_mpeg124(pctx, dsi-&gt;value.data.ptr, dsi-&gt;value.data.size, dump);</span>
<span class="lineNum">    3070 </span>            : #endif
<span class="lineNum">    3071 </span><span class="lineCov">          1 :                 gf_fprintf(dump, &quot; &lt;/MPEGVideoConfig&gt;\n&quot;);</span>
<span class="lineNum">    3072 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    3073 </span><span class="lineCov">          1 :                 if (pctx-&gt;mv124_state) gf_m4v_parser_del(pctx-&gt;mv124_state);</span>
<span class="lineNum">    3074 </span>            : #endif
<span class="lineNum">    3075 </span>            :                 break;
<span class="lineNum">    3076 </span><span class="lineCov">          2 :         case GF_CODECID_MPEG_AUDIO:</span>
<span class="lineNum">    3077 </span>            :         case GF_CODECID_MPEG2_PART3:
<span class="lineNum">    3078 </span>            :         case GF_CODECID_TMCD:
<span class="lineNum">    3079 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3080 </span><span class="lineCov">          2 :                 return;</span>
<span class="lineNum">    3081 </span><span class="lineNoCov">          0 :         case GF_CODECID_SUBS_XML:</span>
<span class="lineNum">    3082 </span>            :         case GF_CODECID_META_XML:
<span class="lineNum">    3083 </span><span class="lineNoCov">          0 :                 if (!dsi) {</span>
<span class="lineNum">    3084 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3085 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">    3086 </span>            :                 }
<span class="lineNum">    3087 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; &lt;XMLTextConfig&gt;\n&quot;);</span>
<span class="lineNum">    3088 </span><span class="lineNoCov">          0 :                 for (i=0; i&lt;dsi-&gt;value.data.size; i++) {</span>
<span class="lineNum">    3089 </span><span class="lineNoCov">          0 :                         gf_fputc(dsi-&gt;value.data.ptr[i], dump);</span>
<span class="lineNum">    3090 </span>            :                 }
<span class="lineNum">    3091 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;\n &lt;/XMLTextConfig&gt;\n&quot;);</span>
<span class="lineNum">    3092 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    3093 </span><span class="lineNoCov">          0 :         case GF_CODECID_SUBS_TEXT:</span>
<span class="lineNum">    3094 </span>            :         case GF_CODECID_META_TEXT:
<span class="lineNum">    3095 </span><span class="lineNoCov">          0 :                 if (!dsi) {</span>
<span class="lineNum">    3096 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3097 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">    3098 </span>            :                 }
<span class="lineNum">    3099 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; &lt;TextConfig&gt;\n&quot;);</span>
<span class="lineNum">    3100 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;&lt;![CDATA[&quot;);</span>
<span class="lineNum">    3101 </span><span class="lineNoCov">          0 :                 for (i=0; i&lt;dsi-&gt;value.data.size; i++) {</span>
<span class="lineNum">    3102 </span><span class="lineNoCov">          0 :                         gf_fputc(dsi-&gt;value.data.ptr[i], dump);</span>
<span class="lineNum">    3103 </span>            :                 }
<span class="lineNum">    3104 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;]]&gt;\n&quot;);</span>
<span class="lineNum">    3105 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; &lt;/TextConfig&gt;\n&quot;);</span>
<span class="lineNum">    3106 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    3107 </span><span class="lineNoCov">          0 :         case GF_CODECID_APCH:</span>
<span class="lineNum">    3108 </span>            :         case GF_CODECID_APCN:
<span class="lineNum">    3109 </span>            :         case GF_CODECID_APCS:
<span class="lineNum">    3110 </span>            :         case GF_CODECID_APCO:
<span class="lineNum">    3111 </span>            :         case GF_CODECID_AP4H:
<span class="lineNum">    3112 </span>            :         case GF_CODECID_AP4X:
<span class="lineNum">    3113 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3114 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">    3115 </span><span class="lineNoCov">          0 :         case GF_CODECID_MPHA:</span>
<span class="lineNum">    3116 </span>            :         case GF_CODECID_MHAS:
<span class="lineNum">    3117 </span><span class="lineNoCov">          0 :                 if (!dsi) {</span>
<span class="lineNum">    3118 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3119 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">    3120 </span>            :                 }
<span class="lineNum">    3121 </span>            :                 {
<span class="lineNum">    3122 </span>            :                 u16 size;
<span class="lineNum">    3123 </span><span class="lineNoCov">          0 :                 if (!pctx-&gt;bs)</span>
<span class="lineNum">    3124 </span><span class="lineNoCov">          0 :                         pctx-&gt;bs = gf_bs_new(dsi-&gt;value.data.ptr, dsi-&gt;value.data.size, GF_BITSTREAM_READ);</span>
<span class="lineNum">    3125 </span>            :                 else
<span class="lineNum">    3126 </span><span class="lineNoCov">          0 :                         gf_bs_reassign_buffer(pctx-&gt;bs, dsi-&gt;value.data.ptr, dsi-&gt;value.data.size);</span>
<span class="lineNum">    3127 </span>            : 
<span class="lineNum">    3128 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; &lt;MPEGHAudioConfig&quot;);</span>
<span class="lineNum">    3129 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; version=\&quot;%d\&quot;&quot;, gf_bs_read_u8(pctx-&gt;bs) );</span>
<span class="lineNum">    3130 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; ProfileLevelIndication=\&quot;%d\&quot;&quot;, gf_bs_read_u8(pctx-&gt;bs) );</span>
<span class="lineNum">    3131 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot; ReferenceChannelLayout=\&quot;%d\&quot;&quot;, gf_bs_read_u8(pctx-&gt;bs) );</span>
<span class="lineNum">    3132 </span><span class="lineNoCov">          0 :                 size = gf_bs_read_u16(pctx-&gt;bs);</span>
<span class="lineNum">    3133 </span><span class="lineNoCov">          0 :                 if (size) {</span>
<span class="lineNum">    3134 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    3135 </span><span class="lineNoCov">          0 :                         dump_mha_config(dump, pctx-&gt;bs, &quot;  &quot;);</span>
<span class="lineNum">    3136 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; &lt;/MPEGHAudioConfig&gt;\n&quot;);</span>
<span class="lineNum">    3137 </span>            :                 } else {
<span class="lineNum">    3138 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3139 </span>            :                 }
<span class="lineNum">    3140 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3141 </span>            :                 }
<span class="lineNum">    3142 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    3143 </span><span class="lineCov">          2 :         case GF_CODECID_VP8:</span>
<span class="lineNum">    3144 </span>            :         case GF_CODECID_VP9:
<span class="lineNum">    3145 </span><span class="lineCov">          2 :                 if (!dsi) {</span>
<span class="lineNum">    3146 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3147 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">    3148 </span>            :                 }
<span class="lineNum">    3149 </span>            : 
<span class="lineNum">    3150 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    3151 </span><span class="lineCov">          2 :                 inspect_reset_parsers(pctx, NULL);</span>
<span class="lineNum">    3152 </span>            : #endif
<span class="lineNum">    3153 </span>            : 
<span class="lineNum">    3154 </span><span class="lineCov">          2 :                 pctx-&gt;vpcc = gf_odf_vp_cfg_read(dsi-&gt;value.data.ptr, dsi-&gt;value.data.size);</span>
<span class="lineNum">    3155 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    3156 </span><span class="lineCov">          2 :                 if (pctx-&gt;vpcc) {</span>
<span class="lineNum">    3157 </span><span class="lineCov">          2 :                         u32 v = (pctx-&gt;codec_id==GF_CODECID_VP9) ? 9 : 8;</span>
<span class="lineNum">    3158 </span><span class="lineCov">         14 :                         gf_fprintf(dump, &quot;&lt;VP%dConfiguration profile=\&quot;%d\&quot; level=\&quot;%d\&quot; bit_depth=\&quot;%u\&quot; chroma_subsampling=\&quot;%u\&quot; colour_primaries=\&quot;%u\&quot; transfer_characteristics=\&quot;%u\&quot; matrix_coefficients=\&quot;%u\&quot; video_full_range=\&quot;%u\&quot;&quot;, v,</span>
<span class="lineNum">    3159 </span><span class="lineCov">         14 :                                 pctx-&gt;vpcc-&gt;profile, pctx-&gt;vpcc-&gt;level, pctx-&gt;vpcc-&gt;bit_depth, pctx-&gt;vpcc-&gt;chroma_subsampling, pctx-&gt;vpcc-&gt;colour_primaries, pctx-&gt;vpcc-&gt;transfer_characteristics, pctx-&gt;vpcc-&gt;matrix_coefficients, pctx-&gt;vpcc-&gt;video_fullRange_flag</span>
<span class="lineNum">    3160 </span>            :                         );
<span class="lineNum">    3161 </span><span class="lineCov">          2 :                         if (pctx-&gt;vpcc-&gt;codec_initdata &amp;&amp; pctx-&gt;vpcc-&gt;codec_initdata_size) {</span>
<span class="lineNum">    3162 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot; init_data=\&quot;&quot;);</span>
<span class="lineNum">    3163 </span><span class="lineNoCov">          0 :                                 for (idx=0; idx&lt;pctx-&gt;vpcc-&gt;codec_initdata_size; idx++)</span>
<span class="lineNum">    3164 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;%02X&quot;, (unsigned char) pctx-&gt;vpcc-&gt;codec_initdata[idx]);</span>
<span class="lineNum">    3165 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;\&quot;&quot;);</span>
<span class="lineNum">    3166 </span>            :                         }
<span class="lineNum">    3167 </span><span class="lineCov">          2 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3168 </span>            :                 }
<span class="lineNum">    3169 </span>            :                 break;
<span class="lineNum">    3170 </span>            : 
<span class="lineNum">    3171 </span><span class="lineCov">          2 :         case GF_CODECID_AAC_MPEG4:</span>
<span class="lineNum">    3172 </span>            :         case GF_CODECID_AAC_MPEG2_MP:
<span class="lineNum">    3173 </span>            :         case GF_CODECID_AAC_MPEG2_LCP:
<span class="lineNum">    3174 </span>            :         case GF_CODECID_AAC_MPEG2_SSRP:
<span class="lineNum">    3175 </span>            :         case GF_CODECID_USAC:
<span class="lineNum">    3176 </span><span class="lineCov">          2 :                 if (!pctx-&gt;no_analysis) {</span>
<span class="lineNum">    3177 </span><span class="lineCov">          2 :                         pctx-&gt;no_analysis = GF_TRUE;</span>
<span class="lineNum">    3178 </span><span class="lineCov">          2 :                         GF_LOG(GF_LOG_WARNING, GF_LOG_AUTHOR, (&quot;[Inspect] bitstream analysis for codec %s not supported, only configuration is\n&quot;, gf_codecid_name(pctx-&gt;codec_id)));</span>
<span class="lineNum">    3179 </span>            :                 }
<span class="lineNum">    3180 </span><span class="lineCov">          2 :                 if (dsi) {</span>
<span class="lineNum">    3181 </span>            :                         GF_M4ADecSpecInfo acfg;
<span class="lineNum">    3182 </span>            :                         InspectLogCbk lcbk;
<span class="lineNum">    3183 </span>            : 
<span class="lineNum">    3184 </span><span class="lineCov">          2 :                         gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    3185 </span><span class="lineCov">          2 :                         gf_fprintf(dump, &quot;&lt;MPEG4AudioConfiguration &quot;);</span>
<span class="lineNum">    3186 </span>            : 
<span class="lineNum">    3187 </span><span class="lineCov">          2 :                         if (!pctx-&gt;bs)</span>
<span class="lineNum">    3188 </span><span class="lineNoCov">          0 :                                 pctx-&gt;bs = gf_bs_new(dsi-&gt;value.data.ptr, dsi-&gt;value.data.size, GF_BITSTREAM_READ);</span>
<span class="lineNum">    3189 </span>            :                         else
<span class="lineNum">    3190 </span><span class="lineCov">          2 :                                 gf_bs_reassign_buffer(pctx-&gt;bs, dsi-&gt;value.data.ptr, dsi-&gt;value.data.size);</span>
<span class="lineNum">    3191 </span>            : 
<span class="lineNum">    3192 </span><span class="lineCov">          2 :                         if (ctx-&gt;analyze&gt;=INSPECT_ANALYZE_BS) {</span>
<span class="lineNum">    3193 </span><span class="lineCov">          1 :                                 lcbk.dump = dump;</span>
<span class="lineNum">    3194 </span><span class="lineCov">          1 :                                 lcbk.dump_bits = (ctx-&gt;analyze==INSPECT_ANALYZE_BS_BITS) ? GF_TRUE : GF_FALSE;</span>
<span class="lineNum">    3195 </span><span class="lineCov">          1 :                                 gf_bs_set_logger(pctx-&gt;bs, regular_bs_log, &amp;lcbk);</span>
<span class="lineNum">    3196 </span>            :                         }
<span class="lineNum">    3197 </span>            : 
<span class="lineNum">    3198 </span><span class="lineCov">          2 :                         gf_m4a_parse_config(pctx-&gt;bs, &amp;acfg, GF_TRUE);</span>
<span class="lineNum">    3199 </span><span class="lineCov">          2 :                         if (ctx-&gt;analyze&lt;INSPECT_ANALYZE_BS) {</span>
<span class="lineNum">    3200 </span><span class="lineCov">          1 :                                 gf_fprintf(dump, &quot;base_object_type=\&quot;%u\&quot; sample_rate=\&quot;%u\&quot; channels=\&quot;%u\&quot; &quot;, acfg.base_object_type, acfg.base_sr, acfg.nb_chan);</span>
<span class="lineNum">    3201 </span><span class="lineCov">          1 :                                 if (acfg.has_sbr)</span>
<span class="lineNum">    3202 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;sbr_sample_rate=\&quot;%u\&quot; &quot;, acfg.sbr_sr);</span>
<span class="lineNum">    3203 </span><span class="lineCov">          1 :                                 if (acfg.has_ps)</span>
<span class="lineNum">    3204 </span><span class="lineNoCov">          0 :                                         gf_fprintf(dump, &quot;parametricStereo=\&quot;yes\&quot; &quot;);</span>
<span class="lineNum">    3205 </span>            :                         }
<span class="lineNum">    3206 </span><span class="lineCov">          2 :                         if (acfg.comments[0])</span>
<span class="lineNum">    3207 </span><span class="lineNoCov">          0 :                                 gf_fprintf(dump, &quot;comments=\&quot;%s\&quot; &quot;, acfg.comments);</span>
<span class="lineNum">    3208 </span><span class="lineCov">          2 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3209 </span>            :                 } else {
<span class="lineNum">    3210 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3211 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">    3212 </span>            :                 }
<span class="lineNum">    3213 </span><span class="lineCov">          2 :                 break;</span>
<span class="lineNum">    3214 </span><span class="lineCov">          2 :         case GF_CODECID_AC3:</span>
<span class="lineNum">    3215 </span>            :         case GF_CODECID_EAC3:
<span class="lineNum">    3216 </span><span class="lineCov">          2 :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3217 </span><span class="lineCov">          2 :                 return;</span>
<span class="lineNum">    3218 </span>            : 
<span class="lineNum">    3219 </span><span class="lineNoCov">          0 :         case GF_CODECID_TRUEHD:</span>
<span class="lineNum">    3220 </span><span class="lineNoCov">          0 :                 if (dsi) {</span>
<span class="lineNum">    3221 </span>            :                         u16 fmt, prate;
<span class="lineNum">    3222 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;&gt;\n&quot;);</span>
<span class="lineNum">    3223 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;&lt;TrueHDAudioConfiguration&quot;);</span>
<span class="lineNum">    3224 </span>            : 
<span class="lineNum">    3225 </span><span class="lineNoCov">          0 :                         if (!pctx-&gt;bs)</span>
<span class="lineNum">    3226 </span><span class="lineNoCov">          0 :                                 pctx-&gt;bs = gf_bs_new(dsi-&gt;value.data.ptr, dsi-&gt;value.data.size, GF_BITSTREAM_READ);</span>
<span class="lineNum">    3227 </span>            :                         else
<span class="lineNum">    3228 </span><span class="lineNoCov">          0 :                                 gf_bs_reassign_buffer(pctx-&gt;bs, dsi-&gt;value.data.ptr, dsi-&gt;value.data.size);</span>
<span class="lineNum">    3229 </span>            : 
<span class="lineNum">    3230 </span><span class="lineNoCov">          0 :                         fmt = gf_bs_read_u32(pctx-&gt;bs);</span>
<span class="lineNum">    3231 </span><span class="lineNoCov">          0 :                         prate = gf_bs_read_int(pctx-&gt;bs, 15);</span>
<span class="lineNum">    3232 </span>            : 
<span class="lineNum">    3233 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot; format=\&quot;%u\&quot; peak_data_rate=\&quot;%u\&quot;/&gt;\n&quot;, fmt, prate);</span>
<span class="lineNum">    3234 </span>            :                 } else {
<span class="lineNum">    3235 </span><span class="lineNoCov">          0 :                         gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3236 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">    3237 </span>            :                 }
<span class="lineNum">    3238 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    3239 </span>            : 
<span class="lineNum">    3240 </span><span class="lineNoCov">          0 :         default:</span>
<span class="lineNum">    3241 </span><span class="lineNoCov">          0 :                 if (!pctx-&gt;no_analysis) {</span>
<span class="lineNum">    3242 </span><span class="lineNoCov">          0 :                         pctx-&gt;no_analysis = GF_TRUE;</span>
<span class="lineNum">    3243 </span><span class="lineNoCov">          0 :                         GF_LOG(GF_LOG_WARNING, GF_LOG_AUTHOR, (&quot;[Inspect] bitstream analysis for codec %s not supported\n&quot;, gf_codecid_name(pctx-&gt;codec_id)));</span>
<span class="lineNum">    3244 </span>            :                 }
<span class="lineNum">    3245 </span><span class="lineNoCov">          0 :                 gf_fprintf(dump, &quot;/&gt;\n&quot;);</span>
<span class="lineNum">    3246 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">    3247 </span>            :         }
<span class="lineNum">    3248 </span>            : 
<span class="lineNum">    3249 </span><span class="lineCov">         11 :         if (avcc) gf_odf_avc_cfg_del(avcc);</span>
<span class="lineNum">    3250 </span><span class="lineCov">         11 :         if (svcc) gf_odf_avc_cfg_del(svcc);</span>
<span class="lineNum">    3251 </span><span class="lineCov">         11 :         if (hvcc) gf_odf_hevc_cfg_del(hvcc);</span>
<span class="lineNum">    3252 </span><span class="lineCov">         11 :         if (lhcc) gf_odf_hevc_cfg_del(lhcc);</span>
<span class="lineNum">    3253 </span><span class="lineCov">         11 :         if (vvcC) gf_odf_vvc_cfg_del(vvcC);</span>
<span class="lineNum">    3254 </span><span class="lineCov">         11 :         gf_fprintf(dump, &quot;&lt;/%s&gt;\n&quot;, elt_name);</span>
<a name="3255"><span class="lineNum">    3255 </span>            : }</a>
<span class="lineNum">    3256 </span>            : 
<span class="lineNum">    3257 </span><span class="lineCov">    1810954 : static GF_Err inspect_process(GF_Filter *filter)</span>
<span class="lineNum">    3258 </span>            : {
<span class="lineNum">    3259 </span>            :         u32 i, count, nb_done=0, nb_hdr_done=0;
<span class="lineNum">    3260 </span><span class="lineCov">    1810954 :         GF_InspectCtx *ctx = (GF_InspectCtx *) gf_filter_get_udta(filter);</span>
<span class="lineNum">    3261 </span>            : 
<span class="lineNum">    3262 </span><span class="lineCov">    1810954 :         count = gf_list_count(ctx-&gt;src_pids);</span>
<span class="lineNum">    3263 </span>            : 
<span class="lineNum">    3264 </span><span class="lineCov">    1810954 :         if (ctx-&gt;args_updated) {</span>
<span class="lineNum">    3265 </span><span class="lineNoCov">          0 :                 ctx-&gt;args_updated = GF_FALSE;</span>
<span class="lineNum">    3266 </span><span class="lineNoCov">          0 :                 for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    3267 </span><span class="lineNoCov">          0 :                         PidCtx *pctx = gf_list_get(ctx-&gt;src_pids, i);</span>
<span class="lineNum">    3268 </span><span class="lineNoCov">          0 :                         switch (ctx-&gt;mode) {</span>
<span class="lineNum">    3269 </span><span class="lineNoCov">          0 :                         case INSPECT_MODE_PCK:</span>
<span class="lineNum">    3270 </span>            :                         case INSPECT_MODE_REFRAME:
<span class="lineNum">    3271 </span><span class="lineNoCov">          0 :                                 gf_filter_pid_set_framing_mode(pctx-&gt;src_pid, GF_TRUE);</span>
<span class="lineNum">    3272 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    3273 </span><span class="lineNoCov">          0 :                         default:</span>
<span class="lineNum">    3274 </span><span class="lineNoCov">          0 :                                 gf_filter_pid_set_framing_mode(pctx-&gt;src_pid, GF_FALSE);</span>
<span class="lineNum">    3275 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    3276 </span>            :                         }
<span class="lineNum">    3277 </span><span class="lineNoCov">          0 :                         gf_filter_pid_set_clock_mode(pctx-&gt;src_pid, ctx-&gt;pcr);</span>
<span class="lineNum">    3278 </span>            :                 }
<span class="lineNum">    3279 </span><span class="lineNoCov">          0 :                 if (ctx-&gt;is_prober || ctx-&gt;deep || ctx-&gt;fmt) {</span>
<span class="lineNum">    3280 </span><span class="lineNoCov">          0 :                         ctx-&gt;dump_pck = GF_TRUE;</span>
<span class="lineNum">    3281 </span>            :                 } else {
<span class="lineNum">    3282 </span><span class="lineNoCov">          0 :                         ctx-&gt;dump_pck = GF_FALSE;</span>
<span class="lineNum">    3283 </span>            :                 }
<span class="lineNum">    3284 </span>            :         }
<span class="lineNum">    3285 </span><span class="lineCov">    1810954 :         count = gf_list_count(ctx-&gt;src_pids);</span>
<span class="lineNum">    3286 </span><span class="lineCov">    5531015 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    3287 </span><span class="lineCov">    3720209 :                 PidCtx *pctx = gf_list_get(ctx-&gt;src_pids, i);</span>
<span class="lineNum">    3288 </span>            :                 GF_FilterPacket *pck = NULL;
<span class="lineNum">    3289 </span><span class="lineCov">    3720209 :                 pck = pctx-&gt;src_pid ? gf_filter_pid_get_packet(pctx-&gt;src_pid) : NULL;</span>
<span class="lineNum">    3290 </span>            : 
<span class="lineNum">    3291 </span><span class="lineCov">    3720209 :                 if (pctx-&gt;init_pid_config_done)</span>
<span class="lineNum">    3292 </span><span class="lineCov">     459957 :                         nb_hdr_done++;</span>
<span class="lineNum">    3293 </span>            : 
<span class="lineNum">    3294 </span><span class="lineCov">    3720209 :                 if (!pck) {</span>
<span class="lineNum">    3295 </span><span class="lineCov">     305309 :                         if (pctx-&gt;src_pid &amp;&amp; !gf_filter_pid_is_eos(pctx-&gt;src_pid))</span>
<span class="lineNum">    3296 </span><span class="lineCov">     124074 :                                 continue;</span>
<span class="lineNum">    3297 </span>            :                         else
<span class="lineNum">    3298 </span><span class="lineCov">     181235 :                                 ctx-&gt;has_seen_eos = GF_TRUE;</span>
<span class="lineNum">    3299 </span>            :                 }
<span class="lineNum">    3300 </span><span class="lineCov">    3596135 :                 if (pctx-&gt;aborted)</span>
<span class="lineNum">    3301 </span><span class="lineCov">       1656 :                         continue;</span>
<span class="lineNum">    3302 </span>            : 
<span class="lineNum">    3303 </span><span class="lineCov">    3594479 :                 if (!pctx-&gt;buffer_done) {</span>
<span class="lineNum">    3304 </span><span class="lineCov">    3257589 :                         if (pck &amp;&amp; !ctx-&gt;has_seen_eos) {</span>
<span class="lineNum">    3305 </span><span class="lineCov">    3257588 :                                 u64 dur = gf_filter_pid_query_buffer_duration(pctx-&gt;src_pid, GF_FALSE);</span>
<span class="lineNum">    3306 </span><span class="lineCov">    3257588 :                                 if ((dur &lt; ctx-&gt;buffer * 1000) &amp;&amp; !gf_filter_pid_has_seen_eos(pctx-&gt;src_pid)) {</span>
<span class="lineNum">    3307 </span><span class="lineCov">    3257551 :                                         continue;</span>
<span class="lineNum">    3308 </span>            :                                 }
<span class="lineNum">    3309 </span>            :                         }
<span class="lineNum">    3310 </span><span class="lineCov">         38 :                         pctx-&gt;buffer_done = GF_TRUE;</span>
<span class="lineNum">    3311 </span>            :                 }
<span class="lineNum">    3312 </span>            : 
<span class="lineNum">    3313 </span><span class="lineCov">     336928 :                 if (pctx-&gt;dump_pid) {</span>
<span class="lineNum">    3314 </span><span class="lineCov">        671 :                         inspect_dump_pid(ctx, pctx-&gt;tmp, pctx-&gt;src_pid, pctx-&gt;idx, pctx-&gt;init_pid_config_done ? GF_FALSE : GF_TRUE, GF_FALSE, pctx-&gt;pck_for_config, (pctx-&gt;dump_pid==2) ? GF_TRUE : GF_FALSE, pctx);</span>
<span class="lineNum">    3315 </span><span class="lineCov">        671 :                         pctx-&gt;dump_pid = 0;</span>
<span class="lineNum">    3316 </span><span class="lineCov">        671 :                         pctx-&gt;init_pid_config_done = 1;</span>
<span class="lineNum">    3317 </span><span class="lineCov">        671 :                         pctx-&gt;pck_for_config=0;</span>
<span class="lineNum">    3318 </span>            : 
<span class="lineNum">    3319 </span><span class="lineCov">        671 :                         if (!ctx-&gt;hdr_done) {</span>
<span class="lineNum">    3320 </span><span class="lineCov">        369 :                                 ctx-&gt;hdr_done=GF_TRUE;</span>
<span class="lineNum">    3321 </span>            :                                 //dump header on main output file, not on pid one!
<span class="lineNum">    3322 </span><span class="lineCov">        369 :                                 if (ctx-&gt;hdr &amp;&amp; ctx-&gt;fmt &amp;&amp; !ctx-&gt;xml)</span>
<span class="lineNum">    3323 </span><span class="lineCov">        116 :                                         inspect_dump_packet_fmt(ctx, ctx-&gt;dump, NULL, 0, 0);</span>
<span class="lineNum">    3324 </span>            :                         }
<span class="lineNum">    3325 </span>            :                 }
<span class="lineNum">    3326 </span><span class="lineCov">     336928 :                 if (!pck) continue;</span>
<span class="lineNum">    3327 </span>            :                 
<span class="lineNum">    3328 </span><span class="lineCov">     157349 :                 pctx-&gt;pck_for_config++;</span>
<span class="lineNum">    3329 </span><span class="lineCov">     157349 :                 pctx-&gt;pck_num++;</span>
<span class="lineNum">    3330 </span>            : 
<span class="lineNum">    3331 </span><span class="lineCov">     157349 :                 if (ctx-&gt;dump_pck) {</span>
<span class="lineNum">    3332 </span>            : 
<span class="lineNum">    3333 </span><span class="lineCov">     157142 :                         if (ctx-&gt;is_prober) {</span>
<span class="lineNum">    3334 </span><span class="lineCov">         85 :                                 nb_done++;</span>
<span class="lineNum">    3335 </span>            :                         } else {
<span class="lineNum">    3336 </span><span class="lineCov">     157057 :                                 GF_LOG(GF_LOG_DEBUG, GF_LOG_AUTHOR, (&quot;[Inspect] PID %d (codec %s) dump packet CTS &quot;LLU&quot;\n&quot;, pctx-&gt;idx, gf_codecid_name(pctx-&gt;codec_id), gf_filter_pck_get_cts(pck) ));</span>
<span class="lineNum">    3337 </span><span class="lineCov">     157057 :                                 if (ctx-&gt;fmt) {</span>
<span class="lineNum">    3338 </span><span class="lineCov">      18630 :                                         inspect_dump_packet_fmt(ctx, pctx-&gt;tmp, pck, pctx, pctx-&gt;pck_num);</span>
<span class="lineNum">    3339 </span>            :                                 } else {
<span class="lineNum">    3340 </span><span class="lineCov">     138427 :                                         inspect_dump_packet(ctx, pctx-&gt;tmp, pck, pctx-&gt;idx, pctx-&gt;pck_num, pctx);</span>
<span class="lineNum">    3341 </span>            :                                 }
<span class="lineNum">    3342 </span>            :                         }
<span class="lineNum">    3343 </span>            :                 }
<span class="lineNum">    3344 </span>            :                 
<span class="lineNum">    3345 </span><span class="lineCov">     157349 :                 if (ctx-&gt;dur.num &amp;&amp; ctx-&gt;dur.den) {</span>
<span class="lineNum">    3346 </span><span class="lineCov">      17181 :                         u64 timescale = gf_filter_pck_get_timescale(pck);</span>
<span class="lineNum">    3347 </span><span class="lineCov">      17181 :                         u64 ts = gf_filter_pck_get_dts(pck);</span>
<span class="lineNum">    3348 </span><span class="lineCov">      17181 :                         u64 dur = gf_filter_pck_get_duration(pck);</span>
<span class="lineNum">    3349 </span><span class="lineCov">      17181 :                         if (ts == GF_FILTER_NO_TS) ts = gf_filter_pck_get_cts(pck);</span>
<span class="lineNum">    3350 </span>            : 
<span class="lineNum">    3351 </span><span class="lineCov">      17181 :                         if (!pctx-&gt;init_ts) pctx-&gt;init_ts = ts+1;</span>
<span class="lineNum">    3352 </span><span class="lineCov">      17017 :                         else if ((ts + dur - pctx-&gt;init_ts + 1) * (u64)ctx-&gt;dur.den &gt;= timescale * (u64) ctx-&gt;dur.num) {</span>
<span class="lineNum">    3353 </span>            :                                 GF_FilterEvent evt;
<span class="lineNum">    3354 </span><span class="lineCov">        148 :                                 GF_FEVT_INIT(evt, GF_FEVT_STOP, pctx-&gt;src_pid);</span>
<span class="lineNum">    3355 </span>            : 
<span class="lineNum">    3356 </span><span class="lineCov">        148 :                                 GF_LOG(GF_LOG_INFO, GF_LOG_AUTHOR, (&quot;[Inspect] PID %d (codec %s) done dumping, aborting\n&quot;, pctx-&gt;idx, gf_codecid_name(pctx-&gt;codec_id) ));</span>
<span class="lineNum">    3357 </span><span class="lineCov">        148 :                                 gf_filter_pid_drop_packet(pctx-&gt;src_pid);</span>
<span class="lineNum">    3358 </span>            : 
<span class="lineNum">    3359 </span><span class="lineCov">        148 :                                 gf_filter_pid_send_event(pctx-&gt;src_pid, &amp;evt);</span>
<span class="lineNum">    3360 </span><span class="lineCov">        148 :                                 gf_filter_pid_set_discard(pctx-&gt;src_pid, GF_TRUE);</span>
<span class="lineNum">    3361 </span><span class="lineCov">        148 :                                 pctx-&gt;aborted = GF_TRUE;</span>
<span class="lineNum">    3362 </span>            :                                 break;
<span class="lineNum">    3363 </span>            :                         }
<span class="lineNum">    3364 </span>            :                 }
<span class="lineNum">    3365 </span><span class="lineCov">     157201 :                 gf_filter_pid_drop_packet(pctx-&gt;src_pid);</span>
<span class="lineNum">    3366 </span>            :         }
<span class="lineNum">    3367 </span><span class="lineCov">    1810954 :         if ((ctx-&gt;is_prober &amp;&amp; !ctx-&gt;probe_done &amp;&amp; (nb_done==count) &amp;&amp; !ctx-&gt;allp)</span>
<span class="lineNum">    3368 </span><span class="lineCov">    1810891 :                 || (!ctx-&gt;is_prober &amp;&amp; !ctx-&gt;allp &amp;&amp; !ctx-&gt;dump_pck &amp;&amp; (nb_hdr_done==count) &amp;&amp; !gf_filter_connections_pending(filter))</span>
<span class="lineNum">    3369 </span>            :         ) {
<span class="lineNum">    3370 </span><span class="lineCov">        182 :                 for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    3371 </span><span class="lineCov">        182 :                         PidCtx *pctx = gf_list_get(ctx-&gt;src_pids, i);</span>
<span class="lineNum">    3372 </span>            :                         GF_FilterEvent evt;
<span class="lineNum">    3373 </span><span class="lineCov">        182 :                         GF_FEVT_INIT(evt, GF_FEVT_STOP, pctx-&gt;src_pid);</span>
<span class="lineNum">    3374 </span><span class="lineCov">        182 :                         gf_filter_pid_send_event(pctx-&gt;src_pid, &amp;evt);</span>
<span class="lineNum">    3375 </span>            :                 }
<span class="lineNum">    3376 </span><span class="lineCov">        157 :                 if (ctx-&gt;is_prober)</span>
<span class="lineNum">    3377 </span><span class="lineCov">         63 :                         ctx-&gt;probe_done = GF_TRUE;</span>
<span class="lineNum">    3378 </span>            :                 return GF_EOS;
<span class="lineNum">    3379 </span>            :         }
<span class="lineNum">    3380 </span>            :         return GF_OK;
<a name="3381"><span class="lineNum">    3381 </span>            : }</a>
<span class="lineNum">    3382 </span>            : 
<span class="lineNum">    3383 </span><span class="lineCov">        873 : static GF_Err inspect_config_input(GF_Filter *filter, GF_FilterPid *pid, Bool is_remove)</span>
<span class="lineNum">    3384 </span>            : {
<span class="lineNum">    3385 </span>            :         GF_FilterEvent evt;
<span class="lineNum">    3386 </span>            :         PidCtx *pctx;
<span class="lineNum">    3387 </span>            :         u32 w, h, sr, ch;
<span class="lineNum">    3388 </span>            :         const GF_PropertyValue *p;
<span class="lineNum">    3389 </span><span class="lineCov">        873 :         GF_InspectCtx *ctx = (GF_InspectCtx *) gf_filter_get_udta(filter);</span>
<span class="lineNum">    3390 </span>            : 
<span class="lineNum">    3391 </span><span class="lineCov">        873 :         if (!ctx-&gt;src_pids) ctx-&gt;src_pids = gf_list_new();</span>
<span class="lineNum">    3392 </span>            : 
<span class="lineNum">    3393 </span><span class="lineCov">        873 :         pctx = gf_filter_pid_get_udta(pid);</span>
<span class="lineNum">    3394 </span><span class="lineCov">        873 :         if (pctx) {</span>
<span class="lineNum">    3395 </span>            :                 assert(pctx-&gt;src_pid == pid);
<span class="lineNum">    3396 </span><span class="lineCov">        306 :                 if (is_remove)</span>
<span class="lineNum">    3397 </span><span class="lineCov">          1 :                         pctx-&gt;src_pid = NULL;</span>
<span class="lineNum">    3398 </span><span class="lineCov">        305 :                 else if (!ctx-&gt;is_prober)</span>
<span class="lineNum">    3399 </span><span class="lineCov">        290 :                         pctx-&gt;dump_pid = 1;</span>
<span class="lineNum">    3400 </span>            :                 return GF_OK;
<span class="lineNum">    3401 </span>            :         }
<span class="lineNum">    3402 </span><span class="lineCov">        567 :         GF_SAFEALLOC(pctx, PidCtx);</span>
<span class="lineNum">    3403 </span><span class="lineCov">        567 :         if (!pctx) return GF_OUT_OF_MEM;</span>
<span class="lineNum">    3404 </span><span class="lineCov">        567 :         if (ctx-&gt;analyze)</span>
<span class="lineNum">    3405 </span><span class="lineCov">         15 :                 pctx-&gt;bs = gf_bs_new((u8 *)pctx, 0, GF_BITSTREAM_READ);</span>
<span class="lineNum">    3406 </span><span class="lineCov">        567 :         if (!ctx-&gt;buffer) {</span>
<span class="lineNum">    3407 </span><span class="lineCov">        527 :                 pctx-&gt;buffer_done = GF_TRUE;</span>
<span class="lineNum">    3408 </span>            :         } else {
<span class="lineNum">    3409 </span><span class="lineCov">         40 :                 GF_FEVT_INIT(evt, GF_FEVT_BUFFER_REQ, pid);</span>
<span class="lineNum">    3410 </span><span class="lineCov">         40 :                 evt.buffer_req.max_buffer_us = ctx-&gt;buffer * 1000;</span>
<span class="lineNum">    3411 </span><span class="lineCov">         40 :                 evt.buffer_req.pid_only = GF_TRUE;</span>
<span class="lineNum">    3412 </span><span class="lineCov">         40 :                 gf_filter_pid_send_event(pid, &amp;evt);</span>
<span class="lineNum">    3413 </span>            :         }
<span class="lineNum">    3414 </span>            : 
<span class="lineNum">    3415 </span><span class="lineCov">        567 :         pctx-&gt;src_pid = pid;</span>
<span class="lineNum">    3416 </span><span class="lineCov">        567 :         gf_filter_pid_set_udta(pid, pctx);</span>
<span class="lineNum">    3417 </span>            : 
<span class="lineNum">    3418 </span>            : 
<span class="lineNum">    3419 </span><span class="lineCov">        567 :         p = gf_filter_pid_get_property(pid, GF_PROP_PID_STREAM_TYPE);</span>
<span class="lineNum">    3420 </span><span class="lineCov">        567 :         pctx-&gt;stream_type = p ? p-&gt;value.uint : 0;</span>
<span class="lineNum">    3421 </span><span class="lineCov">        567 :         p = gf_filter_pid_get_property(pid, GF_PROP_PID_CODECID);</span>
<span class="lineNum">    3422 </span><span class="lineCov">        567 :         pctx-&gt;codec_id = p ? p-&gt;value.uint : 0;</span>
<span class="lineNum">    3423 </span>            : 
<span class="lineNum">    3424 </span>            :         w = h = sr = ch = 0;
<span class="lineNum">    3425 </span><span class="lineCov">        567 :         p = gf_filter_pid_get_property(pid, GF_PROP_PID_WIDTH);</span>
<span class="lineNum">    3426 </span><span class="lineCov">        567 :         if (p) w = p-&gt;value.uint;</span>
<span class="lineNum">    3427 </span><span class="lineCov">        567 :         p = gf_filter_pid_get_property(pid, GF_PROP_PID_HEIGHT);</span>
<span class="lineNum">    3428 </span><span class="lineCov">        567 :         if (p) h = p-&gt;value.uint;</span>
<span class="lineNum">    3429 </span><span class="lineCov">        567 :         p = gf_filter_pid_get_property(pid, GF_PROP_PID_SAMPLE_RATE);</span>
<span class="lineNum">    3430 </span><span class="lineCov">        567 :         if (p) sr = p-&gt;value.uint;</span>
<span class="lineNum">    3431 </span><span class="lineCov">        567 :         p = gf_filter_pid_get_property(pid, GF_PROP_PID_NUM_CHANNELS);</span>
<span class="lineNum">    3432 </span><span class="lineCov">        567 :         if (p) ch = p-&gt;value.uint;</span>
<span class="lineNum">    3433 </span>            : 
<span class="lineNum">    3434 </span><span class="lineCov">        567 :         if (! ctx-&gt;interleave) {</span>
<span class="lineNum">    3435 </span>            :                 u32 insert_idx = 0;
<span class="lineNum">    3436 </span>            :                 u32 i;
<span class="lineNum">    3437 </span>            :                 //sort all PIDs by codec IDs
<span class="lineNum">    3438 </span><span class="lineCov">        230 :                 for (i=0; i&lt;gf_list_count(ctx-&gt;src_pids); i++) {</span>
<span class="lineNum">    3439 </span>            :                         Bool insert = GF_FALSE;
<span class="lineNum">    3440 </span><span class="lineCov">        265 :                         PidCtx *actx = gf_list_get(ctx-&gt;src_pids, i);</span>
<span class="lineNum">    3441 </span>            : 
<span class="lineNum">    3442 </span><span class="lineCov">        265 :                         if (pctx-&gt;codec_id &lt; actx-&gt;codec_id) {</span>
<span class="lineNum">    3443 </span>            :                                 insert = GF_TRUE;
<span class="lineNum">    3444 </span>            :                         }
<span class="lineNum">    3445 </span>            :                         //same codec ID, sort by increasing width/height/samplerate/channels
<span class="lineNum">    3446 </span><span class="lineCov">        240 :                         else if (pctx-&gt;codec_id==actx-&gt;codec_id) {</span>
<span class="lineNum">    3447 </span>            :                                 u32 aw, ah, asr, ach;
<span class="lineNum">    3448 </span>            : 
<span class="lineNum">    3449 </span>            :                                 aw = ah = asr = ach = 0;
<span class="lineNum">    3450 </span><span class="lineCov">        109 :                                 p = gf_filter_pid_get_property(actx-&gt;src_pid, GF_PROP_PID_WIDTH);</span>
<span class="lineNum">    3451 </span><span class="lineCov">        109 :                                 if (p) aw = p-&gt;value.uint;</span>
<span class="lineNum">    3452 </span><span class="lineCov">        109 :                                 p = gf_filter_pid_get_property(actx-&gt;src_pid, GF_PROP_PID_HEIGHT);</span>
<span class="lineNum">    3453 </span><span class="lineCov">        109 :                                 if (p) ah = p-&gt;value.uint;</span>
<span class="lineNum">    3454 </span><span class="lineCov">        109 :                                 p = gf_filter_pid_get_property(actx-&gt;src_pid, GF_PROP_PID_SAMPLE_RATE);</span>
<span class="lineNum">    3455 </span><span class="lineCov">        109 :                                 if (p) asr = p-&gt;value.uint;</span>
<span class="lineNum">    3456 </span><span class="lineCov">        109 :                                 p = gf_filter_pid_get_property(actx-&gt;src_pid, GF_PROP_PID_NUM_CHANNELS);</span>
<span class="lineNum">    3457 </span><span class="lineCov">        109 :                                 if (p) ach = p-&gt;value.uint;</span>
<span class="lineNum">    3458 </span>            : 
<span class="lineNum">    3459 </span><span class="lineCov">        109 :                                 if (w &amp;&amp; aw &amp;&amp; (w&lt;aw)) insert = GF_TRUE;</span>
<span class="lineNum">    3460 </span><span class="lineCov">        109 :                                 if (h &amp;&amp; ah &amp;&amp; (h&lt;ah)) insert = GF_TRUE;</span>
<span class="lineNum">    3461 </span><span class="lineCov">        109 :                                 if (sr &amp;&amp; asr &amp;&amp; (sr&lt;asr)) insert = GF_TRUE;</span>
<span class="lineNum">    3462 </span><span class="lineCov">        109 :                                 if (ch &amp;&amp; ach &amp;&amp; (ch&lt;ach)) insert = GF_TRUE;</span>
<span class="lineNum">    3463 </span>            :                         }
<span class="lineNum">    3464 </span>            : 
<span class="lineNum">    3465 </span><span class="lineCov">        109 :                         if (insert) {</span>
<span class="lineNum">    3466 </span><span class="lineCov">         35 :                                 insert_idx = i+1;</span>
<span class="lineNum">    3467 </span><span class="lineCov">         35 :                                 break;</span>
<span class="lineNum">    3468 </span>            :                         }
<span class="lineNum">    3469 </span>            :                 }
<span class="lineNum">    3470 </span><span class="lineCov">        357 :                 if (insert_idx) {</span>
<span class="lineNum">    3471 </span><span class="lineCov">         35 :                         gf_list_insert(ctx-&gt;src_pids, pctx, insert_idx-1);</span>
<span class="lineNum">    3472 </span><span class="lineCov">        156 :                         for (i=insert_idx; i&lt;gf_list_count(ctx-&gt;src_pids); i++) {</span>
<span class="lineNum">    3473 </span><span class="lineCov">         86 :                                 PidCtx *actx = gf_list_get(ctx-&gt;src_pids, i);</span>
<span class="lineNum">    3474 </span><span class="lineCov">         86 :                                 actx-&gt;idx = i+1;</span>
<span class="lineNum">    3475 </span>            :                         }
<span class="lineNum">    3476 </span>            :                 } else {
<span class="lineNum">    3477 </span><span class="lineCov">        322 :                         gf_list_add(ctx-&gt;src_pids, pctx);</span>
<span class="lineNum">    3478 </span>            :                 }
<span class="lineNum">    3479 </span>            :         } else {
<span class="lineNum">    3480 </span><span class="lineCov">        210 :                 pctx-&gt;tmp = ctx-&gt;dump;</span>
<span class="lineNum">    3481 </span><span class="lineCov">        210 :                 gf_list_add(ctx-&gt;src_pids, pctx);</span>
<span class="lineNum">    3482 </span>            :         }
<span class="lineNum">    3483 </span>            : 
<span class="lineNum">    3484 </span><span class="lineCov">        567 :         pctx-&gt;idx = gf_list_find(ctx-&gt;src_pids, pctx) + 1;</span>
<span class="lineNum">    3485 </span>            : 
<span class="lineNum">    3486 </span><span class="lineCov">        567 :         if (! ctx-&gt;interleave &amp;&amp; !pctx-&gt;tmp &amp;&amp; ctx-&gt;dump) {</span>
<span class="lineNum">    3487 </span><span class="lineCov">        290 :                 pctx-&gt;tmp = gf_file_temp(NULL);</span>
<span class="lineNum">    3488 </span><span class="lineCov">        290 :                 if (ctx-&gt;xml)</span>
<span class="lineNum">    3489 </span><span class="lineNoCov">          0 :                         gf_fprintf(pctx-&gt;tmp, &quot;&lt;PIDInspect ID=\&quot;%d\&quot; name=\&quot;%s\&quot;&gt;\n&quot;, pctx-&gt;idx, gf_filter_pid_get_name(pid) );</span>
<span class="lineNum">    3490 </span>            :         }
<span class="lineNum">    3491 </span>            : 
<span class="lineNum">    3492 </span><span class="lineCov">        567 :         switch (ctx-&gt;mode) {</span>
<span class="lineNum">    3493 </span><span class="lineCov">        563 :         case INSPECT_MODE_PCK:</span>
<span class="lineNum">    3494 </span>            :         case INSPECT_MODE_REFRAME:
<span class="lineNum">    3495 </span><span class="lineCov">        563 :                 gf_filter_pid_set_framing_mode(pid, GF_TRUE);</span>
<span class="lineNum">    3496 </span><span class="lineCov">        563 :                 break;</span>
<span class="lineNum">    3497 </span><span class="lineCov">          4 :         default:</span>
<span class="lineNum">    3498 </span><span class="lineCov">          4 :                 gf_filter_pid_set_framing_mode(pid, GF_FALSE);</span>
<span class="lineNum">    3499 </span><span class="lineCov">          4 :                 break;</span>
<span class="lineNum">    3500 </span>            :         }
<span class="lineNum">    3501 </span>            : 
<span class="lineNum">    3502 </span><span class="lineCov">        567 :         if (!ctx-&gt;is_prober) {</span>
<span class="lineNum">    3503 </span><span class="lineCov">        500 :                 pctx-&gt;dump_pid = 1;</span>
<span class="lineNum">    3504 </span>            :         }
<span class="lineNum">    3505 </span>            : 
<span class="lineNum">    3506 </span><span class="lineCov">        567 :         gf_filter_pid_init_play_event(pid, &amp;evt, ctx-&gt;start, ctx-&gt;speed, &quot;Inspect&quot;);</span>
<span class="lineNum">    3507 </span><span class="lineCov">        567 :         gf_filter_pid_send_event(pid, &amp;evt);</span>
<span class="lineNum">    3508 </span>            : 
<span class="lineNum">    3509 </span><span class="lineCov">        567 :         if (ctx-&gt;is_prober || ctx-&gt;deep || ctx-&gt;fmt) {</span>
<span class="lineNum">    3510 </span><span class="lineCov">        544 :                 ctx-&gt;dump_pck = GF_TRUE;</span>
<span class="lineNum">    3511 </span>            :         } else {
<span class="lineNum">    3512 </span><span class="lineCov">         23 :                 ctx-&gt;dump_pck = GF_FALSE;</span>
<span class="lineNum">    3513 </span>            :         }
<span class="lineNum">    3514 </span><span class="lineCov">        567 :         if (ctx-&gt;pcr)</span>
<span class="lineNum">    3515 </span><span class="lineCov">         17 :                 gf_filter_pid_set_clock_mode(pid, GF_TRUE);</span>
<span class="lineNum">    3516 </span>            :         return GF_OK;
<span class="lineNum">    3517 </span>            : }
<span class="lineNum">    3518 </span>            : 
<span class="lineNum">    3519 </span>            : static const GF_FilterCapability InspecterDemuxedCaps[] =
<span class="lineNum">    3520 </span>            : {
<span class="lineNum">    3521 </span>            :         //accept any stream but files, framed
<span class="lineNum">    3522 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED,  GF_PROP_PID_STREAM_TYPE, GF_STREAM_FILE),
<span class="lineNum">    3523 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED,  GF_PROP_PID_CODECID, GF_CODECID_NONE),
<span class="lineNum">    3524 </span>            :         {0},
<span class="lineNum">    3525 </span>            : };
<span class="lineNum">    3526 </span>            : 
<span class="lineNum">    3527 </span>            : static const GF_FilterCapability InspecterReframeCaps[] =
<span class="lineNum">    3528 </span>            : {
<span class="lineNum">    3529 </span>            :         //accept any stream but files, framed
<span class="lineNum">    3530 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED,  GF_PROP_PID_STREAM_TYPE, GF_STREAM_FILE),
<span class="lineNum">    3531 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED,  GF_PROP_PID_CODECID, GF_CODECID_NONE),
<span class="lineNum">    3532 </span>            :         CAP_BOOL(GF_CAPS_INPUT_EXCLUDED,  GF_PROP_PID_UNFRAMED, GF_TRUE),
<span class="lineNum">    3533 </span>            :         {0},
<a name="3534"><span class="lineNum">    3534 </span>            : };</a>
<span class="lineNum">    3535 </span>            : 
<span class="lineNum">    3536 </span><span class="lineNoCov">          0 : static GF_Err inspect_update_arg(GF_Filter *filter, const char *arg_name, const GF_PropertyValue *new_val)</span>
<span class="lineNum">    3537 </span>            : {
<span class="lineNum">    3538 </span><span class="lineCov">        370 :         GF_InspectCtx  *ctx = (GF_InspectCtx *) gf_filter_get_udta(filter);</span>
<span class="lineNum">    3539 </span><span class="lineCov">        370 :         ctx-&gt;args_updated = GF_TRUE;</span>
<span class="lineNum">    3540 </span><span class="lineNoCov">          0 :         return GF_OK;</span>
<a name="3541"><span class="lineNum">    3541 </span>            : }</a>
<span class="lineNum">    3542 </span>            : 
<span class="lineNum">    3543 </span><span class="lineCov">        437 : GF_Err inspect_initialize(GF_Filter *filter)</span>
<span class="lineNum">    3544 </span>            : {
<span class="lineNum">    3545 </span><span class="lineCov">        437 :         const char *name = gf_filter_get_name(filter);</span>
<span class="lineNum">    3546 </span><span class="lineCov">        437 :         GF_InspectCtx  *ctx = (GF_InspectCtx *) gf_filter_get_udta(filter);</span>
<span class="lineNum">    3547 </span>            : 
<span class="lineNum">    3548 </span><span class="lineCov">        437 :         if (name &amp;&amp; !strcmp(name, &quot;probe&quot;) ) {</span>
<span class="lineNum">    3549 </span><span class="lineCov">         63 :                 ctx-&gt;is_prober = GF_TRUE;</span>
<span class="lineNum">    3550 </span><span class="lineCov">         63 :                 return GF_OK;</span>
<span class="lineNum">    3551 </span>            :         }
<span class="lineNum">    3552 </span>            : 
<span class="lineNum">    3553 </span>            : #ifdef GPAC_DISABLE_AVPARSE_LOGS
<span class="lineNum">    3554 </span>            :         if (ctx-&gt;analyze&gt;=INSPECT_ANALYZE_BS) {
<span class="lineNum">    3555 </span>            :                 GF_LOG(GF_LOG_ERROR, GF_LOG_AUTHOR, (&quot;[Inspect] Bitstream logging is disable in this build\n&quot;));
<span class="lineNum">    3556 </span>            :                 return GF_NOT_SUPPORTED;
<span class="lineNum">    3557 </span>            :         }
<span class="lineNum">    3558 </span>            : #endif
<span class="lineNum">    3559 </span>            : 
<span class="lineNum">    3560 </span><span class="lineCov">        374 :         if (!ctx-&gt;log) return GF_BAD_PARAM;</span>
<span class="lineNum">    3561 </span><span class="lineCov">        374 :         if (!strcmp(ctx-&gt;log, &quot;stderr&quot;)) ctx-&gt;dump = stderr;</span>
<span class="lineNum">    3562 </span><span class="lineCov">        351 :         else if (!strcmp(ctx-&gt;log, &quot;stdout&quot;)) ctx-&gt;dump = stdout;</span>
<span class="lineNum">    3563 </span><span class="lineCov">        351 :         else if (!strcmp(ctx-&gt;log, &quot;null&quot;)) ctx-&gt;dump = NULL;</span>
<span class="lineNum">    3564 </span>            :         else {
<span class="lineNum">    3565 </span><span class="lineCov">        351 :                 ctx-&gt;dump = gf_fopen(ctx-&gt;log, &quot;wt&quot;);</span>
<span class="lineNum">    3566 </span><span class="lineCov">        351 :                 if (!ctx-&gt;dump) {</span>
<span class="lineNum">    3567 </span><span class="lineNoCov">          0 :                         GF_LOG(GF_LOG_ERROR, GF_LOG_AUTHOR, (&quot;[Inspect] Failed to open file %s\n&quot;, ctx-&gt;log));</span>
<span class="lineNum">    3568 </span>            :                         return GF_IO_ERR;
<span class="lineNum">    3569 </span>            :                 }
<span class="lineNum">    3570 </span>            :         }
<span class="lineNum">    3571 </span><span class="lineCov">        374 :         if (ctx-&gt;analyze) {</span>
<span class="lineNum">    3572 </span><span class="lineCov">         15 :                 ctx-&gt;xml = GF_TRUE;</span>
<span class="lineNum">    3573 </span>            :         }
<span class="lineNum">    3574 </span>            : 
<span class="lineNum">    3575 </span><span class="lineCov">        374 :         if (ctx-&gt;xml &amp;&amp; ctx-&gt;dump) {</span>
<span class="lineNum">    3576 </span><span class="lineCov">         15 :                 ctx-&gt;fmt = NULL;</span>
<span class="lineNum">    3577 </span><span class="lineCov">         15 :                 gf_fprintf(ctx-&gt;dump, &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n&quot;);</span>
<span class="lineNum">    3578 </span><span class="lineCov">         15 :                 gf_fprintf(ctx-&gt;dump, &quot;&lt;GPACInspect&gt;\n&quot;);</span>
<span class="lineNum">    3579 </span>            :         }
<span class="lineNum">    3580 </span>            : 
<span class="lineNum">    3581 </span><span class="lineCov">        374 :         switch (ctx-&gt;mode) {</span>
<span class="lineNum">    3582 </span>            :         case INSPECT_MODE_RAW:
<span class="lineNum">    3583 </span>            :                 break;
<span class="lineNum">    3584 </span><span class="lineCov">          9 :         case INSPECT_MODE_REFRAME:</span>
<span class="lineNum">    3585 </span><span class="lineCov">          9 :                 gf_filter_override_caps(filter, InspecterReframeCaps,  sizeof(InspecterReframeCaps)/sizeof(GF_FilterCapability) );</span>
<span class="lineNum">    3586 </span><span class="lineCov">          9 :                 break;</span>
<span class="lineNum">    3587 </span><span class="lineCov">        363 :         default:</span>
<span class="lineNum">    3588 </span><span class="lineCov">        363 :                 gf_filter_override_caps(filter, InspecterDemuxedCaps,  sizeof(InspecterDemuxedCaps)/sizeof(GF_FilterCapability) );</span>
<span class="lineNum">    3589 </span><span class="lineCov">        363 :                 break;</span>
<span class="lineNum">    3590 </span>            :         }
<span class="lineNum">    3591 </span>            : 
<span class="lineNum">    3592 </span>            : #ifdef GPAC_ENABLE_COVERAGE
<span class="lineNum">    3593 </span><span class="lineCov">        374 :         if (gf_sys_is_cov_mode()) {</span>
<span class="lineNum">    3594 </span>            :                 inspect_update_arg(filter, NULL, NULL);
<span class="lineNum">    3595 </span><span class="lineCov">        370 :                 ctx-&gt;args_updated = GF_FALSE;</span>
<span class="lineNum">    3596 </span>            :         }
<span class="lineNum">    3597 </span>            : #endif
<span class="lineNum">    3598 </span>            :         return GF_OK;
<a name="3599"><span class="lineNum">    3599 </span>            : }</a>
<span class="lineNum">    3600 </span>            : 
<span class="lineNum">    3601 </span><span class="lineCov">    3277373 : static Bool inspect_process_event(GF_Filter *filter, const GF_FilterEvent *evt)</span>
<span class="lineNum">    3602 </span>            : {
<span class="lineNum">    3603 </span>            :         PidCtx *pctx;
<span class="lineNum">    3604 </span><span class="lineCov">    3277373 :         GF_InspectCtx *ctx = (GF_InspectCtx *) gf_filter_get_udta(filter);</span>
<span class="lineNum">    3605 </span><span class="lineCov">    3277373 :         if (evt-&gt;base.type != GF_FEVT_INFO_UPDATE) return GF_TRUE;</span>
<span class="lineNum">    3606 </span><span class="lineCov">    3277313 :         if (!ctx-&gt;info) return GF_TRUE;</span>
<span class="lineNum">    3607 </span><span class="lineCov">         30 :         pctx = gf_filter_pid_get_udta(evt-&gt;base.on_pid);</span>
<span class="lineNum">    3608 </span><span class="lineCov">         30 :         pctx-&gt;dump_pid = 2;</span>
<span class="lineNum">    3609 </span><span class="lineCov">         30 :         return GF_TRUE;</span>
<span class="lineNum">    3610 </span>            : }
<span class="lineNum">    3611 </span>            : 
<span class="lineNum">    3612 </span>            : #define OFFS(_n)        #_n, offsetof(GF_InspectCtx, _n)
<span class="lineNum">    3613 </span>            : static const GF_FilterArgs InspectArgs[] =
<span class="lineNum">    3614 </span>            : {
<span class="lineNum">    3615 </span>            :         { OFFS(log), &quot;set inspect log filename&quot;, GF_PROP_STRING, &quot;stderr&quot;, &quot;fileName, stderr, stdout or null&quot;, 0},
<span class="lineNum">    3616 </span>            :         { OFFS(mode), &quot;dump mode\n&quot;
<span class="lineNum">    3617 </span>            :         &quot;- pck: dump full packet\n&quot;
<span class="lineNum">    3618 </span>            :         &quot;- blk: dump packets before reconstruction\n&quot;
<span class="lineNum">    3619 </span>            :         &quot;- frame: force reframer\n&quot;
<span class="lineNum">    3620 </span>            :         &quot;- raw: dump source packets without demuxing&quot;, GF_PROP_UINT, &quot;pck&quot;, &quot;pck|blk|frame|raw&quot;, 0},
<span class="lineNum">    3621 </span>            :         { OFFS(interleave), &quot;dump packets as they are received on each pid. If false, report per pid is generated&quot;, GF_PROP_BOOL, &quot;true&quot;, NULL, GF_FS_ARG_HINT_ADVANCED},
<span class="lineNum">    3622 </span>            :         { OFFS(deep), &quot;dump packets along with PID state change, implied when [-fmt]() is set&quot;, GF_PROP_BOOL, &quot;false&quot;, NULL, GF_FS_ARG_HINT_ADVANCED|GF_FS_ARG_UPDATE},
<span class="lineNum">    3623 </span>            :         { OFFS(props), &quot;dump packet properties, ignored when [-fmt]() is set (see filter help)&quot;, GF_PROP_BOOL, &quot;true&quot;, NULL, GF_FS_ARG_HINT_ADVANCED|GF_FS_ARG_UPDATE},
<span class="lineNum">    3624 </span>            :         { OFFS(dump_data), &quot;enable full data dump (__heavy!__), ignored when [-fmt]() is set (see filter help)&quot;, GF_PROP_BOOL, &quot;false&quot;, NULL, GF_FS_ARG_UPDATE|GF_FS_ARG_HINT_ADVANCED|GF_FS_ARG_UPDATE},
<span class="lineNum">    3625 </span>            :         { OFFS(fmt), &quot;set packet dump format (see filter help)&quot;, GF_PROP_STRING, NULL, NULL, GF_FS_ARG_UPDATE|GF_FS_ARG_HINT_ADVANCED},
<span class="lineNum">    3626 </span>            :         { OFFS(hdr), &quot;print a header corresponding to fmt string without '$' or \&quot;pid\&quot;&quot;, GF_PROP_BOOL, &quot;true&quot;, NULL, GF_FS_ARG_HINT_ADVANCED},
<span class="lineNum">    3627 </span>            :         { OFFS(allp), &quot;analyse for the entire duration, rather than stopping when all pids are found&quot;, GF_PROP_BOOL, &quot;false&quot;, NULL, GF_FS_ARG_HINT_ADVANCED},
<span class="lineNum">    3628 </span>            :         { OFFS(info), &quot;monitor PID info changes&quot;, GF_PROP_BOOL, &quot;false&quot;, NULL, GF_FS_ARG_HINT_ADVANCED|GF_FS_ARG_UPDATE},
<span class="lineNum">    3629 </span>            :         { OFFS(pcr), &quot;dump M2TS PCR info&quot;, GF_PROP_BOOL, &quot;false&quot;, NULL, GF_FS_ARG_HINT_EXPERT|GF_FS_ARG_UPDATE},
<span class="lineNum">    3630 </span>            :         { OFFS(speed), &quot;set playback command speed. If speed is negative and start is 0, start is set to -1&quot;, GF_PROP_DOUBLE, &quot;1.0&quot;, NULL, 0},
<span class="lineNum">    3631 </span>            :         { OFFS(start), &quot;set playback start offset. Negative value means percent of media duration with -1 equal to duration&quot;, GF_PROP_DOUBLE, &quot;0.0&quot;, NULL, 0},
<span class="lineNum">    3632 </span>            :         { OFFS(dur), &quot;set inspect duration&quot;, GF_PROP_FRACTION, &quot;0/0&quot;, NULL, 0},
<span class="lineNum">    3633 </span>            :         { OFFS(analyze), &quot;analyze sample content (NALU, OBU)\n&quot;
<span class="lineNum">    3634 </span>            :         &quot;- off: no analyzing\n&quot;
<span class="lineNum">    3635 </span>            :         &quot;- on: simple analyzing\n&quot;
<span class="lineNum">    3636 </span>            :         &quot;- bs: log bitstream syntax (all elements read from bitstream)\n&quot;
<span class="lineNum">    3637 </span>            :         &quot;- full: log bitstream syntax and bit sizes signaled as `(N)` after field value, except 1-bit fields (omitted)&quot;, GF_PROP_UINT, &quot;off&quot;, &quot;off|on|bs|full&quot;, GF_FS_ARG_HINT_ADVANCED|GF_FS_ARG_UPDATE},
<span class="lineNum">    3638 </span>            :         { OFFS(xml), &quot;use xml formatting (implied if (-analyze]() is set) and disable [-fmt]()&quot;, GF_PROP_BOOL, &quot;false&quot;, NULL, GF_FS_ARG_UPDATE},
<span class="lineNum">    3639 </span>            :         { OFFS(crc), &quot;dump crc of NALU/OBU/... when analyzing&quot;, GF_PROP_BOOL, &quot;false&quot;, NULL, GF_FS_ARG_UPDATE},
<span class="lineNum">    3640 </span>            :         { OFFS(fftmcd), &quot;consider timecodes use ffmpeg-compatible signaling rather than QT compliant one&quot;, GF_PROP_BOOL, &quot;false&quot;, NULL, GF_FS_ARG_HINT_EXPERT|GF_FS_ARG_UPDATE},
<span class="lineNum">    3641 </span>            :         { OFFS(dtype), &quot;dump property type&quot;, GF_PROP_BOOL, &quot;false&quot;, NULL, GF_FS_ARG_UPDATE},
<span class="lineNum">    3642 </span>            :         { OFFS(buffer), &quot;set buffer in ms (mostly used for testing DASH algo)&quot;, GF_PROP_UINT, &quot;0&quot;, NULL, GF_ARG_HINT_EXPERT},
<span class="lineNum">    3643 </span>            :         { OFFS(test), &quot;skip predefined set of properties, used for test mode\n&quot;
<span class="lineNum">    3644 </span>            :                 &quot;- no: no properties skipped\n&quot;
<span class="lineNum">    3645 </span>            :                 &quot;- noprop: all properties/info changes on pid are skipped, only packets are dumped\n&quot;
<span class="lineNum">    3646 </span>            :                 &quot;- network: URL/path dump, cache state, file size properties skipped (used for hashing network results)\n&quot;
<span class="lineNum">    3647 </span>            :                 &quot;- netx: same as network but skip track duration and templates (used for hashing progressive load of fmp4)\n&quot;
<span class="lineNum">    3648 </span>            :                 &quot;- encode: same as network plus skip decoder config (used for hashing encoding results)\n&quot;
<span class="lineNum">    3649 </span>            :                 &quot;- encx: same as encode and skip bitrates, media data size and co\n&quot;
<span class="lineNum">    3650 </span>            :                 &quot;- nocrc: disable packet CRC dump\n&quot;
<span class="lineNum">    3651 </span>            :                 &quot;- nobr: skip bitrate&quot;
<span class="lineNum">    3652 </span>            :                 , GF_PROP_UINT, &quot;no&quot;, &quot;no|noprop|network|netx|encode|encx|nocrc|nobr&quot;, GF_FS_ARG_HINT_EXPERT|GF_FS_ARG_UPDATE},
<span class="lineNum">    3653 </span>            :         {0}
<span class="lineNum">    3654 </span>            : };
<span class="lineNum">    3655 </span>            : 
<span class="lineNum">    3656 </span>            : static const GF_FilterCapability InspectCaps[] =
<span class="lineNum">    3657 </span>            : {
<span class="lineNum">    3658 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED, GF_PROP_PID_STREAM_TYPE, GF_STREAM_UNKNOWN),
<span class="lineNum">    3659 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED, GF_PROP_PID_CODECID, GF_CODECID_NONE),
<span class="lineNum">    3660 </span>            : };
<span class="lineNum">    3661 </span>            : 
<span class="lineNum">    3662 </span>            : const GF_FilterRegister InspectRegister = {
<span class="lineNum">    3663 </span>            :         .name = &quot;inspect&quot;,
<span class="lineNum">    3664 </span>            :         GF_FS_SET_DESCRIPTION(&quot;Inspect packets&quot;)
<span class="lineNum">    3665 </span>            :         GF_FS_SET_HELP(&quot;The inspect filter can be used to dump pid and packets. It may also be used to check parts of payload of the packets. The default options inspect only pid changes.\n&quot;\
<span class="lineNum">    3666 </span>            :                                 &quot;The packet inspector can be configured to dump specific properties of packets using [-fmt]().\n&quot;\
<span class="lineNum">    3667 </span>            :                                 &quot;When the option is not present, all properties are dumped. Otherwise, only properties identified by `$TOKEN$` &quot;
<span class="lineNum">    3668 </span>            :                                 &quot;are printed. You may use '$', '@' or '%' for `TOKEN` separator. `TOKEN` can be:\n&quot;\
<span class="lineNum">    3669 </span>            :                                 &quot;- pn: packet (frame in framed mode) number\n&quot;\
<span class="lineNum">    3670 </span>            :                                 &quot;- dts: decoding time stamp in stream timescale, N/A if not available\n&quot;\
<span class="lineNum">    3671 </span>            :                                 &quot;- ddts: difference between current and previous packets decoding time stamp in stream timescale, N/A if not available\n&quot;\
<span class="lineNum">    3672 </span>            :                                 &quot;- cts: composition time stamp in stream timescale, N/A if not available\n&quot;\
<span class="lineNum">    3673 </span>            :                                 &quot;- dcts: difference between current and previous packets composition time stamp in stream timescale, N/A if not available\n&quot;\
<span class="lineNum">    3674 </span>            :                                 &quot;- ctso: difference between composition time stamp and decoding time stamp in stream timescale, N/A if not available\n&quot;\
<span class="lineNum">    3675 </span>            :                                 &quot;- dur: duration in stream timescale\n&quot;\
<span class="lineNum">    3676 </span>            :                                 &quot;- frame: framing status\n&quot;
<span class="lineNum">    3677 </span>            :                                 &quot;  - interface: complete AU, interface object (no size info). Typically a GL texture\n&quot;
<span class="lineNum">    3678 </span>            :                                 &quot;  - frame_full: complete AU\n&quot;
<span class="lineNum">    3679 </span>            :                                 &quot;  - frame_start: beginning of frame\n&quot;
<span class="lineNum">    3680 </span>            :                                 &quot;  - frame_end: end of frame\n&quot;
<span class="lineNum">    3681 </span>            :                                 &quot;  - frame_cont: frame continuation (not beginning, not end)\n&quot;
<span class="lineNum">    3682 </span>            :                                 &quot;- sap or rap: SAP type of the frame\n&quot;\
<span class="lineNum">    3683 </span>            :                                 &quot;- ilace: interlacing flag (0: progressive, 1: top field, 2: bottom field)\n&quot;\
<span class="lineNum">    3684 </span>            :                                 &quot;- corr: corrupted packet flag\n&quot;\
<span class="lineNum">    3685 </span>            :                                 &quot;- seek: seek flag\n&quot;\
<span class="lineNum">    3686 </span>            :                                 &quot;- bo: byte offset in source, N/A if not available\n&quot;\
<span class="lineNum">    3687 </span>            :                                 &quot;- roll: roll info\n&quot;\
<span class="lineNum">    3688 </span>            :                                 &quot;- crypt: crypt flag\n&quot;\
<span class="lineNum">    3689 </span>            :                                 &quot;- vers: carousel version number\n&quot;\
<span class="lineNum">    3690 </span>            :                                 &quot;- size: size of packet\n&quot;\
<span class="lineNum">    3691 </span>            :                                 &quot;- csize: cumulated size of packets\n&quot;\
<span class="lineNum">    3692 </span>            :                                 &quot;- crc: 32 bit CRC of packet\n&quot;\
<span class="lineNum">    3693 </span>            :                                 &quot;- lf: insert linefeed\n&quot;\
<span class="lineNum">    3694 </span>            :                                 &quot;- cr: insert carriage return\n&quot;\
<span class="lineNum">    3695 </span>            :                                 &quot;- t: insert tab\n&quot;\
<span class="lineNum">    3696 </span>            :                                 &quot;- data: hex dump of packet (__big output!__)\n&quot;\
<span class="lineNum">    3697 </span>            :                                 &quot;- lp: leading picture flag\n&quot;\
<span class="lineNum">    3698 </span>            :                                 &quot;- depo: depends on other packet flag\n&quot;\
<span class="lineNum">    3699 </span>            :                                 &quot;- depf: is depended on other packet flag\n&quot;\
<span class="lineNum">    3700 </span>            :                                 &quot;- red: redundant coding flag\n&quot;\
<span class="lineNum">    3701 </span>            :                                 &quot;- ck: clock type used for PCR discontinuities\n&quot;\
<span class="lineNum">    3702 </span>            :                                 &quot;- P4CC: 4CC of packet property\n&quot;\
<span class="lineNum">    3703 </span>            :                                 &quot;- PropName: Name of packet property\n&quot;\
<span class="lineNum">    3704 </span>            :                                 &quot;- pid.P4CC: 4CC of PID property\n&quot;\
<span class="lineNum">    3705 </span>            :                                 &quot;- pid.PropName: Name of PID property\n&quot;\
<span class="lineNum">    3706 </span>            :                                 &quot;\n&quot;\
<span class="lineNum">    3707 </span>            :                                 &quot;EX fmt=\&quot;PID $pid.ID$ packet $pn$ DTS $dts$ CTS $cts$ $lf$\&quot;\n&quot;
<span class="lineNum">    3708 </span>            :                                 &quot;This dumps packet number, cts and dts as follows: `PID 1 packet 10 DTS 100 CTS 108 \\n`\n&quot;\
<span class="lineNum">    3709 </span>            :                                 &quot;  \n&quot;\
<span class="lineNum">    3710 </span>            :                                 &quot;An unrecognized keyword or missing property will resolve to an empty string.\n&quot;\
<span class="lineNum">    3711 </span>            :                                 &quot;\n&quot;\
<span class="lineNum">    3712 </span>            :                                 &quot;Note: when dumping in interleaved mode, there is no guarantee that the packets will be dumped in their original sequence order since the inspector fetches one packet at a time on each PID.\n&quot;)
<span class="lineNum">    3713 </span>            :         .private_size = sizeof(GF_InspectCtx),
<span class="lineNum">    3714 </span>            :         .flags = GF_FS_REG_EXPLICIT_ONLY,
<span class="lineNum">    3715 </span>            :         .max_extra_pids = (u32) -1,
<span class="lineNum">    3716 </span>            :         .args = InspectArgs,
<span class="lineNum">    3717 </span>            :         SETCAPS(InspectCaps),
<span class="lineNum">    3718 </span>            :         .initialize = inspect_initialize,
<span class="lineNum">    3719 </span>            :         .finalize = inspect_finalize,
<span class="lineNum">    3720 </span>            :         .process = inspect_process,
<span class="lineNum">    3721 </span>            :         .process_event = inspect_process_event,
<span class="lineNum">    3722 </span>            :         .configure_pid = inspect_config_input,
<span class="lineNum">    3723 </span>            :         .update_arg = inspect_update_arg,
<span class="lineNum">    3724 </span>            : };
<span class="lineNum">    3725 </span>            : 
<span class="lineNum">    3726 </span>            : static const GF_FilterCapability ProberCaps[] =
<span class="lineNum">    3727 </span>            : {
<span class="lineNum">    3728 </span>            :         //accept any stream but files, framed
<span class="lineNum">    3729 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED,  GF_PROP_PID_STREAM_TYPE, GF_STREAM_FILE),
<span class="lineNum">    3730 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED,  GF_PROP_PID_STREAM_TYPE, GF_STREAM_SCENE),
<span class="lineNum">    3731 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED,  GF_PROP_PID_STREAM_TYPE, GF_STREAM_OD),
<span class="lineNum">    3732 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED,  GF_PROP_PID_STREAM_TYPE, GF_STREAM_TEXT),
<span class="lineNum">    3733 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED,  GF_PROP_PID_CODECID, GF_CODECID_NONE),
<span class="lineNum">    3734 </span>            :         CAP_BOOL(GF_CAPS_INPUT_EXCLUDED, GF_PROP_PID_UNFRAMED, GF_TRUE),
<span class="lineNum">    3735 </span>            :         {0},
<span class="lineNum">    3736 </span>            :         CAP_UINT(GF_CAPS_INPUT,  GF_PROP_PID_STREAM_TYPE, GF_STREAM_SCENE),
<span class="lineNum">    3737 </span>            :         CAP_UINT(GF_CAPS_INPUT,  GF_PROP_PID_STREAM_TYPE, GF_STREAM_OD),
<span class="lineNum">    3738 </span>            :         CAP_UINT(GF_CAPS_INPUT,  GF_PROP_PID_STREAM_TYPE, GF_STREAM_TEXT),
<span class="lineNum">    3739 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED,  GF_PROP_PID_CODECID, GF_CODECID_NONE),
<span class="lineNum">    3740 </span>            :         CAP_UINT(GF_CAPS_INPUT_EXCLUDED,  GF_PROP_PID_CODECID, GF_CODECID_RAW),
<span class="lineNum">    3741 </span>            :         CAP_BOOL(GF_CAPS_INPUT_EXCLUDED, GF_PROP_PID_UNFRAMED, GF_TRUE),
<span class="lineNum">    3742 </span>            :         {0},
<span class="lineNum">    3743 </span>            : };
<span class="lineNum">    3744 </span>            : 
<span class="lineNum">    3745 </span>            : 
<span class="lineNum">    3746 </span>            : const GF_FilterRegister ProbeRegister = {
<span class="lineNum">    3747 </span>            :         .name = &quot;probe&quot;,
<span class="lineNum">    3748 </span>            :         GF_FS_SET_DESCRIPTION(&quot;Probe source&quot;)
<span class="lineNum">    3749 </span>            :         GF_FS_SET_HELP(&quot;The Probe filter is used by applications (typically `MP4Box`) to query demuxed pids available in a source chain.\n&quot;
<span class="lineNum">    3750 </span>            :         &quot;The filter does not produce any output nor feedback, it is up to the app developer to query input pids of the prober and take appropriated decisions.&quot;)
<span class="lineNum">    3751 </span>            :         .private_size = sizeof(GF_InspectCtx),
<span class="lineNum">    3752 </span>            :         .flags = GF_FS_REG_EXPLICIT_ONLY,
<span class="lineNum">    3753 </span>            :         .max_extra_pids = (u32) -1,
<span class="lineNum">    3754 </span>            :         .initialize = inspect_initialize,
<span class="lineNum">    3755 </span>            :         SETCAPS(ProberCaps),
<span class="lineNum">    3756 </span>            :         .finalize = inspect_finalize,
<span class="lineNum">    3757 </span>            :         .process = inspect_process,
<span class="lineNum">    3758 </span>            :         .configure_pid = inspect_config_input,
<a name="3759"><span class="lineNum">    3759 </span>            : };</a>
<span class="lineNum">    3760 </span>            : 
<span class="lineNum">    3761 </span><span class="lineCov">       2877 : const GF_FilterRegister *inspect_register(GF_FilterSession *session)</span>
<span class="lineNum">    3762 </span>            : {
<span class="lineNum">    3763 </span><span class="lineCov">       2877 :         return &amp;InspectRegister;</span>
<a name="3764"><span class="lineNum">    3764 </span>            : }</a>
<span class="lineNum">    3765 </span>            : 
<span class="lineNum">    3766 </span><span class="lineCov">       2877 : const GF_FilterRegister *probe_register(GF_FilterSession *session)</span>
<span class="lineNum">    3767 </span>            : {
<span class="lineNum">    3768 </span><span class="lineCov">       2877 :         return &amp;ProbeRegister;</span>
<span class="lineNum">    3769 </span>            : }
<span class="lineNum">    3770 </span>            : 
<span class="lineNum">    3771 </span>            : 
<span class="lineNum">    3772 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
