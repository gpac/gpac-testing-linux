<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - /home/travis/build/gpac/gpac/applications/gpac/main.c</title>
  <link rel="stylesheet" type="text/css" href="../../../../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../../../../index.html">top level</a> - <a href="index.html">home/travis/build/gpac/gpac/applications/gpac</a> - main.c<span style="font-size: 80%;"> (source / <a href="main.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">1757</td>
            <td class="headerCovTableEntry">2103</td>
            <td class="headerCovTableEntryMed">83.5 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2021-04-29 23:48:07</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">55</td>
            <td class="headerCovTableEntry">56</td>
            <td class="headerCovTableEntryHi">98.2 %</td>
          </tr>
          <tr><td><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<span class="lineNum">       2 </span>            :  *                      GPAC - Multimedia Framework C SDK
<span class="lineNum">       3 </span>            :  *
<span class="lineNum">       4 </span>            :  *                      Authors: Jean Le Feuvre
<span class="lineNum">       5 </span>            :  *                      Copyright (c) Telecom ParisTech 2017-2021
<span class="lineNum">       6 </span>            :  *                                      All rights reserved
<span class="lineNum">       7 </span>            :  *
<span class="lineNum">       8 </span>            :  *  This file is part of GPAC / gpac application
<span class="lineNum">       9 </span>            :  *
<span class="lineNum">      10 </span>            :  *  GPAC is free software; you can redistribute it and/or modify
<span class="lineNum">      11 </span>            :  *  it under the terms of the GNU Lesser General Public License as published by
<span class="lineNum">      12 </span>            :  *  the Free Software Foundation; either version 2, or (at your option)
<span class="lineNum">      13 </span>            :  *  any later version.
<span class="lineNum">      14 </span>            :  *
<span class="lineNum">      15 </span>            :  *  GPAC is distributed in the hope that it will be useful,
<span class="lineNum">      16 </span>            :  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
<span class="lineNum">      17 </span>            :  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<span class="lineNum">      18 </span>            :  *  GNU Lesser General Public License for more details.
<span class="lineNum">      19 </span>            :  *
<span class="lineNum">      20 </span>            :  *  You should have received a copy of the GNU Lesser General Public
<span class="lineNum">      21 </span>            :  *  License along with this library; see the file COPYING.  If not, write to
<span class="lineNum">      22 </span>            :  *  the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
<span class="lineNum">      23 </span>            :  *
<span class="lineNum">      24 </span>            :  */
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            : #include &lt;gpac/main.h&gt;
<span class="lineNum">      27 </span>            : #include &lt;gpac/filters.h&gt;
<span class="lineNum">      28 </span>            : #include &lt;gpac/thread.h&gt;
<span class="lineNum">      29 </span>            : 
<span class="lineNum">      30 </span>            : static GF_SystemRTInfo rti;
<span class="lineNum">      31 </span>            : static GF_FilterSession *session=NULL;
<span class="lineNum">      32 </span>            : static u32 list_filters = 0;
<span class="lineNum">      33 </span>            : static Bool dump_stats = GF_FALSE;
<span class="lineNum">      34 </span>            : static Bool dump_graph = GF_FALSE;
<span class="lineNum">      35 </span>            : static u32 print_filter_info = 0;
<span class="lineNum">      36 </span>            : static Bool print_meta_filters = GF_FALSE;
<span class="lineNum">      37 </span>            : static Bool load_test_filters = GF_FALSE;
<span class="lineNum">      38 </span>            : static s32 nb_loops = 0;
<span class="lineNum">      39 </span>            : static s32 runfor = 0;
<span class="lineNum">      40 </span>            : static Bool runfor_exit = GF_FALSE;
<span class="lineNum">      41 </span>            : static Bool enable_prompt = GF_FALSE;
<span class="lineNum">      42 </span>            : static u32 enable_reports = 0;
<span class="lineNum">      43 </span>            : static char *report_filter = NULL;
<span class="lineNum">      44 </span>            : static Bool do_unit_tests = GF_FALSE;
<span class="lineNum">      45 </span>            : static int alias_argc = 0;
<span class="lineNum">      46 </span>            : static char **alias_argv = NULL;
<span class="lineNum">      47 </span>            : static GF_List *args_used = NULL;
<span class="lineNum">      48 </span>            : static GF_List *args_alloc = NULL;
<span class="lineNum">      49 </span>            : static u32 gen_doc = 0;
<span class="lineNum">      50 </span>            : static u32 help_flags = 0;
<span class="lineNum">      51 </span>            : static u32 loops_done = 0;
<span class="lineNum">      52 </span>            : 
<span class="lineNum">      53 </span>            : //coverage for FileIO
<span class="lineNum">      54 </span>            : static const char *make_fileio(const char *inargs, const char **out_arg, Bool is_input, GF_Err *e);
<span class="lineNum">      55 </span>            : static void cleanup_file_io();
<span class="lineNum">      56 </span>            : 
<span class="lineNum">      57 </span>            : //coverage for custom filters
<span class="lineNum">      58 </span>            : static GF_Filter *load_custom_filter(GF_FilterSession *sess, char *opts, GF_Err *e);
<span class="lineNum">      59 </span>            : 
<span class="lineNum">      60 </span>            : static FILE *sidebar_md=NULL;
<span class="lineNum">      61 </span>            : static FILE *helpout = NULL;
<span class="lineNum">      62 </span>            : 
<span class="lineNum">      63 </span>            : static const char *auto_gen_md_warning = &quot;&lt;!-- automatically generated - do not edit, patch gpac/applications/gpac/main.c --&gt;\n&quot;;
<span class="lineNum">      64 </span>            : 
<span class="lineNum">      65 </span>            : //uncomment to check argument description matches our conventions - see filter.h
<span class="lineNum">      66 </span>            : #define CHECK_DOC
<span class="lineNum">      67 </span>            : 
<span class="lineNum">      68 </span>            : //the default set of separators
<span class="lineNum">      69 </span>            : static char separator_set[7] = GF_FS_DEFAULT_SEPS;
<span class="lineNum">      70 </span>            : #define SEP_LINK        5
<span class="lineNum">      71 </span>            : #define SEP_FRAG        2
<span class="lineNum">      72 </span>            : #define SEP_LIST        3
<span class="lineNum">      73 </span>            : 
<span class="lineNum">      74 </span>            : static Bool print_filters(int argc, char **argv, GF_FilterSession *session, GF_SysArgMode argmode);
<span class="lineNum">      75 </span>            : static void dump_all_props(void);
<span class="lineNum">      76 </span>            : static void dump_all_colors(void);
<span class="lineNum">      77 </span>            : static void dump_all_codec(GF_FilterSession *session);
<span class="lineNum">      78 </span>            : static void write_filters_options(GF_FilterSession *fsess);
<span class="lineNum">      79 </span>            : static void write_core_options();
<span class="lineNum">      80 </span>            : static void write_file_extensions();
<span class="lineNum">      81 </span>            : static int gpac_make_lang(char *filename);
<span class="lineNum">      82 </span>            : static Bool gpac_expand_alias(int argc, char **argv);
<span class="lineNum">      83 </span>            : static u32 gpac_unit_tests(GF_MemTrackerType mem_track);
<span class="lineNum">      84 </span>            : 
<span class="lineNum">      85 </span>            : static Bool revert_cache_file(void *cbck, char *item_name, char *item_path, GF_FileEnumInfo *file_info);
<span class="lineNum">      86 </span>            : 
<span class="lineNum">      87 </span>            : 
<span class="lineNum">      88 </span>            : 
<span class="lineNum">      89 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">      90 </span>            : const char *gpac_doc =
<span class="lineNum">      91 </span>            : &quot;# General\n&quot;
<span class="lineNum">      92 </span>            : &quot;Filters are configurable processing units consuming and producing data packets. These packets are carried &quot;
<span class="lineNum">      93 </span>            : &quot;between filters through a data channel called __pid__. A PID is in charge of allocating/tracking data packets, &quot;
<span class="lineNum">      94 </span>            : &quot;and passing the packets to the destination filter(s). A filter output PID may be connected to zero or more filters. &quot;
<span class="lineNum">      95 </span>            : &quot;This fan-out is handled internally by GPAC (no such thing as a tee filter in GPAC).\n&quot;
<span class="lineNum">      96 </span>            : &quot;Note: When a PID cannot be connected to any filter, a warning is thrown and all packets dispatched on &quot;
<span class="lineNum">      97 </span>            : &quot;this PID will be destroyed. The session may however still run, unless [-full-link](CORE) is set.\n&quot;
<span class="lineNum">      98 </span>            : &quot;  \nEach output PID carries a set of properties describing the data it delivers (eg __width__, __height__, __codec__, ...). Properties &quot;
<span class="lineNum">      99 </span>            : &quot;can be built-in (identified by a 4 character code **abcd**, see [properties (-h props)](filters_properties) ), or user-defined (identified by a string). Each PID tracks &quot;
<span class="lineNum">     100 </span>            : &quot;its properties changes and triggers filter reconfiguration during packet processing. This allows the filter chain to be &quot;
<span class="lineNum">     101 </span>            : &quot;reconfigured at run time, potentially reloading part of the chain (eg unload a video decoder when switching from compressed &quot;
<span class="lineNum">     102 </span>            : &quot;to uncompressed sources).\n&quot;
<span class="lineNum">     103 </span>            : &quot;  \nEach filter exposes one or more sets of capabilities, called __capability bundle__, which are property type and values &quot;
<span class="lineNum">     104 </span>            : &quot;that must be matched or excluded by connecting PIDs.\n&quot;
<span class="lineNum">     105 </span>            : &quot;  \nEach filter exposes a set of argument to configure itself, using property types and values described as strings formatted with &quot;
<span class="lineNum">     106 </span>            : &quot;separators. This help is given with default separator sets `:=#,@` to specify filters, properties and options. Use [-seps](GPAC) to change them.\n&quot;
<span class="lineNum">     107 </span>            : &quot;# Property format\n&quot;
<span class="lineNum">     108 </span>            : &quot;- boolean: formatted as `yes`,`true`,`1` or `no`,`false`,`0`\n&quot;
<span class="lineNum">     109 </span>            : &quot;- enumeration (for filter arguments only): must use the syntax given in the argument description, otherwise value `0` (first in enum) is assumed.\n&quot;
<span class="lineNum">     110 </span>            : &quot;- 1-dimension (numbers, floats, ints...): formatted as `value[unit]`, where `unit` can be `k`,`K` (x 1000) or `m`,`M` (x 1000000) or `g`,`G` (x 1000000000) or `sec` (x 1000) or `min` (x 60000). &quot;
<span class="lineNum">     111 </span>            : &quot;For such properties, value `+I` means maximum possible value, `-I` minimum possible value.\n&quot;
<span class="lineNum">     112 </span>            : &quot;- fraction: formatted as `num/den` or `num-den` or `num`, in which case the denominator is 1 if `num` is an integer, or 1000000 if `num` is a floating-point value.\n&quot;
<span class="lineNum">     113 </span>            : &quot;- unsigned 32 bit integer: formatted as number or hexadecimal using the format `0xAABBCCDD`.\n&quot;
<span class="lineNum">     114 </span>            : &quot;- N-dimension (vectors): formatted as `DIM1xDIM2[xDIM3[xDIM4]]` values, without unit multiplier.\n&quot;
<span class="lineNum">     115 </span>            : &quot;- string: formatted as:\n&quot;
<span class="lineNum">     116 </span>            : &quot; - `value`: copies value to string.\n&quot;
<span class="lineNum">     117 </span>            : &quot; - `file@FILE`: load string from local `FILE` (opened in binary mode).\n&quot;
<span class="lineNum">     118 </span>            : &quot; - `bxml@FILE`: binarize XML from local `FILE` and set property type to data - see https://wiki.gpac.io/NHML-Format.\n&quot;
<span class="lineNum">     119 </span>            : &quot;- data: formatted as:\n&quot;
<span class="lineNum">     120 </span>            : &quot; - `size@address`: constant data block, not internally copied; `size` gives the size of the block, `address` the data pointer.\n&quot;
<span class="lineNum">     121 </span>            : &quot; - `0xBYTESTRING`: data block specified in hexadecimal, internally copied.\n&quot;
<span class="lineNum">     122 </span>            : &quot; - `file@FILE`: load data from local `FILE` (opened in binary mode).\n&quot;
<span class="lineNum">     123 </span>            : &quot; - `bxml@FILE`: binarize XML from local `FILE` - see https://wiki.gpac.io/NHML-Format.\n&quot;
<span class="lineNum">     124 </span>            : &quot;- pointer: are formatted as `address` giving the pointer address (32 or 64 bit depending on platforms).\n&quot;
<span class="lineNum">     125 </span>            : &quot;- string lists: formatted as `val1,val2[,...]`. Each value can also use `file@FILE` syntax.\n&quot;
<span class="lineNum">     126 </span>            : &quot;- integer lists: formatted as `val1,val2[,...]`\n&quot;
<span class="lineNum">     127 </span>            : &quot;Note: The special characters in property formats (0x,/,-,+I,-I,x) cannot be configured.\n&quot;
<span class="lineNum">     128 </span>            : &quot;# Filter declaration [__FILTER__]\n&quot;
<span class="lineNum">     129 </span>            : &quot;## Generic declaration\n&quot;
<span class="lineNum">     130 </span>            : &quot;Each filter is declared by its name, with optional filter arguments appended as a list of colon-separated `name=value` pairs. Additional syntax is provided for:\n&quot;
<span class="lineNum">     131 </span>            : &quot;- boolean: `value` can be omitted, defaulting to `true` (eg `:noedit`). Using `!` before the name negates the result (eg `:!moof_first`)\n&quot;
<span class="lineNum">     132 </span>            : &quot;- enumerations: name can be omitted (eg `:disp=pbo` is equivalent to `:pbo`), provided that filter developers pay attention to not reuse enumeration names in the same filter.\n&quot;
<span class="lineNum">     133 </span>            : &quot;\n  \n&quot;
<span class="lineNum">     134 </span>            : &quot;When string parameters are used (eg URLs), it is recommended to escape the string using the keyword `gpac`.  \n&quot;
<span class="lineNum">     135 </span>            : &quot;EX filter:ARG=http://foo/bar?yes:gpac:opt=VAL\n&quot;
<span class="lineNum">     136 </span>            : &quot;This will properly extract the URL.\n&quot;
<span class="lineNum">     137 </span>            : &quot;EX filter:ARG=http://foo/bar?yes:opt=VAL\n&quot;
<span class="lineNum">     138 </span>            : &quot;This will fail to extract it and keep `:opt=VAL` as part of the URL.\n&quot;
<span class="lineNum">     139 </span>            : &quot;The escape mechanism is not needed for local source, for which file existence is probed during argument parsing. &quot;
<span class="lineNum">     140 </span>            : &quot;It is also not needed for builtin protocol handlers (`avin://`, `video://`, `audio://`, `pipe://`)\n&quot;
<span class="lineNum">     141 </span>            : &quot;For `tcp://` and `udp://` protocols, the escape is not needed if a trailing `/` is appended after the port number.\n&quot;
<span class="lineNum">     142 </span>            : &quot;EX -i tcp://127.0.0.1:1234:OPT\n&quot;
<span class="lineNum">     143 </span>            : &quot;This will fail to extract the URL and options.\n&quot;
<span class="lineNum">     144 </span>            : &quot;EX -i tcp://127.0.0.1:1234/:OPT\n&quot;
<span class="lineNum">     145 </span>            : &quot;This will extract the URL and options.\n&quot;
<span class="lineNum">     146 </span>            : &quot;Note: one trick to avoid the escape sequence is to declare the URLs option at the end, eg `f1:opt1=foo:url=http://bar`, provided you have only one URL parameter to specify on the filter.\n&quot;
<span class="lineNum">     147 </span>            : &quot;\n&quot;
<span class="lineNum">     148 </span>            : &quot;It is possible to disable option parsing (for string options) by duplicating the separator.\n&quot;
<span class="lineNum">     149 </span>            : &quot;EX filter::opt1=UDP://IP:PORT/:someopt=VAL::opt2=VAL2\n&quot;
<span class="lineNum">     150 </span>            : &quot;This will pass `UDP://IP:PORT/:someopt=VAL` to `opt1` without inspecting it, and `VAL2` to `opt2`.\n&quot;
<span class="lineNum">     151 </span>            : &quot;  \n&quot;
<span class="lineNum">     152 </span>            : &quot;A filter may be assigned a name (for inspection purposes, not inherited) using `:N=name` option. This name is not used in link resolution and may be changed at runtime by the filter instance.\n&quot;
<span class="lineNum">     153 </span>            : &quot;  \n&quot;
<span class="lineNum">     154 </span>            : &quot;A filter may be assigned a tag (any string) using `:TAG=name` option. This tag does not need to be unique, and can be used to exclude filter in link resolution. Tags are not inherited, therefore dynamically loaded filters never have a tag.\n&quot;
<span class="lineNum">     155 </span>            : &quot;  \n&quot;
<span class="lineNum">     156 </span>            : &quot;## Source and Sink filters\n&quot;
<span class="lineNum">     157 </span>            : &quot;Source and sink filters do not need to be addressed by the filter name, specifying `src=` or `dst=` instead is enough. &quot;
<span class="lineNum">     158 </span>            : &quot;You can also use the syntax `-src URL` or `-i URL` for sources and `-dst URL` or `-o URL` for destination, this allows prompt completion in shells.\n&quot;
<span class="lineNum">     159 </span>            : &quot;EX \&quot;src=file.mp4\&quot; or \&quot;-src file.mp4\&quot; or  \&quot;-i file.mp4\&quot;\n&quot;
<span class="lineNum">     160 </span>            : &quot;This will find a filter (for example `fin`) able to load `file.mp4`. The same result can be achieved by using `fin:src=file.mp4`.\n&quot;
<span class="lineNum">     161 </span>            : &quot;EX \&quot;dst=dump.yuv\&quot; or \&quot;-dst dump.yuv\&quot; or \&quot;-o dump.yuv\&quot;\n&quot;
<span class="lineNum">     162 </span>            : &quot;This will dump the video content in `dump.yuv`. The same result can be achieved by using `fout:dst=dump.yuv`.\n&quot;
<span class="lineNum">     163 </span>            : &quot;\n&quot;
<span class="lineNum">     164 </span>            : &quot;Specific source or sink filters may also be specified using `filterName:src=URL` or `filterName:dst=URL`.\n&quot;
<span class="lineNum">     165 </span>            : &quot;\n&quot;
<span class="lineNum">     166 </span>            : &quot;The `src=` and `dst=` syntaxes can also be used in alias for dynamic argument cloning (see `gpac -hx alias`).\n&quot;
<span class="lineNum">     167 </span>            : &quot;\n&quot;
<span class="lineNum">     168 </span>            : &quot;## Forcing specific filters\n&quot;
<span class="lineNum">     169 </span>            : &quot;There is a special option called `gfreg` which allows specifying preferred filters to use when handling URLs.\n&quot;
<span class="lineNum">     170 </span>            : &quot;EX src=file.mp4:gfreg=ffdmx,ffdec\n&quot;
<span class="lineNum">     171 </span>            : &quot;This will use __ffdmx__ to read `file.mp4` and __ffdec__ to decode it.\n&quot;
<span class="lineNum">     172 </span>            : &quot;This can be used to test a specific filter when alternate filter chains are possible.\n&quot;
<span class="lineNum">     173 </span>            : &quot;## Specifying encoders and decoders\n&quot;
<span class="lineNum">     174 </span>            : &quot;By default filters chain will be resolved without any decoding/encoding if the destination accepts the desired format. &quot;
<span class="lineNum">     175 </span>            : &quot;Otherwise, decoders/encoders will be dynamically loaded to perform the conversion, unless dynamic resolution is disabled. &quot;
<span class="lineNum">     176 </span>            : &quot;There is a special shortcut filter name for encoders `enc` allowing to match a filter providing the desired encoding. &quot;
<span class="lineNum">     177 </span>            : &quot;The parameters for `enc` are:\n&quot;
<span class="lineNum">     178 </span>            : &quot;- c=NAME: identifies the desired codec. `NAME` can be the GPAC codec name or the encoder instance for ffmpeg/others\n&quot;
<span class="lineNum">     179 </span>            : &quot;- b=UINT, rate=UINT, bitrate=UINT: indicates the bitrate in bits per second\n&quot;
<span class="lineNum">     180 </span>            : &quot;- g=UINT, gop=UINT: indicates the GOP size in frames\n&quot;
<span class="lineNum">     181 </span>            : &quot;- pfmt=NAME: indicates the target pixel format name (see [properties (-h props)](filters_properties) ) of the source, if supported by codec\n&quot;
<span class="lineNum">     182 </span>            : &quot;- all_intra=BOOL: indicates all frames should be intra frames, if supported by codec\n&quot;
<span class="lineNum">     183 </span>            : &quot;\n  \nOther options will be passed to the filter if it accepts generic argument parsing (as is the case for ffmpeg).\n&quot;
<span class="lineNum">     184 </span>            : &quot;EX src=dump.yuv:size=320x240:fps=25 enc:c=avc:b=150000:g=50:cgop=true:fast=true dst=raw.264\n&quot;
<span class="lineNum">     185 </span>            : &quot;This creates a 25 fps AVC at 175kbps with a gop duration of 2 seconds, using closed gop and fast encoding settings for ffmpeg.\n&quot;
<span class="lineNum">     186 </span>            : &quot;\n&quot;
<span class="lineNum">     187 </span>            : &quot;The inverse operation (forcing a decode to happen) is possible using the __reframer__ filter.\n&quot;
<span class="lineNum">     188 </span>            : &quot;EX src=file.mp4 reframer:raw=av @ -o null\n&quot;
<span class="lineNum">     189 </span>            : &quot;This will force decoding media from `file.mp4` and trash (send to `null`) the result (doing a decoder benchmark for example).\n&quot;
<span class="lineNum">     190 </span>            : &quot;\n&quot;
<span class="lineNum">     191 </span>            : &quot;When a filter uses an option defined as a string using the same separator character as gpac, you can either &quot;
<span class="lineNum">     192 </span>            : &quot;modify the set of separators, or escape the separator by duplicating it. The options enclosed by duplicated &quot;
<span class="lineNum">     193 </span>            : &quot;separator are not parsed. This is mostly used for meta filters, such as ffmpeg, to pass options to sub-filters &quot;
<span class="lineNum">     194 </span>            : &quot;such as libx264 (cf `x264opts` parameter).\n&quot;
<span class="lineNum">     195 </span>            : &quot;EX f:a=foo:b=bar\n&quot;
<span class="lineNum">     196 </span>            : &quot;This will set option `a` to `foo` and option `b` to `bar` on the filter.\n&quot;
<span class="lineNum">     197 </span>            : &quot;EX f::a=foo:b=bar\n&quot;
<span class="lineNum">     198 </span>            : &quot;This will set option `a` to `foo:b=bar` on the filter.\n&quot;
<span class="lineNum">     199 </span>            : &quot;EX f:a=foo::b=bar:c::d=fun\n&quot;
<span class="lineNum">     200 </span>            : &quot;This will set option `a` to `foo`, `b` to `bar:c` and the option `d` to `fun` on the filter.\n&quot;
<span class="lineNum">     201 </span>            : &quot;# Explicit links between filters [__LINK__]\n&quot;
<span class="lineNum">     202 </span>            : &quot;\n&quot;
<span class="lineNum">     203 </span>            : &quot;## Quick links\n&quot;
<span class="lineNum">     204 </span>            : &quot;Link between filters may be manually specified. The syntax is an `@` character optionally followed by an integer (0 if omitted). &quot;
<span class="lineNum">     205 </span>            : &quot;This indicates that the following filter specified at prompt should be linked only to a previous listed filter.\n&quot;
<span class="lineNum">     206 </span>            : &quot;The optional integer is a 0-based index to the previous filter declarations, 0 indicating the previous filter declaration, 1 the one before the previous declaration, ...).\n&quot;
<span class="lineNum">     207 </span>            : &quot;If `@@` is used instead of `@`, the optional integer gives the filter index starting from the first filter specified in command line.\n&quot;
<span class="lineNum">     208 </span>            : &quot;Several link directives can be given for a filter.\n&quot;
<span class="lineNum">     209 </span>            : &quot;EX fA fB @1 fC\n&quot;
<span class="lineNum">     210 </span>            : &quot;This indicates that `fC` only accepts inputs from `fA`.\n&quot;
<span class="lineNum">     211 </span>            : &quot;EX fA fB fC @1 @0 fD\n&quot;
<span class="lineNum">     212 </span>            : &quot;This indicates that `fD` only accepts inputs from `fB` and `fC`.\n&quot;
<span class="lineNum">     213 </span>            : &quot;EX fA fB fC ... @@1 fZ\n&quot;
<span class="lineNum">     214 </span>            : &quot;This indicates that `fZ` only accepts inputs from `fB`.\n&quot;
<span class="lineNum">     215 </span>            : &quot;\nIf no link directives are given, the links will be dynamically solved to fulfill as many connections as possible (__see below__).\n&quot;
<span class="lineNum">     216 </span>            : &quot;Warning: This means that `fA fB fC` and `fA fB @ fC` will likely not give the same result.\n&quot;
<span class="lineNum">     217 </span>            : &quot;\n&quot;
<span class="lineNum">     218 </span>            : &quot;## Complex links\n&quot;
<span class="lineNum">     219 </span>            : &quot;The link directive is just a quick shortcut to set the following arguments:\n&quot;
<span class="lineNum">     220 </span>            : &quot;- FID=name, which assigns an identifier to the filter\n&quot;
<span class="lineNum">     221 </span>            : &quot;- SID=name1[,name2...], which set a list of filter identifiers , or __sourceIDs__, restricting the list of possible inputs for a filter.\n&quot;
<span class="lineNum">     222 </span>            : &quot;\n&quot;
<span class="lineNum">     223 </span>            : &quot;EX fA fB @1 fC\n&quot;
<span class="lineNum">     224 </span>            : &quot;This is equivalent to `fA:FID=1 fB fC:SID=1`.\n&quot;
<span class="lineNum">     225 </span>            : &quot;Link directives specify which source a filter can accept connections from. They do not specify which destination a filter can connect to.\n&quot;
<span class="lineNum">     226 </span>            : &quot;EX fA:FID=1 fB fC:SID=1\n&quot;
<span class="lineNum">     227 </span>            : &quot;This indicates that `fC` only accepts input from `fA`, but `fB` might accept inputs from `fA`.\n&quot;
<span class="lineNum">     228 </span>            : &quot;EX fA:FID=1 fB:FID=2 fC:SID=1 fD:SID=1,2\n&quot;
<span class="lineNum">     229 </span>            : &quot;This indicates that `fD` only accepts input from `fA` and `fB` and `fC` only from `fA`\n&quot;
<span class="lineNum">     230 </span>            : &quot;Note: A filter with sourceID set cannot get input from filters with no IDs.\n&quot;
<span class="lineNum">     231 </span>            : &quot;A sourceID name can be further extended using fragment identifier (`#` by default):\n&quot;
<span class="lineNum">     232 </span>            : &quot;- name#PIDNAME: accepts only PID(s) with name `PIDNAME`\n&quot;
<span class="lineNum">     233 </span>            : &quot;- name#TYPE: accepts only PIDs of matching media type. TYPE can be `audio`, `video`, `scene`, `text`, `font`, `meta`\n&quot;
<span class="lineNum">     234 </span>            : &quot;- name#TYPEN: accepts only `N` (1-based index) PID of matching type from source (eg `video2` to only accept second video PID)\n&quot;
<span class="lineNum">     235 </span>            : &quot;- name#TAG=VAL: accepts the PID if its parent filter has no tag or a tag matching `VAL`\n&quot;
<span class="lineNum">     236 </span>            : &quot;- name#P4CC=VAL: accepts only PIDs with property matching `VAL`.\n&quot;
<span class="lineNum">     237 </span>            : &quot;- name#PName=VAL: same as above, using the builtin name corresponding to the property.\n&quot;
<span class="lineNum">     238 </span>            : &quot;- name#AnyName=VAL: same as above, using the name of a non built-in property.\n&quot;
<span class="lineNum">     239 </span>            : &quot;- name#Name=OtherPropName: compares the value with the value of another property of the PID. The matching will fail if the value to compare to is not present or different from the value to check. The property to compare with shall be a built-in property.\n&quot;
<span class="lineNum">     240 </span>            : &quot;If the property is not defined on the PID, the property is matched. Otherwise, its value is checked against the given value.\n&quot;
<span class="lineNum">     241 </span>            : &quot;\n&quot;
<span class="lineNum">     242 </span>            : &quot;The following modifiers for comparisons are allowed (for any fragment format using `=`):\n&quot;
<span class="lineNum">     243 </span>            : &quot;- name#P4CC=!VAL: accepts only PIDs with property NOT matching `VAL`.\n&quot;
<span class="lineNum">     244 </span>            : &quot;- name#P4CC-VAL: accepts only PIDs with property strictly less than `VAL` (only for 1-dimension number properties).\n&quot;
<span class="lineNum">     245 </span>            : &quot;- name#P4CC+VAL: accepts only PIDs with property strictly greater than `VAL` (only for 1-dimension number properties).\n&quot;
<span class="lineNum">     246 </span>            : &quot;\n&quot;
<span class="lineNum">     247 </span>            : &quot;A sourceID name can also use wildcard or be empty to match a property regardless of the source filter.\n&quot;
<span class="lineNum">     248 </span>            : &quot;EX fA fB:SID=*#ServiceID=2\n&quot;
<span class="lineNum">     249 </span>            : &quot;EX fA fB:SID=#ServiceID=2\n&quot;
<span class="lineNum">     250 </span>            : &quot;This indicates to match connection between `fA` and `fB` only for PIDs with a `ServiceID` property of `2`.\n&quot;
<span class="lineNum">     251 </span>            : &quot;These extensions also work with the __LINK__ `@` shortcut.\n&quot;
<span class="lineNum">     252 </span>            : &quot;EX fA fB @1#video fC\n&quot;
<span class="lineNum">     253 </span>            : &quot;This indicates that `fC` only accepts inputs from `fA`, and of type video.\n&quot;
<span class="lineNum">     254 </span>            : &quot;EX src=img.heif @#ItemID=200 vout\n&quot;
<span class="lineNum">     255 </span>            : &quot;This indicates to connect to `vout` only PIDs with `ItemID` property equal to `200`.\n&quot;
<span class="lineNum">     256 </span>            : &quot;EX src=vid.mp4 @#PID=1 vout\n&quot;
<span class="lineNum">     257 </span>            : &quot;This indicates to connect to `vout` only PIDs with `ID` property equal to `1`.\n&quot;
<span class="lineNum">     258 </span>            : &quot;EX src=vid.mp4 @#Width=640 vout\n&quot;
<span class="lineNum">     259 </span>            : &quot;This indicates to connect to `vout` only PIDs with `Width` property equal to `640`.\n&quot;
<span class="lineNum">     260 </span>            : &quot;EX src=vid.mp4 @#Width-640 vout\n&quot;
<span class="lineNum">     261 </span>            : &quot;This indicates to connect to `vout` only PIDs with `Width` property less than `640`\n&quot;
<span class="lineNum">     262 </span>            : &quot;EX src=vid.mp4 @#ID=ItemID#ItemNumber=1 vout\n&quot;
<span class="lineNum">     263 </span>            : &quot;This will connect to `vout` only PID with an ID property equal to ItemID property (keep items, discard tracks) and an Item number of 1 (first item).\n&quot;
<span class="lineNum">     264 </span>            : &quot;\n&quot;
<span class="lineNum">     265 </span>            : &quot;Multiple fragment can be specified to check for multiple PID properties.\n&quot;
<span class="lineNum">     266 </span>            : &quot;EX src=vid.mp4 @#Width=640#Height+380 vout\n&quot;
<span class="lineNum">     267 </span>            : &quot;This indicates to connect to `vout` only PIDs with `Width` property equal to `640` and `Height` greater than `380`.\n&quot;
<span class="lineNum">     268 </span>            : &quot;\n&quot;
<span class="lineNum">     269 </span>            : &quot;Warning: If a filter PID gets connected to an explicitly loaded filter, no further dynamic link resolution will &quot;
<span class="lineNum">     270 </span>            : &quot;be done to connect it to other filters, unless sourceIDs are set. Link directives should be carefully setup.\n&quot;
<span class="lineNum">     271 </span>            : &quot;EX src=video.264.mp4 @ reframer dst=dump.mp4\n&quot;
<span class="lineNum">     272 </span>            : &quot;This will link src `file.mp4` PID (type `file`) to dst `dump.mp4` filter (type `file`) because dst has no sourceID and therefore will &quot;
<span class="lineNum">     273 </span>            : &quot;accept input from src. Since the PID is connected, the filter engine will not try to solve &quot;
<span class="lineNum">     274 </span>            : &quot;a link between src and `reframer`. The result is a direct copy of the source file, `reframer` being unused.\n&quot;
<span class="lineNum">     275 </span>            : &quot;EX src=file.mp4 reframer @ dst=dump.mp4\n&quot;
<span class="lineNum">     276 </span>            : &quot;This will force dst to accept only from reframer, a muxer will be loaded to solve this link, and &quot;
<span class="lineNum">     277 </span>            : &quot;src PID will be linked to `reframer` (no source ID), loading a demuxer to solve the link. The result is a complete remultiplexing of the source file.\n&quot;
<span class="lineNum">     278 </span>            : &quot;\n&quot;
<span class="lineNum">     279 </span>            : &quot;Note: the linker will prevent cycles in the graph, and a given filter can never have the same PID connected twice as an input, whether directly or through a filter chain.\n&quot;
<span class="lineNum">     280 </span>            : &quot;# Arguments inheriting\n&quot;
<span class="lineNum">     281 </span>            : &quot;Unless explicitly disabled (see [-max-chain](CORE)), the filter engine will resolve implicit or explicit (__LINK__) connections &quot;
<span class="lineNum">     282 </span>            : &quot;between filters and will allocate any filter chain required to connect the filters. &quot;
<span class="lineNum">     283 </span>            : &quot;In doing so, it loads new filters with arguments inherited from both the source and the destination.\n&quot;
<span class="lineNum">     284 </span>            : &quot;EX src=file.mp4:OPT dst=file.aac dst=file.264\n&quot;
<span class="lineNum">     285 </span>            : &quot;This will pass the `:OPT` to all filters loaded between the source and the two destinations.\n&quot;
<span class="lineNum">     286 </span>            : &quot;EX src=file.mp4 dst=file.aac:OPT dst=file.264\n&quot;
<span class="lineNum">     287 </span>            : &quot;This will pass the `:OPT` to all filters loaded between the source and the file.aac destination.\n&quot;
<span class="lineNum">     288 </span>            : &quot;Note: the destination arguments inherited are the arguments placed **AFTER** the `dst=` option.\n&quot;
<span class="lineNum">     289 </span>            : &quot;EX src=file.mp4 fout:OPTFOO:dst=file.aac:OPTBAR\n&quot;
<span class="lineNum">     290 </span>            : &quot;This will pass the `:OPTBAR` to all filters loaded between `file.mp4` source and `file.aac` destination, but not `OPTFOO`.\n&quot;
<span class="lineNum">     291 </span>            : &quot;Arguments inheriting can be stopped by using the keyword `gfloc`: arguments after the keyword will not be inherited.\n&quot;
<span class="lineNum">     292 </span>            : &quot;EX src=file.mp4 dst=file.aac:OPTFOO:gfloc:OPTBAR dst=file.264\n&quot;
<span class="lineNum">     293 </span>            : &quot;This will pass `:OPTFOO` to all filters loaded between `file.mp4` source and `file.aac` destination, but not `OPTBAR`\n&quot;
<span class="lineNum">     294 </span>            : &quot;Arguments are by default tracked to check if they were used by the filter chain, and a warning is thrown if this is not the case.\n&quot;
<span class="lineNum">     295 </span>            : &quot;It may be useful to specify arguments which may not be consumed depending on the graph resolution; the specific keyword `gfopt` indicates that arguments after the keyword will not be tracked.\n&quot;
<span class="lineNum">     296 </span>            : &quot;EX src=file.mp4 dst=file.aac:OPTFOO:gfopt:OPTBAR dst=file.264\n&quot;
<span class="lineNum">     297 </span>            : &quot;This will warn if `OPTFOO` is not consumed, but will not track `OPTBAR`.\n&quot;
<span class="lineNum">     298 </span>            : &quot;# URL templating\n&quot;
<span class="lineNum">     299 </span>            : &quot;Destination URLs can be templated using the same mechanism as MPEG-DASH, where `$KEYWORD$` is replaced in the template with the &quot;
<span class="lineNum">     300 </span>            : &quot;resolved value and `$KEYWORD%%0Nd$` is replaced in the template with the resolved integer, padded with up to N zeros if needed.\n&quot;
<span class="lineNum">     301 </span>            : &quot;`KEYWORD` is **case sensitive**, and may be present multiple times in the string. Supported `KEYWORD`:\n&quot;
<span class="lineNum">     302 </span>            : &quot;- num: replaced by file number if defined, 0 otherwise\n&quot;
<span class="lineNum">     303 </span>            : &quot;- PID: ID of the source PID\n&quot;
<span class="lineNum">     304 </span>            : &quot;- URL: URL of source file\n&quot;
<span class="lineNum">     305 </span>            : &quot;- File: path on disk for source file; if not found, use URL if set, or PID name otherwise\n&quot;
<span class="lineNum">     306 </span>            : &quot;- Type: name of stream type of PID (`video`, `audio` ...)\n&quot;
<span class="lineNum">     307 </span>            : &quot;- p4cc=ABCD: uses PID property with 4CC value `ABCD`\n&quot;
<span class="lineNum">     308 </span>            : &quot;- pname=VAL: uses PID property with name `VAL`\n&quot;
<span class="lineNum">     309 </span>            : &quot;- OTHER: locates property 4CC for the given name, or property name if no 4CC matches.\n&quot;
<span class="lineNum">     310 </span>            : &quot;  \n&quot;
<span class="lineNum">     311 </span>            : &quot;`$$` is an escape for $\n&quot;
<span class="lineNum">     312 </span>            : &quot;\n&quot;
<span class="lineNum">     313 </span>            : &quot;Templating can be useful when encoding several qualities in one pass.\n&quot;
<span class="lineNum">     314 </span>            : &quot;EX src=dump.yuv:size=640x360 vcrop:wnd=0x0x320x180 enc:c=avc:b=1M @2 enc:c=avc:b=750k dst=dump_$CropOrigin$x$Width$x$Height$.264:clone\n&quot;
<span class="lineNum">     315 </span>            : &quot;This will create a cropped version of the source, encoded in AVC at 1M, and a full version of the content in AVC at 750k. &quot;
<span class="lineNum">     316 </span>            : &quot;Outputs will be `dump_0x0x320x180.264` for the cropped version and `dump_0x0x640x360.264` for the non-cropped one.\n&quot;
<span class="lineNum">     317 </span>            : &quot;# Cloning filters\n&quot;
<span class="lineNum">     318 </span>            : &quot;When a filter accepts a single connection and has a connected input, it is no longer available for dynamic resolution. &quot;
<span class="lineNum">     319 </span>            : &quot;There may be cases where this behavior is undesired. Take a HEIF file with N items and do:\n&quot;
<span class="lineNum">     320 </span>            : &quot;EX src=img.heif dst=dump_$ItemID$.jpg\n&quot;
<span class="lineNum">     321 </span>            : &quot;In this case, only one item (likely the first declared in the file) will connect to the destination.\n&quot;
<span class="lineNum">     322 </span>            : &quot;Other items will not be connected since the destination only accepts one input PID.\n&quot;
<span class="lineNum">     323 </span>            : &quot;There is a special option `clone` allowing filters to be cloned with the same arguments. The cloned filters have the same ID as the original one.\n&quot;
<span class="lineNum">     324 </span>            : &quot;EX src=img.heif dst=dump_$ItemID$.jpg:clone\n&quot;
<span class="lineNum">     325 </span>            : &quot;In this case, the destination will be cloned for each item, and all will be exported to different JPEGs thanks to URL templating.\n&quot;
<span class="lineNum">     326 </span>            : &quot;EX src=vid.mpd enc:c=avc:FID=1:clone dst=transcode.mpd:SID=1\n&quot;
<span class="lineNum">     327 </span>            : &quot;In this case, the encoder will be cloned for each video PIDs in the source, and the destination will only use PIDs coming from the encoders.\n&quot;
<span class="lineNum">     328 </span>            : &quot;# Templating filter chains\n&quot;
<span class="lineNum">     329 </span>            : &quot;There can be cases where the number of desired outputs depends on the source content, for example dumping a multiplex of N services into N files. When the destination involves multiplexing the input PIDs, the `:clone` option is not enough since the muxer will always accept the input PIDs.\n&quot;
<span class="lineNum">     330 </span>            : &quot;To handle this, it is possible to use a PID property name in the sourceID of a filter with the value `*` or an empty value. In this case, whenever a new PID with a new value for the property is found, the filter with such sourceID will be dynamically cloned.\n&quot;
<span class="lineNum">     331 </span>            : &quot;Warning: This feature should only be called with a single property set to `*` (or empty) per source ID, results are undefined otherwise.\n&quot;
<span class="lineNum">     332 </span>            : &quot;EX src=source.ts dst=file_$ServiceID$.mp4:SID=*#ServiceID=*\n&quot;
<span class="lineNum">     333 </span>            : &quot;EX src=source.ts dst=file_$ServiceID$.mp4:SID=#ServiceID=\n&quot;
<span class="lineNum">     334 </span>            : &quot;In this case, each new `ServiceID` value found when connecting PIDs to the destination will create a new destination file.\n&quot;
<span class="lineNum">     335 </span>            : &quot;# Assigning PID properties\n&quot;
<span class="lineNum">     336 </span>            : &quot;It is possible to define properties on output PIDs that will be declared by a filter. This allows tagging parts of the &quot;
<span class="lineNum">     337 </span>            : &quot;graph with different properties than other parts (for example `ServiceID`). &quot;
<span class="lineNum">     338 </span>            : &quot;The syntax is the same as filter option, and uses the fragment separator to identify properties, eg `#Name=Value`.\n&quot;
<span class="lineNum">     339 </span>            : &quot;This sets output PIDs property (4cc, built-in name or any name) to the given value. Value can be omitted for boolean &quot;
<span class="lineNum">     340 </span>            : &quot;(defaults to true, eg `:#Alpha`).\n&quot;
<span class="lineNum">     341 </span>            : &quot;Non built-in properties are parsed as follows:\n&quot;
<span class="lineNum">     342 </span>            : &quot;- `file@FOO` will be declared as string with a value set to the content of `FOO`.\n&quot;
<span class="lineNum">     343 </span>            : &quot;- `bxml@FOO` will be declared as data with a value set to the binarized content of `FOO`.\n&quot;
<span class="lineNum">     344 </span>            : &quot;- `FOO` will be declared as string with a value set to `FOO`.\n&quot;
<span class="lineNum">     345 </span>            : &quot;- `TYPE@FOO` will be parsed according to `TYPE`. If the type is not recognized, the entire value is copied as string. See `gpac -h props` for defined types.\n&quot;
<span class="lineNum">     346 </span>            : &quot;\n&quot;
<span class="lineNum">     347 </span>            : &quot;User-assigned PID properties on filter `fA` will be inherited by all filters dynamically loaded to solve `fA -&gt; fB` connection.\n&quot;
<span class="lineNum">     348 </span>            : &quot;If `fB` also has user-assigned PID properties, these only apply starting from `fB` in the chain and are not inherited by filters between `fA` and `fB`.\n&quot;
<span class="lineNum">     349 </span>            : &quot;\n&quot;
<span class="lineNum">     350 </span>            : &quot;Warning: Properties are not filtered and override the properties of the filter's output PIDs, be careful not to break &quot;
<span class="lineNum">     351 </span>            : &quot;the session by overriding core properties such as width/height/samplerate/... !\n&quot;
<span class="lineNum">     352 </span>            : &quot;EX -i v1.mp4:#ServiceID=4 -i v2.mp4:#ServiceID=2 -o dump.ts\n&quot;
<span class="lineNum">     353 </span>            : &quot;This will mux the streams in `dump.ts`, using `ServiceID` 4 for PIDs from `v1.mp4` and `ServiceID` 2 for PIDs from `v2.mp4`.\n&quot;
<span class="lineNum">     354 </span>            : &quot;\n&quot;
<span class="lineNum">     355 </span>            : &quot;PID properties may be conditionally assigned by checking other PID properties. The syntax uses parenthesis (not configurable) after the property assignment sign:\n&quot;
<span class="lineNum">     356 </span>            : &quot;`#Prop=(CP=CV)VAL`\n&quot;
<span class="lineNum">     357 </span>            : &quot;This will assign PID property `Prop` to `VAL` for PIDs with property `CP` equal to `CV`.\n&quot;
<span class="lineNum">     358 </span>            : &quot;`#Prop=(CP=CV)VAL,(CP2=CV2)VAL2`\n&quot;
<span class="lineNum">     359 </span>            : &quot;This will assign PID property `Prop` to `VAL` for PIDs with property `CP` equal to `CV`, and to `VAL2` for PIDs with property `CP2` equal to `CV2`.\n&quot;
<span class="lineNum">     360 </span>            : &quot;`#Prop=(CP=CV)(CP2=CV2)VAL`\n&quot;
<span class="lineNum">     361 </span>            : &quot;This will assign PID property `Prop` to `VAL` for PIDs with property `CP` equal to `CV` and property `CP2` equal to `CV2`.\n&quot;
<span class="lineNum">     362 </span>            : &quot;`#Prop=(CP=CV)VAL,()DEFAULT`\n&quot;
<span class="lineNum">     363 </span>            : &quot;This will assign PID property `Prop` to `VAL` for PIDs with property `CP` equal to `CV`, or to `DEFAULT` for other PIDs.\n&quot;
<span class="lineNum">     364 </span>            : &quot;The condition syntax is the same as source ID fragment syntax.\n&quot;
<span class="lineNum">     365 </span>            : &quot;Note: When set, the default value (empty condition) always matches the PID, therefore it should be placed last in the list of conditions.\n&quot;
<span class="lineNum">     366 </span>            : &quot;EX gpac -i source.mp4:#MyProp=(audio)\&quot;Super Audio\&quot;,(video)\&quot;Super Video\&quot;\n&quot;
<span class="lineNum">     367 </span>            : &quot;This will assign property `MyProp` to `Super Audio` for audio PIDs and to `Super Video` for video PIDs.\n&quot;
<span class="lineNum">     368 </span>            : &quot;EX gpac -i source.mp4:#MyProp=(audio1)\&quot;Super Audio\&quot;\n&quot;
<span class="lineNum">     369 </span>            : &quot;This will assign property `MyProp` to `Super Audio` for first audio PID declared.\n&quot;
<span class="lineNum">     370 </span>            : &quot;EX gpac -i source.mp4:#MyProp=(Width+1280)HD\n&quot;
<span class="lineNum">     371 </span>            : &quot;This will assign property `MyProp` to `HD` for PIDs with property `Width` greater than 1280.\n&quot;
<span class="lineNum">     372 </span>            : &quot;# Using option files\n&quot;
<span class="lineNum">     373 </span>            : &quot;It is possible to use a file to define options of a filter, by specifying the target file name as an option without value, i.e. `:myopts.txt`.\n&quot;
<span class="lineNum">     374 </span>            : &quot;Warning: Only local files are allowed.\n&quot;
<span class="lineNum">     375 </span>            : &quot;An option file is a simple text file containing one or more options or PID properties on one or more lines.\n&quot;
<span class="lineNum">     376 </span>            : &quot;A line beginning with \&quot;//\&quot; is a comment and is ignored.\n&quot;
<span class="lineNum">     377 </span>            : &quot;Options in an option file may point to other option files, with a maximum redirection level of 5.\n&quot;
<span class="lineNum">     378 </span>            : &quot;An option file declaration (`filter:myopts.txt`) follows the same inheritance rules as regular options.\n&quot;
<span class="lineNum">     379 </span>            : &quot;EX src=source.mp4:myopts.txt:foo=bar dst\n&quot;
<span class="lineNum">     380 </span>            : &quot;Any filter loaded between `source.mp4` and `dst` will inherit both `myopts.txt` and `foo` options and will resolve options and PID properties given in `myopts.txt`.\n&quot;
<span class="lineNum">     381 </span>            : &quot;# Specific filter options\n&quot;
<span class="lineNum">     382 </span>            : &quot;Some specific keywords are replaced when processing filter options.\n&quot;
<span class="lineNum">     383 </span>            : &quot;Warning: These keywords do not apply to PID properties. Multiple keywords cannot be defined for a single option.\n&quot;
<span class="lineNum">     384 </span>            : &quot;Defined keywords:\n&quot;
<span class="lineNum">     385 </span>            : &quot;- $GSHARE: replaced by system path to GPAC shared directory (e.g. /usr/share/gpac)\n&quot;
<span class="lineNum">     386 </span>            : &quot;- $GJS: replaced by the first path from global share directory and paths set through [-js-dirs](CORE) that contains the file name following the macro, e.g. $GJS/source.js\n&quot;
<span class="lineNum">     387 </span>            : &quot;- $GLANG: replaced by the global config language option [-lang](CORE)\n&quot;
<span class="lineNum">     388 </span>            : &quot;- $GUA: replaced by the global config user agent option [-user-agent](CORE)\n&quot;
<span class="lineNum">     389 </span>            : &quot;- $GINC(init_val[,inc]): replaced by `init_val` and increment `init_val` by `inc` (positive or negative number, 1 if not specified) each time a new filter using this string is created.\n&quot;
<span class="lineNum">     390 </span>            : &quot;\n&quot;
<span class="lineNum">     391 </span>            : &quot;The $GINC construct can be used to dynamically assign numbers in filter chains:\n&quot;
<span class="lineNum">     392 </span>            : &quot;EX gpac -i source.ts tssplit @#ServiceID= -o dump_$GINC(10,2).ts\n&quot;
<span class="lineNum">     393 </span>            : &quot;This will dump first service in dump_10.ts, second service in dump_12.ts, etc...\n&quot;
<span class="lineNum">     394 </span>            : &quot;# External filters\n&quot;
<span class="lineNum">     395 </span>            : &quot;GPAC comes with a set of built-in filters in libgpac. It may also load external filters in dynamic libraries, located in &quot;
<span class="lineNum">     396 </span>            : &quot;default module folder or folders listed in [-mod-dirs](CORE) option. The files shall be named `gf_*` and shall export&quot;
<span class="lineNum">     397 </span>            : &quot; a single function `RegisterFilter` returning a filter register - see [libgpac documentation](https://doxygen.gpac.io/) for more details.\n&quot;
<span class="lineNum">     398 </span>            : &quot;\n&quot;;
<a name="399"><span class="lineNum">     399 </span>            : #endif</a>
<span class="lineNum">     400 </span>            : 
<span class="lineNum">     401 </span><span class="lineCov">          1 : static void gpac_filter_help(void)</span>
<span class="lineNum">     402 </span>            : {
<span class="lineNum">     403 </span><span class="lineCov">          1 :         gf_sys_format_help(helpout, help_flags,</span>
<span class="lineNum">     404 </span>            : &quot;Usage: gpac [options] FILTER [LINK] FILTER [...] \n&quot;
<span class="lineNum">     405 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">     406 </span>            :         &quot;%s&quot;, gf_sys_localized(&quot;gpac&quot;, &quot;doc&quot;, gpac_doc)
<span class="lineNum">     407 </span>            : #else
<span class="lineNum">     408 </span>            :         &quot;GPAC compiled without built-in doc.\n&quot;
<span class="lineNum">     409 </span>            : #endif
<span class="lineNum">     410 </span>            :         );
<span class="lineNum">     411 </span>            : 
<span class="lineNum">     412 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">     413 </span>            : 
<span class="lineNum">     414 </span>            : #include &lt;gpac/modules/video_out.h&gt;
<span class="lineNum">     415 </span>            : #include &lt;gpac/modules/audio_out.h&gt;
<span class="lineNum">     416 </span>            : #include &lt;gpac/modules/compositor_ext.h&gt;
<span class="lineNum">     417 </span>            : #include &lt;gpac/modules/hardcoded_proto.h&gt;
<a name="418"><span class="lineNum">     418 </span>            : #include &lt;gpac/modules/font.h&gt;</a>
<span class="lineNum">     419 </span>            : 
<span class="lineNum">     420 </span><span class="lineCov">          1 : static void gpac_modules_help(void)</span>
<span class="lineNum">     421 </span>            : {
<span class="lineNum">     422 </span>            :         u32 i;
<span class="lineNum">     423 </span><span class="lineCov">          1 :         gf_sys_format_help(helpout, help_flags, &quot;Available modules:\n&quot;);</span>
<span class="lineNum">     424 </span><span class="lineCov">          8 :         for (i=0; i&lt;gf_modules_count(); i++) {</span>
<span class="lineNum">     425 </span><span class="lineCov">          7 :                 char *str = (char *) gf_modules_get_file_name(i);</span>
<span class="lineNum">     426 </span><span class="lineCov">          7 :                 if (!str) continue;</span>
<span class="lineNum">     427 </span><span class="lineCov">          7 :                 gf_sys_format_help(helpout, help_flags | GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s: implements &quot;, str);</span>
<span class="lineNum">     428 </span><span class="lineCov">          7 :                 if (!strncmp(str, &quot;gm_&quot;, 3) || !strncmp(str, &quot;gsm_&quot;, 4)) {</span>
<span class="lineNum">     429 </span><span class="lineCov">          7 :                         GF_BaseInterface *ifce = gf_modules_load_by_name(str, GF_VIDEO_OUTPUT_INTERFACE);</span>
<span class="lineNum">     430 </span><span class="lineCov">          7 :                         if (ifce) {</span>
<span class="lineNum">     431 </span><span class="lineCov">          2 :                                 gf_sys_format_help(helpout, help_flags, &quot;VideoOutput &quot;);</span>
<span class="lineNum">     432 </span><span class="lineCov">          2 :                                 gf_modules_close_interface(ifce);</span>
<span class="lineNum">     433 </span>            :                         }
<span class="lineNum">     434 </span><span class="lineCov">          7 :                         ifce = gf_modules_load_by_name(str, GF_AUDIO_OUTPUT_INTERFACE);</span>
<span class="lineNum">     435 </span><span class="lineCov">          7 :                         if (ifce) {</span>
<span class="lineNum">     436 </span><span class="lineCov">          4 :                                 gf_sys_format_help(helpout, help_flags, &quot;AudioOutput &quot;);</span>
<span class="lineNum">     437 </span><span class="lineCov">          4 :                                 gf_modules_close_interface(ifce);</span>
<span class="lineNum">     438 </span>            :                         }
<span class="lineNum">     439 </span><span class="lineCov">          7 :                         ifce = gf_modules_load_by_name(str, GF_FONT_READER_INTERFACE);</span>
<span class="lineNum">     440 </span><span class="lineCov">          7 :                         if (ifce) {</span>
<span class="lineNum">     441 </span><span class="lineCov">          1 :                                 gf_sys_format_help(helpout, help_flags, &quot;FontReader &quot;);</span>
<span class="lineNum">     442 </span><span class="lineCov">          1 :                                 gf_modules_close_interface(ifce);</span>
<span class="lineNum">     443 </span>            :                         }
<span class="lineNum">     444 </span><span class="lineCov">          7 :                         ifce = gf_modules_load_by_name(str, GF_COMPOSITOR_EXT_INTERFACE);</span>
<span class="lineNum">     445 </span><span class="lineCov">          7 :                         if (ifce) {</span>
<span class="lineNum">     446 </span><span class="lineCov">          1 :                                 gf_sys_format_help(helpout, help_flags, &quot;CompositorExtension &quot;);</span>
<span class="lineNum">     447 </span><span class="lineCov">          1 :                                 gf_modules_close_interface(ifce);</span>
<span class="lineNum">     448 </span>            :                         }
<span class="lineNum">     449 </span><span class="lineCov">          7 :                         ifce = gf_modules_load_by_name(str, GF_HARDCODED_PROTO_INTERFACE);</span>
<span class="lineNum">     450 </span><span class="lineCov">          7 :                         if (ifce) {</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :                                 gf_sys_format_help(helpout, help_flags, &quot;HardcodedProto &quot;);</span>
<span class="lineNum">     452 </span><span class="lineNoCov">          0 :                                 gf_modules_close_interface(ifce);</span>
<span class="lineNum">     453 </span>            :                         }
<span class="lineNum">     454 </span>            :                 } else {
<span class="lineNum">     455 </span><span class="lineNoCov">          0 :                         gf_sys_format_help(helpout, help_flags, &quot;Filter &quot;);</span>
<span class="lineNum">     456 </span>            :                 }
<span class="lineNum">     457 </span><span class="lineCov">          7 :                 gf_sys_format_help(helpout, help_flags, &quot;\n&quot;);</span>
<span class="lineNum">     458 </span>            :         }
<span class="lineNum">     459 </span><span class="lineCov">          1 :         gf_sys_format_help(helpout, help_flags, &quot;\n&quot;);</span>
<span class="lineNum">     460 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">     461 </span>            : 
<span class="lineNum">     462 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">     463 </span>            : const char *gpac_alias =
<span class="lineNum">     464 </span>            : &quot;The gpac command line can become quite complex when many sources or filters are used. In order to simplify this, an alias system is provided.\n&quot;
<span class="lineNum">     465 </span>            : &quot;\n&quot;
<span class="lineNum">     466 </span>            : &quot;To assign an alias, use the syntax `gpac -alias=\&quot;NAME VALUE\&quot;`.\n&quot;
<span class="lineNum">     467 </span>            : &quot;- `NAME`: shall be a single string, with no space.\n&quot;
<span class="lineNum">     468 </span>            : &quot;- `VALUE`: the list of argument this alias replaces. If not set, the alias is destroyed\n&quot;
<span class="lineNum">     469 </span>            : &quot;\n&quot;
<span class="lineNum">     470 </span>            : &quot;When parsing arguments, the alias will be replace by its value.\n&quot;
<span class="lineNum">     471 </span>            : &quot;EX gpac -alias=\&quot;output aout vout\&quot;\n&quot;
<span class="lineNum">     472 </span>            : &quot;This allows later audio and video playback using `gpac -i src.mp4 output`\n&quot;
<span class="lineNum">     473 </span>            : &quot;\n&quot;
<span class="lineNum">     474 </span>            : &quot;Aliases can use arguments from the command line. The allowed syntaxes are:\n&quot;
<span class="lineNum">     475 </span>            : &quot;- `@{a}`: replaced by the value of the argument with index `a` after the alias\n&quot;
<span class="lineNum">     476 </span>            : &quot;- `@{a,b}`: replaced by the value of the arguments with index `a` and `b`\n&quot;
<span class="lineNum">     477 </span>            : &quot;- `@{a:b}`: replaced by the value of the arguments between index `a` and `b`\n&quot;
<span class="lineNum">     478 </span>            : &quot;- `@{-a,b}`: replaced by the value of the arguments with index `a` and `b`, inserting a list separator (comma by default) between them\n&quot;
<span class="lineNum">     479 </span>            : &quot;- `@{-a:b}`: replaced by the value of the arguments between index `a` and `b`, inserting a list separator (comma by default) between them\n&quot;
<span class="lineNum">     480 </span>            : &quot;- `@{+a,b}`: clones the parent word in the alias for `a` and `b`, replacing this pattern in each clone by the corresponding argument\n&quot;
<span class="lineNum">     481 </span>            : &quot;- `@{+a:b}`: clones the parent word in the alias for each argument between index `a` and `b`, replacing this pattern in each clone by the corresponding argument\n&quot;
<span class="lineNum">     482 </span>            : &quot;\n&quot;
<span class="lineNum">     483 </span>            : &quot;The specified index can be:\n&quot;
<span class="lineNum">     484 </span>            : &quot;- forward index: a strictly positive integer, 1 being the first argument after the alias\n&quot;
<span class="lineNum">     485 </span>            : &quot;- backward index: the value 'n' (or 'N') to indicate the last argument on the command line. This can be followed by `-x` to rewind arguments (eg `@{n-1}` is the before last argument)\n&quot;
<span class="lineNum">     486 </span>            : &quot;\n&quot;
<span class="lineNum">     487 </span>            : &quot;Arguments not used by any aliases are kept on the command line, other ones are removed\n&quot;
<span class="lineNum">     488 </span>            : &quot;\n&quot;
<span class="lineNum">     489 </span>            : &quot;EX -alias=\&quot;foo src=@{N} dst=test.mp4\&quot;\n&quot;
<span class="lineNum">     490 </span>            : &quot;The command `gpac foo f1 f2` expands to `gpac src=f2 dst=test.mp4 f1`\n&quot;
<span class="lineNum">     491 </span>            : &quot;EX -alias=\&quot;list: inspect src=@{+:N}\&quot;\n&quot;
<span class="lineNum">     492 </span>            : &quot;The command `gpac list f1 f2 f3` expands to `gpac inspect src=f1 src=f2 src=f3`\n&quot;
<span class="lineNum">     493 </span>            : &quot;EX -alias=\&quot;list inspect src=@{+2:N}\&quot;\n&quot;
<span class="lineNum">     494 </span>            : &quot;The command `gpac list f1 f2 f3` expands to `gpac inspect src=f2 src=f3 f1`\n&quot;
<span class="lineNum">     495 </span>            : &quot;EX -alias=\&quot;plist aout vout flist:srcs=@{-,N}\&quot;\n&quot;
<span class="lineNum">     496 </span>            : &quot;The command `gpac plist f1 f2 f3` expands to `gpac aout vout flist:srcs=\&quot;f1,f2,f3\&quot;`  \n&quot;
<span class="lineNum">     497 </span>            : &quot;\n&quot;
<span class="lineNum">     498 </span>            : &quot;Alias documentation can be set using `gpac -aliasdoc=\&quot;NAME VALUE\&quot;`, with `NAME` the alias name and `VALUE` the documentation.\n&quot;
<span class="lineNum">     499 </span>            : &quot;Alias documentation will then appear in gpac help.\n&quot;
<span class="lineNum">     500 </span>            : &quot;\n&quot;;
<a name="501"><span class="lineNum">     501 </span>            : #endif</a>
<span class="lineNum">     502 </span>            : 
<span class="lineNum">     503 </span><span class="lineCov">          6 : static void gpac_alias_help(GF_SysArgMode argmode)</span>
<span class="lineNum">     504 </span>            : {
<span class="lineNum">     505 </span>            :         u32 i, count;
<span class="lineNum">     506 </span>            : 
<span class="lineNum">     507 </span><span class="lineCov">          6 :         if (argmode &gt;= GF_ARGMODE_EXPERT) {</span>
<span class="lineNum">     508 </span>            : 
<span class="lineNum">     509 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">     510 </span><span class="lineCov">          2 :                 gf_sys_format_help(helpout, help_flags, &quot;%s&quot;, gf_sys_localized(&quot;gpac&quot;, &quot;alias&quot;, gpac_alias) );</span>
<span class="lineNum">     511 </span>            : #else
<span class="lineNum">     512 </span>            :                 gf_sys_format_help(helpout, help_flags, &quot;%s&quot;, &quot;GPAC compiled without built-in doc.\n&quot;);
<span class="lineNum">     513 </span>            : #endif
<span class="lineNum">     514 </span><span class="lineCov">          2 :                 if (argmode == GF_ARGMODE_EXPERT) {</span>
<span class="lineNum">     515 </span>            :                         return;
<span class="lineNum">     516 </span>            :                 }
<span class="lineNum">     517 </span>            :         }
<span class="lineNum">     518 </span>            : 
<span class="lineNum">     519 </span><span class="lineCov">          4 :         count = gf_opts_get_key_count(&quot;gpac.alias&quot;);</span>
<span class="lineNum">     520 </span><span class="lineCov">          4 :         if (count) {</span>
<span class="lineNum">     521 </span><span class="lineCov">          4 :                 if (argmode &lt; GF_ARGMODE_EXPERT) {</span>
<span class="lineNum">     522 </span><span class="lineCov">          4 :                         gf_sys_format_help(helpout, help_flags, &quot;Available aliases (use 'gpac -hx alias' for more info on aliases):\n&quot;);</span>
<span class="lineNum">     523 </span>            :                 } else {
<span class="lineNum">     524 </span><span class="lineNoCov">          0 :                         gf_sys_format_help(helpout, help_flags, &quot;Available aliases:\n&quot;);</span>
<span class="lineNum">     525 </span>            :                 }
<span class="lineNum">     526 </span><span class="lineCov">         28 :                 for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">     527 </span><span class="lineCov">         28 :                         const char *alias = gf_opts_get_key_name(&quot;gpac.alias&quot;, i);</span>
<span class="lineNum">     528 </span><span class="lineCov">         28 :                         const char *alias_doc = gf_opts_get_key(&quot;gpac.aliasdoc&quot;, alias);</span>
<span class="lineNum">     529 </span><span class="lineCov">         28 :                         const char *alias_value = gf_opts_get_key(&quot;gpac.alias&quot;, alias);</span>
<span class="lineNum">     530 </span>            : 
<span class="lineNum">     531 </span><span class="lineCov">         28 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s&quot;, alias);</span>
<span class="lineNum">     532 </span><span class="lineCov">         28 :                         if (argmode&gt;=GF_ARGMODE_ADVANCED)</span>
<span class="lineNum">     533 </span><span class="lineCov">          7 :                                 gf_sys_format_help(helpout, help_flags, &quot; (%s)&quot;, alias_value);</span>
<span class="lineNum">     534 </span>            : 
<span class="lineNum">     535 </span><span class="lineCov">         28 :                         if (alias_doc)</span>
<span class="lineNum">     536 </span><span class="lineCov">         28 :                                 gf_sys_format_help(helpout, help_flags | GF_PRINTARG_OPT_DESC, &quot;: %s&quot;, gf_sys_localized(&quot;gpac&quot;, &quot;aliasdoc&quot;, alias_doc));</span>
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :                         else if  (argmode&lt;GF_ARGMODE_ADVANCED) {</span>
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :                                 gf_sys_format_help(helpout, help_flags, &quot; (%s)&quot;, alias_value);</span>
<span class="lineNum">     539 </span>            :                         }
<span class="lineNum">     540 </span>            : 
<span class="lineNum">     541 </span><span class="lineCov">         28 :                         gf_sys_format_help(helpout, help_flags, &quot;\n&quot;);</span>
<span class="lineNum">     542 </span>            :                 }
<span class="lineNum">     543 </span>            :         } else {
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :                 gf_sys_format_help(helpout, help_flags, &quot;No aliases defined - use 'gpac -hx alias' for more info on aliases\n&quot;);</span>
<span class="lineNum">     545 </span>            :         }
<span class="lineNum">     546 </span>            : }
<a name="547"><span class="lineNum">     547 </span>            : </a>
<span class="lineNum">     548 </span>            : 
<span class="lineNum">     549 </span><span class="lineCov">          6 : static void gpac_core_help(GF_SysArgMode mode, Bool for_logs)</span>
<span class="lineNum">     550 </span>            : {
<span class="lineNum">     551 </span>            :         u32 mask;
<span class="lineNum">     552 </span><span class="lineCov">          6 :         gf_sys_format_help(helpout, help_flags, &quot;# libgpac %s options:\n&quot;, for_logs ? &quot;logs&quot; : &quot;core&quot;);</span>
<span class="lineNum">     553 </span><span class="lineCov">          6 :         if (for_logs) {</span>
<span class="lineNum">     554 </span>            :                 mask = GF_ARG_SUBSYS_LOG;
<span class="lineNum">     555 </span>            :         } else {
<span class="lineNum">     556 </span>            :                 mask = 0xFFFFFFFF;
<span class="lineNum">     557 </span>            :                 mask &amp;= ~GF_ARG_SUBSYS_LOG;
<span class="lineNum">     558 </span>            :                 mask &amp;= ~GF_ARG_SUBSYS_FILTERS;
<span class="lineNum">     559 </span>            :         }
<span class="lineNum">     560 </span><span class="lineCov">          6 :         gf_sys_print_core_help(helpout, help_flags, mode, mask);</span>
<span class="lineNum">     561 </span><span class="lineCov">          6 : }</span>
<span class="lineNum">     562 </span>            : 
<span class="lineNum">     563 </span>            : static GF_GPACArg gpac_args[] =
<span class="lineNum">     564 </span>            : {
<span class="lineNum">     565 </span>            : #ifdef GPAC_MEMORY_TRACKING
<span class="lineNum">     566 </span>            :         GF_DEF_ARG(&quot;mem-track&quot;, NULL, &quot;enable memory tracker&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     567 </span>            :         GF_DEF_ARG(&quot;mem-track-stack&quot;, NULL, &quot;enable memory tracker with stack dumping&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     568 </span>            : #endif
<span class="lineNum">     569 </span>            :         GF_DEF_ARG(&quot;ltf&quot;, NULL, &quot;load test-unit filters (used for for unit tests only)&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     570 </span>            :         GF_DEF_ARG(&quot;sloop&quot;, NULL, &quot;loop execution of session, creating a session at each loop, mainly used for testing. If no value is given, loops forever&quot;, NULL, NULL, GF_ARG_INT, GF_ARG_HINT_EXPERT),
<span class="lineNum">     571 </span>            :         GF_DEF_ARG(&quot;runfor&quot;, NULL, &quot;run for the given amount of milliseconds&quot;, NULL, NULL, GF_ARG_INT, GF_ARG_HINT_EXPERT),
<span class="lineNum">     572 </span>            :         GF_DEF_ARG(&quot;runforx&quot;, NULL, &quot;run for the given amount of milliseconds and exit with no cleanup&quot;, NULL, NULL, GF_ARG_INT, GF_ARG_HINT_EXPERT),
<span class="lineNum">     573 </span>            : 
<span class="lineNum">     574 </span>            :         GF_DEF_ARG(&quot;stats&quot;, NULL, &quot;print stats after execution&quot;, NULL, NULL, GF_ARG_BOOL, 0),
<span class="lineNum">     575 </span>            :         GF_DEF_ARG(&quot;graph&quot;, NULL, &quot;print graph after execution&quot;, NULL, NULL, GF_ARG_BOOL, 0),
<span class="lineNum">     576 </span>            :         GF_DEF_ARG(&quot;k&quot;, NULL, &quot;enable keyboard interaction from command line&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     577 </span>            :         GF_DEF_ARG(&quot;r&quot;, NULL, &quot;enable reporting\n&quot;
<span class="lineNum">     578 </span>            :                         &quot;- r: runtime reporting\n&quot;
<span class="lineNum">     579 </span>            :                         &quot;- r=FA[,FB]: runtime reporting but only print given filters, eg `r=mp4mx` for ISOBMFF muxer only\n&quot;
<span class="lineNum">     580 </span>            :                         &quot;- r=: only print final report&quot;
<span class="lineNum">     581 </span>            :                         , NULL, NULL, GF_ARG_STRING, 0),
<span class="lineNum">     582 </span>            :         GF_DEF_ARG(&quot;seps&quot;, NULL, &quot;set the default character sets used to separate various arguments\n&quot;\
<span class="lineNum">     583 </span>            :                 &quot;- the first char is used to separate argument names\n&quot;\
<span class="lineNum">     584 </span>            :                 &quot;- the second char, if present, is used to separate names and values\n&quot;\
<span class="lineNum">     585 </span>            :                 &quot;- the third char, if present, is used to separate fragments for PID sources\n&quot;\
<span class="lineNum">     586 </span>            :                 &quot;- the fourth char, if present, is used for list separators (__sourceIDs__, __gfreg__, ...)\n&quot;\
<span class="lineNum">     587 </span>            :                 &quot;- the fifth char, if present, is used for boolean negation\n&quot;\
<span class="lineNum">     588 </span>            :                 &quot;- the sixth char, if present, is used for LINK directives (see [filters help (-h doc)](filters_general))&quot;, GF_FS_DEFAULT_SEPS, NULL, GF_ARG_STRING, GF_ARG_HINT_EXPERT),
<span class="lineNum">     589 </span>            : 
<span class="lineNum">     590 </span>            :         GF_DEF_ARG(&quot;i&quot;, &quot;src&quot;, &quot;specify an input file - see [filters help (-h doc)](filters_general)&quot;, NULL, NULL, GF_ARG_STRING, 0),
<span class="lineNum">     591 </span>            :         GF_DEF_ARG(&quot;o&quot;, &quot;dst&quot;, &quot;specify an output file - see [filters help (-h doc)](filters_general)&quot;, NULL, NULL, GF_ARG_STRING, 0),
<span class="lineNum">     592 </span>            :         GF_DEF_ARG(&quot;ib&quot;, NULL, &quot;specify an input file to wrap as GF_FileIO object (testing of GF_FileIO)&quot;, NULL, NULL, GF_ARG_STRING, GF_ARG_HINT_EXPERT),
<span class="lineNum">     593 </span>            :         GF_DEF_ARG(&quot;ob&quot;, NULL, &quot;specify an output file to wrap as GF_FileIO object (testing of GF_FileIO)&quot;, NULL, NULL, GF_ARG_STRING, GF_ARG_HINT_EXPERT),
<span class="lineNum">     594 </span>            :         GF_DEF_ARG(&quot;h&quot;, &quot;help,-ha,-hx,-hh&quot;, &quot;print help. Use `-help` or `-h` for basic options, `-ha` for advanced options, `-hx` for expert options and `-hh` for all.  \nNote: The `@` character can be used in place of the `*` character. String parameter can be:\n&quot;\
<span class="lineNum">     595 </span>            :                         &quot;- empty: print command line options help\n&quot;\
<span class="lineNum">     596 </span>            :                         &quot;- doc: print the general filter info\n&quot;\
<span class="lineNum">     597 </span>            :                         &quot;- alias: print the gpac alias syntax\n&quot;\
<span class="lineNum">     598 </span>            :                         &quot;- log: print the log system help\n&quot;\
<span class="lineNum">     599 </span>            :                         &quot;- core: print the supported libgpac core options. Use -ha/-hx/-hh for advanced/expert options\n&quot;\
<span class="lineNum">     600 </span>            :                         &quot;- cfg: print the GPAC configuration help\n&quot;\
<span class="lineNum">     601 </span>            :                         &quot;- prompt: print the GPAC prompt help when running in interactive mode (see [-k](GPAC) )\n&quot;\
<span class="lineNum">     602 </span>            :                         &quot;- modules: print available modules\n&quot;\
<span class="lineNum">     603 </span>            :                         &quot;- filters: print name of all available filters\n&quot;\
<span class="lineNum">     604 </span>            :                         &quot;- filters:*: print name of all available filters, including meta filters\n&quot;\
<span class="lineNum">     605 </span>            :                         &quot;- codecs: print the supported builtin codecs\n&quot;\
<span class="lineNum">     606 </span>            :                         &quot;- props: print the supported builtin PID and packet properties\n&quot;\
<span class="lineNum">     607 </span>            :                         &quot;- colors: print the builtin color names and their values\n&quot;\
<span class="lineNum">     608 </span>            :                         &quot;- links: print possible connections between each supported filters\n&quot;\
<span class="lineNum">     609 </span>            :                         &quot;- links FNAME: print sources and sinks for filter `FNAME` (either builtin or JS filter)\n&quot;\
<span class="lineNum">     610 </span>            :                         &quot;- FNAME: print filter `FNAME` info (multiple FNAME can be given)\n&quot;
<span class="lineNum">     611 </span>            :                         &quot;  - For meta-filters, use `FNAME:INST`, eg `ffavin:avfoundation`\n&quot;
<span class="lineNum">     612 </span>            :                         &quot;  - Use `*` to print info on all filters (__big output!__), `*:*` to print info on all filters including meta filter instances (__really big output!__)\n&quot;
<span class="lineNum">     613 </span>            :                         &quot;  - By default only basic filter options and description are shown. Use `-ha` to show advanced options capabilities, `-hx` for expert options, `-hh` for all options and filter capabilities including on filters disabled in this build\n&quot;\
<span class="lineNum">     614 </span>            :                         &quot;- FNAME.OPT: print option `OPT` in filter `FNAME`\n&quot;
<span class="lineNum">     615 </span>            :                         &quot;- OPT: look in filter names and options for `OPT` and suggest possible matches if none found. Use `-hx` to look for keyword in all option descriptions\n&quot;
<span class="lineNum">     616 </span>            :                 , NULL, NULL, GF_ARG_STRING, 0),
<span class="lineNum">     617 </span>            : 
<span class="lineNum">     618 </span>            :         GF_DEF_ARG(&quot;p&quot;, NULL, &quot;use indicated profile for the global GPAC config. If not found, config file is created. If a file path is indicated, this will load profile from that file. Otherwise, this will create a directory of the specified name and store new config there. Reserved name `0` means a new profile, not stored to disk. Appending `:reload` to the profile name will force recreating a new configuration file&quot;, NULL, NULL, GF_ARG_STRING, GF_ARG_HINT_ADVANCED),
<span class="lineNum">     619 </span>            :         GF_DEF_ARG(&quot;alias&quot;, NULL, &quot;assign a new alias or remove an alias. Can be specified several times. See [alias usage (-h alias)](#using-aliases)&quot;, NULL, NULL, GF_ARG_STRING, GF_ARG_HINT_ADVANCED),
<span class="lineNum">     620 </span>            :         GF_DEF_ARG(&quot;aliasdoc&quot;, NULL, &quot;assign documentation for a given alias (optional). Can be specified several times&quot;, NULL, NULL, GF_ARG_STRING, GF_ARG_HINT_ADVANCED),
<span class="lineNum">     621 </span>            : 
<span class="lineNum">     622 </span>            :         GF_DEF_ARG(&quot;uncache&quot;, NULL, &quot;revert all items in GPAC cache directory to their original name and server path&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_ADVANCED),
<span class="lineNum">     623 </span>            :         GF_DEF_ARG(&quot;js&quot;, NULL, &quot;specify javascript file to use as controller of filter session&quot;, NULL, NULL, GF_ARG_STRING, GF_ARG_HINT_EXPERT),
<span class="lineNum">     624 </span>            : 
<span class="lineNum">     625 </span>            :         GF_DEF_ARG(&quot;wc&quot;, NULL, &quot;write all core options in the config file unless already set&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     626 </span>            :         GF_DEF_ARG(&quot;we&quot;, NULL, &quot;write all file extensions in the config file unless already set (useful to change some default file extensions)&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     627 </span>            :         GF_DEF_ARG(&quot;wf&quot;, NULL, &quot;write all filter options in the config file unless already set&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     628 </span>            :         GF_DEF_ARG(&quot;wfx&quot;, NULL, &quot;write all filter options and all meta filter arguments in the config file unless already set (__large config file !__)&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     629 </span>            :         GF_DEF_ARG(&quot;unit-tests&quot;, NULL, &quot;enable unit tests of some functions otherwise not covered by gpac test suite&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_HIDE),
<span class="lineNum">     630 </span>            :         GF_DEF_ARG(&quot;genmd&quot;, NULL, &quot;generate markdown doc&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_HIDE),
<span class="lineNum">     631 </span>            :         GF_DEF_ARG(&quot;xopt&quot;, NULL, &quot;unrecognized options and filters declaration following this option are ignored - used to pass arguments to GUI&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     632 </span>            :         {0}
<span class="lineNum">     633 </span>            : };
<a name="634"><span class="lineNum">     634 </span>            : </a>
<span class="lineNum">     635 </span>            : 
<span class="lineNum">     636 </span><span class="lineCov">          5 : static void gpac_usage(GF_SysArgMode argmode)</span>
<span class="lineNum">     637 </span>            : {
<span class="lineNum">     638 </span>            :         u32 i=0;
<span class="lineNum">     639 </span><span class="lineCov">          5 :         if ((argmode != GF_ARGMODE_ADVANCED) &amp;&amp; (argmode != GF_ARGMODE_EXPERT) ) {</span>
<span class="lineNum">     640 </span><span class="lineCov">          5 :                 if (gen_doc!=2)</span>
<span class="lineNum">     641 </span><span class="lineCov">          4 :                         gf_sys_format_help(helpout, help_flags, &quot;Usage: gpac [options] FILTER [LINK] FILTER [...] \n&quot;);</span>
<span class="lineNum">     642 </span>            : 
<span class="lineNum">     643 </span><span class="lineCov">          5 :                 gf_sys_format_help(helpout, help_flags, &quot;gpac is GPAC's command line tool for setting up and running filter chains.\n\n&quot;</span>
<span class="lineNum">     644 </span>            :                 &quot;__FILTER__: a single filter declaration (eg, `-i file`, `-o dump`, `inspect`, ...), see %s.\n&quot;
<span class="lineNum">     645 </span>            :                 &quot;__[LINK]__: a link instruction (eg, `@`, `@2`, `@2#StreamType=Visual`, ...), see %s.\n&quot;
<span class="lineNum">     646 </span>            :                 &quot;__[options]__: one or more option strings, each starting with a `-` character.\n&quot;
<span class="lineNum">     647 </span>            :                 &quot;  - an option using a single `-` indicates an option of gpac (see %s) or of libgpac (see %s)\n&quot;
<span class="lineNum">     648 </span>            :                 &quot;  - an option using `--` indicates a global filter option, for example `--block_size=1000` (see %s)\n&quot;
<span class="lineNum">     649 </span>            :                 &quot;  - an option using `-+` indicates a global meta-filter filter (eg FFMPEG) option, for example `-+profile=Baseline` (see %s)\n&quot;
<span class="lineNum">     650 </span>            :                 &quot;  \n&quot;
<span class="lineNum">     651 </span>            :                 &quot;Filter declaration order may impact the link resolver which will try linking in declaration order. Most of the time for simple graphs, this has no impact. However, for complex graphs with no link declarations, this can lead to different results.  \n&quot;
<span class="lineNum">     652 </span>            :                 &quot;Options do not require any specific order, and may be present anywhere, including between link statements or filter declarations.  \n&quot;
<span class="lineNum">     653 </span>            :                 &quot;Boolean values do not need any value specified. Other types shall be formatted as `opt=val`, except [-i](), `-src`, [-o](), `-dst` and [-h]() options.\n\n&quot;
<span class="lineNum">     654 </span>            :                 &quot;The possible options for gpac are:\n\n&quot;,
<span class="lineNum">     655 </span>            :                         (gen_doc==1) ? &quot;[gpac -h doc](filters_general#filter-declaration-filter)&quot; : &quot;`gpac -h doc`&quot;,
<span class="lineNum">     656 </span>            :                         (gen_doc==1) ? &quot;[gpac -h doc](filters_general#explicit-links-between-filters-link)&quot; : &quot;`gpac -h doc`&quot;,
<span class="lineNum">     657 </span>            :                         (gen_doc==1) ? &quot;[gpac -hx](gpac_general#h)&quot; : &quot;`gpac -hx`&quot;,
<span class="lineNum">     658 </span>            :                         (gen_doc==1) ? &quot;[gpac -hx core](core_options)&quot; : &quot;`gpac -hx core`&quot;,
<span class="lineNum">     659 </span>            :                         (gen_doc==1) ? &quot;[gpac -h doc](core_config#global-filter-options)&quot; : &quot;`gpac -h doc`&quot;,
<span class="lineNum">     660 </span><span class="lineCov">          5 :                         (gen_doc==1) ? &quot;[gpac -h doc](core_config#global-filter-options)&quot; : &quot;`gpac -h doc`&quot;</span>
<span class="lineNum">     661 </span>            :                 );
<span class="lineNum">     662 </span>            :         }
<span class="lineNum">     663 </span>            : 
<span class="lineNum">     664 </span><span class="lineCov">        145 :         while (gpac_args[i].name) {</span>
<span class="lineNum">     665 </span><span class="lineCov">        140 :                 GF_GPACArg *arg = &amp;gpac_args[i];</span>
<span class="lineNum">     666 </span><span class="lineCov">        140 :                 i++;</span>
<span class="lineNum">     667 </span>            : 
<span class="lineNum">     668 </span><span class="lineCov">        140 :                 if (argmode!=GF_ARGMODE_ALL) {</span>
<span class="lineNum">     669 </span><span class="lineCov">         56 :                         if ((argmode==GF_ARGMODE_EXPERT) &amp;&amp; !(arg-&gt;flags &amp; GF_ARG_HINT_EXPERT)) continue;</span>
<span class="lineNum">     670 </span><span class="lineCov">         56 :                         if ((argmode==GF_ARGMODE_ADVANCED) &amp;&amp; !(arg-&gt;flags &amp; GF_ARG_HINT_ADVANCED)) continue;</span>
<span class="lineNum">     671 </span><span class="lineCov">         56 :                         else if ((argmode==GF_ARGMODE_BASE) &amp;&amp; (arg-&gt;flags &amp; (GF_ARG_HINT_ADVANCED| GF_ARG_HINT_EXPERT)) ) continue;</span>
<span class="lineNum">     672 </span>            :                 }
<span class="lineNum">     673 </span>            : 
<span class="lineNum">     674 </span><span class="lineCov">        100 :                 gf_sys_print_arg(helpout, help_flags, arg, &quot;gpac&quot;);</span>
<span class="lineNum">     675 </span>            :         }
<span class="lineNum">     676 </span>            : 
<span class="lineNum">     677 </span><span class="lineCov">          5 :         if (argmode&gt;=GF_ARGMODE_ADVANCED) {</span>
<span class="lineNum">     678 </span><span class="lineCov">          3 :                 gf_sys_format_help(helpout, help_flags, &quot;\n  \nThe following libgpac core options allow customizing the filter session:\n  \n&quot; );</span>
<span class="lineNum">     679 </span><span class="lineCov">          3 :                 gf_sys_print_core_help(helpout, help_flags, argmode, GF_ARG_SUBSYS_FILTERS);</span>
<span class="lineNum">     680 </span>            :         }
<span class="lineNum">     681 </span>            : 
<span class="lineNum">     682 </span><span class="lineCov">          5 :         if (argmode==GF_ARGMODE_BASE) {</span>
<span class="lineNum">     683 </span><span class="lineCov">          2 :                 if ( gf_opts_get_key_count(&quot;gpac.aliasdoc&quot;)) {</span>
<span class="lineNum">     684 </span><span class="lineCov">          2 :                         gf_sys_format_help(helpout, help_flags, &quot;\n&quot;);</span>
<span class="lineNum">     685 </span><span class="lineCov">          2 :                         gpac_alias_help(GF_ARGMODE_BASE);</span>
<span class="lineNum">     686 </span>            :                 }
<span class="lineNum">     687 </span>            : 
<span class="lineNum">     688 </span><span class="lineCov">          2 :                 gf_sys_format_help(helpout, help_flags, &quot;\ngpac - GPAC command line filter engine - version %s\n%s\n&quot;, gf_gpac_version(), gf_gpac_copyright_cite() );</span>
<span class="lineNum">     689 </span>            :         }
<span class="lineNum">     690 </span><span class="lineCov">          5 : }</span>
<span class="lineNum">     691 </span>            : 
<span class="lineNum">     692 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">     693 </span>            : static const char *gpac_config =
<span class="lineNum">     694 </span>            : {
<span class="lineNum">     695 </span>            : &quot;# Configuration file\n&quot;
<span class="lineNum">     696 </span>            : &quot;GPAC uses a configuration file to modify default options of libgpac and filters. This configuration file is located in `$HOME/.gpac/GPAC.cfg`.\n&quot;
<span class="lineNum">     697 </span>            : &quot;Applications in GPAC can also specify a different configuration file through the [-p](GPAC) option to indicate a profile. &quot;
<span class="lineNum">     698 </span>            : &quot;This allows different configurations for different usages and simplifies command line typing.\n&quot;
<span class="lineNum">     699 </span>            : &quot;EX gpac -p=foo []\n&quot;
<span class="lineNum">     700 </span>            : &quot;This will load configuration from $HOME/.gpac/foo/GPAC.cfg, creating it if needed.\n&quot;
<span class="lineNum">     701 </span>            : &quot;The reserved name `0` is used to disable configuration file writing.\n&quot;
<span class="lineNum">     702 </span>            : &quot;By default the configuration file only holds a few system specific options and directories. It is possible to serialize &quot;
<span class="lineNum">     703 </span>            : &quot;the entire set of options to the configuration file, using [-wc](GPAC) [-wf](GPAC). This should be avoided as the resulting &quot;
<span class="lineNum">     704 </span>            : &quot;configuration file size will be quite large, hence larger memory usage for the applications.\n&quot;
<span class="lineNum">     705 </span>            : &quot;The options specified in the configuration file may be overridden by the values in __restrict.cfg__ file located in GPAC share system directory (e.g. /usr/share/gpac), &quot;
<span class="lineNum">     706 </span>            : &quot;if present; this allows enforcing system-wide configuration values.\n&quot;
<span class="lineNum">     707 </span>            : &quot;Note: The methods describe in this section apply to any application in GPAC transferring their arguments &quot;
<span class="lineNum">     708 </span>            : &quot;to libgpac. This is the case for __gpac__, __MP4Box__, __MP4Client/Osmo4__.\n&quot;
<span class="lineNum">     709 </span>            : &quot;# Core options\n&quot;
<span class="lineNum">     710 </span>            : &quot;The options from libgpac core can also be assigned though the config file from section __core__ using &quot;
<span class="lineNum">     711 </span>            : &quot;option name **without initial dash** as key name.\n&quot;
<span class="lineNum">     712 </span>            : &quot;EX [core]threads=2\n&quot;
<span class="lineNum">     713 </span>            : &quot;Setting this in the config file is equivalent to using `-threads=2`.\n&quot;
<span class="lineNum">     714 </span>            : &quot;The options specified at prompt overrides the value of the config file.\n&quot;
<span class="lineNum">     715 </span>            : &quot;# Filter options in configuration\n&quot;
<span class="lineNum">     716 </span>            : &quot;It is possible to alter the default value of a filter option by modifying the configuration file. Filter __foo__ options are stored in section &quot;
<span class="lineNum">     717 </span>            : &quot;`[filter@foo]`, using option name and value as key-value pair. Options specified through the configuration file do not take precedence over &quot;
<span class="lineNum">     718 </span>            : &quot;options specified at prompt or through alias.\n&quot;
<span class="lineNum">     719 </span>            : &quot;EX [filter@rtpin]interleave=yes\n&quot;
<span class="lineNum">     720 </span>            : &quot;This will force the rtp input filter to always request RTP over RTSP by default.\n&quot;
<span class="lineNum">     721 </span>            : &quot;To generate a configuration file with all filters options serialized, use [-wf](GPAC).\n&quot;
<span class="lineNum">     722 </span>            : &quot;# Global filter options\n&quot;
<span class="lineNum">     723 </span>            : &quot;It is possible to specify options global to multiple filters using `--OPTNAME=VAL`. Global options do not override filter options but &quot;
<span class="lineNum">     724 </span>            : &quot;take precedence over options loaded from configuration file.\n&quot;
<span class="lineNum">     725 </span>            : &quot;This will set option `OPTNAME`, when present, to `VAL` in any loaded filter.\n&quot;
<span class="lineNum">     726 </span>            : &quot;EX --buffer=100 -i file vout aout\n&quot;
<span class="lineNum">     727 </span>            : &quot;This is equivalent to specifying `vout:buffer=100 aout:buffer=100`.\n&quot;
<span class="lineNum">     728 </span>            : &quot;EX --buffer=100 -i file vout aout:buffer=10\n&quot;
<span class="lineNum">     729 </span>            : &quot;This is equivalent to specifying `vout:buffer=100 aout:buffer=10`.\n&quot;
<span class="lineNum">     730 </span>            : &quot;Warning: This syntax only applies to regular filter options. It cannot be used with builtin shortcuts (gfreg, enc, ...).\n&quot;
<span class="lineNum">     731 </span>            : &quot;Meta-filter options can be set in the same way using the syntax `-+OPT_NAME=VAL`.\n&quot;
<span class="lineNum">     732 </span>            : &quot;EX -+profile=Baseline -i file.cmp -o dump.264\n&quot;
<span class="lineNum">     733 </span>            : &quot;This is equivalent to specifying `-o dump.264:profile=Baseline`.\n&quot;
<span class="lineNum">     734 </span>            : &quot;  \n&quot;
<span class="lineNum">     735 </span>            : &quot;For both syntax, it is possible to specify the filter registry name of the option, using `--FNAME@OPTNAME=VAL`.\n&quot;
<span class="lineNum">     736 </span>            : &quot;In this case the option will only be set for filters which are instances of registry FNAME. This is used when several registries use same option names.\n&quot;
<span class="lineNum">     737 </span>            : &quot;EX --flist@timescale=100 -i plist1 -i plist2 -o live.mpd\n&quot;
<span class="lineNum">     738 </span>            : &quot;This will set the timescale option on the playlists filters but not on the dasher filter.\n&quot;
<span class="lineNum">     739 </span>            : };
<a name="740"><span class="lineNum">     740 </span>            : #endif</a>
<span class="lineNum">     741 </span>            : 
<span class="lineNum">     742 </span><span class="lineCov">          2 : static void gpac_config_help()</span>
<span class="lineNum">     743 </span>            : {
<span class="lineNum">     744 </span>            : 
<span class="lineNum">     745 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">     746 </span><span class="lineCov">          2 :                 gf_sys_format_help(helpout, help_flags, &quot;%s&quot;, gf_sys_localized(&quot;gpac&quot;, &quot;config&quot;, gpac_config) );</span>
<span class="lineNum">     747 </span>            : #else
<span class="lineNum">     748 </span>            :                 gf_sys_format_help(helpout, help_flags, &quot;%s&quot;, &quot;GPAC compiled without built-in doc.\n&quot;);
<span class="lineNum">     749 </span>            : #endif
<span class="lineNum">     750 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">     751 </span>            : 
<span class="lineNum">     752 </span>            : 
<span class="lineNum">     753 </span>            : static Bool logs_to_file=GF_FALSE;
<span class="lineNum">     754 </span>            : 
<span class="lineNum">     755 </span>            : #define DEF_LOG_ENTRIES 10
<span class="lineNum">     756 </span>            : 
<span class="lineNum">     757 </span>            : struct _logentry
<span class="lineNum">     758 </span>            : {
<span class="lineNum">     759 </span>            :         u32 tool, level;
<span class="lineNum">     760 </span>            :         u32 nb_repeat;
<span class="lineNum">     761 </span>            :         u64 clock;
<span class="lineNum">     762 </span>            :         char *szMsg;
<span class="lineNum">     763 </span>            : } *static_logs;
<span class="lineNum">     764 </span>            : static u32 nb_log_entries = DEF_LOG_ENTRIES;
<span class="lineNum">     765 </span>            : 
<span class="lineNum">     766 </span>            : static u32 log_write=0;
<span class="lineNum">     767 </span>            : 
<a name="768"><span class="lineNum">     768 </span>            : static char *log_buf = NULL;</a>
<span class="lineNum">     769 </span>            : static u32 log_buf_size=0;
<span class="lineNum">     770 </span><span class="lineCov">       3704 : static void gpac_on_logs(void *cbck, GF_LOG_Level log_level, GF_LOG_Tool log_tool, const char* fmt, va_list vlist)</span>
<span class="lineNum">     771 </span>            : {
<span class="lineNum">     772 </span>            :         va_list vlist_tmp;
<span class="lineNum">     773 </span><span class="lineCov">       3704 :         va_copy(vlist_tmp, vlist);</span>
<span class="lineNum">     774 </span><span class="lineCov">       3704 :         u32 len = vsnprintf(NULL, 0, fmt, vlist_tmp);</span>
<span class="lineNum">     775 </span><span class="lineCov">       3704 :         va_end(vlist_tmp);</span>
<span class="lineNum">     776 </span><span class="lineCov">       3704 :         if (log_buf_size &lt; len+2) {</span>
<span class="lineNum">     777 </span><span class="lineCov">          5 :                 log_buf_size = len+2;</span>
<span class="lineNum">     778 </span><span class="lineCov">          5 :                 log_buf = gf_realloc(log_buf, log_buf_size);</span>
<span class="lineNum">     779 </span>            :         }
<span class="lineNum">     780 </span><span class="lineCov">       3704 :         vsprintf(log_buf, fmt, vlist);</span>
<span class="lineNum">     781 </span>            : 
<span class="lineNum">     782 </span><span class="lineCov">       3704 :         if (log_write &amp;&amp; static_logs[log_write-1].szMsg) {</span>
<span class="lineNum">     783 </span><span class="lineCov">       3703 :                 if (!strcmp(static_logs[log_write-1].szMsg, log_buf)) {</span>
<span class="lineNum">     784 </span><span class="lineCov">          4 :                         static_logs[log_write-1].nb_repeat++;</span>
<span class="lineNum">     785 </span><span class="lineCov">          4 :                         return;</span>
<span class="lineNum">     786 </span>            :                 }
<span class="lineNum">     787 </span>            :         }
<span class="lineNum">     788 </span>            : 
<span class="lineNum">     789 </span><span class="lineCov">       3700 :         static_logs[log_write].level = log_level;</span>
<span class="lineNum">     790 </span><span class="lineCov">       3700 :         static_logs[log_write].tool = log_tool;</span>
<span class="lineNum">     791 </span><span class="lineCov">       3700 :         if (static_logs[log_write].szMsg) gf_free(static_logs[log_write].szMsg);</span>
<span class="lineNum">     792 </span><span class="lineCov">       3700 :         static_logs[log_write].szMsg = gf_strdup(log_buf);</span>
<span class="lineNum">     793 </span><span class="lineCov">       3700 :         static_logs[log_write].clock = gf_net_get_utc();</span>
<span class="lineNum">     794 </span>            : 
<span class="lineNum">     795 </span><span class="lineCov">       3700 :         log_write++;</span>
<span class="lineNum">     796 </span><span class="lineCov">       3700 :         if (log_write==nb_log_entries) {</span>
<span class="lineNum">     797 </span><span class="lineCov">       3691 :                 log_write = nb_log_entries - 1;</span>
<span class="lineNum">     798 </span><span class="lineCov">       3691 :                 gf_free(static_logs[0].szMsg);</span>
<span class="lineNum">     799 </span><span class="lineCov">       3691 :                 memmove(&amp;static_logs[0], &amp;static_logs[1], sizeof (struct _logentry) * (nb_log_entries-1) );</span>
<span class="lineNum">     800 </span><span class="lineCov">       3691 :                 memset(&amp;static_logs[log_write], 0, sizeof(struct _logentry));</span>
<span class="lineNum">     801 </span>            :         }
<span class="lineNum">     802 </span>            : }
<a name="803"><span class="lineNum">     803 </span>            : </a>
<span class="lineNum">     804 </span>            : static u64 last_report_clock_us = 0;
<span class="lineNum">     805 </span><span class="lineCov">         22 : static void print_date(u64 time)</span>
<span class="lineNum">     806 </span>            : {
<span class="lineNum">     807 </span>            :         time_t gtime;
<span class="lineNum">     808 </span>            :         struct tm *t;
<span class="lineNum">     809 </span>            :         u32 sec;
<span class="lineNum">     810 </span>            :         u32 ms;
<span class="lineNum">     811 </span><span class="lineCov">         22 :         gtime = time / 1000;</span>
<span class="lineNum">     812 </span><span class="lineCov">         22 :         sec = (u32)(time / 1000);</span>
<span class="lineNum">     813 </span><span class="lineCov">         22 :         ms = (u32)(time - ((u64)sec) * 1000);</span>
<span class="lineNum">     814 </span><span class="lineCov">         22 :         t = gf_gmtime(&amp;gtime);</span>
<span class="lineNum">     815 </span>            : //      fprintf(stderr, &quot;[%d-%02d-%02dT%02d:%02d:%02d.%03dZ&quot;, 1900 + t-&gt;tm_year, t-&gt;tm_mon + 1, t-&gt;tm_mday, t-&gt;tm_hour, t-&gt;tm_min, t-&gt;tm_sec, ms);
<span class="lineNum">     816 </span><span class="lineCov">         22 :         fprintf(stderr, &quot;[%02d:%02d:%02d.%03dZ] &quot;, t-&gt;tm_hour, t-&gt;tm_min, t-&gt;tm_sec, ms);</span>
<a name="817"><span class="lineNum">     817 </span><span class="lineCov">         22 : }</span></a>
<span class="lineNum">     818 </span>            : 
<span class="lineNum">     819 </span><span class="lineCov">         20 : static void gpac_print_report(GF_FilterSession *fsess, Bool is_init, Bool is_final)</span>
<span class="lineNum">     820 </span>            : {
<span class="lineNum">     821 </span>            :         u32 i, count, nb_active;
<span class="lineNum">     822 </span>            :         u64 now;
<span class="lineNum">     823 </span>            : 
<span class="lineNum">     824 </span><span class="lineCov">         20 :         if (is_init) {</span>
<span class="lineNum">     825 </span><span class="lineCov">          2 :                 if (enable_reports==2)</span>
<span class="lineNum">     826 </span><span class="lineCov">          2 :                         gf_sys_set_console_code(stderr, GF_CONSOLE_SAVE);</span>
<span class="lineNum">     827 </span>            : 
<span class="lineNum">     828 </span><span class="lineCov">          2 :                 logs_to_file = gf_log_use_file();</span>
<span class="lineNum">     829 </span><span class="lineCov">          2 :                 if (!logs_to_file &amp;&amp; (enable_reports==2) ) {</span>
<span class="lineNum">     830 </span><span class="lineCov">          2 :                         if (!nb_log_entries) nb_log_entries = 1;</span>
<span class="lineNum">     831 </span><span class="lineCov">          2 :                         static_logs = gf_malloc(sizeof(struct _logentry) * nb_log_entries);</span>
<span class="lineNum">     832 </span><span class="lineCov">          2 :                         memset(static_logs, 0, sizeof(struct _logentry) * nb_log_entries);</span>
<span class="lineNum">     833 </span><span class="lineCov">          2 :                         gf_log_set_callback(fsess, gpac_on_logs);</span>
<span class="lineNum">     834 </span>            :                 }
<span class="lineNum">     835 </span><span class="lineCov">          2 :                 last_report_clock_us = gf_sys_clock_high_res();</span>
<span class="lineNum">     836 </span><span class="lineCov">          2 :                 return;</span>
<span class="lineNum">     837 </span>            :         }
<span class="lineNum">     838 </span>            : 
<span class="lineNum">     839 </span><span class="lineCov">         18 :         now = gf_sys_clock_high_res();</span>
<span class="lineNum">     840 </span><span class="lineCov">         18 :         if ( (now - last_report_clock_us &lt; 200000) &amp;&amp; !is_final)</span>
<span class="lineNum">     841 </span>            :                 return;
<span class="lineNum">     842 </span>            : 
<span class="lineNum">     843 </span><span class="lineCov">         13 :         last_report_clock_us = now;</span>
<span class="lineNum">     844 </span><span class="lineCov">         13 :         if (!is_final)</span>
<span class="lineNum">     845 </span><span class="lineCov">         11 :                 gf_sys_set_console_code(stderr, GF_CONSOLE_CLEAR);</span>
<span class="lineNum">     846 </span>            : 
<span class="lineNum">     847 </span><span class="lineCov">         13 :         gf_sys_get_rti(100, &amp;rti, 0);</span>
<span class="lineNum">     848 </span><span class="lineCov">         13 :         gf_sys_set_console_code(stderr, GF_CONSOLE_CYAN);</span>
<span class="lineNum">     849 </span><span class="lineCov">         13 :         print_date(gf_net_get_utc());</span>
<span class="lineNum">     850 </span><span class="lineCov">         13 :         fprintf(stderr, &quot;GPAC Session Status: &quot;);</span>
<span class="lineNum">     851 </span><span class="lineCov">         13 :         gf_sys_set_console_code(stderr, GF_CONSOLE_RESET);</span>
<span class="lineNum">     852 </span><span class="lineCov">         13 :         fprintf(stderr, &quot;mem % 10&quot;LLD_SUF&quot; kb CPU % 2d&quot;, rti.gpac_memory/1000, rti.process_cpu_time);</span>
<span class="lineNum">     853 </span><span class="lineCov">         13 :         fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">     854 </span>            : 
<span class="lineNum">     855 </span><span class="lineCov">         13 :         gf_fs_lock_filters(fsess, GF_TRUE);</span>
<span class="lineNum">     856 </span><span class="lineCov">         13 :         nb_active = count = gf_fs_get_filters_count(fsess);</span>
<span class="lineNum">     857 </span><span class="lineCov">         28 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">     858 </span>            :                 GF_FilterStats stats;
<span class="lineNum">     859 </span><span class="lineCov">         15 :                 gf_fs_get_filter_stats(fsess, i, &amp;stats);</span>
<span class="lineNum">     860 </span><span class="lineCov">         15 :                 if (stats.done || stats.filter_alias) {</span>
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :                         nb_active--;</span>
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :                         continue;</span>
<span class="lineNum">     863 </span>            :                 }
<span class="lineNum">     864 </span><span class="lineCov">         15 :                 if (report_filter &amp;&amp; (!strstr(report_filter, stats.reg_name)))</span>
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :                         continue;</span>
<span class="lineNum">     866 </span>            : 
<span class="lineNum">     867 </span><span class="lineCov">         15 :                 gf_sys_set_console_code(stderr, GF_CONSOLE_GREEN);</span>
<span class="lineNum">     868 </span><span class="lineCov">         15 :                 fprintf(stderr, &quot;%s&quot;, stats.name ? stats.name : stats.reg_name);</span>
<span class="lineNum">     869 </span><span class="lineCov">         15 :                 gf_sys_set_console_code(stderr, GF_CONSOLE_RESET);</span>
<span class="lineNum">     870 </span><span class="lineCov">         15 :                 if (stats.name &amp;&amp; strcmp(stats.name, stats.reg_name))</span>
<span class="lineNum">     871 </span><span class="lineCov">          3 :                         fprintf(stderr, &quot; (%s)&quot;, stats.reg_name);</span>
<span class="lineNum">     872 </span><span class="lineCov">         15 :                 fprintf(stderr, &quot;: &quot;);</span>
<span class="lineNum">     873 </span>            : 
<span class="lineNum">     874 </span><span class="lineCov">         15 :                 if (stats.status) {</span>
<span class="lineNum">     875 </span><span class="lineCov">         14 :                         fprintf(stderr, &quot;%s\n&quot;, stats.status);</span>
<span class="lineNum">     876 </span>            :                 } else {
<span class="lineNum">     877 </span><span class="lineCov">          1 :                         if (stats.stream_type)</span>
<span class="lineNum">     878 </span><span class="lineCov">          1 :                                 fprintf(stderr, &quot;%s &quot;, gf_stream_type_name(stats.stream_type));</span>
<span class="lineNum">     879 </span><span class="lineCov">          1 :                         if (stats.codecid)</span>
<span class="lineNum">     880 </span><span class="lineCov">          1 :                                 fprintf(stderr, &quot;(%s) &quot;, gf_codecid_name(stats.codecid) );</span>
<span class="lineNum">     881 </span>            : 
<span class="lineNum">     882 </span><span class="lineCov">          1 :                         if ((stats.nb_pid_in == stats.nb_pid_out) &amp;&amp; (stats.nb_pid_in==1)) {</span>
<span class="lineNum">     883 </span><span class="lineNoCov">          0 :                                 Double pck_per_sec = (Double) (stats.nb_hw_pck_sent ? stats.nb_hw_pck_sent : stats.nb_pck_sent);</span>
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :                                 pck_per_sec *= 1000000;</span>
<span class="lineNum">     885 </span><span class="lineNoCov">          0 :                                 pck_per_sec /= (stats.time_process+1);</span>
<span class="lineNum">     886 </span>            : 
<span class="lineNum">     887 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;% 10&quot;LLD_SUF&quot; pck %02.02f FPS &quot;, (s64) stats.nb_out_pck, pck_per_sec);</span>
<span class="lineNum">     888 </span>            :                         } else {
<span class="lineNum">     889 </span><span class="lineCov">          1 :                                 if (stats.nb_pid_in)</span>
<span class="lineNum">     890 </span><span class="lineCov">          1 :                                         fprintf(stderr, &quot;%d input PIDs % 10&quot;LLD_SUF&quot; pck &quot;, stats.nb_pid_in, (s64)stats.nb_in_pck);</span>
<span class="lineNum">     891 </span><span class="lineCov">          1 :                                 if (stats.nb_pid_out)</span>
<span class="lineNum">     892 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;%d output PIDs % 10&quot;LLD_SUF&quot; pck &quot;, stats.nb_pid_out, (s64) stats.nb_out_pck);</span>
<span class="lineNum">     893 </span>            :                         }
<span class="lineNum">     894 </span><span class="lineCov">          1 :                         if (stats.in_eos)</span>
<span class="lineNum">     895 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;- EOS&quot;);</span>
<span class="lineNum">     896 </span><span class="lineCov">          1 :                         fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">     897 </span>            :                 }
<span class="lineNum">     898 </span>            :         }
<span class="lineNum">     899 </span><span class="lineCov">         13 :         fprintf(stderr, &quot;Active filters: %d\n&quot;, nb_active);</span>
<span class="lineNum">     900 </span>            : 
<span class="lineNum">     901 </span><span class="lineCov">         13 :         if (static_logs) {</span>
<span class="lineNum">     902 </span><span class="lineCov">         13 :                 if (is_final &amp;&amp; (!log_write || !static_logs[log_write-1].szMsg))</span>
<span class="lineNum">     903 </span>            :                         return;
<span class="lineNum">     904 </span>            : 
<span class="lineNum">     905 </span><span class="lineCov">         12 :                 fprintf(stderr, &quot;\nLogs:\n&quot;);</span>
<span class="lineNum">     906 </span><span class="lineCov">         21 :                 for (i=0; i&lt;log_write; i++) {</span>
<span class="lineNum">     907 </span><span class="lineCov">          9 :                         if (static_logs[i].level==GF_LOG_ERROR) gf_sys_set_console_code(stderr, GF_CONSOLE_RED);</span>
<span class="lineNum">     908 </span><span class="lineCov">          9 :                         else if (static_logs[i].level==GF_LOG_WARNING) gf_sys_set_console_code(stderr, GF_CONSOLE_YELLOW);</span>
<span class="lineNum">     909 </span><span class="lineCov">          9 :                         else if (static_logs[i].level==GF_LOG_INFO) gf_sys_set_console_code(stderr, GF_CONSOLE_GREEN);</span>
<span class="lineNum">     910 </span><span class="lineCov">          8 :                         else gf_sys_set_console_code(stderr, GF_CONSOLE_CYAN);</span>
<span class="lineNum">     911 </span>            : 
<span class="lineNum">     912 </span><span class="lineCov">          9 :                         print_date(static_logs[i].clock);</span>
<span class="lineNum">     913 </span>            : 
<span class="lineNum">     914 </span><span class="lineCov">          9 :                         if (static_logs[i].nb_repeat)</span>
<span class="lineNum">     915 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;[repeated %d] &quot;, static_logs[i].nb_repeat);</span>
<span class="lineNum">     916 </span>            : 
<span class="lineNum">     917 </span><span class="lineCov">          9 :                         fprintf(stderr, &quot;%s&quot;, static_logs[i].szMsg);</span>
<span class="lineNum">     918 </span><span class="lineCov">          9 :                         gf_sys_set_console_code(stderr, GF_CONSOLE_RESET);</span>
<span class="lineNum">     919 </span>            :                 }
<span class="lineNum">     920 </span><span class="lineCov">         12 :                 fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">     921 </span>            :         }
<span class="lineNum">     922 </span><span class="lineCov">         12 :         gf_fs_lock_filters(fsess, GF_FALSE);</span>
<span class="lineNum">     923 </span><span class="lineCov">         12 :         fflush(stderr);</span>
<a name="924"><span class="lineNum">     924 </span>            : }</a>
<span class="lineNum">     925 </span>            : 
<span class="lineNum">     926 </span><span class="lineCov">         16 : static Bool gpac_event_proc(void *opaque, GF_Event *event)</span>
<span class="lineNum">     927 </span>            : {
<span class="lineNum">     928 </span>            :         GF_FilterSession *fsess = (GF_FilterSession *)opaque;
<span class="lineNum">     929 </span><span class="lineCov">         16 :         if (event-&gt;type==GF_EVENT_PROGRESS) {</span>
<span class="lineNum">     930 </span><span class="lineCov">         16 :                 if (event-&gt;progress.progress_type==3) {</span>
<span class="lineNum">     931 </span><span class="lineCov">         16 :                         gpac_print_report(fsess, GF_FALSE, GF_FALSE);</span>
<span class="lineNum">     932 </span>            :                 }
<span class="lineNum">     933 </span>            :         }
<span class="lineNum">     934 </span><span class="lineNoCov">          0 :         else if (event-&gt;type==GF_EVENT_QUIT) {</span>
<span class="lineNum">     935 </span><span class="lineNoCov">          0 :                 gf_fs_abort(fsess, GF_TRUE);</span>
<span class="lineNum">     936 </span>            :         }
<span class="lineNum">     937 </span><span class="lineCov">         16 :         return GF_FALSE;</span>
<span class="lineNum">     938 </span>            : }
<span class="lineNum">     939 </span>            : 
<span class="lineNum">     940 </span>            : 
<span class="lineNum">     941 </span>            : typedef enum
<span class="lineNum">     942 </span>            : {
<span class="lineNum">     943 </span>            :         GPAC_COM_UNDEF = 0,
<span class="lineNum">     944 </span>            :         GPAC_QUIT,
<span class="lineNum">     945 </span>            :         GPAC_EXIT,
<span class="lineNum">     946 </span>            :         GPAC_PRINT_STATS,
<span class="lineNum">     947 </span>            :         GPAC_PRINT_GRAPH,
<span class="lineNum">     948 </span>            :         GPAC_SEND_UPDATE,
<span class="lineNum">     949 </span>            :         GPAC_LIST_FILTERS,
<span class="lineNum">     950 </span>            :         GPAC_INSERT_FILTER,
<span class="lineNum">     951 </span>            :         GPAC_REMOVE_FILTER,
<span class="lineNum">     952 </span>            :         GPAC_PRINT_HELP
<span class="lineNum">     953 </span>            : } GPAC_Command;
<span class="lineNum">     954 </span>            : 
<span class="lineNum">     955 </span>            : static struct _gpac_key
<span class="lineNum">     956 </span>            : {
<span class="lineNum">     957 </span>            :         u8 char_code;
<span class="lineNum">     958 </span>            :         GPAC_Command cmd_type;
<span class="lineNum">     959 </span>            :         const char *cmd_help;
<span class="lineNum">     960 </span>            :         u32 flags;
<span class="lineNum">     961 </span>            : } GPAC_Keys[] = {
<span class="lineNum">     962 </span>            :         {'q', GPAC_QUIT, &quot;flush all streams and exit&quot;, 0},
<span class="lineNum">     963 </span>            :         {'x', GPAC_EXIT, &quot;exit with no flush (may break output files)&quot;, 0},
<span class="lineNum">     964 </span>            :         {'s', GPAC_PRINT_STATS, &quot;print statistics&quot;, 0},
<span class="lineNum">     965 </span>            :         {'g', GPAC_PRINT_GRAPH, &quot;print filter graph&quot;, 0},
<span class="lineNum">     966 </span>            :         {'l', GPAC_LIST_FILTERS, &quot;list filters&quot;, 0},
<span class="lineNum">     967 </span>            :         {'u', GPAC_SEND_UPDATE, &quot;update argument of filter&quot;, 0},
<span class="lineNum">     968 </span>            :         {'i', GPAC_INSERT_FILTER, &quot;insert a filter in the chain&quot;, 0},
<span class="lineNum">     969 </span>            :         {'r', GPAC_REMOVE_FILTER, &quot;remove a filter from the chain&quot;, 0},
<span class="lineNum">     970 </span>            :         {'h', GPAC_PRINT_HELP, &quot;print this help&quot;, 0},
<span class="lineNum">     971 </span>            :         {0}
<span class="lineNum">     972 </span>            : };
<span class="lineNum">     973 </span>            : 
<span class="lineNum">     974 </span>            : static GPAC_Command get_cmd(u8 char_code)
<span class="lineNum">     975 </span>            : {
<span class="lineNum">     976 </span>            :         u32 i=0;
<span class="lineNum">     977 </span><span class="lineNoCov">          0 :         while (GPAC_Keys[i].char_code) {</span>
<span class="lineNum">     978 </span><span class="lineNoCov">          0 :                 if (GPAC_Keys[i].char_code == char_code)</span>
<span class="lineNum">     979 </span><span class="lineNoCov">          0 :                         return GPAC_Keys[i].cmd_type;</span>
<span class="lineNum">     980 </span><span class="lineNoCov">          0 :                 i++;</span>
<span class="lineNum">     981 </span>            :         }
<span class="lineNum">     982 </span>            :         return GPAC_COM_UNDEF;
<a name="983"><span class="lineNum">     983 </span>            : }</a>
<span class="lineNum">     984 </span>            : 
<span class="lineNum">     985 </span><span class="lineCov">          1 : static void gpac_fsess_task_help()</span>
<span class="lineNum">     986 </span>            : {
<span class="lineNum">     987 </span><span class="lineCov">          1 :         gf_sys_format_help(helpout, help_flags, &quot;Available runtime options/keys:\n&quot;);</span>
<span class="lineNum">     988 </span>            : 
<span class="lineNum">     989 </span>            :         u32 i=0;
<span class="lineNum">     990 </span><span class="lineCov">         11 :         while (GPAC_Keys[i].char_code) {</span>
<span class="lineNum">     991 </span><span class="lineCov">          9 :                 gf_sys_format_help(helpout, help_flags, &quot;- %c: %s\n&quot;, GPAC_Keys[i].char_code, GPAC_Keys[i].cmd_help);</span>
<span class="lineNum">     992 </span><span class="lineCov">          9 :                 i++;</span>
<span class="lineNum">     993 </span>            :         }
<span class="lineNum">     994 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">     995 </span>            : 
<span class="lineNum">     996 </span>            : static char szFilter[100];
<a name="997"><span class="lineNum">     997 </span>            : static char szCom[2048];</a>
<span class="lineNum">     998 </span>            : static u64 run_start_time = 0;
<span class="lineNum">     999 </span><span class="lineCov">       2739 : static Bool gpac_fsess_task(GF_FilterSession *fsess, void *callback, u32 *reschedule_ms)</span>
<span class="lineNum">    1000 </span>            : {
<span class="lineNum">    1001 </span><span class="lineCov">       2739 :         if (enable_prompt &amp;&amp; gf_prompt_has_input()) {</span>
<span class="lineNum">    1002 </span>            :                 u32 i, count;
<span class="lineNum">    1003 </span>            :                 GF_Filter *filter;
<span class="lineNum">    1004 </span>            :                 const GF_Filter *link_from=NULL;
<span class="lineNum">    1005 </span>            :                 GF_Err e;
<span class="lineNum">    1006 </span>            :                 char *link_args = NULL;
<span class="lineNum">    1007 </span><span class="lineNoCov">          0 :                 GPAC_Command c = get_cmd(gf_prompt_get_char());</span>
<span class="lineNum">    1008 </span><span class="lineNoCov">          0 :                 switch (c) {</span>
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 :                 case GPAC_QUIT:</span>
<span class="lineNum">    1010 </span><span class="lineNoCov">          0 :                         gf_fs_abort(fsess, GF_TRUE);</span>
<span class="lineNum">    1011 </span><span class="lineNoCov">          0 :                         nb_loops = 0;</span>
<span class="lineNum">    1012 </span><span class="lineNoCov">          0 :                         return GF_FALSE;</span>
<span class="lineNum">    1013 </span><span class="lineNoCov">          0 :                 case GPAC_EXIT:</span>
<span class="lineNum">    1014 </span><span class="lineNoCov">          0 :                         gf_fs_abort(fsess, GF_FALSE);</span>
<span class="lineNum">    1015 </span><span class="lineNoCov">          0 :                         nb_loops = 0;</span>
<span class="lineNum">    1016 </span><span class="lineNoCov">          0 :                         return GF_FALSE;</span>
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :                 case GPAC_PRINT_STATS:</span>
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :                         gf_fs_print_stats(fsess);</span>
<span class="lineNum">    1019 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 :                 case GPAC_PRINT_GRAPH:</span>
<span class="lineNum">    1021 </span><span class="lineNoCov">          0 :                         gf_fs_print_connections(fsess);</span>
<span class="lineNum">    1022 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1023 </span><span class="lineNoCov">          0 :                 case GPAC_PRINT_HELP:</span>
<span class="lineNum">    1024 </span><span class="lineNoCov">          0 :                         gpac_fsess_task_help();</span>
<span class="lineNum">    1025 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1026 </span><span class="lineNoCov">          0 :                 case GPAC_SEND_UPDATE:</span>
<span class="lineNum">    1027 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Sending filter update - enter the target filter ID, name, registry name or #N with N the 0-based index in loaded filter list:\n&quot;);</span>
<span class="lineNum">    1028 </span>            : 
<span class="lineNum">    1029 </span><span class="lineNoCov">          0 :                         if (1 &gt; scanf(&quot;%99s&quot;, szFilter)) {</span>
<span class="lineNum">    1030 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Cannot read the filter ID, aborting.\n&quot;);</span>
<span class="lineNum">    1031 </span>            :                                 break;
<span class="lineNum">    1032 </span>            :                         }
<span class="lineNum">    1033 </span><span class="lineNoCov">          0 :                         e = GF_OK;</span>
<span class="lineNum">    1034 </span><span class="lineNoCov">          0 :                         if (szFilter[0]=='#') {</span>
<span class="lineNum">    1035 </span>            :                                 GF_FilterStats stats;
<span class="lineNum">    1036 </span><span class="lineNoCov">          0 :                                 u32 idx = atoi(szFilter+1);</span>
<span class="lineNum">    1037 </span><span class="lineNoCov">          0 :                                 gf_fs_lock_filters(fsess, GF_TRUE);</span>
<span class="lineNum">    1038 </span><span class="lineNoCov">          0 :                                 e = gf_fs_get_filter_stats(fsess, idx, &amp;stats);</span>
<span class="lineNum">    1039 </span><span class="lineNoCov">          0 :                                 gf_fs_lock_filters(fsess, GF_FALSE);</span>
<span class="lineNum">    1040 </span><span class="lineNoCov">          0 :                                 if (e==GF_OK)</span>
<span class="lineNum">    1041 </span><span class="lineNoCov">          0 :                                         strncpy(szFilter, stats.filter_id ? stats.filter_id : stats.name, 99);</span>
<span class="lineNum">    1042 </span>            :                         }
<span class="lineNum">    1043 </span><span class="lineNoCov">          0 :                         if (e) {</span>
<span class="lineNum">    1044 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Cannot get filter for ID %s, aborting.\n&quot;, szFilter);</span>
<span class="lineNum">    1045 </span>            :                                 break;
<span class="lineNum">    1046 </span>            :                         }
<span class="lineNum">    1047 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Enter the command to send\n&quot;);</span>
<span class="lineNum">    1048 </span><span class="lineNoCov">          0 :                         if (1 &gt; scanf(&quot;%2047s&quot;, szCom)) {</span>
<span class="lineNum">    1049 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Cannot read the command, aborting.\n&quot;);</span>
<span class="lineNum">    1050 </span>            :                                 break;
<span class="lineNum">    1051 </span>            :                         }
<span class="lineNum">    1052 </span><span class="lineNoCov">          0 :                         gf_fs_send_update(fsess, szFilter, NULL, szCom, NULL, 0);</span>
<span class="lineNum">    1053 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1054 </span><span class="lineNoCov">          0 :                 case GPAC_LIST_FILTERS:</span>
<span class="lineNum">    1055 </span><span class="lineNoCov">          0 :                         gf_fs_lock_filters(fsess, GF_TRUE);</span>
<span class="lineNum">    1056 </span><span class="lineNoCov">          0 :                         count = gf_fs_get_filters_count(fsess);</span>
<span class="lineNum">    1057 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Loaded filters:\n&quot;);</span>
<span class="lineNum">    1058 </span><span class="lineNoCov">          0 :                         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    1059 </span>            :                                 GF_FilterStats stats;
<span class="lineNum">    1060 </span><span class="lineNoCov">          0 :                                 gf_fs_get_filter_stats(fsess, i, &amp;stats);</span>
<span class="lineNum">    1061 </span><span class="lineNoCov">          0 :                                 if (stats.filter_id)</span>
<span class="lineNum">    1062 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;%s (%s) ID %s\n&quot;, stats.name, stats.reg_name, stats.filter_id);</span>
<span class="lineNum">    1063 </span>            :                                 else
<span class="lineNum">    1064 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;%s (%s)\n&quot;, stats.name, stats.reg_name);</span>
<span class="lineNum">    1065 </span>            :                         }
<span class="lineNum">    1066 </span><span class="lineNoCov">          0 :                         gf_fs_lock_filters(fsess, GF_FALSE);</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1068 </span><span class="lineNoCov">          0 :                 case GPAC_INSERT_FILTER:</span>
<span class="lineNum">    1069 </span>            :                 case GPAC_REMOVE_FILTER:
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;%s filter ID, name, registry name or #N with N the 0-based index in loaded filter list:\n&quot;,</span>
<span class="lineNum">    1071 </span>            :                                         (c==GPAC_INSERT_FILTER) ? &quot;Inserting filter - enter the source&quot; : &quot;Removing filter - enter the&quot;);
<span class="lineNum">    1072 </span>            : 
<span class="lineNum">    1073 </span><span class="lineNoCov">          0 :                         if (1 &gt; scanf(&quot;%99s&quot;, szFilter)) {</span>
<span class="lineNum">    1074 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Cannot read the filter ID or index, aborting.\n&quot;);</span>
<span class="lineNum">    1075 </span>            :                                 break;
<span class="lineNum">    1076 </span>            :                         }
<span class="lineNum">    1077 </span><span class="lineNoCov">          0 :                         link_args = strchr(szFilter, separator_set[SEP_LINK]);</span>
<span class="lineNum">    1078 </span><span class="lineNoCov">          0 :                         if (link_args) {</span>
<span class="lineNum">    1079 </span><span class="lineNoCov">          0 :                                 link_args[0] = 0;</span>
<span class="lineNum">    1080 </span><span class="lineNoCov">          0 :                                 link_args++;</span>
<span class="lineNum">    1081 </span>            :                         }
<span class="lineNum">    1082 </span><span class="lineNoCov">          0 :                         if (szFilter[0]=='#') {</span>
<span class="lineNum">    1083 </span>            :                                 GF_FilterStats stats;
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :                                 u32 idx = atoi(szFilter+1);</span>
<span class="lineNum">    1085 </span><span class="lineNoCov">          0 :                                 gf_fs_lock_filters(fsess, GF_TRUE);</span>
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :                                 gf_fs_get_filter_stats(fsess, idx, &amp;stats);</span>
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :                                 gf_fs_lock_filters(fsess, GF_FALSE);</span>
<span class="lineNum">    1088 </span><span class="lineNoCov">          0 :                                 link_from = stats.filter;</span>
<span class="lineNum">    1089 </span>            :                         } else {
<span class="lineNum">    1090 </span>            :                                 const GF_Filter *link_from_by_reg=NULL;
<span class="lineNum">    1091 </span><span class="lineNoCov">          0 :                                 gf_fs_lock_filters(fsess, GF_TRUE);</span>
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :                                 count = gf_fs_get_filters_count(fsess);</span>
<span class="lineNum">    1093 </span><span class="lineNoCov">          0 :                                 for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    1094 </span>            :                                         GF_FilterStats stats;
<span class="lineNum">    1095 </span><span class="lineNoCov">          0 :                                         gf_fs_get_filter_stats(fsess, i, &amp;stats);</span>
<span class="lineNum">    1096 </span><span class="lineNoCov">          0 :                                         if (!strcmp(stats.name, szFilter)) {</span>
<span class="lineNum">    1097 </span><span class="lineNoCov">          0 :                                                 link_from = stats.filter;</span>
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :                                                 break;</span>
<span class="lineNum">    1099 </span>            :                                         }
<span class="lineNum">    1100 </span><span class="lineNoCov">          0 :                                         if (!link_from_by_reg &amp;&amp; !strcmp(stats.reg_name, szFilter)) {</span>
<span class="lineNum">    1101 </span><span class="lineNoCov">          0 :                                                 link_from_by_reg = stats.filter;</span>
<span class="lineNum">    1102 </span>            :                                         }
<span class="lineNum">    1103 </span>            :                                 }
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :                                 gf_fs_lock_filters(fsess, GF_FALSE);</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :                                 if (!link_from)</span>
<span class="lineNum">    1106 </span>            :                                         link_from = link_from_by_reg;
<span class="lineNum">    1107 </span>            :                         }
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :                         if (!link_from) {</span>
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Failed to get filter %s, not found\n&quot;, szFilter);</span>
<span class="lineNum">    1110 </span>            :                                 break;
<span class="lineNum">    1111 </span>            :                         }
<span class="lineNum">    1112 </span>            : 
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :                         if (c==GPAC_REMOVE_FILTER) {</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :                                 gf_filter_remove((GF_Filter *) link_from);</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    1116 </span>            :                         }
<span class="lineNum">    1117 </span>            : 
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Enter the filter to insert\n&quot;);</span>
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 :                         if (1 &gt; scanf(&quot;%2047s&quot;, szCom)) {</span>
<span class="lineNum">    1120 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Cannot read the filter to insert, aborting.\n&quot;);</span>
<span class="lineNum">    1121 </span>            :                                 break;
<span class="lineNum">    1122 </span>            :                         }
<span class="lineNum">    1123 </span>            : 
<span class="lineNum">    1124 </span><span class="lineNoCov">          0 :                         if (!strncmp(szCom, &quot;src=&quot;, 4)) {</span>
<span class="lineNum">    1125 </span><span class="lineNoCov">          0 :                                 filter = gf_fs_load_source(fsess, szCom+4, NULL, NULL, &amp;e);</span>
<span class="lineNum">    1126 </span><span class="lineNoCov">          0 :                         } else if (!strncmp(szCom, &quot;dst=&quot;, 4)) {</span>
<span class="lineNum">    1127 </span><span class="lineNoCov">          0 :                                 filter = gf_fs_load_destination(fsess, szCom+4, NULL, NULL, &amp;e);</span>
<span class="lineNum">    1128 </span>            :                         } else {
<span class="lineNum">    1129 </span><span class="lineNoCov">          0 :                                 filter = gf_fs_load_filter(fsess, szCom, &amp;e);</span>
<span class="lineNum">    1130 </span>            :                         }
<span class="lineNum">    1131 </span>            : 
<span class="lineNum">    1132 </span><span class="lineNoCov">          0 :                         if (!filter) {</span>
<span class="lineNum">    1133 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Cannot load filter %s: %s\n&quot;, szCom, gf_error_to_string(e));</span>
<span class="lineNum">    1134 </span>            :                                 break;
<span class="lineNum">    1135 </span>            :                         }
<span class="lineNum">    1136 </span><span class="lineNoCov">          0 :                         gf_filter_set_source(filter, (GF_Filter *) link_from, link_args);</span>
<span class="lineNum">    1137 </span>            :                         //reconnect outputs of source
<span class="lineNum">    1138 </span><span class="lineNoCov">          0 :                         gf_filter_reconnect_output((GF_Filter *) link_from);</span>
<span class="lineNum">    1139 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1140 </span>            :                 default:
<span class="lineNum">    1141 </span>            :                         break;
<span class="lineNum">    1142 </span>            :                 }
<span class="lineNum">    1143 </span>            :         }
<span class="lineNum">    1144 </span><span class="lineCov">       2739 :         if (runfor&gt;0) {</span>
<span class="lineNum">    1145 </span><span class="lineCov">       2733 :                 u64 now = gf_sys_clock_high_res();</span>
<span class="lineNum">    1146 </span><span class="lineCov">       2733 :                 if (!run_start_time) run_start_time = now;</span>
<span class="lineNum">    1147 </span><span class="lineCov">       2700 :                 else if (now - run_start_time &gt; runfor) {</span>
<span class="lineNum">    1148 </span><span class="lineCov">         28 :                         if (nb_loops || loops_done) {</span>
<span class="lineNum">    1149 </span><span class="lineNoCov">          0 :                                 gf_fs_abort(fsess, runfor_exit ? GF_FALSE : GF_TRUE);</span>
<span class="lineNum">    1150 </span><span class="lineNoCov">          0 :                                 run_start_time = 0;</span>
<span class="lineNum">    1151 </span>            :                         } else {
<span class="lineNum">    1152 </span><span class="lineCov">         28 :                                 if (runfor_exit)</span>
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 :                                         exit(0);</span>
<span class="lineNum">    1154 </span><span class="lineCov">         28 :                                 gf_fs_abort(fsess, GF_TRUE);</span>
<span class="lineNum">    1155 </span>            :                         }
<span class="lineNum">    1156 </span>            :                         return GF_FALSE;
<span class="lineNum">    1157 </span>            :                 }
<span class="lineNum">    1158 </span>            :         }
<span class="lineNum">    1159 </span>            : 
<span class="lineNum">    1160 </span><span class="lineCov">       2711 :         if (gf_fs_is_last_task(fsess))</span>
<span class="lineNum">    1161 </span>            :                 return GF_FALSE;
<span class="lineNum">    1162 </span>            :         //check every 50 ms
<span class="lineNum">    1163 </span><span class="lineCov">       2703 :         *reschedule_ms = 50;</span>
<span class="lineNum">    1164 </span><span class="lineCov">       2703 :         return GF_TRUE;</span>
<span class="lineNum">    1165 </span>            : }
<span class="lineNum">    1166 </span>            : 
<span class="lineNum">    1167 </span>            : static Bool sigint_catched=GF_FALSE;
<span class="lineNum">    1168 </span>            : static Bool sigint_processed=GF_FALSE;
<span class="lineNum">    1169 </span>            : #ifdef WIN32
<span class="lineNum">    1170 </span>            : #include &lt;windows.h&gt;
<span class="lineNum">    1171 </span>            : static BOOL WINAPI gpac_sig_handler(DWORD sig)
<span class="lineNum">    1172 </span>            : {
<span class="lineNum">    1173 </span>            :         if (sig == CTRL_C_EVENT) {
<a name="1174"><span class="lineNum">    1174 </span>            : #else</a>
<span class="lineNum">    1175 </span>            : #include &lt;signal.h&gt;
<span class="lineNum">    1176 </span><span class="lineCov">          1 : static void gpac_sig_handler(int sig)</span>
<span class="lineNum">    1177 </span>            : {
<span class="lineNum">    1178 </span><span class="lineCov">          1 :         if (sig == SIGINT) {</span>
<span class="lineNum">    1179 </span>            : #endif
<span class="lineNum">    1180 </span><span class="lineCov">          1 :                 nb_loops = 0;</span>
<span class="lineNum">    1181 </span><span class="lineCov">          1 :                 if (session) {</span>
<span class="lineNum">    1182 </span><span class="lineNoCov">          0 :                         char input=0;</span>
<span class="lineNum">    1183 </span>            :                         int res;
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :                         if (sigint_catched) {</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :                                 if (sigint_processed) {</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;catched SIGINT twice and session not responding, forcing exit.\n&quot;);</span>
<span class="lineNum">    1187 </span>            :                                 }
<span class="lineNum">    1188 </span><span class="lineNoCov">          0 :                                 exit(1);</span>
<span class="lineNum">    1189 </span>            :                         }
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :                         sigint_catched = GF_TRUE;</span>
<span class="lineNum">    1191 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;catched SIGINT - flush session before exit ? (Y/n):\n&quot;);</span>
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :                         res = scanf(&quot;%c&quot;, &amp;input);</span>
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 :                         if (res!=1) input=0;</span>
<span class="lineNum">    1194 </span><span class="lineNoCov">          0 :                         switch (input) {</span>
<span class="lineNum">    1195 </span><span class="lineNoCov">          0 :                         case 'Y':</span>
<span class="lineNum">    1196 </span>            :                         case 'y':
<span class="lineNum">    1197 </span>            :                         case '\n':
<span class="lineNum">    1198 </span><span class="lineNoCov">          0 :                                 sigint_processed = GF_TRUE;</span>
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :                                 gf_fs_abort(session, GF_TRUE);</span>
<span class="lineNum">    1200 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    1201 </span>            :                         case 0:
<span class="lineNum">    1202 </span>            :                                 break;
<span class="lineNum">    1203 </span><span class="lineNoCov">          0 :                         default:</span>
<span class="lineNum">    1204 </span><span class="lineNoCov">          0 :                                 sigint_processed = GF_TRUE;</span>
<span class="lineNum">    1205 </span><span class="lineNoCov">          0 :                                 gf_fs_abort(session, GF_FALSE);</span>
<span class="lineNum">    1206 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    1207 </span>            :                         }
<span class="lineNum">    1208 </span>            :                 }
<span class="lineNum">    1209 </span>            :         }
<span class="lineNum">    1210 </span>            : #ifdef WIN32
<span class="lineNum">    1211 </span>            :         return TRUE;
<span class="lineNum">    1212 </span>            : #endif
<a name="1213"><span class="lineNum">    1213 </span><span class="lineCov">          1 : }</span></a>
<span class="lineNum">    1214 </span>            : 
<span class="lineNum">    1215 </span><span class="lineCov">          1 : static void parse_sep_set(const char *arg, Bool *override_seps)</span>
<span class="lineNum">    1216 </span>            : {
<span class="lineNum">    1217 </span><span class="lineCov">          1 :         if (!arg) return;</span>
<span class="lineNum">    1218 </span><span class="lineCov">          1 :         u32 len = (u32) strlen(arg);</span>
<span class="lineNum">    1219 </span><span class="lineCov">          1 :         if (!len) return;</span>
<span class="lineNum">    1220 </span><span class="lineCov">          1 :         *override_seps = GF_TRUE;</span>
<span class="lineNum">    1221 </span><span class="lineCov">          1 :         if (len&gt;=1) separator_set[0] = arg[0];</span>
<span class="lineNum">    1222 </span><span class="lineCov">          1 :         if (len&gt;=2) separator_set[1] = arg[1];</span>
<span class="lineNum">    1223 </span><span class="lineCov">          1 :         if (len&gt;=3) separator_set[2] = arg[2];</span>
<span class="lineNum">    1224 </span><span class="lineCov">          1 :         if (len&gt;=4) separator_set[3] = arg[3];</span>
<span class="lineNum">    1225 </span><span class="lineCov">          1 :         if (len&gt;=5) separator_set[4] = arg[4];</span>
<span class="lineNum">    1226 </span><span class="lineCov">          1 :         if (len&gt;=6) separator_set[5] = arg[5];</span>
<span class="lineNum">    1227 </span>            : }
<a name="1228"><span class="lineNum">    1228 </span>            : </a>
<span class="lineNum">    1229 </span>            : 
<span class="lineNum">    1230 </span><span class="lineCov">       1741 : static int gpac_exit_fun(int code, char **alias_argv, int alias_argc)</span>
<span class="lineNum">    1231 </span>            : {
<span class="lineNum">    1232 </span>            :         u32 i;
<span class="lineNum">    1233 </span><span class="lineCov">      21359 :         for (i=1; i&lt;gf_sys_get_argc(); i++) {</span>
<span class="lineNum">    1234 </span><span class="lineCov">      21359 :                 if (!gf_sys_is_arg_used(i)) {</span>
<span class="lineNum">    1235 </span><span class="lineNoCov">          0 :                         GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Warning: argument %s set but not used\n&quot;, gf_sys_get_arg(i) ));</span>
<span class="lineNum">    1236 </span>            :                 }
<span class="lineNum">    1237 </span>            :         }
<span class="lineNum">    1238 </span>            : 
<span class="lineNum">    1239 </span>            : 
<span class="lineNum">    1240 </span><span class="lineCov">       1741 :         if (alias_argv) {</span>
<span class="lineNum">    1241 </span><span class="lineCov">         10 :                 while (gf_list_count(args_alloc)) {</span>
<span class="lineNum">    1242 </span><span class="lineCov">          7 :                         gf_free(gf_list_pop_back(args_alloc));</span>
<span class="lineNum">    1243 </span>            :                 }
<span class="lineNum">    1244 </span><span class="lineCov">          3 :                 gf_list_del(args_alloc);</span>
<span class="lineNum">    1245 </span><span class="lineCov">          3 :                 gf_list_del(args_used);</span>
<span class="lineNum">    1246 </span><span class="lineCov">          3 :                 gf_free(alias_argv);</span>
<span class="lineNum">    1247 </span>            :         }
<span class="lineNum">    1248 </span><span class="lineCov">       1741 :         if (log_buf) gf_free(log_buf);</span>
<span class="lineNum">    1249 </span><span class="lineCov">       1741 :         if ((helpout != stdout) &amp;&amp; (helpout != stderr)) {</span>
<span class="lineNum">    1250 </span><span class="lineCov">          2 :                 if (gen_doc==2) {</span>
<span class="lineNum">    1251 </span>            :                         fprintf(helpout, &quot;.SH EXAMPLES\n.TP\nBasic and advanced examples are available at https://wiki.gpac.io/Filters\n&quot;);
<span class="lineNum">    1252 </span><span class="lineCov">          1 :                         fprintf(helpout, &quot;.SH MORE\n.LP\nAuthors: GPAC developers, see git repo history (-log)\n&quot;</span>
<span class="lineNum">    1253 </span>            :                         &quot;.br\nFor bug reports, feature requests, more information and source code, visit https://github.com/gpac/gpac\n&quot;
<span class="lineNum">    1254 </span>            :                         &quot;.br\nbuild: %s\n&quot;
<span class="lineNum">    1255 </span>            :                         &quot;.br\nCopyright: %s\n.br\n&quot;
<span class="lineNum">    1256 </span>            :                         &quot;.SH SEE ALSO\n&quot;
<span class="lineNum">    1257 </span>            :                         &quot;.LP\ngpac(1), MP4Client(1), MP4Box(1)\n&quot;, gf_gpac_version(), gf_gpac_copyright());
<span class="lineNum">    1258 </span>            :                 }
<span class="lineNum">    1259 </span><span class="lineCov">          2 :                 gf_fclose(helpout);</span>
<span class="lineNum">    1260 </span>            :         }
<span class="lineNum">    1261 </span>            : 
<span class="lineNum">    1262 </span><span class="lineCov">       1741 :         if (sidebar_md)</span>
<span class="lineNum">    1263 </span><span class="lineCov">          1 :                 gf_fclose(sidebar_md);</span>
<span class="lineNum">    1264 </span>            : 
<span class="lineNum">    1265 </span><span class="lineCov">       1741 :         if (static_logs) {</span>
<span class="lineNum">    1266 </span><span class="lineCov">         20 :                 for (i=0; i&lt;nb_log_entries; i++) {</span>
<span class="lineNum">    1267 </span><span class="lineCov">         20 :                         if (static_logs[i].szMsg)</span>
<span class="lineNum">    1268 </span><span class="lineCov">          9 :                                 gf_free(static_logs[i].szMsg);</span>
<span class="lineNum">    1269 </span>            :                 }
<span class="lineNum">    1270 </span><span class="lineCov">          2 :                 gf_free(static_logs);</span>
<span class="lineNum">    1271 </span>            :         }
<span class="lineNum">    1272 </span><span class="lineCov">       1741 :         gf_sys_close();</span>
<span class="lineNum">    1273 </span><span class="lineCov">       1741 :         if (code) return code;</span>
<span class="lineNum">    1274 </span>            : 
<span class="lineNum">    1275 </span>            : #ifdef GPAC_MEMORY_TRACKING
<span class="lineNum">    1276 </span><span class="lineCov">       1729 :         if (gf_memory_size() || gf_file_handles_count() ) {</span>
<span class="lineNum">    1277 </span><span class="lineNoCov">          0 :                 gf_log_set_tool_level(GF_LOG_MEMORY, GF_LOG_INFO);</span>
<span class="lineNum">    1278 </span><span class="lineNoCov">          0 :                 gf_memory_print();</span>
<span class="lineNum">    1279 </span>            :                 return 2;
<span class="lineNum">    1280 </span>            :         }
<span class="lineNum">    1281 </span>            : #endif
<span class="lineNum">    1282 </span>            :         return 0;
<span class="lineNum">    1283 </span>            : }
<span class="lineNum">    1284 </span>            : 
<span class="lineNum">    1285 </span>            : #define gpac_exit(_code) return gpac_exit_fun(_code, alias_argv, alias_argc)
<a name="1286"><span class="lineNum">    1286 </span>            : </a>
<span class="lineNum">    1287 </span>            : #include &lt;gpac/network.h&gt;
<span class="lineNum">    1288 </span><span class="lineCov">         26 : static void gpac_load_suggested_filter_args()</span>
<span class="lineNum">    1289 </span>            : {
<span class="lineNum">    1290 </span>            :         u32 i, count, k;
<span class="lineNum">    1291 </span>            :         GF_Config *opts = NULL;
<span class="lineNum">    1292 </span>            :         GF_FilterSession *fsess;
<span class="lineNum">    1293 </span>            :         const char *version, *cfg_path;
<span class="lineNum">    1294 </span>            :         char *all_opts;
<span class="lineNum">    1295 </span>            : 
<span class="lineNum">    1296 </span><span class="lineCov">         26 :         if (gf_opts_get_bool(&quot;core&quot;, &quot;no-argchk&quot;))</span>
<span class="lineNum">    1297 </span>            :                 return;
<span class="lineNum">    1298 </span>            : 
<span class="lineNum">    1299 </span><span class="lineCov">         26 :         cfg_path = gf_opts_get_filename();</span>
<span class="lineNum">    1300 </span><span class="lineCov">         26 :         all_opts = gf_url_concatenate(cfg_path, &quot;all_opts.txt&quot;);</span>
<span class="lineNum">    1301 </span>            : 
<span class="lineNum">    1302 </span><span class="lineCov">         26 :         opts = gf_cfg_force_new(&quot;probe&quot;, all_opts);</span>
<span class="lineNum">    1303 </span><span class="lineCov">         26 :         gf_free(all_opts);</span>
<span class="lineNum">    1304 </span>            : 
<span class="lineNum">    1305 </span><span class="lineCov">         26 :         version = gf_cfg_get_key(opts, &quot;version&quot;, &quot;version&quot;);</span>
<span class="lineNum">    1306 </span><span class="lineCov">         26 :         if (version &amp;&amp; !strcmp(version, gf_gpac_version()) ) {</span>
<span class="lineNum">    1307 </span><span class="lineCov">         24 :                 gf_cfg_del(opts);</span>
<span class="lineNum">    1308 </span><span class="lineCov">         24 :                 return;</span>
<span class="lineNum">    1309 </span>            :         }
<span class="lineNum">    1310 </span><span class="lineCov">          2 :         gf_cfg_del_section(opts, &quot;allopts&quot;);</span>
<span class="lineNum">    1311 </span><span class="lineCov">          2 :         gf_cfg_set_key(opts, &quot;version&quot;, &quot;version&quot;, gf_gpac_version());</span>
<span class="lineNum">    1312 </span>            : 
<span class="lineNum">    1313 </span><span class="lineCov">          2 :         gf_sys_format_help(stderr, 0, &quot;__Refreshing all options registry, this may take some time ... &quot;);</span>
<span class="lineNum">    1314 </span>            : 
<span class="lineNum">    1315 </span><span class="lineCov">          2 :         fsess = gf_fs_new(0, GF_FS_SCHEDULER_LOCK_FREE, GF_FS_FLAG_LOAD_META, NULL);</span>
<span class="lineNum">    1316 </span><span class="lineCov">          2 :         if (!fsess) {</span>
<span class="lineNum">    1317 </span><span class="lineNoCov">          0 :                 gf_sys_format_help(stderr, 0, &quot;\nWarning: Error creating session\n&quot;);</span>
<span class="lineNum">    1318 </span><span class="lineNoCov">          0 :                 gf_cfg_del(opts);</span>
<span class="lineNum">    1319 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">    1320 </span>            :         }
<span class="lineNum">    1321 </span>            : 
<span class="lineNum">    1322 </span><span class="lineCov">          2 :         count = gf_fs_filters_registers_count(fsess);</span>
<span class="lineNum">    1323 </span><span class="lineCov">       2412 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    1324 </span><span class="lineCov">       2410 :                 const GF_FilterRegister *freg = gf_fs_get_filter_register(fsess, i);</span>
<span class="lineNum">    1325 </span>            : 
<span class="lineNum">    1326 </span>            :                 k=0;
<span class="lineNum">    1327 </span><span class="lineCov">      11080 :                 while (freg-&gt;args) {</span>
<span class="lineNum">    1328 </span>            :                         const char *old_val;
<span class="lineNum">    1329 </span><span class="lineCov">       7088 :                         char *argn=NULL;</span>
<span class="lineNum">    1330 </span><span class="lineCov">       7088 :                         const GF_FilterArgs *arg = &amp;freg-&gt;args[k];</span>
<span class="lineNum">    1331 </span><span class="lineCov">       7088 :                         if (!arg || !arg-&gt;arg_name) {</span>
<span class="lineNum">    1332 </span>            :                                 break;
<span class="lineNum">    1333 </span>            :                         }
<span class="lineNum">    1334 </span><span class="lineCov">       6260 :                         k++;</span>
<span class="lineNum">    1335 </span><span class="lineCov">       6260 :                         if (arg-&gt;flags &amp; GF_FS_ARG_HINT_HIDE) continue;</span>
<span class="lineNum">    1336 </span>            : 
<span class="lineNum">    1337 </span><span class="lineCov">       6220 :                         if (arg-&gt;flags &amp; GF_FS_ARG_META) {</span>
<span class="lineNum">    1338 </span><span class="lineCov">       4582 :                                 gf_dynstrcat(&amp;argn, &quot;-+&quot;, NULL);</span>
<span class="lineNum">    1339 </span>            :                         } else {
<span class="lineNum">    1340 </span><span class="lineCov">       1638 :                                 gf_dynstrcat(&amp;argn, &quot;--&quot;, NULL);</span>
<span class="lineNum">    1341 </span>            :                         }
<span class="lineNum">    1342 </span><span class="lineCov">       6220 :                         gf_dynstrcat(&amp;argn, arg-&gt;arg_name, NULL);</span>
<span class="lineNum">    1343 </span>            : 
<span class="lineNum">    1344 </span><span class="lineCov">       6220 :                         old_val = gf_cfg_get_key(opts, &quot;allopts&quot;, argn);</span>
<span class="lineNum">    1345 </span><span class="lineCov">       6220 :                         if (old_val) {</span>
<span class="lineNum">    1346 </span><span class="lineCov">       3542 :                                 char *newval = gf_strdup(freg-&gt;name);</span>
<span class="lineNum">    1347 </span><span class="lineCov">       3542 :                                 gf_dynstrcat(&amp;newval, old_val, &quot; &quot;);</span>
<span class="lineNum">    1348 </span><span class="lineCov">       3542 :                                 gf_cfg_set_key(opts, &quot;allopts&quot;, argn, newval);</span>
<span class="lineNum">    1349 </span><span class="lineCov">       3542 :                                 gf_free(newval);</span>
<span class="lineNum">    1350 </span>            :                         } else {
<span class="lineNum">    1351 </span><span class="lineCov">       2678 :                                 gf_cfg_set_key(opts, &quot;allopts&quot;, argn, freg-&gt;name);</span>
<span class="lineNum">    1352 </span>            :                         }
<span class="lineNum">    1353 </span><span class="lineCov">       6220 :                         gf_free(argn);</span>
<span class="lineNum">    1354 </span>            :                 }
<span class="lineNum">    1355 </span>            :         }
<span class="lineNum">    1356 </span><span class="lineCov">          2 :         gf_fs_del(fsess);</span>
<span class="lineNum">    1357 </span><span class="lineCov">          2 :         gf_cfg_del(opts);</span>
<span class="lineNum">    1358 </span><span class="lineCov">          2 :         gf_sys_format_help(stderr, 0, &quot;done\n&quot;);</span>
<span class="lineNum">    1359 </span>            : }
<a name="1360"><span class="lineNum">    1360 </span>            : </a>
<span class="lineNum">    1361 </span>            : 
<span class="lineNum">    1362 </span><span class="lineCov">          1 : static void gpac_suggest_arg(char *aname)</span>
<span class="lineNum">    1363 </span>            : {
<span class="lineNum">    1364 </span>            :         u32 k;
<span class="lineNum">    1365 </span>            :         const GF_GPACArg *args;
<span class="lineNum">    1366 </span><span class="lineCov">          1 :         if (!aname) return;</span>
<span class="lineNum">    1367 </span>            :         Bool found=GF_FALSE;
<span class="lineNum">    1368 </span><span class="lineCov">          2 :         for (k=0; k&lt;2; k++) {</span>
<span class="lineNum">    1369 </span>            :                 u32 i=0;
<span class="lineNum">    1370 </span><span class="lineCov">          2 :                 if (k==0) args = gpac_args;</span>
<span class="lineNum">    1371 </span><span class="lineCov">          1 :                 else args = gf_sys_get_options();</span>
<span class="lineNum">    1372 </span>            : 
<span class="lineNum">    1373 </span><span class="lineCov">        120 :                 while (args[i].name) {</span>
<span class="lineNum">    1374 </span>            :                         const GF_GPACArg *arg = &amp;args[i];
<span class="lineNum">    1375 </span><span class="lineCov">        118 :                         i++;</span>
<span class="lineNum">    1376 </span><span class="lineCov">        118 :                         if (gf_sys_word_match(aname, arg-&gt;name)) {</span>
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :                                 if (!found) {</span>
<span class="lineNum">    1378 </span><span class="lineNoCov">          0 :                                         GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Unrecognized option \&quot;%s\&quot;, did you mean:\n&quot;, aname));</span>
<span class="lineNum">    1379 </span>            :                                         found = GF_TRUE;
<span class="lineNum">    1380 </span>            :                                 }
<span class="lineNum">    1381 </span><span class="lineNoCov">          0 :                                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;\t-%s (see gpac -hx%s)\n&quot;, arg-&gt;name, k ? &quot; core&quot; : &quot;&quot;));</span>
<span class="lineNum">    1382 </span>            :                         }
<span class="lineNum">    1383 </span>            :                 }
<span class="lineNum">    1384 </span>            :         }
<span class="lineNum">    1385 </span><span class="lineCov">          1 :         if (!found) {</span>
<span class="lineNum">    1386 </span><span class="lineCov">          1 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Unrecognized option \&quot;%s\&quot;, check usage \&quot;gpac -h\&quot;\n&quot;, aname));</span>
<span class="lineNum">    1387 </span>            :         }
<a name="1388"><span class="lineNum">    1388 </span>            : }</a>
<span class="lineNum">    1389 </span>            : 
<span class="lineNum">    1390 </span><span class="lineCov">          8 : static void gpac_suggest_filter(char *fname, Bool is_help, Bool filter_only)</span>
<span class="lineNum">    1391 </span>            : {
<span class="lineNum">    1392 </span>            :         Bool found = GF_FALSE;
<span class="lineNum">    1393 </span>            :         u32 i, count;
<span class="lineNum">    1394 </span><span class="lineCov">          8 :         if (!fname) return;</span>
<span class="lineNum">    1395 </span><span class="lineCov">          8 :         count = gf_fs_filters_registers_count(session);</span>
<span class="lineNum">    1396 </span><span class="lineCov">       8443 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    1397 </span><span class="lineCov">       8435 :                 const GF_FilterRegister *freg = gf_fs_get_filter_register(session, i);</span>
<span class="lineNum">    1398 </span>            : 
<span class="lineNum">    1399 </span><span class="lineCov">       8435 :                 if (gf_sys_word_match(fname, freg-&gt;name)) {</span>
<span class="lineNum">    1400 </span><span class="lineCov">          4 :                         if (!found) {</span>
<span class="lineNum">    1401 </span>            :                                 found = GF_TRUE;
<span class="lineNum">    1402 </span><span class="lineCov">          4 :                                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Closest filter names: \n&quot;));</span>
<span class="lineNum">    1403 </span>            :                         }
<span class="lineNum">    1404 </span><span class="lineCov">          4 :                         GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;- %s\n&quot;, freg-&gt;name));</span>
<span class="lineNum">    1405 </span>            :                 }
<span class="lineNum">    1406 </span>            :         }
<span class="lineNum">    1407 </span><span class="lineCov">          8 :         if (!found &amp;&amp; is_help) {</span>
<span class="lineNum">    1408 </span><span class="lineCov">          3 :                 const char *doc_helps[] = {</span>
<span class="lineNum">    1409 </span>            :                         &quot;log&quot;, &quot;core&quot;, &quot;modules&quot;, &quot;doc&quot;, &quot;alias&quot;, &quot;props&quot;, &quot;colors&quot;, &quot;cfg&quot;, &quot;prompt&quot;, &quot;codecs&quot;, &quot;links&quot;, &quot;bin&quot;, &quot;filters&quot;, &quot;filters:*&quot;, &quot;filters:@&quot;, NULL
<span class="lineNum">    1410 </span>            :                 };
<span class="lineNum">    1411 </span>            :                 i=0;
<span class="lineNum">    1412 </span><span class="lineCov">         51 :                 while (doc_helps[i]) {</span>
<span class="lineNum">    1413 </span><span class="lineCov">         45 :                         if (gf_sys_word_match(fname, doc_helps[i])) {</span>
<span class="lineNum">    1414 </span><span class="lineCov">          2 :                                 if (!found) {</span>
<span class="lineNum">    1415 </span>            :                                         found = GF_TRUE;
<span class="lineNum">    1416 </span><span class="lineCov">          2 :                                         GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Closest help command: \n&quot;));</span>
<span class="lineNum">    1417 </span>            :                                 }
<span class="lineNum">    1418 </span><span class="lineCov">          2 :                                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;-h %s\n&quot;, doc_helps[i]));</span>
<span class="lineNum">    1419 </span>            :                         }
<span class="lineNum">    1420 </span><span class="lineCov">         45 :                         i++;</span>
<span class="lineNum">    1421 </span>            :                 }
<span class="lineNum">    1422 </span><span class="lineCov">          3 :                 if (!filter_only) {</span>
<span class="lineNum">    1423 </span>            :                         Bool arg_found=GF_FALSE;
<span class="lineNum">    1424 </span><span class="lineCov">          3 :                         u32 nb_alias = gf_opts_get_key_count(&quot;gpac.alias&quot;);</span>
<span class="lineNum">    1425 </span><span class="lineCov">         24 :                         for (i=0; i&lt;nb_alias; i++) {</span>
<span class="lineNum">    1426 </span><span class="lineCov">         21 :                                 const char *alias = gf_opts_get_key_name(&quot;gpac.alias&quot;, i);</span>
<span class="lineNum">    1427 </span><span class="lineCov">         21 :                                 if (gf_sys_word_match(fname, alias)) {</span>
<span class="lineNum">    1428 </span><span class="lineNoCov">          0 :                                         if (!found) {</span>
<span class="lineNum">    1429 </span>            :                                                 found = GF_TRUE;
<span class="lineNum">    1430 </span><span class="lineNoCov">          0 :                                                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Closest alias: \n&quot;));</span>
<span class="lineNum">    1431 </span>            :                                         }
<span class="lineNum">    1432 </span><span class="lineNoCov">          0 :                                         GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;%s\n&quot;, alias));</span>
<span class="lineNum">    1433 </span>            :                                 }
<span class="lineNum">    1434 </span>            :                         }
<span class="lineNum">    1435 </span><span class="lineCov">       3615 :                         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    1436 </span>            :                                 u32 j=0;
<span class="lineNum">    1437 </span><span class="lineCov">       3615 :                                 const GF_FilterRegister *reg = gf_fs_get_filter_register(session, i);</span>
<span class="lineNum">    1438 </span>            : 
<span class="lineNum">    1439 </span><span class="lineCov">      16620 :                                 while (reg-&gt;args) {</span>
<span class="lineNum">    1440 </span><span class="lineCov">      10632 :                                         const GF_FilterArgs *arg = &amp;reg-&gt;args[j];</span>
<span class="lineNum">    1441 </span><span class="lineCov">      10632 :                                         if (!arg || !arg-&gt;arg_name) break;</span>
<span class="lineNum">    1442 </span><span class="lineCov">       9390 :                                         j++;</span>
<span class="lineNum">    1443 </span><span class="lineCov">       9390 :                                         if (!gf_sys_word_match(fname, arg-&gt;arg_name)) continue;</span>
<span class="lineNum">    1444 </span>            : 
<span class="lineNum">    1445 </span><span class="lineCov">         26 :                                         if (!arg_found) {</span>
<span class="lineNum">    1446 </span><span class="lineCov">          2 :                                                 GF_LOG(GF_LOG_WARNING, GF_LOG_APP, (&quot;Closest matching filter option:\n&quot;, fname));</span>
<span class="lineNum">    1447 </span>            :                                                 arg_found = GF_TRUE;
<span class="lineNum">    1448 </span>            :                                                 found = GF_TRUE;
<span class="lineNum">    1449 </span>            :                                         }
<span class="lineNum">    1450 </span><span class="lineCov">         26 :                                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s.%s \n&quot;, reg-&gt;name, arg-&gt;arg_name);</span>
<span class="lineNum">    1451 </span>            :                                 }
<span class="lineNum">    1452 </span>            :                         }
<span class="lineNum">    1453 </span>            :                 }
<span class="lineNum">    1454 </span>            :         }
<span class="lineNum">    1455 </span><span class="lineCov">          8 :         if (!found) {</span>
<span class="lineNum">    1456 </span><span class="lineCov">          2 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;No filter %swith similar name found, see gpac -h filters%s\n&quot;,</span>
<span class="lineNum">    1457 </span>            :                         is_help ? &quot;or help command &quot; : &quot;&quot;,
<span class="lineNum">    1458 </span>            :                         is_help ? &quot; or gpac -h&quot; : &quot;&quot;
<span class="lineNum">    1459 </span>            :                 ));
<span class="lineNum">    1460 </span>            :         }
<a name="1461"><span class="lineNum">    1461 </span>            : }</a>
<span class="lineNum">    1462 </span>            : 
<span class="lineNum">    1463 </span><span class="lineNoCov">          0 : static void gpac_suggest_filter_arg(GF_Config *opts, char *argname, u32 atype)</span>
<span class="lineNum">    1464 </span>            : {
<span class="lineNum">    1465 </span>            :         char *keyname;
<span class="lineNum">    1466 </span>            :         const char *keyval;
<span class="lineNum">    1467 </span>            :         u32 i, count, len, nb_filters, j;
<span class="lineNum">    1468 </span>            :         Bool f_found = GF_FALSE;
<span class="lineNum">    1469 </span>            :         char szSep[2];
<span class="lineNum">    1470 </span>            : 
<span class="lineNum">    1471 </span><span class="lineNoCov">          0 :         if (gf_opts_get_bool(&quot;core&quot;, &quot;no-argchk&quot;))</span>
<span class="lineNum">    1472 </span><span class="lineNoCov">          0 :                 return;</span>
<span class="lineNum">    1473 </span>            : 
<span class="lineNum">    1474 </span><span class="lineNoCov">          0 :         szSep[0] = separator_set[0];</span>
<span class="lineNum">    1475 </span><span class="lineNoCov">          0 :         szSep[1] = 0;</span>
<span class="lineNum">    1476 </span>            : 
<span class="lineNum">    1477 </span><span class="lineNoCov">          0 :         len = (u32) strlen(argname);</span>
<span class="lineNum">    1478 </span><span class="lineNoCov">          0 :         keyname = gf_malloc(sizeof(char)*(len+3));</span>
<span class="lineNum">    1479 </span><span class="lineNoCov">          0 :         sprintf(keyname, &quot;-%c%s&quot;, (atype==2) ? '+' : '-', argname);</span>
<span class="lineNum">    1480 </span><span class="lineNoCov">          0 :         keyval = gf_cfg_get_key(opts, &quot;allopts&quot;, keyname);</span>
<span class="lineNum">    1481 </span><span class="lineNoCov">          0 :         gf_free(keyname);</span>
<span class="lineNum">    1482 </span><span class="lineNoCov">          0 :         if (keyval) {</span>
<span class="lineNum">    1483 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Argument \&quot;%s%s\&quot; was set but not used by any filter\n&quot;,</span>
<span class="lineNum">    1484 </span>            :                 (atype==2) ? &quot;-+&quot; : (atype ? &quot;--&quot; : szSep), argname));
<span class="lineNum">    1485 </span>            :                 return;
<span class="lineNum">    1486 </span>            :         }
<span class="lineNum">    1487 </span>            : 
<span class="lineNum">    1488 </span><span class="lineNoCov">          0 :         nb_filters = gf_fs_get_filters_count(session);</span>
<span class="lineNum">    1489 </span><span class="lineNoCov">          0 :         count = gf_cfg_get_key_count(opts, &quot;allopts&quot;);</span>
<span class="lineNum">    1490 </span><span class="lineNoCov">          0 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    1491 </span>            :                 Bool ffound = GF_FALSE;
<span class="lineNum">    1492 </span><span class="lineNoCov">          0 :                 const char *arg = gf_cfg_get_key_name(opts, &quot;allopts&quot;, i);</span>
<span class="lineNum">    1493 </span><span class="lineNoCov">          0 :                 const char *aval = gf_cfg_get_key(opts, &quot;allopts&quot;, arg);</span>
<span class="lineNum">    1494 </span><span class="lineNoCov">          0 :                 if ((arg[1]=='+') &amp;&amp; (atype!=2)) continue;</span>
<span class="lineNum">    1495 </span><span class="lineNoCov">          0 :                 if ((arg[1]=='-') &amp;&amp; (atype==2)) continue;</span>
<span class="lineNum">    1496 </span>            : 
<span class="lineNum">    1497 </span><span class="lineNoCov">          0 :                 arg += 2;</span>
<span class="lineNum">    1498 </span><span class="lineNoCov">          0 :                 u32 alen = (u32) strlen(arg);</span>
<span class="lineNum">    1499 </span><span class="lineNoCov">          0 :                 if (alen&gt;2*len) continue;</span>
<span class="lineNum">    1500 </span>            : 
<span class="lineNum">    1501 </span><span class="lineNoCov">          0 :                 for (j=0; j&lt;nb_filters; j++) {</span>
<span class="lineNum">    1502 </span>            :                         GF_FilterStats stats;
<span class="lineNum">    1503 </span><span class="lineNoCov">          0 :                         stats.reg_name = NULL;</span>
<span class="lineNum">    1504 </span><span class="lineNoCov">          0 :                         gf_fs_get_filter_stats(session, j, &amp;stats);</span>
<span class="lineNum">    1505 </span>            : 
<span class="lineNum">    1506 </span><span class="lineNoCov">          0 :                         if (stats.reg_name &amp;&amp; strstr(aval, stats.reg_name)) {</span>
<span class="lineNum">    1507 </span>            :                                 ffound = GF_TRUE;
<span class="lineNum">    1508 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    1509 </span>            :                         }
<span class="lineNum">    1510 </span>            :                 }
<span class="lineNum">    1511 </span><span class="lineNoCov">          0 :                 if (!ffound) continue;</span>
<span class="lineNum">    1512 </span>            : 
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 :                 if (gf_sys_word_match(argname, arg)) {</span>
<span class="lineNum">    1514 </span><span class="lineNoCov">          0 :                         if (!f_found) {</span>
<span class="lineNum">    1515 </span><span class="lineNoCov">          0 :                                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Unknown argument \&quot;%s%s\&quot; set but not used by any filter - possible matches\n&quot;,</span>
<span class="lineNum">    1516 </span>            :                                         (atype==2) ? &quot;-+&quot; : (atype ? &quot;--&quot; : szSep), argname));
<span class="lineNum">    1517 </span>            :                                 f_found = GF_TRUE;
<span class="lineNum">    1518 </span>            :                         }
<span class="lineNum">    1519 </span><span class="lineNoCov">          0 :                         GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;- %s in filters %s\n&quot;, arg, aval));</span>
<span class="lineNum">    1520 </span>            :                 }
<span class="lineNum">    1521 </span>            :         }
<span class="lineNum">    1522 </span><span class="lineNoCov">          0 :         if (!f_found) {</span>
<span class="lineNum">    1523 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Unknown argument \&quot;%s%s\&quot; set but not used by any filter - no matching argument found\n&quot;,</span>
<span class="lineNum">    1524 </span>            :                         (atype==2) ? &quot;-+&quot; : (atype ? &quot;--&quot; : szSep), argname));
<span class="lineNum">    1525 </span>            :         }
<a name="1526"><span class="lineNum">    1526 </span>            : }</a>
<span class="lineNum">    1527 </span>            : 
<span class="lineNum">    1528 </span><span class="lineCov">       1675 : static void gpac_check_session_args()</span>
<span class="lineNum">    1529 </span>            : {
<span class="lineNum">    1530 </span>            :         GF_Config *opts = NULL;
<span class="lineNum">    1531 </span><span class="lineCov">       1675 :         u32 idx = 0;</span>
<span class="lineNum">    1532 </span>            :         char *argname;
<span class="lineNum">    1533 </span>            :         u32 argtype;
<span class="lineNum">    1534 </span>            : 
<span class="lineNum">    1535 </span>            :         while (1) {
<span class="lineNum">    1536 </span><span class="lineCov">       1675 :                 if (gf_fs_enum_unmapped_options(session, &amp;idx, &amp;argname, &amp;argtype)==GF_FALSE)</span>
<span class="lineNum">    1537 </span>            :                         break;
<span class="lineNum">    1538 </span>            : 
<span class="lineNum">    1539 </span><span class="lineCov">         12 :                 if (!opts) {</span>
<span class="lineNum">    1540 </span><span class="lineCov">         12 :                         const char *cfg_path = gf_opts_get_filename();</span>
<span class="lineNum">    1541 </span><span class="lineCov">         12 :                         char *all_opts = gf_url_concatenate(cfg_path, &quot;all_opts.txt&quot;);</span>
<span class="lineNum">    1542 </span><span class="lineCov">         12 :                         opts = gf_cfg_new(NULL, all_opts);</span>
<span class="lineNum">    1543 </span><span class="lineCov">         12 :                         gf_free(all_opts);</span>
<span class="lineNum">    1544 </span>            :                 }
<span class="lineNum">    1545 </span><span class="lineCov">         12 :                 if (!opts) {</span>
<span class="lineNum">    1546 </span>            :                         break;
<span class="lineNum">    1547 </span>            :                 }
<span class="lineNum">    1548 </span><span class="lineNoCov">          0 :                 gpac_suggest_filter_arg(opts, argname, argtype);</span>
<span class="lineNum">    1549 </span>            :         }
<span class="lineNum">    1550 </span><span class="lineCov">       1675 :         if (opts) gf_cfg_del(opts);</span>
<a name="1551"><span class="lineNum">    1551 </span><span class="lineCov">       1675 : }</span></a>
<span class="lineNum">    1552 </span>            : 
<span class="lineNum">    1553 </span><span class="lineCov">       1742 : static int gpac_main(int argc, char **argv)</span>
<span class="lineNum">    1554 </span>            : {
<span class="lineNum">    1555 </span><span class="lineCov">       1742 :         GF_Err e=GF_OK;</span>
<span class="lineNum">    1556 </span>            :         int i;
<span class="lineNum">    1557 </span>            :         const char *profile=NULL;
<span class="lineNum">    1558 </span>            :         const char *session_js=NULL;
<span class="lineNum">    1559 </span>            :         u32 sflags=0;
<span class="lineNum">    1560 </span><span class="lineCov">       1742 :         Bool override_seps=GF_FALSE;</span>
<span class="lineNum">    1561 </span>            :         Bool write_profile=GF_FALSE;
<span class="lineNum">    1562 </span>            :         Bool write_core_opts=GF_FALSE;
<span class="lineNum">    1563 </span>            :         Bool write_extensions=GF_FALSE;
<span class="lineNum">    1564 </span>            :         GF_List *links_directive=NULL;
<span class="lineNum">    1565 </span>            :         GF_List *loaded_filters=NULL;
<span class="lineNum">    1566 </span>            :         GF_SysArgMode argmode = GF_ARGMODE_BASE;
<span class="lineNum">    1567 </span>            :         u32 nb_filters = 0;
<span class="lineNum">    1568 </span>            :         Bool nothing_to_do = GF_TRUE;
<span class="lineNum">    1569 </span>            :         GF_MemTrackerType mem_track=GF_MemTrackerNone;
<span class="lineNum">    1570 </span>            :         char *view_conn_for_filter = NULL;
<span class="lineNum">    1571 </span>            :         Bool view_filter_conn = GF_FALSE;
<span class="lineNum">    1572 </span>            :         Bool dump_codecs = GF_FALSE;
<span class="lineNum">    1573 </span>            :         Bool has_alias = GF_FALSE;
<span class="lineNum">    1574 </span>            :         Bool alias_set = GF_FALSE;
<span class="lineNum">    1575 </span>            :         GF_FilterSession *tmp_sess;
<span class="lineNum">    1576 </span>            :         Bool alias_is_play = GF_FALSE;
<span class="lineNum">    1577 </span>            :         Bool has_xopt = GF_FALSE;
<span class="lineNum">    1578 </span><span class="lineCov">       1742 :         helpout = stdout;</span>
<span class="lineNum">    1579 </span>            : 
<span class="lineNum">    1580 </span>            :         //look for mem track and profile, and also process all helpers
<span class="lineNum">    1581 </span><span class="lineCov">      23110 :         for (i=1; i&lt;argc; i++) {</span>
<span class="lineNum">    1582 </span><span class="lineCov">      21369 :                 char *arg = argv[i];</span>
<span class="lineNum">    1583 </span><span class="lineCov">      21369 :                 if (!strcmp(arg, &quot;-mem-track&quot;) || !strcmp(arg, &quot;-mem-track-stack&quot;)) {</span>
<span class="lineNum">    1584 </span>            : #ifdef GPAC_MEMORY_TRACKING
<span class="lineNum">    1585 </span><span class="lineCov">       1723 :             mem_track = !strcmp(arg, &quot;-mem-track-stack&quot;) ? GF_MemTrackerBackTrace : GF_MemTrackerSimple;</span>
<span class="lineNum">    1586 </span>            : #else
<span class="lineNum">    1587 </span>            :                         fprintf(stderr, &quot;WARNING - GPAC not compiled with Memory Tracker - ignoring \&quot;%s\&quot;\n&quot;, arg);
<span class="lineNum">    1588 </span>            : #endif
<span class="lineNum">    1589 </span><span class="lineCov">      19646 :                 } else if (!strncmp(arg, &quot;-p=&quot;, 3)) {</span>
<span class="lineNum">    1590 </span><span class="lineCov">       1719 :                         profile = arg+3;</span>
<span class="lineNum">    1591 </span><span class="lineCov">      17927 :                 } else if (!strncmp(arg, &quot;-mkl=&quot;, 5)) {</span>
<span class="lineNum">    1592 </span><span class="lineCov">          1 :                         return gpac_make_lang(arg+5);</span>
<span class="lineNum">    1593 </span>            :                 }
<span class="lineNum">    1594 </span>            :         }
<span class="lineNum">    1595 </span>            : 
<span class="lineNum">    1596 </span><span class="lineCov">       1741 :         gf_sys_init(mem_track, profile);</span>
<span class="lineNum">    1597 </span>            : 
<span class="lineNum">    1598 </span>            : //      gf_log_set_tool_level(GF_LOG_ALL, GF_LOG_WARNING);
<span class="lineNum">    1599 </span><span class="lineCov">       1741 :         gf_log_set_tool_level(GF_LOG_APP, GF_LOG_INFO);</span>
<span class="lineNum">    1600 </span>            : 
<span class="lineNum">    1601 </span><span class="lineCov">       1741 :         if (gf_opts_get_key_count(&quot;gpac.alias&quot;)) {</span>
<span class="lineNum">    1602 </span><span class="lineCov">      21350 :                 for (i=1; i&lt;argc; i++) {</span>
<span class="lineNum">    1603 </span><span class="lineCov">      21353 :                         char *arg = argv[i];</span>
<span class="lineNum">    1604 </span><span class="lineCov">      21353 :                         if (gf_opts_get_key(&quot;gpac.alias&quot;, arg) != NULL) {</span>
<span class="lineNum">    1605 </span>            :                                 has_alias = GF_TRUE;
<span class="lineNum">    1606 </span><span class="lineCov">          3 :                                 if (!strcmp(arg, &quot;-play&quot;))</span>
<span class="lineNum">    1607 </span>            :                                         alias_is_play = GF_TRUE;
<span class="lineNum">    1608 </span>            :                                 break;
<span class="lineNum">    1609 </span>            :                         }
<span class="lineNum">    1610 </span>            :                 }
<span class="lineNum">    1611 </span>            :                 if (has_alias) {
<span class="lineNum">    1612 </span><span class="lineCov">          3 :                         if (! gpac_expand_alias(argc, argv) ) {</span>
<span class="lineNum">    1613 </span><span class="lineNoCov">          0 :                                 gpac_exit(1);</span>
<span class="lineNum">    1614 </span>            :                         }
<span class="lineNum">    1615 </span><span class="lineCov">          3 :                         argc = alias_argc;</span>
<span class="lineNum">    1616 </span><span class="lineCov">          3 :                         argv = alias_argv;</span>
<span class="lineNum">    1617 </span>            :                 }
<span class="lineNum">    1618 </span>            :         }
<span class="lineNum">    1619 </span>            : 
<span class="lineNum">    1620 </span>            : 
<span class="lineNum">    1621 </span>            :         //this will parse default args
<span class="lineNum">    1622 </span><span class="lineCov">       1741 :         e = gf_sys_set_args(argc, (const char **) argv);</span>
<span class="lineNum">    1623 </span><span class="lineCov">       1741 :         if (e) {</span>
<span class="lineNum">    1624 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Error assigning libgpac arguments: %s\n&quot;, gf_error_to_string(e) );</span>
<span class="lineNum">    1625 </span><span class="lineNoCov">          0 :                 gpac_exit(1);</span>
<span class="lineNum">    1626 </span>            :         }
<span class="lineNum">    1627 </span>            : 
<span class="lineNum">    1628 </span><span class="lineCov">       1741 :         if (!profile || strcmp(profile, &quot;0&quot;) )</span>
<span class="lineNum">    1629 </span><span class="lineCov">         26 :                 gpac_load_suggested_filter_args();</span>
<span class="lineNum">    1630 </span>            : 
<span class="lineNum">    1631 </span>            : #ifndef GPAC_DISABLE_LOG
<span class="lineNum">    1632 </span><span class="lineCov">       1741 :         if (gf_log_tool_level_on(GF_LOG_APP, GF_LOG_DEBUG)) {</span>
<span class="lineNum">    1633 </span><span class="lineCov">          6 :                 GF_LOG(GF_LOG_DEBUG, GF_LOG_APP, (&quot;GPAC args: &quot;));</span>
<span class="lineNum">    1634 </span><span class="lineCov">         67 :                 for (i=1; i&lt;argc; i++) {</span>
<span class="lineNum">    1635 </span><span class="lineCov">         67 :                         char *arg = argv[i];</span>
<span class="lineNum">    1636 </span><span class="lineCov">         67 :                         GF_LOG(GF_LOG_DEBUG, GF_LOG_APP, (&quot;%s &quot;, arg));</span>
<span class="lineNum">    1637 </span>            :                 }
<span class="lineNum">    1638 </span><span class="lineCov">          6 :                 GF_LOG(GF_LOG_DEBUG, GF_LOG_APP, (&quot;\n&quot;));</span>
<span class="lineNum">    1639 </span>            :         }
<span class="lineNum">    1640 </span>            : #endif
<span class="lineNum">    1641 </span>            : 
<span class="lineNum">    1642 </span><span class="lineCov">      21308 :         for (i=1; i&lt;argc; i++) {</span>
<span class="lineNum">    1643 </span><span class="lineCov">      21331 :                 char *arg = argv[i];</span>
<span class="lineNum">    1644 </span><span class="lineCov">      21331 :                 char *arg_val = strchr(arg, '=');</span>
<span class="lineNum">    1645 </span><span class="lineCov">      21331 :                 if (arg_val) {</span>
<span class="lineNum">    1646 </span><span class="lineCov">       5004 :                         arg_val[0]=0;</span>
<span class="lineNum">    1647 </span><span class="lineCov">       5004 :                         arg_val++;</span>
<span class="lineNum">    1648 </span>            :                 }
<span class="lineNum">    1649 </span>            : 
<span class="lineNum">    1650 </span><span class="lineCov">      21331 :                 gf_sys_mark_arg_used(i, GF_TRUE);</span>
<span class="lineNum">    1651 </span>            : 
<span class="lineNum">    1652 </span><span class="lineCov">      21331 :                 if ((!has_xopt &amp;&amp; !strcmp(arg, &quot;-h&quot;)) || !strcmp(arg, &quot;-help&quot;) || !strcmp(arg, &quot;-ha&quot;) || !strcmp(arg, &quot;-hx&quot;) || !strcmp(arg, &quot;-hh&quot;)) {</span>
<span class="lineNum">    1653 </span><span class="lineCov">         55 :                         if (!strcmp(arg, &quot;-ha&quot;)) argmode = GF_ARGMODE_ADVANCED;</span>
<span class="lineNum">    1654 </span><span class="lineCov">         53 :                         else if (!strcmp(arg, &quot;-hx&quot;)) argmode = GF_ARGMODE_EXPERT;</span>
<span class="lineNum">    1655 </span><span class="lineCov">         51 :                         else if (!strcmp(arg, &quot;-hh&quot;)) argmode = GF_ARGMODE_ALL;</span>
<span class="lineNum">    1656 </span>            : 
<span class="lineNum">    1657 </span><span class="lineCov">         55 :                         if (i+1&lt;argc)</span>
<span class="lineNum">    1658 </span><span class="lineCov">         52 :                                 gf_sys_mark_arg_used(i+1, GF_TRUE);</span>
<span class="lineNum">    1659 </span>            : 
<span class="lineNum">    1660 </span><span class="lineCov">         55 :                         if ((i+1==argc) || (argv[i+1][0]=='-')) {</span>
<span class="lineNum">    1661 </span><span class="lineCov">          3 :                                 gpac_usage(argmode);</span>
<span class="lineNum">    1662 </span><span class="lineCov">          3 :                                 gpac_exit(0);</span>
<span class="lineNum">    1663 </span><span class="lineCov">         52 :                         } else if (!strcmp(argv[i+1], &quot;log&quot;)) {</span>
<span class="lineNum">    1664 </span><span class="lineCov">          1 :                                 gpac_core_help(GF_ARGMODE_ALL, GF_TRUE);</span>
<span class="lineNum">    1665 </span><span class="lineCov">          1 :                                 gpac_exit(0);</span>
<span class="lineNum">    1666 </span><span class="lineCov">         51 :                         } else if (!strcmp(argv[i+1], &quot;core&quot;)) {</span>
<span class="lineNum">    1667 </span><span class="lineCov">          1 :                                 gpac_core_help(argmode, GF_FALSE);</span>
<span class="lineNum">    1668 </span><span class="lineCov">          1 :                                 gpac_exit(0);</span>
<span class="lineNum">    1669 </span><span class="lineCov">         50 :                         } else if (!strcmp(argv[i+1], &quot;modules&quot;)) {</span>
<span class="lineNum">    1670 </span><span class="lineCov">          1 :                                 gpac_modules_help();</span>
<span class="lineNum">    1671 </span><span class="lineCov">          1 :                                 gpac_exit(0);</span>
<span class="lineNum">    1672 </span><span class="lineCov">         49 :                         } else if (!strcmp(argv[i+1], &quot;doc&quot;)) {</span>
<span class="lineNum">    1673 </span><span class="lineCov">          1 :                                 gpac_filter_help();</span>
<span class="lineNum">    1674 </span><span class="lineCov">          1 :                                 gpac_exit(0);</span>
<span class="lineNum">    1675 </span><span class="lineCov">         48 :                         } else if (!strcmp(argv[i+1], &quot;alias&quot;)) {</span>
<span class="lineNum">    1676 </span><span class="lineCov">          2 :                                 gpac_alias_help(argmode);</span>
<span class="lineNum">    1677 </span><span class="lineCov">          2 :                                 gpac_exit(0);</span>
<span class="lineNum">    1678 </span><span class="lineCov">         46 :                         } else if (!strcmp(argv[i+1], &quot;props&quot;)) {</span>
<span class="lineNum">    1679 </span><span class="lineCov">          1 :                                 dump_all_props();</span>
<span class="lineNum">    1680 </span><span class="lineCov">          1 :                                 gpac_exit(0);</span>
<span class="lineNum">    1681 </span><span class="lineCov">         45 :                         } else if (!strcmp(argv[i+1], &quot;colors&quot;)) {</span>
<span class="lineNum">    1682 </span><span class="lineCov">          1 :                                 dump_all_colors();</span>
<span class="lineNum">    1683 </span><span class="lineCov">          1 :                                 gpac_exit(0);</span>
<span class="lineNum">    1684 </span><span class="lineCov">         44 :                         } else if (!strcmp(argv[i+1], &quot;cfg&quot;)) {</span>
<span class="lineNum">    1685 </span><span class="lineNoCov">          0 :                                 gpac_config_help();</span>
<span class="lineNum">    1686 </span><span class="lineNoCov">          0 :                                 gpac_exit(0);</span>
<span class="lineNum">    1687 </span><span class="lineCov">         44 :                         } else if (!strcmp(argv[i+1], &quot;prompt&quot;)) {</span>
<span class="lineNum">    1688 </span><span class="lineNoCov">          0 :                                 gpac_fsess_task_help();</span>
<span class="lineNum">    1689 </span><span class="lineNoCov">          0 :                                 gpac_exit(0);</span>
<span class="lineNum">    1690 </span><span class="lineCov">         44 :                         } else if (!strcmp(argv[i+1], &quot;codecs&quot;)) {</span>
<span class="lineNum">    1691 </span>            :                                 dump_codecs = GF_TRUE;
<span class="lineNum">    1692 </span>            :                                 sflags |= GF_FS_FLAG_LOAD_META | GF_FS_FLAG_NO_GRAPH_CACHE;
<span class="lineNum">    1693 </span>            :                                 i++;
<span class="lineNum">    1694 </span><span class="lineCov">         43 :                         } else if (!strcmp(argv[i+1], &quot;links&quot;)) {</span>
<span class="lineNum">    1695 </span>            :                                 view_filter_conn = GF_TRUE;
<span class="lineNum">    1696 </span><span class="lineCov">          3 :                                 if ((i+2&lt;argc)       &amp;&amp; (argv[i+2][0] != '-')) {</span>
<span class="lineNum">    1697 </span>            :                                         view_conn_for_filter = argv[i+2];
<span class="lineNum">    1698 </span><span class="lineCov">          2 :                                         gf_sys_mark_arg_used(i+2, GF_TRUE);</span>
<span class="lineNum">    1699 </span>            :                                         i++;
<span class="lineNum">    1700 </span>            :                                 }
<span class="lineNum">    1701 </span>            : 
<span class="lineNum">    1702 </span><span class="lineCov">          3 :                                 i++;</span>
<span class="lineNum">    1703 </span><span class="lineCov">         40 :                         } else if (!strcmp(argv[i+1], &quot;bin&quot;)) {</span>
<span class="lineNum">    1704 </span><span class="lineCov">         11 :                                 gf_sys_format_help(helpout, help_flags, &quot;GPAC binary information:\n&quot;\</span>
<span class="lineNum">    1705 </span>            :                                         &quot;Version: %s\n&quot;\
<span class="lineNum">    1706 </span>            :                                 &quot;Compilation configuration: &quot; GPAC_CONFIGURATION &quot;\n&quot;\
<span class="lineNum">    1707 </span>            :                                 &quot;Enabled features: %s\n&quot; \
<span class="lineNum">    1708 </span>            :                                 &quot;Disabled features: %s\n&quot;, gf_gpac_version(), gf_sys_features(GF_FALSE), gf_sys_features(GF_TRUE)
<span class="lineNum">    1709 </span>            :                                 );
<span class="lineNum">    1710 </span><span class="lineCov">         11 :                                 gpac_exit(0);</span>
<span class="lineNum">    1711 </span><span class="lineCov">         29 :                         } else if (!strcmp(argv[i+1], &quot;filters&quot;)) {</span>
<span class="lineNum">    1712 </span><span class="lineCov">          2 :                                 list_filters = 1;</span>
<span class="lineNum">    1713 </span><span class="lineCov">          2 :                                 sflags |= GF_FS_FLAG_NO_GRAPH_CACHE;</span>
<span class="lineNum">    1714 </span>            :                                 i++;
<span class="lineNum">    1715 </span><span class="lineCov">         27 :                         } else if (!strcmp(argv[i+1], &quot;filters:*&quot;) || !strcmp(argv[i+1], &quot;filters:@&quot;)) {</span>
<span class="lineNum">    1716 </span><span class="lineCov">          1 :                                 list_filters = 2;</span>
<span class="lineNum">    1717 </span><span class="lineCov">          1 :                                 sflags |= GF_FS_FLAG_NO_GRAPH_CACHE;</span>
<span class="lineNum">    1718 </span><span class="lineCov">          1 :                                 i++;</span>
<span class="lineNum">    1719 </span>            :                         } else {
<span class="lineNum">    1720 </span><span class="lineCov">         26 :                                 print_filter_info = 1;</span>
<span class="lineNum">    1721 </span><span class="lineCov">         26 :                                 if (!strcmp(argv[i+1], &quot;*:*&quot;) || !strcmp(argv[i+1], &quot;@:@&quot;))</span>
<span class="lineNum">    1722 </span><span class="lineCov">          1 :                                         print_filter_info = 2;</span>
<span class="lineNum">    1723 </span><span class="lineCov">         26 :                                 sflags |= GF_FS_FLAG_NO_GRAPH_CACHE;</span>
<span class="lineNum">    1724 </span>            :                         }
<span class="lineNum">    1725 </span>            :                 }
<span class="lineNum">    1726 </span><span class="lineCov">      21276 :                 else if (has_xopt &amp;&amp; !strcmp(arg, &quot;-h&quot;)) {</span>
<span class="lineNum">    1727 </span><span class="lineNoCov">          0 :                         gf_opts_set_key(&quot;temp&quot;, &quot;gpac-help&quot;, &quot;yes&quot;);</span>
<span class="lineNum">    1728 </span>            :                 }
<span class="lineNum">    1729 </span><span class="lineCov">      21276 :                 else if (!strcmp(arg, &quot;-genmd&quot;) || !strcmp(arg, &quot;-genman&quot;)) {</span>
<span class="lineNum">    1730 </span>            :                         argmode = GF_ARGMODE_ALL;
<span class="lineNum">    1731 </span><span class="lineCov">          2 :                         if (!strcmp(arg, &quot;-genmd&quot;)) {</span>
<span class="lineNum">    1732 </span><span class="lineCov">          1 :                                 gf_opts_set_key(&quot;temp&quot;, &quot;gendoc&quot;, &quot;yes&quot;);</span>
<span class="lineNum">    1733 </span><span class="lineCov">          1 :                                 gen_doc = 1;</span>
<span class="lineNum">    1734 </span><span class="lineCov">          1 :                                 help_flags = GF_PRINTARG_MD;</span>
<span class="lineNum">    1735 </span><span class="lineCov">          1 :                                 helpout = gf_fopen(&quot;gpac_general.md&quot;, &quot;w&quot;);</span>
<span class="lineNum">    1736 </span>            :                                 fprintf(helpout, &quot;[**HOME**](Home)  [**Filters**](Filters)  Usage\n&quot;);
<span class="lineNum">    1737 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;%s&quot;, auto_gen_md_warning);</span>
<span class="lineNum">    1738 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;# General Usage of gpac\n&quot;);</span>
<span class="lineNum">    1739 </span>            :                         } else {
<span class="lineNum">    1740 </span><span class="lineCov">          1 :                                 gf_opts_set_key(&quot;temp&quot;, &quot;gendoc&quot;, &quot;yes&quot;);</span>
<span class="lineNum">    1741 </span><span class="lineCov">          1 :                                 gen_doc = 2;</span>
<span class="lineNum">    1742 </span><span class="lineCov">          1 :                                 help_flags = GF_PRINTARG_MAN;</span>
<span class="lineNum">    1743 </span><span class="lineCov">          1 :                                 helpout = gf_fopen(&quot;gpac.1&quot;, &quot;w&quot;);</span>
<span class="lineNum">    1744 </span>            :                                 fprintf(helpout, &quot;.TH gpac 1 2019 gpac GPAC\n&quot;);
<span class="lineNum">    1745 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;.\n.SH NAME\n.LP\ngpac \\- GPAC command-line filter session manager\n&quot;</span>
<span class="lineNum">    1746 </span>            :                                 &quot;.SH SYNOPSIS\n.LP\n.B gpac\n&quot;
<span class="lineNum">    1747 </span>            :                                 &quot;.RI [options] FILTER [LINK] FILTER [...]\n.br\n.\n&quot;);
<span class="lineNum">    1748 </span>            :                         }
<span class="lineNum">    1749 </span><span class="lineCov">          2 :                         gpac_usage(GF_ARGMODE_ALL);</span>
<span class="lineNum">    1750 </span>            : 
<span class="lineNum">    1751 </span><span class="lineCov">          2 :                         if (gen_doc==1) {</span>
<span class="lineNum">    1752 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;# Using Aliases\n&quot;);</span>
<span class="lineNum">    1753 </span>            :                         } else {
<span class="lineNum">    1754 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;.SH Using Aliases\n.PL\n&quot;);</span>
<span class="lineNum">    1755 </span>            :                         }
<span class="lineNum">    1756 </span><span class="lineCov">          2 :                         gpac_alias_help(GF_ARGMODE_EXPERT);</span>
<span class="lineNum">    1757 </span>            : 
<span class="lineNum">    1758 </span><span class="lineCov">          2 :                         if (gen_doc==1) {</span>
<span class="lineNum">    1759 </span><span class="lineCov">          1 :                                 gf_fclose(helpout);</span>
<span class="lineNum">    1760 </span><span class="lineCov">          1 :                                 helpout = gf_fopen(&quot;core_config.md&quot;, &quot;w&quot;);</span>
<span class="lineNum">    1761 </span>            :                                 fprintf(helpout, &quot;[**HOME**](Home)  [**Filters**](Filters)  Configuration\n&quot;);
<span class="lineNum">    1762 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;%s&quot;, auto_gen_md_warning);</span>
<span class="lineNum">    1763 </span>            :                         }
<span class="lineNum">    1764 </span><span class="lineCov">          2 :                         gpac_config_help();</span>
<span class="lineNum">    1765 </span>            : 
<span class="lineNum">    1766 </span><span class="lineCov">          2 :                         if (gen_doc==1) {</span>
<span class="lineNum">    1767 </span><span class="lineCov">          1 :                                 gf_fclose(helpout);</span>
<span class="lineNum">    1768 </span><span class="lineCov">          1 :                                 helpout = gf_fopen(&quot;core_options.md&quot;, &quot;w&quot;);</span>
<span class="lineNum">    1769 </span>            :                                 fprintf(helpout, &quot;[**HOME**](Home)  [**Filters**](Filters)  Core Options\n&quot;);
<span class="lineNum">    1770 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;%s&quot;, auto_gen_md_warning);</span>
<span class="lineNum">    1771 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;# GPAC Core Options\n&quot;);</span>
<span class="lineNum">    1772 </span>            :                         }
<span class="lineNum">    1773 </span><span class="lineCov">          2 :                         gpac_core_help(argmode, GF_FALSE);</span>
<span class="lineNum">    1774 </span>            : 
<span class="lineNum">    1775 </span><span class="lineCov">          2 :                         if (gen_doc==1) {</span>
<span class="lineNum">    1776 </span><span class="lineCov">          1 :                                 gf_fclose(helpout);</span>
<span class="lineNum">    1777 </span><span class="lineCov">          1 :                                 helpout = gf_fopen(&quot;core_logs.md&quot;, &quot;w&quot;);</span>
<span class="lineNum">    1778 </span>            :                                 fprintf(helpout, &quot;[**HOME**](Home)  [**Filters**](Filters)  Logging System\n&quot;);
<span class="lineNum">    1779 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;%s&quot;, auto_gen_md_warning);</span>
<span class="lineNum">    1780 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;# GPAC Log System\n&quot;);</span>
<span class="lineNum">    1781 </span>            :                         }
<span class="lineNum">    1782 </span><span class="lineCov">          2 :                         gpac_core_help(argmode, GF_TRUE);</span>
<span class="lineNum">    1783 </span>            : 
<span class="lineNum">    1784 </span><span class="lineCov">          2 :                         if (gen_doc==1) {</span>
<span class="lineNum">    1785 </span><span class="lineCov">          1 :                                 gf_fclose(helpout);</span>
<span class="lineNum">    1786 </span><span class="lineCov">          1 :                                 helpout = gf_fopen(&quot;filters_general.md&quot;, &quot;w&quot;);</span>
<span class="lineNum">    1787 </span>            :                                 fprintf(helpout, &quot;[**HOME**](Home)  [**Filters**](Filters)  General Concepts\n&quot;);
<span class="lineNum">    1788 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;%s&quot;, auto_gen_md_warning);</span>
<span class="lineNum">    1789 </span>            :                         }
<span class="lineNum">    1790 </span><span class="lineCov">          2 :                         gf_sys_format_help(helpout, help_flags, &quot;%s&quot;, gpac_doc);</span>
<span class="lineNum">    1791 </span>            : 
<span class="lineNum">    1792 </span><span class="lineCov">          2 :                         if (gen_doc==1) {</span>
<span class="lineNum">    1793 </span><span class="lineCov">          1 :                                 gf_fclose(helpout);</span>
<span class="lineNum">    1794 </span><span class="lineCov">          1 :                                 helpout = gf_fopen(&quot;filters_properties.md&quot;, &quot;w&quot;);</span>
<span class="lineNum">    1795 </span>            :                                 fprintf(helpout, &quot;[**HOME**](Home)  [**Filters**](Filters)  Built-in Properties\n&quot;);
<span class="lineNum">    1796 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;%s&quot;, auto_gen_md_warning);</span>
<span class="lineNum">    1797 </span>            :                         }
<span class="lineNum">    1798 </span><span class="lineCov">          2 :                         gf_sys_format_help(helpout, help_flags, &quot;# GPAC Built-in properties\n&quot;);</span>
<span class="lineNum">    1799 </span><span class="lineCov">          2 :                         dump_all_props();</span>
<span class="lineNum">    1800 </span>            : //                      dump_codecs = GF_TRUE;
<span class="lineNum">    1801 </span>            : 
<span class="lineNum">    1802 </span><span class="lineCov">          2 :                         if (gen_doc==2) {</span>
<span class="lineNum">    1803 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;.SH EXAMPLES\n.TP\nBasic and advanced examples are available at https://wiki.gpac.io/Filters\n&quot;);</span>
<span class="lineNum">    1804 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;.SH MORE\n.LP\nAuthors: GPAC developers, see git repo history (-log)\n&quot;</span>
<span class="lineNum">    1805 </span>            :                                 &quot;.br\nFor bug reports, feature requests, more information and source code, visit https://github.com/gpac/gpac\n&quot;
<span class="lineNum">    1806 </span>            :                                 &quot;.br\nbuild: %s\n&quot;
<span class="lineNum">    1807 </span>            :                                 &quot;.br\nCopyright: %s\n.br\n&quot;
<span class="lineNum">    1808 </span>            :                                 &quot;.SH SEE ALSO\n&quot;
<span class="lineNum">    1809 </span>            :                                 &quot;.LP\ngpac-filters(1), MP4Client(1), MP4Box(1)\n&quot;, gf_gpac_version(), gf_gpac_copyright());
<span class="lineNum">    1810 </span><span class="lineCov">          1 :                                 gf_fclose(helpout);</span>
<span class="lineNum">    1811 </span>            : 
<span class="lineNum">    1812 </span><span class="lineCov">          1 :                                 helpout = gf_fopen(&quot;gpac-filters.1&quot;, &quot;w&quot;);</span>
<span class="lineNum">    1813 </span>            :                                 fprintf(helpout, &quot;.TH gpac 1 2019 gpac GPAC\n&quot;);
<span class="lineNum">    1814 </span><span class="lineCov">          1 :                                 fprintf(helpout, &quot;.\n.SH NAME\n.LP\ngpac \\- GPAC command-line filter session manager\n&quot;</span>
<span class="lineNum">    1815 </span>            :                                 &quot;.SH SYNOPSIS\n.LP\n.B gpac\n&quot;
<span class="lineNum">    1816 </span>            :                                 &quot;.RI [options] FILTER [LINK] FILTER [...]\n.br\n.\n&quot;
<span class="lineNum">    1817 </span>            :                                 &quot;.SH DESCRIPTION\n.LP&quot;
<span class="lineNum">    1818 </span>            :                                 &quot;\nThis page describes all filters usually present in GPAC\n&quot;
<span class="lineNum">    1819 </span>            :                                 &quot;\nTo check for help on a filter not listed here, use gpac -h myfilter\n&quot;
<span class="lineNum">    1820 </span>            :                                 &quot;\n&quot;
<span class="lineNum">    1821 </span>            :                                 );
<span class="lineNum">    1822 </span>            :                         }
<span class="lineNum">    1823 </span>            : 
<span class="lineNum">    1824 </span><span class="lineCov">          2 :                         list_filters = 1;</span>
<span class="lineNum">    1825 </span>            :                 }
<span class="lineNum">    1826 </span><span class="lineCov">      21274 :                 else if (!strcmp(arg, &quot;-ltf&quot;)) {</span>
<span class="lineNum">    1827 </span><span class="lineCov">        142 :                         load_test_filters = GF_TRUE;</span>
<span class="lineNum">    1828 </span><span class="lineCov">      21132 :                 } else if (!strncmp(arg, &quot;-lcf&quot;, 4)) {</span>
<span class="lineNum">    1829 </span><span class="lineCov">      21131 :                 } else if (!strcmp(arg, &quot;-stats&quot;)) {</span>
<span class="lineNum">    1830 </span><span class="lineCov">        391 :                         dump_stats = GF_TRUE;</span>
<span class="lineNum">    1831 </span><span class="lineCov">      20740 :                 } else if (!strcmp(arg, &quot;-graph&quot;)) {</span>
<span class="lineNum">    1832 </span><span class="lineCov">        289 :                         dump_graph = GF_TRUE;</span>
<span class="lineNum">    1833 </span><span class="lineCov">      20451 :                 } else if (strstr(arg, &quot;:*&quot;) || strstr(arg, &quot;:@&quot;)) {</span>
<span class="lineNum">    1834 </span><span class="lineCov">          6 :                         if (list_filters)</span>
<span class="lineNum">    1835 </span><span class="lineNoCov">          0 :                                 list_filters = 3;</span>
<span class="lineNum">    1836 </span>            :                         else
<span class="lineNum">    1837 </span><span class="lineCov">          6 :                                 print_meta_filters = GF_TRUE;</span>
<span class="lineNum">    1838 </span><span class="lineCov">      20445 :                 } else if (!strcmp(arg, &quot;-wc&quot;)) {</span>
<span class="lineNum">    1839 </span>            :                         write_core_opts = GF_TRUE;
<span class="lineNum">    1840 </span><span class="lineCov">      20444 :                 } else if (!strcmp(arg, &quot;-we&quot;)) {</span>
<span class="lineNum">    1841 </span>            :                         write_extensions = GF_TRUE;
<span class="lineNum">    1842 </span><span class="lineCov">      20443 :                 } else if (!strcmp(arg, &quot;-wf&quot;)) {</span>
<span class="lineNum">    1843 </span>            :                         write_profile = GF_TRUE;
<span class="lineNum">    1844 </span><span class="lineCov">      20442 :                 } else if (!strcmp(arg, &quot;-wfx&quot;)) {</span>
<span class="lineNum">    1845 </span>            :                         write_profile = GF_TRUE;
<span class="lineNum">    1846 </span><span class="lineCov">          1 :                         sflags |= GF_FS_FLAG_LOAD_META;</span>
<span class="lineNum">    1847 </span><span class="lineCov">      20441 :                 } else if (!strcmp(arg, &quot;-sloop&quot;)) {</span>
<span class="lineNum">    1848 </span><span class="lineCov">          1 :                         nb_loops = -1;</span>
<span class="lineNum">    1849 </span><span class="lineCov">          2 :                         if (arg_val) nb_loops = atoi(arg_val);</span>
<span class="lineNum">    1850 </span><span class="lineCov">          1 :                         if (nb_loops) {</span>
<span class="lineNum">    1851 </span><span class="lineCov">          1 :                                 gf_opts_set_key(&quot;temp&quot;, &quot;peristent-jsrt&quot;, &quot;true&quot;);</span>
<span class="lineNum">    1852 </span>            :                         }
<span class="lineNum">    1853 </span><span class="lineCov">      20440 :                 } else if (!strcmp(arg, &quot;-runfor&quot;)) {</span>
<span class="lineNum">    1854 </span><span class="lineCov">         66 :                         if (arg_val) runfor = 1000*atoi(arg_val);</span>
<span class="lineNum">    1855 </span><span class="lineCov">      20407 :                 } else if (!strcmp(arg, &quot;-runforx&quot;)) {</span>
<span class="lineNum">    1856 </span><span class="lineNoCov">          0 :                         if (arg_val) runfor = 1000*atoi(arg_val);</span>
<span class="lineNum">    1857 </span><span class="lineNoCov">          0 :                         runfor_exit = GF_TRUE;</span>
<span class="lineNum">    1858 </span><span class="lineCov">      20407 :                 } else if (!strcmp(arg, &quot;-uncache&quot;)) {</span>
<span class="lineNum">    1859 </span><span class="lineCov">          1 :                         const char *cache_dir = gf_opts_get_key(&quot;core&quot;, &quot;cache&quot;);</span>
<span class="lineNum">    1860 </span><span class="lineCov">          1 :                         gf_enum_directory(cache_dir, GF_FALSE, revert_cache_file, NULL, &quot;.txt&quot;);</span>
<span class="lineNum">    1861 </span><span class="lineCov">          1 :                         fprintf(stderr, &quot;GPAC Cache dir %s flattened\n&quot;, cache_dir);</span>
<span class="lineNum">    1862 </span><span class="lineCov">          1 :                         gpac_exit(0);</span>
<span class="lineNum">    1863 </span><span class="lineCov">      20406 :                 } else if (!strcmp(arg, &quot;-cfg&quot;)) {</span>
<span class="lineNum">    1864 </span>            :                         nothing_to_do = GF_FALSE;
<span class="lineNum">    1865 </span>            :                 }
<span class="lineNum">    1866 </span>            : 
<span class="lineNum">    1867 </span><span class="lineCov">      20174 :                 else if (!strcmp(arg, &quot;-alias&quot;) || !strcmp(arg, &quot;-aliasdoc&quot;)) {</span>
<span class="lineNum">    1868 </span>            :                         char *alias_val;
<span class="lineNum">    1869 </span>            :                         Bool exists;
<span class="lineNum">    1870 </span><span class="lineCov">          6 :                         if (!arg_val) {</span>
<span class="lineNum">    1871 </span><span class="lineNoCov">          0 :                                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;-alias does not have any argument, check usage \&quot;gpac -h\&quot;\n&quot;));</span>
<span class="lineNum">    1872 </span><span class="lineNoCov">          0 :                                 gpac_exit(1);</span>
<span class="lineNum">    1873 </span>            :                         }
<span class="lineNum">    1874 </span><span class="lineCov">          6 :                         alias_val = arg_val ? strchr(arg_val, ' ') : NULL;</span>
<span class="lineNum">    1875 </span><span class="lineCov">          6 :                         if (alias_val) alias_val[0] = 0;</span>
<span class="lineNum">    1876 </span>            : 
<span class="lineNum">    1877 </span><span class="lineCov">          6 :                         session = gf_fs_new_defaults(sflags);</span>
<span class="lineNum">    1878 </span><span class="lineCov">          6 :                         exists = gf_fs_filter_exists(session, arg_val);</span>
<span class="lineNum">    1879 </span><span class="lineCov">          6 :                         gf_fs_del(session);</span>
<span class="lineNum">    1880 </span><span class="lineCov">          6 :                         if (exists) {</span>
<span class="lineNum">    1881 </span><span class="lineNoCov">          0 :                                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;alias %s has the same name as an existing filter, not allowed\n&quot;, arg_val));</span>
<span class="lineNum">    1882 </span><span class="lineNoCov">          0 :                                 if (alias_val) alias_val[0] = ' ';</span>
<span class="lineNum">    1883 </span><span class="lineNoCov">          0 :                                 gpac_exit(1);</span>
<span class="lineNum">    1884 </span>            :                         }
<span class="lineNum">    1885 </span>            : 
<span class="lineNum">    1886 </span><span class="lineCov">          6 :                         gf_opts_set_key(!strcmp(arg, &quot;-alias&quot;) ? &quot;gpac.alias&quot; : &quot;gpac.aliasdoc&quot;, arg_val, alias_val ? alias_val+1 : NULL);</span>
<span class="lineNum">    1887 </span><span class="lineCov">          6 :                         fprintf(stderr, &quot;Set %s for %s to %s\n&quot;, arg, arg_val, alias_val ? alias_val+1 : &quot;NULL&quot;);</span>
<span class="lineNum">    1888 </span><span class="lineCov">          6 :                         if (alias_val) alias_val[0] = ' ';</span>
<span class="lineNum">    1889 </span>            :                         alias_set = GF_TRUE;
<span class="lineNum">    1890 </span>            :                 }
<span class="lineNum">    1891 </span><span class="lineCov">      20168 :                 else if (!strncmp(arg, &quot;-seps&quot;, 5)) {</span>
<span class="lineNum">    1892 </span><span class="lineCov">          1 :                         parse_sep_set(arg_val, &amp;override_seps);</span>
<span class="lineNum">    1893 </span><span class="lineCov">      20167 :                 } else if (!strcmp(arg, &quot;-mem-track&quot;) || !strcmp(arg, &quot;-mem-track-stack&quot;)) {</span>
<span class="lineNum">    1894 </span>            : 
<span class="lineNum">    1895 </span><span class="lineCov">      18445 :                 } else if (!strcmp(arg, &quot;-k&quot;)) {</span>
<span class="lineNum">    1896 </span><span class="lineCov">          2 :                         enable_prompt = GF_TRUE;</span>
<span class="lineNum">    1897 </span><span class="lineCov">      18443 :                 } else if (!strcmp(arg, &quot;-js&quot;)) {</span>
<span class="lineNum">    1898 </span>            :                         session_js = arg_val;
<span class="lineNum">    1899 </span><span class="lineCov">      18439 :                 } else if (!strcmp(arg, &quot;-r&quot;)) {</span>
<span class="lineNum">    1900 </span><span class="lineCov">          2 :                         enable_reports = 2;</span>
<span class="lineNum">    1901 </span><span class="lineCov">          2 :                         if (arg_val &amp;&amp; !strlen(arg_val)) {</span>
<span class="lineNum">    1902 </span><span class="lineNoCov">          0 :                                 enable_reports = 1;</span>
<span class="lineNum">    1903 </span>            :                         } else {
<span class="lineNum">    1904 </span><span class="lineCov">          2 :                                 report_filter = arg_val;</span>
<span class="lineNum">    1905 </span>            :                         }
<span class="lineNum">    1906 </span><span class="lineCov">      18437 :                 } else if (!strcmp(arg, &quot;-unit-tests&quot;)) {</span>
<span class="lineNum">    1907 </span><span class="lineCov">          2 :                         do_unit_tests = GF_TRUE;</span>
<span class="lineNum">    1908 </span><span class="lineCov">      18435 :                 } else if (!strcmp(arg, &quot;-xopt&quot;)) {</span>
<span class="lineNum">    1909 </span>            :                         has_xopt = GF_TRUE;
<span class="lineNum">    1910 </span><span class="lineCov">      18434 :                 } else if (arg[0]=='-') {</span>
<span class="lineNum">    1911 </span><span class="lineCov">      12677 :                         if (!strcmp(arg, &quot;-i&quot;) || !strcmp(arg, &quot;-src&quot;)</span>
<span class="lineNum">    1912 </span><span class="lineCov">      11133 :                                 || !strcmp(arg, &quot;-o&quot;) || !strcmp(arg, &quot;-dst&quot;)</span>
<span class="lineNum">    1913 </span><span class="lineCov">       9704 :                                 || !strcmp(arg, &quot;-ib&quot;) || !strcmp(arg, &quot;-ob&quot;)</span>
<span class="lineNum">    1914 </span><span class="lineCov">       9697 :                                 || !strcmp(arg, &quot;-p&quot;) || !strcmp(arg, &quot;-&quot;)</span>
<span class="lineNum">    1915 </span>            :                         ) {
<span class="lineNum">    1916 </span><span class="lineCov">       7977 :                         } else if (!gf_sys_is_gpac_arg(arg) ) {</span>
<span class="lineNum">    1917 </span><span class="lineNoCov">          0 :                                 if (!has_xopt) {</span>
<span class="lineNum">    1918 </span><span class="lineNoCov">          0 :                                         gpac_suggest_arg(arg);</span>
<span class="lineNum">    1919 </span><span class="lineNoCov">          0 :                                         gpac_exit(1);</span>
<span class="lineNum">    1920 </span>            :                                 } else {
<span class="lineNum">    1921 </span><span class="lineNoCov">          0 :                                         gf_sys_mark_arg_used(i, GF_FALSE);</span>
<span class="lineNum">    1922 </span>            :                                 }
<span class="lineNum">    1923 </span>            :                         }
<span class="lineNum">    1924 </span>            :                 }
<span class="lineNum">    1925 </span>            : 
<span class="lineNum">    1926 </span><span class="lineCov">      21308 :                 if (arg_val) {</span>
<span class="lineNum">    1927 </span>            :                         arg_val--;
<span class="lineNum">    1928 </span><span class="lineCov">       5004 :                         arg_val[0]='=';</span>
<span class="lineNum">    1929 </span>            :                 }
<span class="lineNum">    1930 </span>            :         }
<span class="lineNum">    1931 </span>            : 
<span class="lineNum">    1932 </span><span class="lineCov">       1718 :         if (do_unit_tests) {</span>
<span class="lineNum">    1933 </span><span class="lineCov">          2 :                 gpac_exit( gpac_unit_tests(mem_track) );</span>
<span class="lineNum">    1934 </span>            :         }
<span class="lineNum">    1935 </span>            : 
<span class="lineNum">    1936 </span><span class="lineCov">       1716 :         if (alias_set) {</span>
<span class="lineNum">    1937 </span><span class="lineCov">          3 :                 gpac_exit(0);</span>
<span class="lineNum">    1938 </span>            :         }
<span class="lineNum">    1939 </span>            : 
<span class="lineNum">    1940 </span><span class="lineCov">       1713 :         if (dump_stats &amp;&amp; gf_sys_get_rti(0, &amp;rti, 0) ) {</span>
<span class="lineNum">    1941 </span><span class="lineCov">        391 :                 GF_LOG(GF_LOG_INFO, GF_LOG_APP, (&quot;System info: %d MB RAM - %d cores - main thread ID %d\n&quot;, (u32) (rti.physical_memory/1024/1024), rti.nb_cores, gf_th_id() ));</span>
<span class="lineNum">    1942 </span>            :         }
<span class="lineNum">    1943 </span><span class="lineCov">       1713 :         if ((list_filters&gt;=2) || print_meta_filters || dump_codecs || print_filter_info) sflags |= GF_FS_FLAG_LOAD_META;</span>
<span class="lineNum">    1944 </span>            : 
<span class="lineNum">    1945 </span><span class="lineCov">       1713 :         if (view_filter_conn || list_filters || (print_filter_info &amp;&amp; (argmode == GF_ARGMODE_ALL)) )</span>
<span class="lineNum">    1946 </span><span class="lineCov">         14 :                 gf_opts_set_key(&quot;temp&quot;, &quot;gendoc&quot;, &quot;yes&quot;);</span>
<span class="lineNum">    1947 </span>            : 
<span class="lineNum">    1948 </span><span class="lineCov">       1713 :         if (list_filters || print_filter_info)</span>
<span class="lineNum">    1949 </span><span class="lineCov">         31 :                 gf_opts_set_key(&quot;temp&quot;, &quot;helponly&quot;, &quot;yes&quot;);</span>
<span class="lineNum">    1950 </span>            : 
<span class="lineNum">    1951 </span><span class="lineCov">       1682 : restart:</span>
<span class="lineNum">    1952 </span>            : 
<span class="lineNum">    1953 </span><span class="lineCov">       1715 :         session = gf_fs_new_defaults(sflags);</span>
<span class="lineNum">    1954 </span>            : 
<span class="lineNum">    1955 </span><span class="lineCov">       1715 :         if (!session) {</span>
<span class="lineNum">    1956 </span><span class="lineNoCov">          0 :                 gpac_exit(1);</span>
<span class="lineNum">    1957 </span>            :         }
<span class="lineNum">    1958 </span><span class="lineCov">       1715 :         if (override_seps) gf_fs_set_separators(session, separator_set);</span>
<span class="lineNum">    1959 </span><span class="lineCov">       1715 :         if (load_test_filters) gf_fs_register_test_filters(session);</span>
<span class="lineNum">    1960 </span>            : 
<span class="lineNum">    1961 </span><span class="lineCov">       1715 :         if (gf_fs_get_max_resolution_chain_length(session) &lt;= 1 ) {</span>
<span class="lineNum">    1962 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_INFO, GF_LOG_APP, (&quot;\nDynamic resolution of filter connections disabled\n\n&quot;));</span>
<span class="lineNum">    1963 </span>            :         }
<span class="lineNum">    1964 </span>            : 
<span class="lineNum">    1965 </span><span class="lineCov">       1715 :         if (list_filters || print_filter_info) {</span>
<span class="lineNum">    1966 </span><span class="lineCov">         31 :                 if (print_filters(argc, argv, session, argmode)==GF_FALSE)</span>
<span class="lineNum">    1967 </span><span class="lineCov">          7 :                         e = GF_FILTER_NOT_FOUND;</span>
<span class="lineNum">    1968 </span>            :                 goto exit;
<span class="lineNum">    1969 </span>            :         }
<span class="lineNum">    1970 </span><span class="lineCov">       1684 :         if (view_filter_conn) {</span>
<span class="lineNum">    1971 </span><span class="lineCov">          3 :                 gf_fs_print_all_connections(session, view_conn_for_filter, gf_sys_format_help);</span>
<span class="lineNum">    1972 </span><span class="lineCov">          3 :                 goto exit;</span>
<span class="lineNum">    1973 </span>            :         }
<span class="lineNum">    1974 </span><span class="lineCov">       1681 :         if (dump_codecs) {</span>
<span class="lineNum">    1975 </span><span class="lineCov">          1 :                 dump_all_codec(session);</span>
<span class="lineNum">    1976 </span><span class="lineCov">          1 :                 goto exit;</span>
<span class="lineNum">    1977 </span>            :         }
<span class="lineNum">    1978 </span><span class="lineCov">       1680 :         if (write_profile || write_extensions || write_core_opts) {</span>
<span class="lineNum">    1979 </span><span class="lineCov">          1 :                 if (write_core_opts)</span>
<span class="lineNum">    1980 </span><span class="lineCov">          1 :                         write_core_options();</span>
<span class="lineNum">    1981 </span><span class="lineCov">          1 :                 if (write_extensions)</span>
<span class="lineNum">    1982 </span><span class="lineCov">          1 :                         write_file_extensions();</span>
<span class="lineNum">    1983 </span><span class="lineCov">          1 :                 if (write_profile)</span>
<span class="lineNum">    1984 </span><span class="lineCov">          1 :                         write_filters_options(session);</span>
<span class="lineNum">    1985 </span>            :                 goto exit;
<span class="lineNum">    1986 </span>            :         }
<span class="lineNum">    1987 </span>            : 
<span class="lineNum">    1988 </span><span class="lineCov">       1679 :         if (session_js) {</span>
<span class="lineNum">    1989 </span><span class="lineCov">          4 :                 e = gf_fs_load_script(session, session_js);</span>
<span class="lineNum">    1990 </span><span class="lineCov">          4 :                 if (e) {</span>
<span class="lineNum">    1991 </span><span class="lineNoCov">          0 :                         GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Failed to load JS for session: %s\n&quot;, gf_error_to_string(e) ));</span>
<span class="lineNum">    1992 </span>            :                         goto exit;
<span class="lineNum">    1993 </span>            :                 }
<span class="lineNum">    1994 </span>            :         }
<span class="lineNum">    1995 </span>            : 
<span class="lineNum">    1996 </span>            :         //all good to go, load filters
<span class="lineNum">    1997 </span>            :         has_xopt = GF_FALSE;
<span class="lineNum">    1998 </span><span class="lineCov">       1679 :         links_directive = gf_list_new();</span>
<span class="lineNum">    1999 </span><span class="lineCov">       1679 :         loaded_filters = gf_list_new();</span>
<span class="lineNum">    2000 </span><span class="lineCov">      19679 :         for (i=1; i&lt;argc; i++) {</span>
<span class="lineNum">    2001 </span>            :                 GF_Filter *filter=NULL;
<span class="lineNum">    2002 </span>            :                 Bool is_simple=GF_FALSE;
<span class="lineNum">    2003 </span>            :                 Bool f_loaded = GF_FALSE;
<span class="lineNum">    2004 </span><span class="lineCov">      18003 :                 char *arg = argv[i];</span>
<span class="lineNum">    2005 </span>            : 
<span class="lineNum">    2006 </span><span class="lineCov">      18003 :                 if (!strcmp(arg, &quot;-src&quot;) || !strcmp(arg, &quot;-i&quot;) || !strcmp(arg, &quot;-ib&quot;) ) {</span>
<span class="lineNum">    2007 </span><span class="lineCov">       1548 :                         if (!strcmp(arg, &quot;-ib&quot;)) {</span>
<span class="lineNum">    2008 </span><span class="lineCov">          4 :                                 const char *fargs=NULL;</span>
<span class="lineNum">    2009 </span><span class="lineCov">          4 :                                 const char *fio_url = make_fileio(argv[i+1], &amp;fargs, GF_TRUE, &amp;e);</span>
<span class="lineNum">    2010 </span><span class="lineCov">          4 :                                 if (fio_url)</span>
<span class="lineNum">    2011 </span><span class="lineCov">          4 :                                         filter = gf_fs_load_source(session, fio_url, fargs, NULL, &amp;e);</span>
<span class="lineNum">    2012 </span>            :                         } else {
<span class="lineNum">    2013 </span><span class="lineCov">       1544 :                                 filter = gf_fs_load_source(session, argv[i+1], NULL, NULL, &amp;e);</span>
<span class="lineNum">    2014 </span>            :                         }
<span class="lineNum">    2015 </span><span class="lineCov">       1548 :                         arg = argv[i+1];</span>
<span class="lineNum">    2016 </span><span class="lineCov">       1548 :                         i++;</span>
<span class="lineNum">    2017 </span><span class="lineCov">       1548 :                         f_loaded = GF_TRUE;</span>
<span class="lineNum">    2018 </span><span class="lineCov">      16455 :                 } else if (!strcmp(arg, &quot;-dst&quot;) || !strcmp(arg, &quot;-o&quot;)  || !strcmp(arg, &quot;-ob&quot;) ) {</span>
<span class="lineNum">    2019 </span><span class="lineCov">       1432 :                         if (!strcmp(arg, &quot;-ob&quot;)) {</span>
<span class="lineNum">    2020 </span><span class="lineCov">          3 :                                 const char *fargs=NULL;</span>
<span class="lineNum">    2021 </span><span class="lineCov">          3 :                                 const char *fio_url = make_fileio(argv[i+1], &amp;fargs, GF_FALSE, &amp;e);</span>
<span class="lineNum">    2022 </span><span class="lineCov">          3 :                                 if (fio_url)</span>
<span class="lineNum">    2023 </span><span class="lineCov">          3 :                                         filter = gf_fs_load_destination(session, fio_url, fargs, NULL, &amp;e);</span>
<span class="lineNum">    2024 </span>            :                         } else {
<span class="lineNum">    2025 </span><span class="lineCov">       1429 :                                 filter = gf_fs_load_destination(session, argv[i+1], NULL, NULL, &amp;e);</span>
<span class="lineNum">    2026 </span>            :                         }
<span class="lineNum">    2027 </span><span class="lineCov">       1432 :                         arg = argv[i+1];</span>
<span class="lineNum">    2028 </span><span class="lineCov">       1432 :                         i++;</span>
<span class="lineNum">    2029 </span><span class="lineCov">       1432 :                         f_loaded = GF_TRUE;</span>
<span class="lineNum">    2030 </span>            :                 }
<span class="lineNum">    2031 </span><span class="lineCov">      15023 :                 else if (!strncmp(arg, &quot;-lcf&quot;, 4)) {</span>
<span class="lineNum">    2032 </span>            :                         f_loaded = GF_TRUE;
<span class="lineNum">    2033 </span><span class="lineCov">          1 :                         filter = load_custom_filter(session, arg+4, &amp;e);</span>
<span class="lineNum">    2034 </span>            :                 }
<span class="lineNum">    2035 </span>            :                 //appart from the above src/dst, other args starting with - are not filters
<span class="lineNum">    2036 </span><span class="lineCov">      15022 :                 else if (arg[0]=='-') {</span>
<span class="lineNum">    2037 </span><span class="lineCov">      12259 :                         if (!strcmp(arg, &quot;-xopt&quot;)) has_xopt = GF_TRUE;</span>
<span class="lineNum">    2038 </span><span class="lineCov">      12259 :                         continue;</span>
<span class="lineNum">    2039 </span>            :                 }
<span class="lineNum">    2040 </span><span class="lineCov">       5744 :                 if (!f_loaded &amp;&amp; !has_xopt) {</span>
<span class="lineNum">    2041 </span><span class="lineCov">       2763 :                         if (arg[0]== separator_set[SEP_LINK] ) {</span>
<span class="lineNum">    2042 </span><span class="lineCov">       1104 :                                 gf_list_add(links_directive, arg);</span>
<span class="lineNum">    2043 </span><span class="lineCov">       1104 :                                 continue;</span>
<span class="lineNum">    2044 </span>            :                         }
<span class="lineNum">    2045 </span>            : 
<span class="lineNum">    2046 </span><span class="lineCov">       1659 :                         if (!strncmp(arg, &quot;src=&quot;, 4) ) {</span>
<span class="lineNum">    2047 </span><span class="lineCov">          7 :                                 filter = gf_fs_load_source(session, arg+4, NULL, NULL, &amp;e);</span>
<span class="lineNum">    2048 </span><span class="lineCov">       1652 :                         } else if (!strncmp(arg, &quot;dst=&quot;, 4) ) {</span>
<span class="lineNum">    2049 </span><span class="lineCov">          1 :                                 filter = gf_fs_load_destination(session, arg+4, NULL, NULL, &amp;e);</span>
<span class="lineNum">    2050 </span>            :                         } else {
<span class="lineNum">    2051 </span><span class="lineCov">       1651 :                                 e = GF_EOS;</span>
<span class="lineNum">    2052 </span><span class="lineCov">       1651 :                                 char *need_gfio = strstr(arg, &quot;@gfi://&quot;);</span>
<span class="lineNum">    2053 </span><span class="lineCov">       1651 :                                 if (!need_gfio) need_gfio = strstr(arg, &quot;@gfo://&quot;);</span>
<span class="lineNum">    2054 </span><span class="lineCov">       1651 :                                 if (need_gfio) {</span>
<span class="lineNum">    2055 </span><span class="lineCov">          1 :                                         const char *fargs=NULL;</span>
<span class="lineNum">    2056 </span>            :                                         const char *fio_url;
<span class="lineNum">    2057 </span>            :                                         char *updated_args;
<span class="lineNum">    2058 </span><span class="lineCov">          1 :                                         u32 len = (u32) (need_gfio - arg);</span>
<span class="lineNum">    2059 </span><span class="lineCov">          1 :                                         updated_args = gf_malloc(sizeof(char)*(len+1));</span>
<span class="lineNum">    2060 </span><span class="lineCov">          1 :                                         strncpy(updated_args, arg, len);</span>
<span class="lineNum">    2061 </span><span class="lineCov">          1 :                                         updated_args[len]=0;</span>
<span class="lineNum">    2062 </span>            : 
<span class="lineNum">    2063 </span><span class="lineCov">          1 :                                         fio_url = make_fileio(need_gfio+7, &amp;fargs, need_gfio[3]=='i' ? GF_TRUE : GF_FALSE, &amp;e);</span>
<span class="lineNum">    2064 </span><span class="lineCov">          1 :                                         if (fio_url) {</span>
<span class="lineNum">    2065 </span><span class="lineCov">          1 :                                                 gf_dynstrcat(&amp;updated_args, fio_url, NULL);</span>
<span class="lineNum">    2066 </span><span class="lineCov">          1 :                                                 if (fargs)</span>
<span class="lineNum">    2067 </span><span class="lineNoCov">          0 :                                                         gf_dynstrcat(&amp;updated_args, fargs, NULL);</span>
<span class="lineNum">    2068 </span>            : 
<span class="lineNum">    2069 </span><span class="lineCov">          1 :                                                 filter = gf_fs_load_filter(session, updated_args, &amp;e);</span>
<span class="lineNum">    2070 </span>            :                                         }
<span class="lineNum">    2071 </span><span class="lineCov">          1 :                                         gf_free(updated_args);</span>
<span class="lineNum">    2072 </span>            :                                 } else {
<span class="lineNum">    2073 </span><span class="lineCov">       1650 :                                         filter = gf_fs_load_filter(session, arg, &amp;e);</span>
<span class="lineNum">    2074 </span>            :                                 }
<span class="lineNum">    2075 </span>            :                                 is_simple=GF_TRUE;
<span class="lineNum">    2076 </span><span class="lineCov">       1651 :                                 if (!filter &amp;&amp; has_xopt)</span>
<span class="lineNum">    2077 </span><span class="lineNoCov">          0 :                                         continue;</span>
<span class="lineNum">    2078 </span>            :                         }
<span class="lineNum">    2079 </span>            :                 }
<span class="lineNum">    2080 </span>            : 
<span class="lineNum">    2081 </span><span class="lineCov">       4640 :                 if (!filter) {</span>
<span class="lineNum">    2082 </span><span class="lineCov">          3 :                         if (has_xopt)</span>
<span class="lineNum">    2083 </span><span class="lineNoCov">          0 :                                 continue;</span>
<span class="lineNum">    2084 </span><span class="lineCov">          3 :                         if (!e) e = GF_FILTER_NOT_FOUND;</span>
<span class="lineNum">    2085 </span>            : 
<span class="lineNum">    2086 </span><span class="lineCov">          3 :                         if (e!=GF_FILTER_NOT_FOUND) {</span>
<span class="lineNum">    2087 </span><span class="lineCov">          3 :                                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Failed to load filter%s \&quot;%s\&quot;: %s\n&quot;, is_simple ? &quot;&quot; : &quot; for&quot;,  arg, gf_error_to_string(e) ));</span>
<span class="lineNum">    2088 </span>            :                         } else {
<span class="lineNum">    2089 </span><span class="lineNoCov">          0 :                                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Failed to find filter%s \&quot;%s\&quot;\n&quot;, is_simple ? &quot;&quot; : &quot; for&quot;,  arg));</span>
<span class="lineNum">    2090 </span>            : 
<span class="lineNum">    2091 </span><span class="lineNoCov">          0 :                                 gpac_suggest_filter(arg, GF_FALSE, GF_TRUE);</span>
<span class="lineNum">    2092 </span>            :                                 nb_filters=0;
<span class="lineNum">    2093 </span>            :                         }
<span class="lineNum">    2094 </span>            :                         goto exit;
<span class="lineNum">    2095 </span>            :                 }
<span class="lineNum">    2096 </span><span class="lineCov">       4637 :                 nb_filters++;</span>
<span class="lineNum">    2097 </span>            : 
<span class="lineNum">    2098 </span><span class="lineCov">      10378 :                 while (gf_list_count(links_directive)) {</span>
<span class="lineNum">    2099 </span>            :                         char *link_prev_filter_ext = NULL;
<span class="lineNum">    2100 </span>            :                         GF_Filter *link_from;
<span class="lineNum">    2101 </span>            :                         Bool reverse_order = GF_FALSE;
<span class="lineNum">    2102 </span>            :                         s32 link_filter_idx = -1;
<span class="lineNum">    2103 </span><span class="lineCov">       1104 :                         char *link = gf_list_pop_front(links_directive);</span>
<span class="lineNum">    2104 </span><span class="lineCov">       1104 :                         char *ext = strchr(link, separator_set[SEP_FRAG]);</span>
<span class="lineNum">    2105 </span><span class="lineCov">       1104 :                         if (ext) {</span>
<span class="lineNum">    2106 </span><span class="lineCov">          1 :                                 ext[0] = 0;</span>
<span class="lineNum">    2107 </span><span class="lineCov">          1 :                                 link_prev_filter_ext = ext+1;</span>
<span class="lineNum">    2108 </span>            :                         }
<span class="lineNum">    2109 </span><span class="lineCov">       1104 :                         if (strlen(link)&gt;1) {</span>
<span class="lineNum">    2110 </span><span class="lineCov">        291 :                                 if (link[1] == separator_set[SEP_LINK] ) {</span>
<span class="lineNum">    2111 </span>            :                                         reverse_order = GF_TRUE;
<span class="lineNum">    2112 </span><span class="lineNoCov">          0 :                                         link++;</span>
<span class="lineNum">    2113 </span>            :                                 }
<span class="lineNum">    2114 </span><span class="lineCov">        291 :                                 link_filter_idx = atoi(link+1);</span>
<span class="lineNum">    2115 </span><span class="lineCov">        291 :                                 if (link_filter_idx &lt; 0) {</span>
<span class="lineNum">    2116 </span><span class="lineNoCov">          0 :                                         GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Wrong filter index %d, must be positive\n&quot;, link_filter_idx));</span>
<span class="lineNum">    2117 </span><span class="lineNoCov">          0 :                                         e = GF_BAD_PARAM;</span>
<span class="lineNum">    2118 </span><span class="lineNoCov">          0 :                                         goto exit;</span>
<span class="lineNum">    2119 </span>            :                                 }
<span class="lineNum">    2120 </span>            :                         } else {
<span class="lineNum">    2121 </span>            :                                 link_filter_idx = 0;
<span class="lineNum">    2122 </span>            :                         }
<span class="lineNum">    2123 </span><span class="lineCov">       1104 :                         if (ext) ext[0] = separator_set[SEP_FRAG];</span>
<span class="lineNum">    2124 </span>            : 
<span class="lineNum">    2125 </span><span class="lineCov">       1104 :                         if (reverse_order)</span>
<span class="lineNum">    2126 </span><span class="lineNoCov">          0 :                                 link_from = gf_list_get(loaded_filters, link_filter_idx);</span>
<span class="lineNum">    2127 </span>            :                         else
<span class="lineNum">    2128 </span><span class="lineCov">       1104 :                                 link_from = gf_list_get(loaded_filters, gf_list_count(loaded_filters)-1-link_filter_idx);</span>
<span class="lineNum">    2129 </span>            : 
<span class="lineNum">    2130 </span><span class="lineCov">       1104 :                         if (!link_from) {</span>
<span class="lineNum">    2131 </span><span class="lineNoCov">          0 :                                 GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;Wrong filter index @%d\n&quot;, link_filter_idx));</span>
<span class="lineNum">    2132 </span><span class="lineNoCov">          0 :                                 e = GF_BAD_PARAM;</span>
<span class="lineNum">    2133 </span><span class="lineNoCov">          0 :                                 goto exit;</span>
<span class="lineNum">    2134 </span>            :                         }
<span class="lineNum">    2135 </span><span class="lineCov">       1104 :                         gf_filter_set_source(filter, link_from, link_prev_filter_ext);</span>
<span class="lineNum">    2136 </span>            :                 }
<span class="lineNum">    2137 </span><span class="lineCov">       4637 :                 gf_list_add(loaded_filters, filter);</span>
<span class="lineNum">    2138 </span>            :         }
<span class="lineNum">    2139 </span><span class="lineCov">       1676 :         if (!gf_list_count(loaded_filters) &amp;&amp; !session_js) {</span>
<span class="lineNum">    2140 </span><span class="lineCov">          1 :                 if (nothing_to_do &amp;&amp; !gen_doc) {</span>
<span class="lineNum">    2141 </span><span class="lineCov">          1 :                         GF_LOG(GF_LOG_INFO, GF_LOG_APP, (&quot;Nothing to do, check usage \&quot;gpac -h\&quot;\ngpac - GPAC command line filter engine - version %s\n%s\n&quot;, gf_gpac_version(), gf_gpac_copyright_cite()));</span>
<span class="lineNum">    2142 </span><span class="lineCov">          1 :                         e = GF_BAD_PARAM;</span>
<span class="lineNum">    2143 </span>            :                 } else {
<span class="lineNum">    2144 </span><span class="lineNoCov">          0 :                         e = GF_EOS;</span>
<span class="lineNum">    2145 </span>            :                 }
<span class="lineNum">    2146 </span>            :                 goto exit;
<span class="lineNum">    2147 </span>            :         }
<span class="lineNum">    2148 </span><span class="lineCov">       1675 :         if (enable_reports) {</span>
<span class="lineNum">    2149 </span><span class="lineCov">          2 :                 if (enable_reports==2)</span>
<span class="lineNum">    2150 </span><span class="lineCov">          2 :                         gf_fs_set_ui_callback(session, gpac_event_proc, session);</span>
<span class="lineNum">    2151 </span>            : 
<span class="lineNum">    2152 </span><span class="lineCov">          2 :                 gf_fs_enable_reporting(session, GF_TRUE);</span>
<span class="lineNum">    2153 </span>            :         }
<span class="lineNum">    2154 </span>            : 
<span class="lineNum">    2155 </span><span class="lineCov">       1675 :         if (enable_prompt || (runfor&gt;0)) {</span>
<span class="lineNum">    2156 </span><span class="lineCov">         36 :                 if (enable_prompt &amp;&amp; !loops_done) {</span>
<span class="lineNum">    2157 </span><span class="lineCov">          2 :                         GF_LOG(GF_LOG_INFO, GF_LOG_APP, (&quot;Running session, press 'h' for help\n&quot;));</span>
<span class="lineNum">    2158 </span>            :                 }
<span class="lineNum">    2159 </span><span class="lineCov">         36 :                 gf_fs_post_user_task(session, gpac_fsess_task, NULL, &quot;gpac_fsess_task&quot;);</span>
<span class="lineNum">    2160 </span>            :         }
<span class="lineNum">    2161 </span><span class="lineCov">       1675 :         if (!enable_prompt) {</span>
<span class="lineNum">    2162 </span>            : #ifdef WIN32
<span class="lineNum">    2163 </span>            :                 SetConsoleCtrlHandler((PHANDLER_ROUTINE)gpac_sig_handler, TRUE);
<span class="lineNum">    2164 </span>            : #else
<span class="lineNum">    2165 </span><span class="lineCov">       1671 :                 signal(SIGINT, gpac_sig_handler);</span>
<span class="lineNum">    2166 </span>            : #endif
<span class="lineNum">    2167 </span>            :         }
<span class="lineNum">    2168 </span>            : 
<span class="lineNum">    2169 </span><span class="lineCov">       1675 :         if (enable_reports) {</span>
<span class="lineNum">    2170 </span><span class="lineCov">          2 :                 gpac_print_report(session, GF_TRUE, GF_FALSE);</span>
<span class="lineNum">    2171 </span>            :         }
<span class="lineNum">    2172 </span>            : 
<span class="lineNum">    2173 </span><span class="lineCov">       1675 :         if (!session_js) {</span>
<span class="lineNum">    2174 </span>            :                 u32 j;
<span class="lineNum">    2175 </span>            :                 Bool has_vout = GF_FALSE;
<span class="lineNum">    2176 </span>            :                 Bool has_compositor = GF_FALSE;
<span class="lineNum">    2177 </span><span class="lineCov">       4634 :                 for (j=0; j&lt;gf_list_count(loaded_filters); j++) {</span>
<span class="lineNum">    2178 </span>            :                         GF_FilterStats stats;
<span class="lineNum">    2179 </span><span class="lineCov">       4634 :                         GF_Filter *f = gf_list_get(loaded_filters, j);</span>
<span class="lineNum">    2180 </span><span class="lineCov">       4634 :                         gf_filter_get_stats(f, &amp;stats);</span>
<span class="lineNum">    2181 </span><span class="lineCov">       4634 :                         if (!stats.reg_name) continue;</span>
<span class="lineNum">    2182 </span><span class="lineCov">       4634 :                         if (!strcmp(stats.reg_name, &quot;vout&quot;)) has_vout=GF_TRUE;</span>
<span class="lineNum">    2183 </span>            :                         //if compositor in player mode, don't load script
<span class="lineNum">    2184 </span><span class="lineCov">       4606 :                         else if (!strcmp(stats.reg_name, &quot;compositor&quot;)) {</span>
<span class="lineNum">    2185 </span>            :                                 GF_PropertyValue p;
<span class="lineNum">    2186 </span><span class="lineCov">        586 :                                 gf_filter_get_arg(f, &quot;player&quot;, &amp;p);</span>
<span class="lineNum">    2187 </span><span class="lineCov">        586 :                                 if (p.value.uint!=0)</span>
<span class="lineNum">    2188 </span>            :                                         has_compositor=GF_TRUE;
<span class="lineNum">    2189 </span>            :                         }
<span class="lineNum">    2190 </span>            :                 }
<span class="lineNum">    2191 </span><span class="lineCov">       1671 :                 if (has_vout &amp;&amp; !has_compositor) {</span>
<span class="lineNum">    2192 </span>            :                         session_js = &quot;$GSHARE/scripts/vout.js&quot;;
<span class="lineNum">    2193 </span><span class="lineCov">         28 :                         gf_fs_load_script(session, session_js);</span>
<span class="lineNum">    2194 </span>            :                 }
<span class="lineNum">    2195 </span>            :         }
<span class="lineNum">    2196 </span>            : 
<span class="lineNum">    2197 </span>            : 
<span class="lineNum">    2198 </span>            : 
<span class="lineNum">    2199 </span><span class="lineCov">       1675 :         e = gf_fs_run(session);</span>
<span class="lineNum">    2200 </span><span class="lineCov">       1675 :         if (e&gt;0) e = GF_OK;</span>
<span class="lineNum">    2201 </span>            : 
<span class="lineNum">    2202 </span><span class="lineCov">       1675 :         if (e) {</span>
<span class="lineNum">    2203 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;session error %s\n&quot;, gf_error_to_string(e) );</span>
<span class="lineNum">    2204 </span>            :         } else {
<span class="lineNum">    2205 </span><span class="lineCov">       1675 :                 e = gf_fs_get_last_connect_error(session);</span>
<span class="lineNum">    2206 </span><span class="lineCov">       1675 :                 if (e&lt;0) fprintf(stderr, &quot;session last connect error %s\n&quot;, gf_error_to_string(e) );</span>
<span class="lineNum">    2207 </span>            : 
<span class="lineNum">    2208 </span><span class="lineCov">       1675 :                 if (!e) {</span>
<span class="lineNum">    2209 </span><span class="lineCov">       1674 :                         e = gf_fs_get_last_process_error(session);</span>
<span class="lineNum">    2210 </span><span class="lineCov">       1674 :                         if (e&lt;0) fprintf(stderr, &quot;session last process error %s\n&quot;, gf_error_to_string(e) );</span>
<span class="lineNum">    2211 </span>            :                 }
<span class="lineNum">    2212 </span><span class="lineCov">       1675 :                 gpac_check_session_args();</span>
<span class="lineNum">    2213 </span>            :         }
<span class="lineNum">    2214 </span>            : 
<span class="lineNum">    2215 </span><span class="lineCov">       1675 :         if (enable_reports) {</span>
<span class="lineNum">    2216 </span><span class="lineCov">          2 :                 if (enable_reports==2) {</span>
<span class="lineNum">    2217 </span><span class="lineCov">          2 :                         gf_sys_set_console_code(stderr, GF_CONSOLE_RESTORE);</span>
<span class="lineNum">    2218 </span>            :                 }
<span class="lineNum">    2219 </span><span class="lineCov">          2 :                 gpac_print_report(session, GF_FALSE, GF_TRUE);</span>
<span class="lineNum">    2220 </span>            :         }
<span class="lineNum">    2221 </span><span class="lineCov">       1675 :         gf_fs_print_non_connected_ex(session, alias_is_play);</span>
<span class="lineNum">    2222 </span>            : 
<span class="lineNum">    2223 </span><span class="lineCov">       1715 : exit:</span>
<span class="lineNum">    2224 </span><span class="lineCov">       1715 :         if (enable_reports==2) {</span>
<span class="lineNum">    2225 </span><span class="lineCov">          2 :                 gf_log_set_callback(session, NULL);</span>
<span class="lineNum">    2226 </span>            :         }
<span class="lineNum">    2227 </span>            : 
<span class="lineNum">    2228 </span><span class="lineCov">       1715 :         if (e &amp;&amp; nb_filters) {</span>
<span class="lineNum">    2229 </span><span class="lineCov">          3 :                 gf_fs_run(session);</span>
<span class="lineNum">    2230 </span>            :         }
<span class="lineNum">    2231 </span><span class="lineCov">       1715 :         if (dump_stats)</span>
<span class="lineNum">    2232 </span><span class="lineCov">        391 :                 gf_fs_print_stats(session);</span>
<span class="lineNum">    2233 </span><span class="lineCov">       1715 :         if (dump_graph)</span>
<span class="lineNum">    2234 </span><span class="lineCov">        289 :                 gf_fs_print_connections(session);</span>
<span class="lineNum">    2235 </span>            : 
<span class="lineNum">    2236 </span>            : 
<span class="lineNum">    2237 </span><span class="lineCov">       1715 :         tmp_sess = session;</span>
<span class="lineNum">    2238 </span><span class="lineCov">       1715 :         session = NULL;</span>
<span class="lineNum">    2239 </span><span class="lineCov">       1715 :         gf_fs_del(tmp_sess);</span>
<span class="lineNum">    2240 </span><span class="lineCov">       1715 :         if (loaded_filters) gf_list_del(loaded_filters);</span>
<span class="lineNum">    2241 </span><span class="lineCov">       1715 :         if (links_directive) gf_list_del(links_directive);</span>
<span class="lineNum">    2242 </span>            : 
<span class="lineNum">    2243 </span><span class="lineCov">       1715 :         cleanup_file_io();</span>
<span class="lineNum">    2244 </span>            : 
<span class="lineNum">    2245 </span><span class="lineCov">       1715 :         if (!e &amp;&amp; nb_loops) {</span>
<span class="lineNum">    2246 </span><span class="lineCov">          2 :                 if (nb_loops&gt;0) nb_loops--;</span>
<span class="lineNum">    2247 </span><span class="lineCov">          2 :                 loops_done++;</span>
<span class="lineNum">    2248 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;session done, restarting (loop %d)\n&quot;, loops_done);</span>
<span class="lineNum">    2249 </span><span class="lineCov">          2 :                 fflush(stderr);</span>
<span class="lineNum">    2250 </span><span class="lineCov">          2 :                 gf_log_reset_file();</span>
<span class="lineNum">    2251 </span><span class="lineCov">          2 :                 goto restart;</span>
<span class="lineNum">    2252 </span>            :         }
<span class="lineNum">    2253 </span>            : 
<span class="lineNum">    2254 </span>            : #ifdef GPAC_HAS_QJS
<span class="lineNum">    2255 </span><span class="lineCov">       1713 :         if (loops_done) {</span>
<span class="lineNum">    2256 </span>            :                 void gf_js_delete_runtime();
<span class="lineNum">    2257 </span><span class="lineCov">          1 :                 gf_js_delete_runtime();</span>
<span class="lineNum">    2258 </span>            :         }
<span class="lineNum">    2259 </span>            : #endif
<span class="lineNum">    2260 </span>            : 
<span class="lineNum">    2261 </span><span class="lineCov">       1713 :         gpac_exit(e&lt;0 ? 1 : 0);</span>
<a name="2262"><span class="lineNum">    2262 </span>            : }</a>
<span class="lineNum">    2263 </span>            : 
<span class="lineNum">    2264 </span><span class="lineCov">       1742 : GF_MAIN_FUNC(gpac_main)</span>
<span class="lineNum">    2265 </span>            : 
<span class="lineNum">    2266 </span>            : 
<span class="lineNum">    2267 </span>            : /*********************************************************
<span class="lineNum">    2268 </span>            :                 Filter and property info/dump functions
<a name="2269"><span class="lineNum">    2269 </span>            : *********************************************************/</a>
<span class="lineNum">    2270 </span>            : 
<span class="lineNum">    2271 </span><span class="lineCov">       1290 : static void dump_caps(u32 nb_caps, const GF_FilterCapability *caps)</span>
<span class="lineNum">    2272 </span>            : {
<span class="lineNum">    2273 </span>            :         u32 i;
<span class="lineNum">    2274 </span><span class="lineCov">       5180 :         for (i=0;i&lt;nb_caps; i++) {</span>
<span class="lineNum">    2275 </span>            :                 const char *szName;
<span class="lineNum">    2276 </span>            :                 const char *szVal;
<span class="lineNum">    2277 </span>            :                 char szDump[GF_PROP_DUMP_ARG_SIZE];
<span class="lineNum">    2278 </span><span class="lineCov">       3890 :                 const GF_FilterCapability *cap = &amp;caps[i];</span>
<span class="lineNum">    2279 </span><span class="lineCov">       3890 :                 if (!(cap-&gt;flags &amp; GF_CAPFLAG_IN_BUNDLE) &amp;&amp; i+1==nb_caps) break;</span>
<span class="lineNum">    2280 </span><span class="lineCov">       3890 :                 if (!i) gf_sys_format_help(helpout, help_flags, &quot;Capabilities Bundle:\n&quot;);</span>
<span class="lineNum">    2281 </span><span class="lineCov">       2600 :                 else if (!(cap-&gt;flags &amp; GF_CAPFLAG_IN_BUNDLE) ) {</span>
<span class="lineNum">    2282 </span><span class="lineCov">          2 :                         gf_sys_format_help(helpout, help_flags, &quot;Capabilities Bundle:\n&quot;);</span>
<span class="lineNum">    2283 </span><span class="lineCov">          2 :                         continue;</span>
<span class="lineNum">    2284 </span>            :                 }
<span class="lineNum">    2285 </span>            : 
<span class="lineNum">    2286 </span><span class="lineCov">       3888 :                 szName = cap-&gt;name ? cap-&gt;name : gf_props_4cc_get_name(cap-&gt;code);</span>
<span class="lineNum">    2287 </span><span class="lineCov">       3888 :                 if (!szName) szName = gf_4cc_to_str(cap-&gt;code);</span>
<span class="lineNum">    2288 </span><span class="lineCov">       3888 :                 gf_sys_format_help(helpout, help_flags, &quot;\t Flags:&quot;);</span>
<span class="lineNum">    2289 </span><span class="lineCov">       3888 :                 if (cap-&gt;flags &amp; GF_CAPFLAG_INPUT) gf_sys_format_help(helpout, help_flags, &quot; Input&quot;);</span>
<span class="lineNum">    2290 </span><span class="lineCov">       3888 :                 if (cap-&gt;flags &amp; GF_CAPFLAG_OUTPUT) gf_sys_format_help(helpout, help_flags, &quot; Output&quot;);</span>
<span class="lineNum">    2291 </span><span class="lineCov">       3888 :                 if (cap-&gt;flags &amp; GF_CAPFLAG_EXCLUDED) gf_sys_format_help(helpout, help_flags, &quot; Exclude&quot;);</span>
<span class="lineNum">    2292 </span><span class="lineCov">       3888 :                 if (cap-&gt;flags &amp; GF_CAPFLAG_LOADED_FILTER) gf_sys_format_help(helpout, help_flags, &quot; LoadedFilterOnly&quot;);</span>
<span class="lineNum">    2293 </span>            : 
<span class="lineNum">    2294 </span>            :                 //dump some interesting predefined ones which are not mapped to types
<span class="lineNum">    2295 </span><span class="lineCov">       3888 :                 if (cap-&gt;code==GF_PROP_PID_STREAM_TYPE) szVal = gf_stream_type_name(cap-&gt;val.value.uint);</span>
<span class="lineNum">    2296 </span><span class="lineCov">       2588 :                 else if (cap-&gt;code==GF_PROP_PID_CODECID) szVal = (const char *) gf_codecid_name(cap-&gt;val.value.uint);</span>
<span class="lineNum">    2297 </span><span class="lineCov">          8 :                 else szVal = gf_props_dump_val(&amp;cap-&gt;val, szDump, GF_PROP_DUMP_DATA_NONE, NULL);</span>
<span class="lineNum">    2298 </span>            : 
<span class="lineNum">    2299 </span><span class="lineCov">       3888 :                 gf_sys_format_help(helpout, help_flags, &quot; %s=\&quot;%s\&quot;&quot;, szName,  szVal);</span>
<span class="lineNum">    2300 </span><span class="lineCov">       3888 :                 if (cap-&gt;priority) gf_sys_format_help(helpout, help_flags, &quot;, priority=%d&quot;, cap-&gt;priority);</span>
<span class="lineNum">    2301 </span><span class="lineCov">       3888 :                 gf_sys_format_help(helpout, help_flags, &quot;\n&quot;);</span>
<span class="lineNum">    2302 </span>            :         }
<a name="2303"><span class="lineNum">    2303 </span><span class="lineCov">       1290 : }</span></a>
<span class="lineNum">    2304 </span>            : 
<span class="lineNum">    2305 </span><span class="lineCov">       6988 : static void print_filter_arg(const GF_FilterArgs *a, u32 gen_doc)</span>
<span class="lineNum">    2306 </span>            : {
<span class="lineNum">    2307 </span>            :         Bool is_enum = GF_FALSE;
<span class="lineNum">    2308 </span>            : 
<span class="lineNum">    2309 </span><span class="lineCov">       6988 :         if ((a-&gt;arg_type==GF_PROP_UINT) &amp;&amp; a-&gt;min_max_enum &amp;&amp; strchr(a-&gt;min_max_enum, '|')) {</span>
<span class="lineNum">    2310 </span>            :                 is_enum = GF_TRUE;
<span class="lineNum">    2311 </span>            :         }
<span class="lineNum">    2312 </span>            : 
<span class="lineNum">    2313 </span><span class="lineCov">       6988 :         if (gen_doc==1) {</span>
<span class="lineNum">    2314 </span><span class="lineCov">        856 :                 gf_sys_format_help(helpout, help_flags, &quot;&lt;a id=\&quot;%s\&quot;&gt;&quot;, a-&gt;arg_name);</span>
<span class="lineNum">    2315 </span><span class="lineCov">        856 :                 gf_sys_format_help(helpout, help_flags | GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s&quot;, a-&gt;arg_name);</span>
<span class="lineNum">    2316 </span><span class="lineCov">        856 :                 gf_sys_format_help(helpout, help_flags, &quot;&lt;/a&gt; (%s&quot;, is_enum ? &quot;enum&quot; : gf_props_get_type_name(a-&gt;arg_type));</span>
<span class="lineNum">    2317 </span>            :         } else {
<span class="lineNum">    2318 </span><span class="lineCov">       6132 :                 gf_sys_format_help(helpout, help_flags | GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s (%s&quot;, a-&gt;arg_name, is_enum ? &quot;enum&quot; : gf_props_get_type_name(a-&gt;arg_type));</span>
<span class="lineNum">    2319 </span>            :         }
<span class="lineNum">    2320 </span><span class="lineCov">       6988 :         if (a-&gt;arg_default_val) {</span>
<span class="lineNum">    2321 </span><span class="lineCov">       6102 :                 if (!strcmp(a-&gt;arg_default_val, &quot;2147483647&quot;))</span>
<span class="lineNum">    2322 </span><span class="lineCov">         17 :                         gf_sys_format_help(helpout, help_flags, &quot;, default: __+I__&quot;);</span>
<span class="lineNum">    2323 </span><span class="lineCov">       6085 :                 else if (!strcmp(a-&gt;arg_default_val, &quot;-2147483648&quot;))</span>
<span class="lineNum">    2324 </span><span class="lineCov">          6 :                         gf_sys_format_help(helpout, help_flags, &quot;, default: __-I__&quot;);</span>
<span class="lineNum">    2325 </span>            :                 else
<span class="lineNum">    2326 </span><span class="lineCov">       6079 :                         gf_sys_format_help(helpout, help_flags, &quot;, default: __%s__&quot;, a-&gt;arg_default_val);</span>
<span class="lineNum">    2327 </span>            :         } else {
<span class="lineNum">    2328 </span>            : //              gf_sys_format_help(helpout, help_flags, &quot;, no default&quot;);
<span class="lineNum">    2329 </span>            :         }
<span class="lineNum">    2330 </span><span class="lineCov">       6988 :         if (a-&gt;min_max_enum &amp;&amp; !is_enum) {</span>
<span class="lineNum">    2331 </span><span class="lineCov">       2896 :                 if (!strcmp(a-&gt;min_max_enum, &quot;-2147483648-I&quot;))</span>
<span class="lineNum">    2332 </span><span class="lineCov">        708 :                         gf_sys_format_help(helpout, help_flags, &quot;, %s: -I-I&quot;, /*strchr(a-&gt;min_max_enum, '|') ? &quot;Enum&quot; : */&quot;minmax&quot;);</span>
<span class="lineNum">    2333 </span>            :                 else
<span class="lineNum">    2334 </span><span class="lineCov">       2188 :                         gf_sys_format_help(helpout, help_flags, &quot;, %s: %s&quot;, /*strchr(a-&gt;min_max_enum, '|') ? &quot;Enum&quot; : */&quot;minmax&quot;, a-&gt;min_max_enum);</span>
<span class="lineNum">    2335 </span>            :         }
<span class="lineNum">    2336 </span><span class="lineCov">       6988 :         if (a-&gt;flags &amp; GF_FS_ARG_UPDATE) gf_sys_format_help(helpout, help_flags, &quot;, updatable&quot;);</span>
<span class="lineNum">    2337 </span>            : //              if (a-&gt;flags &amp; GF_FS_ARG_META) gf_sys_format_help(helpout, help_flags, &quot;, meta&quot;);
<span class="lineNum">    2338 </span><span class="lineCov">       6988 :         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_OPT_DESC, &quot;): %s\n&quot;, a-&gt;arg_desc);</span>
<span class="lineNum">    2339 </span>            : 
<span class="lineNum">    2340 </span>            :         //check syntax
<span class="lineNum">    2341 </span><span class="lineCov">       6988 :         if (gen_doc) {</span>
<span class="lineNum">    2342 </span>            :                 GF_GPACArg _a;
<span class="lineNum">    2343 </span>            :                 memset(&amp;_a, 0, sizeof(GF_GPACArg));
<span class="lineNum">    2344 </span><span class="lineCov">       1712 :                 _a.name = a-&gt;arg_name;</span>
<span class="lineNum">    2345 </span><span class="lineCov">       1712 :                 _a.description = a-&gt;arg_desc;</span>
<span class="lineNum">    2346 </span><span class="lineCov">       1712 :                 _a.flags = GF_ARG_HINT_HIDE;</span>
<span class="lineNum">    2347 </span><span class="lineCov">       1712 :                 gf_sys_print_arg(NULL, 0, &amp;_a, &quot;&quot;);</span>
<span class="lineNum">    2348 </span>            :         }
<span class="lineNum">    2349 </span>            : 
<span class="lineNum">    2350 </span><span class="lineCov">       6988 :         if (a-&gt;min_max_enum &amp;&amp; strchr(a-&gt;min_max_enum, '|'))</span>
<span class="lineNum">    2351 </span><span class="lineCov">        248 :                 gf_sys_format_help(helpout, help_flags, &quot;\n&quot;);</span>
<a name="2352"><span class="lineNum">    2352 </span><span class="lineCov">       6988 : }</span></a>
<span class="lineNum">    2353 </span>            : 
<span class="lineNum">    2354 </span><span class="lineCov">          1 : static void print_filter_single_opt(const GF_FilterRegister *reg, char *optname, GF_Filter *filter_inst)</span>
<span class="lineNum">    2355 </span>            : {
<span class="lineNum">    2356 </span>            :         u32 idx=0;
<span class="lineNum">    2357 </span>            :         Bool found = GF_FALSE;
<span class="lineNum">    2358 </span>            :         const GF_FilterArgs *args = NULL;
<span class="lineNum">    2359 </span><span class="lineCov">          1 :         if (filter_inst)</span>
<span class="lineNum">    2360 </span><span class="lineNoCov">          0 :                 args = gf_filter_get_args(filter_inst);</span>
<span class="lineNum">    2361 </span><span class="lineCov">          1 :         else if (reg)</span>
<span class="lineNum">    2362 </span><span class="lineCov">          1 :                 args = reg-&gt;args;</span>
<span class="lineNum">    2363 </span>            : 
<span class="lineNum">    2364 </span><span class="lineCov">          1 :         if (!args) return;</span>
<span class="lineNum">    2365 </span>            : 
<span class="lineNum">    2366 </span><span class="lineCov">         63 :         while (1) {</span>
<span class="lineNum">    2367 </span><span class="lineCov">         64 :                 const GF_FilterArgs *a = &amp; args[idx];</span>
<span class="lineNum">    2368 </span><span class="lineCov">         64 :                 if (!a || !a-&gt;arg_name) break;</span>
<span class="lineNum">    2369 </span><span class="lineCov">         63 :                 idx++;</span>
<span class="lineNum">    2370 </span><span class="lineCov">         63 :                 if (strcmp(a-&gt;arg_name, optname)) continue;</span>
<span class="lineNum">    2371 </span>            : 
<span class="lineNum">    2372 </span><span class="lineNoCov">          0 :                 print_filter_arg(a, 0);</span>
<span class="lineNum">    2373 </span>            :                 found = GF_TRUE;
<span class="lineNum">    2374 </span>            :                 break;
<span class="lineNum">    2375 </span>            :         }
<span class="lineNum">    2376 </span>            :         if (found) return;
<span class="lineNum">    2377 </span>            : 
<span class="lineNum">    2378 </span>            :         idx = 0;
<span class="lineNum">    2379 </span>            :         while (1) {
<span class="lineNum">    2380 </span><span class="lineCov">         64 :                 const GF_FilterArgs *a = &amp; args[idx];</span>
<span class="lineNum">    2381 </span><span class="lineCov">         64 :                 if (!a || !a-&gt;arg_name) break;</span>
<span class="lineNum">    2382 </span><span class="lineCov">         63 :                 idx++;</span>
<span class="lineNum">    2383 </span><span class="lineCov">         63 :                 if (gf_sys_word_match(optname, a-&gt;arg_name)</span>
<span class="lineNum">    2384 </span><span class="lineCov">         63 :                         || (a-&gt;arg_desc &amp;&amp; strstr(a-&gt;arg_desc, optname))</span>
<span class="lineNum">    2385 </span>            :                 ) {
<span class="lineNum">    2386 </span><span class="lineNoCov">          0 :                         if (!found) {</span>
<span class="lineNum">    2387 </span>            :                                 found = GF_TRUE;
<span class="lineNum">    2388 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;No such option %s for filter %s - did you mean:\n&quot;, optname, filter_inst ? gf_filter_get_name(filter_inst) : reg-&gt;name);</span>
<span class="lineNum">    2389 </span>            :                         }
<span class="lineNum">    2390 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot; - %s: %s\n&quot;, a-&gt;arg_name, a-&gt;arg_desc);</span>
<span class="lineNum">    2391 </span>            :                 }
<span class="lineNum">    2392 </span>            :         }
<span class="lineNum">    2393 </span><span class="lineCov">          1 :         if (found) return;</span>
<span class="lineNum">    2394 </span>            : 
<span class="lineNum">    2395 </span><span class="lineCov">          1 :         fprintf(stderr, &quot;No such option %s for filter %s\n&quot;, optname, filter_inst ? gf_filter_get_name(filter_inst) : reg-&gt;name);</span>
<a name="2396"><span class="lineNum">    2396 </span>            : }</a>
<span class="lineNum">    2397 </span>            : 
<span class="lineNum">    2398 </span><span class="lineCov">       3180 : static void print_filter(const GF_FilterRegister *reg, GF_SysArgMode argmode, GF_Filter *filter_inst, char *inst_name)</span>
<span class="lineNum">    2399 </span>            : {
<span class="lineNum">    2400 </span>            :         const GF_FilterArgs *args = NULL;
<span class="lineNum">    2401 </span>            :         const char *reg_name, *reg_desc;
<span class="lineNum">    2402 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">    2403 </span>            :         const char *reg_help;
<span class="lineNum">    2404 </span>            : #endif
<span class="lineNum">    2405 </span>            : 
<span class="lineNum">    2406 </span><span class="lineCov">       3180 :         if (filter_inst) {</span>
<span class="lineNum">    2407 </span>            :                 reg_name = inst_name;
<span class="lineNum">    2408 </span><span class="lineCov">          3 :                 reg_desc = gf_filter_get_description(filter_inst);</span>
<span class="lineNum">    2409 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">    2410 </span><span class="lineCov">          3 :                 reg_help = gf_filter_get_help(filter_inst);</span>
<span class="lineNum">    2411 </span>            : #endif
<span class="lineNum">    2412 </span><span class="lineCov">       3177 :         } else if (reg) {</span>
<span class="lineNum">    2413 </span><span class="lineCov">       3177 :                 reg_name = reg-&gt;name;</span>
<span class="lineNum">    2414 </span><span class="lineCov">       3177 :                 reg_desc = reg-&gt;description;</span>
<span class="lineNum">    2415 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">    2416 </span><span class="lineCov">       3177 :                 reg_help = reg-&gt;help;</span>
<span class="lineNum">    2417 </span>            : #endif
<span class="lineNum">    2418 </span>            :         } else {
<span class="lineNum">    2419 </span>            :                 return;
<span class="lineNum">    2420 </span>            :         }
<span class="lineNum">    2421 </span>            : 
<span class="lineNum">    2422 </span>            :         //happens on some meta filter or JS filters
<span class="lineNum">    2423 </span><span class="lineCov">       3180 :         if (!reg_desc) {</span>
<span class="lineNum">    2424 </span>            :                 reg_desc = &quot;No description available&quot;;
<span class="lineNum">    2425 </span>            :         }
<span class="lineNum">    2426 </span>            : 
<span class="lineNum">    2427 </span><span class="lineCov">       3180 :         if (gen_doc==1) {</span>
<span class="lineNum">    2428 </span>            :                 char szName[1024];
<span class="lineNum">    2429 </span>            :                 sprintf(szName, &quot;%s.md&quot;, reg_name);
<span class="lineNum">    2430 </span><span class="lineCov">        108 :                 if (gen_doc==1) {</span>
<span class="lineNum">    2431 </span><span class="lineCov">        108 :                         gf_fclose(helpout);</span>
<span class="lineNum">    2432 </span><span class="lineCov">        108 :                         helpout = gf_fopen(szName, &quot;w&quot;);</span>
<span class="lineNum">    2433 </span>            :                         fprintf(helpout, &quot;[**HOME**](Home)  [**Filters**](Filters)  %s\n&quot;, reg_desc);
<span class="lineNum">    2434 </span><span class="lineCov">        108 :                         fprintf(helpout, &quot;%s&quot;, auto_gen_md_warning);</span>
<span class="lineNum">    2435 </span>            : 
<span class="lineNum">    2436 </span><span class="lineCov">        108 :                         if (!sidebar_md) {</span>
<span class="lineNum">    2437 </span>            :                                 char *sbbuf = NULL;
<span class="lineNum">    2438 </span><span class="lineCov">          1 :                                 if (gf_file_exists(&quot;_Sidebar.md&quot;)) {</span>
<span class="lineNum">    2439 </span>            :                                         char szLine[1024];
<span class="lineNum">    2440 </span>            :                                         u32 end_pos=0;
<span class="lineNum">    2441 </span><span class="lineNoCov">          0 :                                         sidebar_md = gf_fopen(&quot;_Sidebar.md&quot;, &quot;r&quot;);</span>
<span class="lineNum">    2442 </span><span class="lineNoCov">          0 :                                         gf_fseek(sidebar_md, 0, SEEK_SET);</span>
<span class="lineNum">    2443 </span><span class="lineNoCov">          0 :                                         while (!feof(sidebar_md)) {</span>
<span class="lineNum">    2444 </span><span class="lineNoCov">          0 :                                                 char *read = gf_fgets(szLine, 1024, sidebar_md);</span>
<span class="lineNum">    2445 </span><span class="lineNoCov">          0 :                                                 if (!read) break;</span>
<span class="lineNum">    2446 </span><span class="lineNoCov">          0 :                                                 if (!strncmp(szLine, &quot;**Filters Help**&quot;, 16)) {</span>
<span class="lineNum">    2447 </span><span class="lineNoCov">          0 :                                                         end_pos = (u32) gf_ftell(sidebar_md);</span>
<span class="lineNum">    2448 </span><span class="lineNoCov">          0 :                                                         break;</span>
<span class="lineNum">    2449 </span>            :                                                 }
<span class="lineNum">    2450 </span>            :                                         }
<span class="lineNum">    2451 </span><span class="lineNoCov">          0 :                                         if (!end_pos) end_pos = (u32) gf_ftell(sidebar_md);</span>
<span class="lineNum">    2452 </span><span class="lineNoCov">          0 :                                         if (end_pos) {</span>
<span class="lineNum">    2453 </span><span class="lineNoCov">          0 :                                                 sbbuf = gf_malloc(end_pos+1);</span>
<span class="lineNum">    2454 </span><span class="lineNoCov">          0 :                                                 gf_fseek(sidebar_md, 0, SEEK_SET);</span>
<span class="lineNum">    2455 </span><span class="lineNoCov">          0 :                                                 end_pos = (u32) gf_fread(sbbuf, end_pos, sidebar_md);</span>
<span class="lineNum">    2456 </span><span class="lineNoCov">          0 :                                                 sbbuf[end_pos]=0;</span>
<span class="lineNum">    2457 </span><span class="lineNoCov">          0 :                                                 gf_fclose(sidebar_md);</span>
<span class="lineNum">    2458 </span>            :                                         }
<span class="lineNum">    2459 </span>            :                                 }
<span class="lineNum">    2460 </span><span class="lineCov">          1 :                                 sidebar_md = gf_fopen(&quot;_Sidebar.md&quot;, &quot;w&quot;);</span>
<span class="lineNum">    2461 </span><span class="lineCov">          1 :                                 if (sbbuf) {</span>
<span class="lineNum">    2462 </span>            :                                         fprintf(sidebar_md, &quot;%s\n  \n&quot;, sbbuf);
<span class="lineNum">    2463 </span><span class="lineNoCov">          0 :                                         gf_free(sbbuf);</span>
<span class="lineNum">    2464 </span>            :                                 }
<span class="lineNum">    2465 </span>            :                         }
<span class="lineNum">    2466 </span><span class="lineCov">        108 :                         fprintf(sidebar_md, &quot;[[%s (%s)|%s]]  \n&quot;, reg_desc, reg_name, reg_name);</span>
<span class="lineNum">    2467 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">    2468 </span>            : 
<span class="lineNum">    2469 </span><span class="lineCov">        108 :                         if (!reg_help) {</span>
<span class="lineNum">    2470 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;filter %s without help, forbidden\n&quot;, reg_name);</span>
<span class="lineNum">    2471 </span><span class="lineNoCov">          0 :                                 exit(1);</span>
<span class="lineNum">    2472 </span>            :                         }
<span class="lineNum">    2473 </span>            : #endif
<span class="lineNum">    2474 </span>            :                 }
<span class="lineNum">    2475 </span>            : 
<span class="lineNum">    2476 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">    2477 </span><span class="lineCov">        108 :                 gf_sys_format_help(helpout, help_flags, &quot;# %s\n&quot;, reg_desc);</span>
<span class="lineNum">    2478 </span>            : #endif
<span class="lineNum">    2479 </span><span class="lineCov">        108 :                 gf_sys_format_help(helpout, help_flags, &quot;Register name used to load filter: **%s**\n&quot;, reg_name);</span>
<span class="lineNum">    2480 </span><span class="lineCov">        108 :                 if (filter_inst) {</span>
<span class="lineNum">    2481 </span><span class="lineCov">          1 :                         gf_sys_format_help(helpout, help_flags, &quot;This is a JavaScript filter, not checked during graph resolution and needs explicit loading.\n&quot;);</span>
<span class="lineNum">    2482 </span>            :                 } else {
<span class="lineNum">    2483 </span><span class="lineCov">        107 :                         if (reg-&gt;flags &amp; GF_FS_REG_EXPLICIT_ONLY) {</span>
<span class="lineNum">    2484 </span><span class="lineCov">         14 :                                 gf_sys_format_help(helpout, help_flags, &quot;This filter is not checked during graph resolution and needs explicit loading.\n&quot;);</span>
<span class="lineNum">    2485 </span>            :                         } else {
<span class="lineNum">    2486 </span><span class="lineCov">         93 :                                 gf_sys_format_help(helpout, help_flags, &quot;This filter may be automatically loaded during graph resolution.\n&quot;);</span>
<span class="lineNum">    2487 </span>            :                         }
<span class="lineNum">    2488 </span><span class="lineCov">        107 :                         if (reg-&gt;flags &amp; GF_FS_REG_REQUIRES_RESOLVER) {</span>
<span class="lineNum">    2489 </span><span class="lineCov">          3 :                                 gf_sys_format_help(helpout, help_flags, &quot;This filter requires the graph resolver to be activated.\n&quot;);</span>
<span class="lineNum">    2490 </span>            :                         }
<span class="lineNum">    2491 </span>            :                 }
<span class="lineNum">    2492 </span>            :         } else {
<span class="lineNum">    2493 </span><span class="lineCov">       3072 :                 gf_sys_format_help(helpout, help_flags, &quot;# %s\n&quot;, reg_name);</span>
<span class="lineNum">    2494 </span><span class="lineCov">       3072 :                 gf_sys_format_help(helpout, help_flags, &quot;Description: %s\n&quot;, reg_desc );</span>
<span class="lineNum">    2495 </span>            : 
<span class="lineNum">    2496 </span><span class="lineCov">       3072 :                 if (filter_inst) {</span>
<span class="lineNum">    2497 </span><span class="lineCov">          2 :                         const char *version = gf_filter_get_version(filter_inst);</span>
<span class="lineNum">    2498 </span><span class="lineCov">          2 :                         if (version)</span>
<span class="lineNum">    2499 </span><span class="lineCov">          2 :                                 gf_sys_format_help(helpout, help_flags, &quot;Version: %s\n&quot;, version );</span>
<span class="lineNum">    2500 </span>            :                 } else {
<span class="lineNum">    2501 </span><span class="lineCov">       3070 :                         if (reg-&gt;version) {</span>
<span class="lineNum">    2502 </span><span class="lineCov">       2866 :                                 if (!strncmp(reg-&gt;version, &quot;! &quot;, 2)) {</span>
<span class="lineNum">    2503 </span><span class="lineCov">          3 :                                         if (!gen_doc)</span>
<span class="lineNum">    2504 </span><span class="lineNoCov">          0 :                                                 gf_sys_format_help(helpout, help_flags, &quot;%s\n&quot;, reg-&gt;version+2);</span>
<span class="lineNum">    2505 </span>            :                                 } else {
<span class="lineNum">    2506 </span><span class="lineCov">       2863 :                                         gf_sys_format_help(helpout, help_flags, &quot;Version: %s\n&quot;, reg-&gt;version);</span>
<span class="lineNum">    2507 </span>            :                                 }
<span class="lineNum">    2508 </span>            :                         }
<span class="lineNum">    2509 </span>            :                 }
<span class="lineNum">    2510 </span>            :         }
<span class="lineNum">    2511 </span>            : 
<span class="lineNum">    2512 </span><span class="lineCov">       3180 :         if (filter_inst) {</span>
<span class="lineNum">    2513 </span><span class="lineCov">          3 :                 const char *str = gf_filter_get_author(filter_inst);</span>
<span class="lineNum">    2514 </span><span class="lineCov">          3 :                 if (str)</span>
<span class="lineNum">    2515 </span><span class="lineCov">          3 :                         gf_sys_format_help(helpout, help_flags, &quot;%s: %s\n&quot;, (str[0]=='-') ? &quot;Configuration&quot; : &quot;Author&quot;, str );</span>
<span class="lineNum">    2516 </span><span class="lineCov">          3 :                 str = gf_filter_get_help(filter_inst);</span>
<span class="lineNum">    2517 </span><span class="lineCov">          3 :                 if (str)</span>
<span class="lineNum">    2518 </span><span class="lineCov">          3 :                         gf_sys_format_help(helpout, help_flags, &quot;\n%s\n\n&quot;, str);</span>
<span class="lineNum">    2519 </span>            :         } else {
<span class="lineNum">    2520 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">    2521 </span><span class="lineCov">       3177 :                 if (reg-&gt;author) {</span>
<span class="lineNum">    2522 </span><span class="lineCov">       2866 :                         if (reg-&gt;author[0]=='-') {</span>
<span class="lineNum">    2523 </span><span class="lineCov">       2866 :                                 if (! (help_flags &amp; (GF_PRINTARG_MD|GF_PRINTARG_MAN))) {</span>
<span class="lineNum">    2524 </span><span class="lineCov">       2856 :                                         gf_sys_format_help(helpout, help_flags, &quot;Configuration: %s\n&quot;, reg-&gt;author);</span>
<span class="lineNum">    2525 </span>            :                                 }
<span class="lineNum">    2526 </span>            :                         } else {
<span class="lineNum">    2527 </span><span class="lineNoCov">          0 :                                 gf_sys_format_help(helpout, help_flags, &quot;Author: %s\n&quot;, reg-&gt;author);</span>
<span class="lineNum">    2528 </span>            :                         }
<span class="lineNum">    2529 </span>            :                 }
<span class="lineNum">    2530 </span><span class="lineCov">       3177 :                 if (reg-&gt;help) {</span>
<span class="lineNum">    2531 </span><span class="lineCov">        328 :                         u32 hf = help_flags;</span>
<span class="lineNum">    2532 </span><span class="lineCov">        328 :                         if (gen_doc==1) hf |= GF_PRINTARG_ESCAPE_XML;</span>
<span class="lineNum">    2533 </span><span class="lineCov">        328 :                         gf_sys_format_help(helpout, hf, &quot;\n%s\n\n&quot;, reg-&gt;help);</span>
<span class="lineNum">    2534 </span>            :                 }
<span class="lineNum">    2535 </span>            : #else
<span class="lineNum">    2536 </span>            :                 gf_sys_format_help(helpout, help_flags, &quot;GPAC compiled without built-in doc\n&quot;);
<span class="lineNum">    2537 </span>            : #endif
<span class="lineNum">    2538 </span>            :         }
<span class="lineNum">    2539 </span>            : 
<span class="lineNum">    2540 </span><span class="lineCov">       3180 :         if (reg &amp;&amp; (argmode==GF_ARGMODE_EXPERT)) {</span>
<span class="lineNum">    2541 </span><span class="lineCov">          1 :                 if (reg-&gt;max_extra_pids==(u32) -1) gf_sys_format_help(helpout, help_flags, &quot;Max Input PIDs: any\n&quot;);</span>
<span class="lineNum">    2542 </span><span class="lineCov">          1 :                 else gf_sys_format_help(helpout, help_flags, &quot;Max Input PIDs: %d\n&quot;, 1 + reg-&gt;max_extra_pids);</span>
<span class="lineNum">    2543 </span>            : 
<span class="lineNum">    2544 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;Flags:&quot;);</span>
<span class="lineNum">    2545 </span><span class="lineCov">          1 :                 if (reg-&gt;flags &amp; GF_FS_REG_EXPLICIT_ONLY) gf_sys_format_help(helpout, help_flags, &quot; ExplicitOnly&quot;);</span>
<span class="lineNum">    2546 </span><span class="lineCov">          1 :                 if (reg-&gt;flags &amp; GF_FS_REG_MAIN_THREAD) gf_sys_format_help(helpout, help_flags, &quot; MainThread&quot;);</span>
<span class="lineNum">    2547 </span><span class="lineCov">          1 :                 if (reg-&gt;flags &amp; GF_FS_REG_CONFIGURE_MAIN_THREAD) gf_sys_format_help(helpout, help_flags, &quot; ConfigureMainThread&quot;);</span>
<span class="lineNum">    2548 </span><span class="lineCov">          1 :                 if (reg-&gt;flags &amp; GF_FS_REG_HIDE_WEIGHT) gf_sys_format_help(helpout, help_flags, &quot; HideWeight&quot;);</span>
<span class="lineNum">    2549 </span><span class="lineCov">          1 :                 if (reg-&gt;flags &amp; GF_FS_REG_REQUIRES_RESOLVER) gf_sys_format_help(helpout, help_flags, &quot; RequireResolver&quot;);</span>
<span class="lineNum">    2550 </span><span class="lineCov">          1 :                 if (reg-&gt;flags &amp; GF_FS_REG_DYNLIB) gf_sys_format_help(helpout, help_flags, &quot; DynamicLib&quot;);</span>
<span class="lineNum">    2551 </span><span class="lineCov">          1 :                 if (reg-&gt;probe_url) gf_sys_format_help(helpout, help_flags, &quot; URLMimeProber&quot;);</span>
<span class="lineNum">    2552 </span><span class="lineCov">          1 :                 if (reg-&gt;probe_data) gf_sys_format_help(helpout, help_flags, &quot; DataProber&quot;);</span>
<span class="lineNum">    2553 </span><span class="lineCov">          1 :                 if (reg-&gt;reconfigure_output) gf_sys_format_help(helpout, help_flags, &quot; ReconfigurableOutput&quot;);</span>
<span class="lineNum">    2554 </span>            : 
<span class="lineNum">    2555 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;\nPriority %d&quot;, reg-&gt;priority);</span>
<span class="lineNum">    2556 </span>            : 
<span class="lineNum">    2557 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;\n&quot;);</span>
<span class="lineNum">    2558 </span>            :         }
<span class="lineNum">    2559 </span>            : 
<span class="lineNum">    2560 </span><span class="lineCov">       3180 :         if (filter_inst) args = gf_filter_get_args(filter_inst);</span>
<span class="lineNum">    2561 </span><span class="lineCov">       3177 :         else args = reg-&gt;args;</span>
<span class="lineNum">    2562 </span>            : 
<span class="lineNum">    2563 </span><span class="lineCov">       3180 :         if (args) {</span>
<span class="lineNum">    2564 </span>            :                 u32 idx=0;
<span class="lineNum">    2565 </span><span class="lineCov">        952 :                 if (gen_doc==1) {</span>
<span class="lineNum">    2566 </span><span class="lineCov">         95 :                         gf_sys_format_help(helpout, help_flags, &quot;# Options  \n&quot;);</span>
<span class="lineNum">    2567 </span>            :                 } else {
<span class="lineNum">    2568 </span><span class="lineCov">        857 :                         switch (argmode) {</span>
<span class="lineNum">    2569 </span><span class="lineCov">        376 :                         case GF_ARGMODE_ALL:</span>
<span class="lineNum">    2570 </span>            :                         case GF_ARGMODE_EXPERT:
<span class="lineNum">    2571 </span><span class="lineCov">        376 :                                 gf_sys_format_help(helpout, help_flags, &quot;# Options (expert):\n&quot;);</span>
<span class="lineNum">    2572 </span><span class="lineCov">        376 :                                 break;</span>
<span class="lineNum">    2573 </span><span class="lineCov">          1 :                         case GF_ARGMODE_ADVANCED:</span>
<span class="lineNum">    2574 </span><span class="lineCov">          1 :                                 gf_sys_format_help(helpout, help_flags, &quot;# Options (advanced):\n&quot;);</span>
<span class="lineNum">    2575 </span><span class="lineCov">          1 :                                 break;</span>
<span class="lineNum">    2576 </span><span class="lineCov">        480 :                         case GF_ARGMODE_BASE:</span>
<span class="lineNum">    2577 </span><span class="lineCov">        480 :                                 gf_sys_format_help(helpout, help_flags, &quot;# Options (basic):\n&quot;);</span>
<span class="lineNum">    2578 </span><span class="lineCov">        480 :                                 break;</span>
<span class="lineNum">    2579 </span>            :                         }
<span class="lineNum">    2580 </span>            :                 }
<span class="lineNum">    2581 </span>            : 
<span class="lineNum">    2582 </span>            :                 while (1) {
<span class="lineNum">    2583 </span><span class="lineCov">       8583 :                         const GF_FilterArgs *a = &amp; args[idx];</span>
<span class="lineNum">    2584 </span><span class="lineCov">       8583 :                         if (!a || !a-&gt;arg_name) break;</span>
<span class="lineNum">    2585 </span><span class="lineCov">       7631 :                         idx++;</span>
<span class="lineNum">    2586 </span>            : 
<span class="lineNum">    2587 </span><span class="lineCov">      13562 :                         if (a-&gt;flags &amp; GF_FS_ARG_HINT_HIDE) continue;</span>
<span class="lineNum">    2588 </span>            : 
<span class="lineNum">    2589 </span><span class="lineCov">       7559 :                         switch (argmode) {</span>
<span class="lineNum">    2590 </span>            :                         case GF_ARGMODE_ALL:
<span class="lineNum">    2591 </span>            :                         case GF_ARGMODE_EXPERT:
<span class="lineNum">    2592 </span>            :                                 break;
<span class="lineNum">    2593 </span><span class="lineCov">         60 :                         case GF_ARGMODE_ADVANCED:</span>
<span class="lineNum">    2594 </span><span class="lineCov">         60 :                                 if (a-&gt;flags &amp; GF_FS_ARG_HINT_EXPERT) continue;</span>
<span class="lineNum">    2595 </span>            :                                 break;
<span class="lineNum">    2596 </span><span class="lineCov">       3327 :                         case GF_ARGMODE_BASE:</span>
<span class="lineNum">    2597 </span><span class="lineCov">       3327 :                                 if (a-&gt;flags &amp; (GF_FS_ARG_HINT_EXPERT|GF_FS_ARG_HINT_ADVANCED)) continue;</span>
<span class="lineNum">    2598 </span>            :                                 break;
<span class="lineNum">    2599 </span>            :                         }
<span class="lineNum">    2600 </span>            : 
<span class="lineNum">    2601 </span><span class="lineCov">       6988 :                         print_filter_arg(a, gen_doc);</span>
<span class="lineNum">    2602 </span>            : 
<span class="lineNum">    2603 </span><span class="lineCov">       6988 :                         if (!gen_doc) continue;</span>
<span class="lineNum">    2604 </span>            : 
<span class="lineNum">    2605 </span>            : #ifdef CHECK_DOC
<span class="lineNum">    2606 </span><span class="lineCov">       1712 :                         if (a-&gt;flags &amp; GF_FS_ARG_META) continue;</span>
<span class="lineNum">    2607 </span>            : 
<span class="lineNum">    2608 </span>            :                         u8 achar;
<span class="lineNum">    2609 </span>            :                         u32 j=0;
<span class="lineNum">    2610 </span>            :                         char szArg[100];
<span class="lineNum">    2611 </span><span class="lineCov">       1700 :                         sprintf(szArg, &quot; %s &quot;, a-&gt;arg_name);</span>
<span class="lineNum">    2612 </span><span class="lineCov">       1700 :                         if (reg_help &amp;&amp; strstr(reg_help, szArg)) {</span>
<span class="lineNum">    2613 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;\nWARNING: filter %s bad help, uses arg %s without link\n&quot;, reg_name, a-&gt;arg_name);</span>
<span class="lineNum">    2614 </span><span class="lineNoCov">          0 :                                 exit(1);</span>
<span class="lineNum">    2615 </span>            :                         }
<span class="lineNum">    2616 </span>            :                         while (1) {
<span class="lineNum">    2617 </span><span class="lineCov">      52010 :                                 const GF_FilterArgs *anarg = &amp; args[j];</span>
<span class="lineNum">    2618 </span><span class="lineCov">      52010 :                                 if (!anarg || !anarg-&gt;arg_name) break;</span>
<span class="lineNum">    2619 </span><span class="lineCov">      50310 :                                 j++;</span>
<span class="lineNum">    2620 </span><span class="lineCov">      50310 :                                 if (a == anarg) continue;</span>
<span class="lineNum">    2621 </span><span class="lineCov">      48610 :                                 if (reg_help &amp;&amp; strstr(reg_help, szArg)) {</span>
<span class="lineNum">    2622 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;\nWARNING: filter %s bad description for argument %s, uses arg %s without link\n&quot;, reg_name, anarg-&gt;arg_name, a-&gt;arg_name);</span>
<span class="lineNum">    2623 </span><span class="lineNoCov">          0 :                                         exit(1);</span>
<span class="lineNum">    2624 </span>            :                                 }
<span class="lineNum">    2625 </span>            :                         }
<span class="lineNum">    2626 </span>            : 
<span class="lineNum">    2627 </span><span class="lineCov">       1700 :                         if (a-&gt;min_max_enum) {</span>
<span class="lineNum">    2628 </span>            :                                 //check format
<span class="lineNum">    2629 </span><span class="lineCov">        230 :                 if ((a-&gt;arg_type!=GF_PROP_UINT_LIST) &amp;&amp; !(a-&gt;flags&amp;GF_FS_ARG_META) &amp;&amp; strchr(a-&gt;min_max_enum, '|') &amp;&amp; (!a-&gt;arg_default_val || strcmp(a-&gt;arg_default_val, &quot;-1&quot;)) ) {</span>
<span class="lineNum">    2630 </span>            :                                         const char *a_val = a-&gt;min_max_enum;
<span class="lineNum">    2631 </span><span class="lineCov">          2 :                                         while (a_val[0] == '|') a_val++;</span>
<span class="lineNum">    2632 </span><span class="lineCov">        182 :                                         if (strstr(a-&gt;arg_desc, &quot;see filter info&quot;))</span>
<span class="lineNum">    2633 </span>            :                                                 a_val = NULL;
<span class="lineNum">    2634 </span><span class="lineCov">        700 :                                         while (a_val) {</span>
<span class="lineNum">    2635 </span>            :                                                 char szName[100];
<span class="lineNum">    2636 </span><span class="lineCov">        698 :                                                 const char *a_sep = strchr(a_val, '|');</span>
<span class="lineNum">    2637 </span><span class="lineCov">        698 :                                                 u32 len = a_sep ? (u32)(a_sep - a_val) : (u32)strlen(a_val);</span>
<span class="lineNum">    2638 </span>            :                                                 strcpy(szName, &quot;- &quot;);
<span class="lineNum">    2639 </span><span class="lineCov">        698 :                                                 strncat(szName, a_val, MIN(sizeof(szName)-3,len));</span>
<span class="lineNum">    2640 </span><span class="lineCov">        698 :                                                 szName[2+len]=0;</span>
<span class="lineNum">    2641 </span>            :                                                 strcat(szName, &quot;: &quot;);
<span class="lineNum">    2642 </span>            : 
<span class="lineNum">    2643 </span><span class="lineCov">        698 :                                                 if (!strstr(a-&gt;arg_desc, szName)) {</span>
<span class="lineNum">    2644 </span><span class="lineNoCov">          0 :                                                         fprintf(stderr, &quot;\nWARNING: filter %s bad description format for arg %s, missing list bullet \&quot;%s\&quot;\n&quot;, reg_name, a-&gt;arg_name, szName);</span>
<span class="lineNum">    2645 </span><span class="lineNoCov">          0 :                                                         exit(1);</span>
<span class="lineNum">    2646 </span>            :                                                 }
<span class="lineNum">    2647 </span><span class="lineCov">        698 :                                                 if (!a_sep) break;</span>
<span class="lineNum">    2648 </span><span class="lineCov">        518 :                                                 a_val = a_sep+1;</span>
<span class="lineNum">    2649 </span>            :                                         }
<span class="lineNum">    2650 </span><span class="lineCov">        182 :                         if (!strstr(a-&gt;arg_desc, &quot;- &quot;)) {</span>
<span class="lineNum">    2651 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;\nWARNING: filter %s bad description format for arg %s, missing list bullet \&quot;- \&quot;\n&quot;, reg_name, a-&gt;arg_name);</span>
<span class="lineNum">    2652 </span><span class="lineNoCov">          0 :                         exit(1);</span>
<span class="lineNum">    2653 </span>            :                                         }
<span class="lineNum">    2654 </span><span class="lineCov">        182 :                         if (strstr(a-&gt;arg_desc, &quot;:\n&quot;)) {</span>
<span class="lineNum">    2655 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;\nWARNING: filter %s bad description format for arg %s, should not use \&quot;:\\n\&quot;\n&quot;, reg_name, a-&gt;arg_name);</span>
<span class="lineNum">    2656 </span><span class="lineNoCov">          0 :                         exit(1);</span>
<span class="lineNum">    2657 </span>            :                                         }
<span class="lineNum">    2658 </span><span class="lineCov">         48 :                 } else if (!(a-&gt;flags&amp;GF_FS_ARG_META) &amp;&amp; strchr(a-&gt;arg_desc, '\n')) {</span>
<span class="lineNum">    2659 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;\nWARNING: filter %s bad description format for arg %s, should not contain \&quot;\\n\&quot;\n&quot;, reg_name, a-&gt;arg_name);</span>
<span class="lineNum">    2660 </span><span class="lineNoCov">          0 :                                         exit(1);</span>
<span class="lineNum">    2661 </span>            :                                 }
<span class="lineNum">    2662 </span>            :                         }
<span class="lineNum">    2663 </span><span class="lineCov">       1700 :             if (!(a-&gt;flags&amp;GF_FS_ARG_META)) {</span>
<span class="lineNum">    2664 </span>            :                                 char *sep;
<span class="lineNum">    2665 </span>            : 
<span class="lineNum">    2666 </span><span class="lineCov">       1700 :                                 achar = a-&gt;arg_desc[strlen(a-&gt;arg_desc)-1];</span>
<span class="lineNum">    2667 </span><span class="lineCov">       1700 :                                 if (achar == '\n') {</span>
<span class="lineNum">    2668 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;\nWARNING: filter %s bad description format for arg %s, should not end with \&quot;\\n\&quot;\n&quot;, reg_name, a-&gt;arg_name);</span>
<span class="lineNum">    2669 </span><span class="lineNoCov">          0 :                                         exit(1);</span>
<span class="lineNum">    2670 </span>            :                                 }
<span class="lineNum">    2671 </span>            : 
<span class="lineNum">    2672 </span><span class="lineCov">       1700 :                                 achar = a-&gt;arg_desc[0];</span>
<span class="lineNum">    2673 </span><span class="lineCov">       1700 :                                 if ((achar &gt;= 'A') &amp;&amp; (achar &lt;= 'Z')) {</span>
<span class="lineNum">    2674 </span><span class="lineCov">         32 :                                         achar = a-&gt;arg_desc[1];</span>
<span class="lineNum">    2675 </span><span class="lineCov">         32 :                                         if ((achar &lt; 'A') || (achar &gt; 'Z')) {</span>
<span class="lineNum">    2676 </span><span class="lineNoCov">          0 :                                                 fprintf(stderr, &quot;\nWARNING: filter %s bad description format for arg %s, should start with lowercase\n&quot;, reg_name, a-&gt;arg_name);</span>
<span class="lineNum">    2677 </span><span class="lineNoCov">          0 :                                                 exit(1);</span>
<span class="lineNum">    2678 </span>            :                                         }
<span class="lineNum">    2679 </span>            :                                 }
<span class="lineNum">    2680 </span><span class="lineCov">       1700 :                                 if (a-&gt;arg_desc[0] == ' ') {</span>
<span class="lineNum">    2681 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;\nWARNING: filter %s bad description format for arg %s, first character should not be space\n&quot;, reg_name, a-&gt;arg_name);</span>
<span class="lineNum">    2682 </span><span class="lineNoCov">          0 :                                         exit(1);</span>
<span class="lineNum">    2683 </span>            :                                 }
<span class="lineNum">    2684 </span><span class="lineCov">       1700 :                                 sep = strchr(a-&gt;arg_desc+1, ' ');</span>
<span class="lineNum">    2685 </span><span class="lineCov">       1700 :                                 if (sep) sep--;</span>
<span class="lineNum">    2686 </span><span class="lineCov">       1700 :                                 if (sep &amp;&amp; (sep[0] == 's') &amp;&amp; (sep[-1] != 's')) {</span>
<span class="lineNum">    2687 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;\nWARNING: filter %s bad description format for arg %s, first word should be infinitive\n&quot;, reg_name, a-&gt;arg_name);</span>
<span class="lineNum">    2688 </span><span class="lineNoCov">          0 :                                         exit(1);</span>
<span class="lineNum">    2689 </span>            :                                 }
<span class="lineNum">    2690 </span>            :                         }
<span class="lineNum">    2691 </span>            : #endif
<span class="lineNum">    2692 </span>            :                 }
<span class="lineNum">    2693 </span>            :         } else {
<span class="lineNum">    2694 </span><span class="lineCov">       2228 :                 gf_sys_format_help(helpout, help_flags, &quot;No options\n&quot;);</span>
<span class="lineNum">    2695 </span>            :         }
<span class="lineNum">    2696 </span>            : 
<span class="lineNum">    2697 </span><span class="lineCov">       3180 :         if (!gen_doc &amp;&amp; (argmode==GF_ARGMODE_ALL)) {</span>
<span class="lineNum">    2698 </span><span class="lineCov">       1290 :                 if (filter_inst) {</span>
<span class="lineNum">    2699 </span><span class="lineNoCov">          0 :                         u32 nb_caps = 0;</span>
<span class="lineNum">    2700 </span><span class="lineNoCov">          0 :                         const GF_FilterCapability *caps = gf_filter_get_caps(filter_inst, &amp;nb_caps);</span>
<span class="lineNum">    2701 </span><span class="lineNoCov">          0 :                         dump_caps(nb_caps, caps);</span>
<span class="lineNum">    2702 </span><span class="lineCov">       1290 :                 } else if (reg-&gt;nb_caps) {</span>
<span class="lineNum">    2703 </span><span class="lineCov">       1290 :                         dump_caps(reg-&gt;nb_caps, reg-&gt;caps);</span>
<span class="lineNum">    2704 </span>            :                 }
<span class="lineNum">    2705 </span>            :         }
<span class="lineNum">    2706 </span><span class="lineCov">       3180 :         gf_sys_format_help(helpout, help_flags, &quot;\n&quot;);</span>
<a name="2707"><span class="lineNum">    2707 </span>            : }</a>
<span class="lineNum">    2708 </span>            : 
<span class="lineNum">    2709 </span><span class="lineCov">       3076 : static Bool strstr_nocase(const char *text, const char *subtext, u32 subtext_len)</span>
<span class="lineNum">    2710 </span>            : {
<span class="lineNum">    2711 </span><span class="lineCov">       3076 :         if (!*text || !subtext || !subtext_len)</span>
<span class="lineNum">    2712 </span>            :                 return GF_FALSE;
<span class="lineNum">    2713 </span>            : 
<span class="lineNum">    2714 </span><span class="lineCov">     214498 :         while (*text) {</span>
<span class="lineNum">    2715 </span><span class="lineCov">     211516 :                 if (tolower(*text) == *subtext) {</span>
<span class="lineNum">    2716 </span><span class="lineCov">       6150 :                         if (!strnicmp(text, subtext, subtext_len))</span>
<span class="lineNum">    2717 </span>            :                                 return GF_TRUE;
<span class="lineNum">    2718 </span>            : 
<span class="lineNum">    2719 </span>            :                 }
<span class="lineNum">    2720 </span><span class="lineCov">     211508 :                 text++;</span>
<span class="lineNum">    2721 </span>            :         }
<span class="lineNum">    2722 </span>            :         return GF_FALSE;
<span class="lineNum">    2723 </span>            : }
<span class="lineNum">    2724 </span>            : 
<span class="lineNum">    2725 </span>            : struct __jsenum_info
<span class="lineNum">    2726 </span>            : {
<span class="lineNum">    2727 </span>            :         GF_FilterSession *session;
<span class="lineNum">    2728 </span>            :         GF_SysArgMode argmode;
<span class="lineNum">    2729 </span>            :         Bool print_filter_info;
<span class="lineNum">    2730 </span>            :         char *js_dir;
<a name="2731"><span class="lineNum">    2731 </span>            : };</a>
<span class="lineNum">    2732 </span>            : 
<span class="lineNum">    2733 </span><span class="lineCov">          5 : static Bool jsinfo_enum(void *cbck, char *item_name, char *item_path, GF_FileEnumInfo *file_info)</span>
<span class="lineNum">    2734 </span>            : {
<span class="lineNum">    2735 </span>            :         struct __jsenum_info *jsi = (struct __jsenum_info *)cbck;
<span class="lineNum">    2736 </span>            :         GF_Filter *f;
<span class="lineNum">    2737 </span><span class="lineCov">          5 :         if (jsi-&gt;js_dir &amp;&amp; strcmp(item_name, &quot;init.js&quot;)) {</span>
<span class="lineNum">    2738 </span>            :                 return GF_FALSE;
<span class="lineNum">    2739 </span>            :         }
<span class="lineNum">    2740 </span><span class="lineCov">          5 :         f = gf_fs_load_filter(jsi-&gt;session, item_path, NULL);</span>
<span class="lineNum">    2741 </span><span class="lineCov">          5 :         if (f) {</span>
<span class="lineNum">    2742 </span>            :                 char szPath[GF_MAX_PATH];
<span class="lineNum">    2743 </span>            :                 char *ext;
<span class="lineNum">    2744 </span><span class="lineCov">          5 :                 if (jsi-&gt;js_dir) {</span>
<span class="lineNum">    2745 </span>            :                         strcpy(szPath, jsi-&gt;js_dir);
<span class="lineNum">    2746 </span>            :                 } else {
<span class="lineNum">    2747 </span>            :                         strcpy(szPath, item_name);
<span class="lineNum">    2748 </span>            :                 }
<span class="lineNum">    2749 </span><span class="lineCov">          5 :                 ext = gf_file_ext_start(szPath);</span>
<span class="lineNum">    2750 </span><span class="lineCov">          5 :                 if (ext) ext[0] = 0;</span>
<span class="lineNum">    2751 </span><span class="lineCov">          5 :                 if (jsi-&gt;print_filter_info || gen_doc)</span>
<span class="lineNum">    2752 </span><span class="lineCov">          2 :                         print_filter(NULL, jsi-&gt;argmode, f, szPath);</span>
<span class="lineNum">    2753 </span>            :                 else
<span class="lineNum">    2754 </span><span class="lineCov">          3 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s: %s\n&quot;, szPath, gf_filter_get_description(f));</span>
<span class="lineNum">    2755 </span>            :         }
<a name="2756"><span class="lineNum">    2756 </span>            :         return GF_FALSE;</a>
<span class="lineNum">    2757 </span>            : }
<span class="lineNum">    2758 </span><span class="lineCov">          5 : static Bool jsinfo_dir_enum(void *cbck, char *item_name, char *item_path, GF_FileEnumInfo *file_info)</span>
<span class="lineNum">    2759 </span>            : {
<span class="lineNum">    2760 </span>            :         struct __jsenum_info *jsi = (struct __jsenum_info *)cbck;
<span class="lineNum">    2761 </span><span class="lineCov">          5 :         jsi-&gt;js_dir = item_name;</span>
<span class="lineNum">    2762 </span>            : 
<span class="lineNum">    2763 </span><span class="lineCov">          5 :         gf_enum_directory(item_path, GF_FALSE, jsinfo_enum, jsi, &quot;.js&quot;);</span>
<span class="lineNum">    2764 </span><span class="lineCov">          5 :         jsi-&gt;js_dir = NULL;</span>
<span class="lineNum">    2765 </span><span class="lineCov">          5 :         return GF_FALSE;</span>
<a name="2766"><span class="lineNum">    2766 </span>            : }</a>
<span class="lineNum">    2767 </span>            : 
<span class="lineNum">    2768 </span><span class="lineCov">         31 : static Bool print_filters(int argc, char **argv, GF_FilterSession *session, GF_SysArgMode argmode)</span>
<span class="lineNum">    2769 </span>            : {
<span class="lineNum">    2770 </span>            :         Bool found = GF_FALSE;
<span class="lineNum">    2771 </span>            :         Bool print_all = GF_FALSE;
<span class="lineNum">    2772 </span>            :         char *fname = NULL;
<span class="lineNum">    2773 </span>            :         char *l_fname = NULL;
<span class="lineNum">    2774 </span>            :         u32 lf_len = 0;
<span class="lineNum">    2775 </span><span class="lineCov">         31 :         u32 i, count = gf_fs_filters_registers_count(session);</span>
<span class="lineNum">    2776 </span>            : 
<span class="lineNum">    2777 </span><span class="lineCov">         31 :         if (!gen_doc &amp;&amp; list_filters) gf_sys_format_help(helpout, help_flags, &quot;Listing %d supported filters%s:\n&quot;, count, (list_filters==2) ? &quot; including meta-filters&quot; : &quot;&quot;);</span>
<span class="lineNum">    2778 </span>            : 
<span class="lineNum">    2779 </span><span class="lineCov">         31 :         if (print_filter_info != 1) {</span>
<span class="lineNum">    2780 </span><span class="lineCov">       2841 :                 for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    2781 </span><span class="lineCov">       2841 :                         const GF_FilterRegister *reg = gf_fs_get_filter_register(session, i);</span>
<span class="lineNum">    2782 </span><span class="lineCov">       2841 :                         if (gen_doc) {</span>
<span class="lineNum">    2783 </span><span class="lineCov">        214 :                                 print_filter(reg, argmode, NULL, NULL);</span>
<span class="lineNum">    2784 </span><span class="lineCov">       2627 :                         } else if (print_filter_info) {</span>
<span class="lineNum">    2785 </span><span class="lineCov">       1205 :                                 print_filter(reg, argmode, NULL, NULL);</span>
<span class="lineNum">    2786 </span>            :                         } else {
<span class="lineNum">    2787 </span>            : #ifndef GPAC_DISABLE_DOC
<span class="lineNum">    2788 </span><span class="lineCov">       1422 :                                 gf_sys_format_help(helpout, help_flags | GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s: %s\n&quot;, reg-&gt;name, reg-&gt;description);</span>
<span class="lineNum">    2789 </span>            : #else
<span class="lineNum">    2790 </span>            :                                 gf_sys_format_help(helpout, help_flags, &quot;%s (compiled without built-in doc)\n&quot;, reg-&gt;name);
<span class="lineNum">    2791 </span>            : #endif
<span class="lineNum">    2792 </span>            :                         }
<span class="lineNum">    2793 </span>            :                 }
<span class="lineNum">    2794 </span>            :                 found = GF_TRUE;
<span class="lineNum">    2795 </span>            :         }
<span class="lineNum">    2796 </span>            :         //print a specific filter info, browse args
<span class="lineNum">    2797 </span>            :         else {
<span class="lineNum">    2798 </span>            :                 u32 k;
<span class="lineNum">    2799 </span>            :                 //all good to go, load filters
<span class="lineNum">    2800 </span><span class="lineCov">        166 :                 for (k=1; k&lt;(u32) argc; k++) {</span>
<span class="lineNum">    2801 </span><span class="lineCov">        166 :                         char *arg = argv[k];</span>
<span class="lineNum">    2802 </span>            :                         char *sepe;
<span class="lineNum">    2803 </span>            :                         Bool found_freg = GF_FALSE;
<span class="lineNum">    2804 </span>            :                         char *optname = NULL;
<span class="lineNum">    2805 </span><span class="lineCov">        166 :                         if (arg[0]=='-') continue;</span>
<span class="lineNum">    2806 </span>            : 
<span class="lineNum">    2807 </span><span class="lineCov">         25 :                         sepe = gf_file_basename(arg);</span>
<span class="lineNum">    2808 </span><span class="lineCov">         25 :                         if (sepe) sepe = strchr(sepe, '.');</span>
<span class="lineNum">    2809 </span><span class="lineCov">         25 :                         if (sepe) {</span>
<span class="lineNum">    2810 </span><span class="lineCov">          2 :                                 if (!strncmp(sepe, &quot;.js.&quot;, 4)) sepe = strchr(sepe+1, '.');</span>
<span class="lineNum">    2811 </span><span class="lineCov">          2 :                                 else if (!strcmp(sepe, &quot;.js&quot;)) sepe = NULL;</span>
<span class="lineNum">    2812 </span><span class="lineCov">          1 :                                 if (sepe) {</span>
<span class="lineNum">    2813 </span><span class="lineCov">          1 :                                         sepe[0] = 0;</span>
<span class="lineNum">    2814 </span><span class="lineCov">          1 :                                         optname = sepe+1;</span>
<span class="lineNum">    2815 </span>            :                                 }
<span class="lineNum">    2816 </span>            :                         }
<span class="lineNum">    2817 </span>            :                         fname = arg;
<span class="lineNum">    2818 </span><span class="lineCov">      30172 :                         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    2819 </span><span class="lineCov">      30147 :                                 const GF_FilterRegister *reg = gf_fs_get_filter_register(session, i);</span>
<span class="lineNum">    2820 </span>            :                                 //exact match
<span class="lineNum">    2821 </span><span class="lineCov">      30147 :                                 if (!strcmp(arg, reg-&gt;name) ) {</span>
<span class="lineNum">    2822 </span><span class="lineCov">         11 :                                         if (optname)</span>
<span class="lineNum">    2823 </span><span class="lineCov">          1 :                                                 print_filter_single_opt(reg, optname, NULL);</span>
<span class="lineNum">    2824 </span>            :                                         else
<span class="lineNum">    2825 </span><span class="lineCov">         10 :                                                 print_filter(reg, argmode, NULL, NULL);</span>
<span class="lineNum">    2826 </span>            :                                         found_freg = GF_TRUE;
<span class="lineNum">    2827 </span>            :                                 }
<span class="lineNum">    2828 </span>            :                                 //search for name:*, also accept *:*
<span class="lineNum">    2829 </span>            :                                 else {
<span class="lineNum">    2830 </span><span class="lineCov">      30136 :                                         char *sepo = strchr(arg, ':');</span>
<span class="lineNum">    2831 </span><span class="lineCov">      30136 :                                         char *sepd = strchr(reg-&gt;name, ':');</span>
<span class="lineNum">    2832 </span>            :                                         Bool patch_meta = GF_FALSE;
<span class="lineNum">    2833 </span><span class="lineCov">      30136 :                                         if (sepo &amp;&amp; sepd) {</span>
<span class="lineNum">    2834 </span><span class="lineCov">       5505 :                                                 u32 slen = (u32) (sepd - reg-&gt;name);</span>
<span class="lineNum">    2835 </span><span class="lineCov">       5505 :                                                 if (!strnicmp(arg, reg-&gt;name, slen)) {</span>
<span class="lineNum">    2836 </span><span class="lineCov">       1748 :                                                         char *subf = strstr(reg-&gt;name, sepo+1);</span>
<span class="lineNum">    2837 </span><span class="lineCov">       1748 :                                                         if (subf) {</span>
<span class="lineNum">    2838 </span><span class="lineNoCov">          0 :                                                                 slen = (u32) strlen(sepo+1);</span>
<span class="lineNum">    2839 </span><span class="lineNoCov">          0 :                                                                 if ((subf[slen]==0) || (subf[slen]==','))</span>
<span class="lineNum">    2840 </span>            :                                                                         patch_meta = GF_TRUE;
<span class="lineNum">    2841 </span>            :                                                         }
<span class="lineNum">    2842 </span>            :                                                 }
<span class="lineNum">    2843 </span>            :                                         }
<span class="lineNum">    2844 </span><span class="lineCov">      30136 :                                         if (!strcmp(arg, &quot;*:*&quot;) || !strcmp(arg, &quot;@:@&quot;)</span>
<span class="lineNum">    2845 </span><span class="lineCov">      30136 :                                                 || (!sepo &amp;&amp; (!strcmp(arg, &quot;*&quot;) || !strcmp(arg, &quot;@&quot;)) )</span>
<span class="lineNum">    2846 </span><span class="lineCov">      30136 :                                                 || (sepo &amp;&amp; (!strcmp(sepo, &quot;:*&quot;) || !strcmp(sepo, &quot;:@&quot;))  &amp;&amp; !strncmp(reg-&gt;name, arg, 1+sepo - arg) )</span>
<span class="lineNum">    2847 </span><span class="lineCov">      28388 :                                                 || patch_meta</span>
<span class="lineNum">    2848 </span>            :                                         ) {
<span class="lineNum">    2849 </span><span class="lineCov">       1748 :                                                 if (optname)</span>
<span class="lineNum">    2850 </span><span class="lineNoCov">          0 :                                                         print_filter_single_opt(reg, optname, NULL);</span>
<span class="lineNum">    2851 </span>            :                                                 else
<span class="lineNum">    2852 </span><span class="lineCov">       1748 :                                                         print_filter(reg, argmode, NULL, NULL);</span>
<span class="lineNum">    2853 </span>            :                                                 found_freg = GF_TRUE;
<span class="lineNum">    2854 </span><span class="lineCov">       1748 :                                                 if (!strcmp(arg, &quot;*&quot;)) print_all = GF_TRUE;</span>
<span class="lineNum">    2855 </span>            :                                         }
<span class="lineNum">    2856 </span>            :                                 }
<span class="lineNum">    2857 </span>            :                         }
<span class="lineNum">    2858 </span><span class="lineCov">         25 :                         if (found_freg) {</span>
<span class="lineNum">    2859 </span>            :                                 found = GF_TRUE;
<span class="lineNum">    2860 </span><span class="lineCov">          9 :                         } else if (!strchr(arg, ':')) {</span>
<span class="lineNum">    2861 </span>            :                                 //try to load the filter (JS)
<span class="lineNum">    2862 </span><span class="lineCov">          9 :                                 GF_Filter *f = gf_fs_load_filter(session, arg, NULL);</span>
<span class="lineNum">    2863 </span><span class="lineCov">          9 :                                 if (f) {</span>
<span class="lineNum">    2864 </span>            :                                         char *ext;
<span class="lineNum">    2865 </span>            :                                         char szPath[GF_MAX_PATH];
<span class="lineNum">    2866 </span><span class="lineCov">          1 :                                         strcpy(szPath, gf_file_basename(arg) );</span>
<span class="lineNum">    2867 </span><span class="lineCov">          1 :                                         ext = gf_file_ext_start(szPath);</span>
<span class="lineNum">    2868 </span><span class="lineCov">          1 :                                         if (ext) ext[0] = 0;</span>
<span class="lineNum">    2869 </span><span class="lineCov">          1 :                                         if (optname) {</span>
<span class="lineNum">    2870 </span><span class="lineNoCov">          0 :                                                 print_filter_single_opt(NULL, optname, f);</span>
<span class="lineNum">    2871 </span>            :                                         } else {
<span class="lineNum">    2872 </span><span class="lineCov">          1 :                                                 print_filter(NULL, argmode, f, szPath);</span>
<span class="lineNum">    2873 </span>            :                                         }
<span class="lineNum">    2874 </span>            :                                         found = GF_TRUE;
<span class="lineNum">    2875 </span>            :                                 }
<span class="lineNum">    2876 </span>            :                         }
<span class="lineNum">    2877 </span><span class="lineCov">         25 :                         if (sepe) sepe[0] = '.';</span>
<span class="lineNum">    2878 </span>            :                 }
<span class="lineNum">    2879 </span>            :         }
<span class="lineNum">    2880 </span>            : 
<span class="lineNum">    2881 </span><span class="lineCov">         31 :         if (print_all || !print_filter_info || gen_doc) {</span>
<span class="lineNum">    2882 </span><span class="lineCov">          5 :                 const char *js_dirs = gf_opts_get_key(&quot;core&quot;, &quot;js-dirs&quot;);</span>
<span class="lineNum">    2883 </span>            :                 char szPath[GF_MAX_PATH];
<span class="lineNum">    2884 </span>            :                 struct __jsenum_info jsi;
<span class="lineNum">    2885 </span><span class="lineCov">          5 :                 jsi.argmode = argmode;</span>
<span class="lineNum">    2886 </span><span class="lineCov">          5 :                 jsi.session = session;</span>
<span class="lineNum">    2887 </span><span class="lineCov">          5 :                 jsi.print_filter_info = print_filter_info;</span>
<span class="lineNum">    2888 </span>            : 
<span class="lineNum">    2889 </span><span class="lineCov">          5 :                 gf_log_set_tools_levels(&quot;console@error&quot;, GF_FALSE);</span>
<span class="lineNum">    2890 </span>            : 
<span class="lineNum">    2891 </span><span class="lineCov">          5 :                 if (gf_opts_default_shared_directory(szPath)) {</span>
<span class="lineNum">    2892 </span>            :                         strcat(szPath, &quot;/scripts/jsf/&quot;);
<span class="lineNum">    2893 </span><span class="lineCov">          5 :                         gf_enum_directory(szPath, GF_FALSE, jsinfo_enum, &amp;jsi, &quot;.js&quot;);</span>
<span class="lineNum">    2894 </span><span class="lineCov">          5 :                         gf_enum_directory(szPath, GF_TRUE, jsinfo_dir_enum, &amp;jsi, NULL);</span>
<span class="lineNum">    2895 </span>            :                 }
<span class="lineNum">    2896 </span><span class="lineCov">          5 :                 while (js_dirs &amp;&amp; js_dirs[0]) {</span>
<span class="lineNum">    2897 </span><span class="lineNoCov">          0 :                         char *sep = strchr(js_dirs, ',');</span>
<span class="lineNum">    2898 </span><span class="lineNoCov">          0 :                         if (sep) {</span>
<span class="lineNum">    2899 </span><span class="lineNoCov">          0 :                                 u32 cplen = (u32) (sep-js_dirs);</span>
<span class="lineNum">    2900 </span><span class="lineNoCov">          0 :                                 if (cplen&gt;=GF_MAX_PATH) cplen = GF_MAX_PATH-1;</span>
<span class="lineNum">    2901 </span><span class="lineNoCov">          0 :                                 strncpy(szPath, js_dirs, cplen);</span>
<span class="lineNum">    2902 </span><span class="lineNoCov">          0 :                                 szPath[cplen]=0;</span>
<span class="lineNum">    2903 </span><span class="lineNoCov">          0 :                                 js_dirs = sep+1;</span>
<span class="lineNum">    2904 </span>            :                         } else {
<span class="lineNum">    2905 </span>            :                                 strcpy(szPath, js_dirs);
<span class="lineNum">    2906 </span>            :                         }
<span class="lineNum">    2907 </span>            :                         //pre 1.1, $GJS was inserted by default
<span class="lineNum">    2908 </span><span class="lineNoCov">          0 :                         if (strcmp(szPath, &quot;$GJS&quot;)) {</span>
<span class="lineNum">    2909 </span><span class="lineNoCov">          0 :                                 u32 len = (u32) strlen(szPath);</span>
<span class="lineNum">    2910 </span><span class="lineNoCov">          0 :                                 if (len &amp;&amp; (szPath[len-1]!='/') &amp;&amp; (szPath[len-1]!='\\'))</span>
<span class="lineNum">    2911 </span>            :                                         strcat(szPath, &quot;/&quot;);
<span class="lineNum">    2912 </span><span class="lineNoCov">          0 :                                 gf_enum_directory(szPath, GF_FALSE, jsinfo_enum, &amp;jsi, &quot;.js&quot;);</span>
<span class="lineNum">    2913 </span>            :                         }
<span class="lineNum">    2914 </span><span class="lineNoCov">          0 :                         if (!sep) break;</span>
<span class="lineNum">    2915 </span>            :                 }
<span class="lineNum">    2916 </span>            :                 return GF_TRUE;
<span class="lineNum">    2917 </span>            :         }
<span class="lineNum">    2918 </span>            : 
<span class="lineNum">    2919 </span>            : 
<span class="lineNum">    2920 </span><span class="lineCov">         26 :         if (found) return GF_TRUE;</span>
<span class="lineNum">    2921 </span><span class="lineCov">          8 :         if (!fname) return GF_FALSE;</span>
<span class="lineNum">    2922 </span>            :         if (!print_filter_info) return GF_FALSE;
<span class="lineNum">    2923 </span>            :         if (gen_doc) return GF_FALSE;
<span class="lineNum">    2924 </span>            : 
<span class="lineNum">    2925 </span><span class="lineCov">          8 :         if (argmode==GF_ARGMODE_EXPERT) {</span>
<span class="lineNum">    2926 </span><span class="lineCov">          1 :                 l_fname = gf_strdup(fname);</span>
<span class="lineNum">    2927 </span><span class="lineCov">          1 :                 strlwr(l_fname);</span>
<span class="lineNum">    2928 </span><span class="lineCov">          1 :                 lf_len = (u32) strlen(l_fname);</span>
<span class="lineNum">    2929 </span>            :         }
<span class="lineNum">    2930 </span>            : 
<span class="lineNum">    2931 </span><span class="lineCov">       9648 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    2932 </span>            :                 u32 j=0;
<span class="lineNum">    2933 </span><span class="lineCov">       9640 :                 const GF_FilterRegister *reg = gf_fs_get_filter_register(session, i);</span>
<span class="lineNum">    2934 </span>            : 
<span class="lineNum">    2935 </span><span class="lineCov">      44320 :                 while (reg-&gt;args) {</span>
<span class="lineNum">    2936 </span><span class="lineCov">      28352 :                         const GF_FilterArgs *arg = &amp;reg-&gt;args[j];</span>
<span class="lineNum">    2937 </span><span class="lineCov">      28352 :                         if (!arg || !arg-&gt;arg_name) break;</span>
<span class="lineNum">    2938 </span><span class="lineCov">      25040 :                         j++;</span>
<span class="lineNum">    2939 </span><span class="lineCov">      25040 :                         if (argmode==GF_ARGMODE_EXPERT) {</span>
<span class="lineNum">    2940 </span><span class="lineCov">       3130 :                                 if (!arg-&gt;arg_desc || !strstr_nocase(arg-&gt;arg_desc, l_fname, lf_len)) continue;</span>
<span class="lineNum">    2941 </span><span class="lineCov">          8 :                                 if (!found) {</span>
<span class="lineNum">    2942 </span><span class="lineCov">          1 :                                         GF_LOG(GF_LOG_WARNING, GF_LOG_APP, (&quot;\&quot;%s\&quot; is mentionned in the following filters options:\n&quot;, fname));</span>
<span class="lineNum">    2943 </span>            :                                         found = GF_TRUE;
<span class="lineNum">    2944 </span>            :                                 }
<span class="lineNum">    2945 </span><span class="lineCov">          8 :                                 gf_sys_format_help(helpout, help_flags | GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s.%s \n&quot;, reg-&gt;name, arg-&gt;arg_name);</span>
<span class="lineNum">    2946 </span>            : #if 0
<span class="lineNum">    2947 </span>            : 
<span class="lineNum">    2948 </span>            :                         } else {
<span class="lineNum">    2949 </span>            :                                 if (strcmp(arg-&gt;arg_name, fname)) continue;
<span class="lineNum">    2950 </span>            :                                 if (!found) {
<span class="lineNum">    2951 </span>            :                                         GF_LOG(GF_LOG_WARNING, GF_LOG_APP, (&quot;No such filter \&quot;%s\&quot; but found filters with matching options:\n&quot;, fname));
<span class="lineNum">    2952 </span>            :                                         found = GF_TRUE;
<span class="lineNum">    2953 </span>            :                                 }
<span class="lineNum">    2954 </span>            :                                 gf_sys_format_help(helpout, help_flags | GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s.%s: %s\n&quot;, reg-&gt;name, arg-&gt;arg_name, arg-&gt;arg_desc);
<span class="lineNum">    2955 </span>            : #endif
<span class="lineNum">    2956 </span>            :                         }
<span class="lineNum">    2957 </span>            :                 }
<span class="lineNum">    2958 </span>            :         }
<span class="lineNum">    2959 </span><span class="lineCov">          8 :         if (l_fname) gf_free(l_fname);</span>
<span class="lineNum">    2960 </span>            : 
<span class="lineNum">    2961 </span>            : 
<span class="lineNum">    2962 </span><span class="lineCov">          8 :         if (found) return GF_TRUE;</span>
<span class="lineNum">    2963 </span>            : 
<span class="lineNum">    2964 </span><span class="lineCov">          7 :         GF_LOG(GF_LOG_ERROR, GF_LOG_APP, (&quot;No such filter \&quot;%s\&quot;\n&quot;, fname));</span>
<span class="lineNum">    2965 </span><span class="lineCov">          7 :         gpac_suggest_filter(fname, GF_TRUE, GF_FALSE);</span>
<span class="lineNum">    2966 </span><span class="lineCov">          7 :         return GF_FALSE;</span>
<a name="2967"><span class="lineNum">    2967 </span>            : }</a>
<span class="lineNum">    2968 </span>            : 
<span class="lineNum">    2969 </span><span class="lineCov">          3 : static void dump_all_props(void)</span>
<span class="lineNum">    2970 </span>            : {
<span class="lineNum">    2971 </span>            :         u32 i=0;
<span class="lineNum">    2972 </span>            :         const GF_BuiltInProperty *prop_info;
<span class="lineNum">    2973 </span>            : 
<span class="lineNum">    2974 </span><span class="lineCov">          3 :         if (gen_doc==1) {</span>
<span class="lineNum">    2975 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;## Built-in property types\n&quot;</span>
<span class="lineNum">    2976 </span>            :                 &quot;  \n&quot;);
<span class="lineNum">    2977 </span>            : 
<span class="lineNum">    2978 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;Name | Description  \n&quot;);</span>
<span class="lineNum">    2979 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;--- | ---  \n&quot;);</span>
<span class="lineNum">    2980 </span><span class="lineCov">         45 :                 for (i=GF_PROP_FORBIDEN+1; i&lt;GF_PROP_LAST_DEFINED; i++) {</span>
<span class="lineNum">    2981 </span><span class="lineCov">         44 :                         if (i==GF_PROP_STRING_NO_COPY) continue;</span>
<span class="lineNum">    2982 </span><span class="lineCov">         43 :                         if (i==GF_PROP_DATA_NO_COPY) continue;</span>
<span class="lineNum">    2983 </span><span class="lineCov">         42 :                         if ((i&gt;=GF_PROP_LAST_NON_ENUM) &amp;&amp; (i&lt;GF_PROP_FIRST_ENUM)) continue;</span>
<span class="lineNum">    2984 </span><span class="lineCov">         29 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_NL_TO_BR, &quot;%s | %s  \n&quot;, gf_props_get_type_name(i), gf_props_get_type_desc(i) );</span>
<span class="lineNum">    2985 </span>            :                 }
<span class="lineNum">    2986 </span>            : 
<span class="lineNum">    2987 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;## Built-in properties for PIDs and packets, pixel formats and audio formats\n&quot;</span>
<span class="lineNum">    2988 </span>            :                 &quot;  \n&quot;
<span class="lineNum">    2989 </span>            :                 &quot;Flags can be:\n&quot;
<span class="lineNum">    2990 </span>            :                 &quot;- D: droppable property, see [GSF mux](gsfmx) filter help for more info\n&quot;
<span class="lineNum">    2991 </span>            :                 &quot;- P: property applying to packet\n&quot;
<span class="lineNum">    2992 </span>            :                 &quot;  \n&quot;);
<span class="lineNum">    2993 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;Name | type | Flags | Description | 4CC  \n&quot;);</span>
<span class="lineNum">    2994 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;--- | --- | --- | --- | ---  \n&quot;);</span>
<span class="lineNum">    2995 </span>            :         } else {
<span class="lineNum">    2996 </span><span class="lineCov">          2 :                 gf_sys_format_help(helpout, help_flags, &quot;Built-in property types\n&quot;);</span>
<span class="lineNum">    2997 </span><span class="lineCov">         90 :                 for (i=GF_PROP_FORBIDEN+1; i&lt;GF_PROP_LAST_DEFINED; i++) {</span>
<span class="lineNum">    2998 </span><span class="lineCov">         88 :                         if (i==GF_PROP_STRING_NO_COPY) continue;</span>
<span class="lineNum">    2999 </span><span class="lineCov">         86 :                         if (i==GF_PROP_DATA_NO_COPY) continue;</span>
<span class="lineNum">    3000 </span><span class="lineCov">         84 :                         if ((i&gt;=GF_PROP_LAST_NON_ENUM) &amp;&amp; (i&lt;GF_PROP_FIRST_ENUM)) continue;</span>
<span class="lineNum">    3001 </span>            : 
<span class="lineNum">    3002 </span><span class="lineCov">         58 :                         if (gen_doc==2) {</span>
<span class="lineNum">    3003 </span><span class="lineCov">         29 :                                 gf_sys_format_help(helpout, help_flags, &quot;.TP\n.B %s\n%s\n&quot;, gf_props_get_type_name(i), gf_props_get_type_desc(i));</span>
<span class="lineNum">    3004 </span>            :                         } else {
<span class="lineNum">    3005 </span><span class="lineCov">         29 :                                 gf_sys_format_help(helpout, help_flags | GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s : %s\n&quot;, gf_props_get_type_name(i), gf_props_get_type_desc(i) );</span>
<span class="lineNum">    3006 </span>            :                         }
<span class="lineNum">    3007 </span>            :                 }
<span class="lineNum">    3008 </span><span class="lineCov">          2 :                 gf_sys_format_help(helpout, help_flags, &quot;\n\n&quot;);</span>
<span class="lineNum">    3009 </span>            : 
<span class="lineNum">    3010 </span><span class="lineCov">          2 :                 gf_sys_format_help(helpout, help_flags, &quot;Built-in properties for PIDs and packets listed as `Name (4CC type FLAGS): description`\n`FLAGS` can be D (droppable - see GSF mux filter help), P (packet property)\n&quot;);</span>
<span class="lineNum">    3011 </span>            :         }
<span class="lineNum">    3012 </span>            :         i=0;
<span class="lineNum">    3013 </span><span class="lineCov">        642 :         while ((prop_info = gf_props_get_description(i))) {</span>
<span class="lineNum">    3014 </span><span class="lineCov">        639 :                 i++;</span>
<span class="lineNum">    3015 </span>            :                 char szFlags[10];
<span class="lineNum">    3016 </span><span class="lineCov">        639 :                 if (! prop_info-&gt;name) continue;</span>
<span class="lineNum">    3017 </span>            : 
<span class="lineNum">    3018 </span><span class="lineCov">        630 :                 if (gen_doc==1) {</span>
<span class="lineNum">    3019 </span>            :                         strcpy(szFlags, &quot;&quot;);
<span class="lineNum">    3020 </span><span class="lineCov">        210 :                         if (prop_info-&gt;flags &amp; GF_PROP_FLAG_GSF_REM) strcat(szFlags, &quot;D&quot;);</span>
<span class="lineNum">    3021 </span><span class="lineCov">        210 :                         if (prop_info-&gt;flags &amp; GF_PROP_FLAG_PCK) strcat(szFlags, &quot;P&quot;);</span>
<span class="lineNum">    3022 </span>            : 
<span class="lineNum">    3023 </span><span class="lineCov">        210 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_NL_TO_BR, &quot;%s | %s | %s | %s | %s  \n&quot;, prop_info-&gt;name,  gf_props_get_type_name(prop_info-&gt;data_type),</span>
<span class="lineNum">    3024 </span>            :                                 szFlags,
<span class="lineNum">    3025 </span>            :                                 prop_info-&gt;description,
<span class="lineNum">    3026 </span>            :                                 gf_4cc_to_str(prop_info-&gt;type)
<span class="lineNum">    3027 </span>            :                         );
<span class="lineNum">    3028 </span><span class="lineCov">        420 :                 } else if (gen_doc==2) {</span>
<span class="lineNum">    3029 </span><span class="lineCov">        420 :                         gf_sys_format_help(helpout, help_flags, &quot;.TP\n.B %s (%s,%s,%s%s)\n%s\n&quot;, prop_info-&gt;name, gf_4cc_to_str(prop_info-&gt;type), gf_props_get_type_name(prop_info-&gt;data_type),</span>
<span class="lineNum">    3030 </span>            :                                 (prop_info-&gt;flags &amp; GF_PROP_FLAG_GSF_REM) ? &quot;D&quot; : &quot; &quot;,
<span class="lineNum">    3031 </span><span class="lineCov">        210 :                                 (prop_info-&gt;flags &amp; GF_PROP_FLAG_PCK) ? &quot;P&quot; : &quot; &quot;,</span>
<span class="lineNum">    3032 </span>            :                                 prop_info-&gt;description);
<span class="lineNum">    3033 </span>            :                 } else {
<span class="lineNum">    3034 </span>            :                         u32 len;
<span class="lineNum">    3035 </span>            :                         const char *ptype;
<span class="lineNum">    3036 </span><span class="lineCov">        210 :                         szFlags[0]=0;</span>
<span class="lineNum">    3037 </span><span class="lineCov">        210 :                         if (prop_info-&gt;flags &amp; GF_PROP_FLAG_GSF_REM) strcat(szFlags, &quot;D&quot;);</span>
<span class="lineNum">    3038 </span><span class="lineCov">        210 :                         if (prop_info-&gt;flags &amp; GF_PROP_FLAG_PCK) strcat(szFlags, &quot;P&quot;);</span>
<span class="lineNum">    3039 </span>            : 
<span class="lineNum">    3040 </span><span class="lineCov">        210 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s&quot;, prop_info-&gt;name);</span>
<span class="lineNum">    3041 </span><span class="lineCov">        210 :                         len = (u32) strlen(prop_info-&gt;name);</span>
<span class="lineNum">    3042 </span><span class="lineCov">       1840 :                         while (len&lt;16) {</span>
<span class="lineNum">    3043 </span><span class="lineCov">       1420 :                                 gf_sys_format_help(helpout, help_flags, &quot; &quot;);</span>
<span class="lineNum">    3044 </span><span class="lineCov">       1420 :                                 len++;</span>
<span class="lineNum">    3045 </span>            :                         }
<span class="lineNum">    3046 </span><span class="lineCov">        210 :                         ptype = gf_props_get_type_name(prop_info-&gt;data_type);</span>
<span class="lineNum">    3047 </span><span class="lineCov">        210 :                         gf_sys_format_help(helpout, help_flags, &quot; (%s %s %s):&quot;, gf_4cc_to_str(prop_info-&gt;type), ptype, szFlags);</span>
<span class="lineNum">    3048 </span><span class="lineCov">        210 :                         len = (u32) strlen(ptype);</span>
<span class="lineNum">    3049 </span><span class="lineCov">        865 :                         while (len&lt;6) {</span>
<span class="lineNum">    3050 </span><span class="lineCov">        445 :                                 gf_sys_format_help(helpout, help_flags, &quot; &quot;);</span>
<span class="lineNum">    3051 </span><span class="lineCov">        445 :                                 len++;</span>
<span class="lineNum">    3052 </span>            :                         }
<span class="lineNum">    3053 </span>            : 
<span class="lineNum">    3054 </span><span class="lineCov">        210 :                         gf_sys_format_help(helpout, help_flags, &quot;%s&quot;, prop_info-&gt;description);</span>
<span class="lineNum">    3055 </span>            : 
<span class="lineNum">    3056 </span><span class="lineCov">        210 :                         if (prop_info-&gt;data_type==GF_PROP_PIXFMT) {</span>
<span class="lineNum">    3057 </span><span class="lineCov">          2 :                                 gf_sys_format_help(helpout, help_flags, &quot;\n\tNames: %s\n\tFile extensions: %s&quot;, gf_pixel_fmt_all_names(), gf_pixel_fmt_all_shortnames() );</span>
<span class="lineNum">    3058 </span><span class="lineCov">        208 :                         } else if (prop_info-&gt;data_type==GF_PROP_PCMFMT) {</span>
<span class="lineNum">    3059 </span><span class="lineCov">          1 :                                 gf_sys_format_help(helpout, help_flags, &quot;\n\tNames: %s\n\tFile extensions: %s&quot;, gf_audio_fmt_all_names(), gf_audio_fmt_all_shortnames() );</span>
<span class="lineNum">    3060 </span><span class="lineCov">        207 :                         } else if (gf_props_type_is_enum(prop_info-&gt;data_type)) {</span>
<span class="lineNum">    3061 </span><span class="lineCov">          3 :                                 gf_sys_format_help(helpout, help_flags, &quot;\n\tNames: %s\n\t&quot;, gf_props_enum_all_names(prop_info-&gt;data_type) );</span>
<span class="lineNum">    3062 </span>            :                         }
<span class="lineNum">    3063 </span><span class="lineCov">        210 :                         gf_sys_format_help(helpout, help_flags, &quot;\n&quot;);</span>
<span class="lineNum">    3064 </span>            :                 }
<span class="lineNum">    3065 </span>            :         }
<span class="lineNum">    3066 </span><span class="lineCov">          3 :         if (gen_doc==1) {</span>
<span class="lineNum">    3067 </span><span class="lineCov">          1 :                 u32 idx=0;</span>
<span class="lineNum">    3068 </span>            :                 GF_PixelFormat pfmt;
<span class="lineNum">    3069 </span>            :                 const char *name, *fileext, *desc;
<span class="lineNum">    3070 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;# Pixel formats\n&quot;);</span>
<span class="lineNum">    3071 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;Name | File extensions | QT 4CC |Description  \n&quot;);</span>
<span class="lineNum">    3072 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot; --- | --- |  --- | ---  \n&quot;);</span>
<span class="lineNum">    3073 </span><span class="lineCov">         48 :                 while ( (pfmt = gf_pixel_fmt_enum(&amp;idx, &amp;name, &amp;fileext, &amp;desc) )) {</span>
<span class="lineNum">    3074 </span>            :                         const char *qtname = &quot;&quot;;
<span class="lineNum">    3075 </span><span class="lineCov">         46 :                         u32 qt_code = gf_pixel_fmt_to_qt_type(pfmt);</span>
<span class="lineNum">    3076 </span><span class="lineCov">         46 :                         if (qt_code) qtname = gf_4cc_to_str(qt_code);</span>
<span class="lineNum">    3077 </span>            : 
<span class="lineNum">    3078 </span><span class="lineCov">         46 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_NL_TO_BR, &quot;%s | %s | %s | %s  \n&quot;, name, fileext, qtname, desc);</span>
<span class="lineNum">    3079 </span>            :                 }
<span class="lineNum">    3080 </span>            : 
<span class="lineNum">    3081 </span><span class="lineCov">          1 :                 idx=0;</span>
<span class="lineNum">    3082 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;# Audio formats\n&quot;);</span>
<span class="lineNum">    3083 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot; Name | File extensions | Description  \n&quot;);</span>
<span class="lineNum">    3084 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot; --- | --- | ---  \n&quot;);</span>
<span class="lineNum">    3085 </span><span class="lineCov">         14 :                 while ( gf_audio_fmt_enum(&amp;idx, &amp;name, &amp;fileext, &amp;desc)) {</span>
<span class="lineNum">    3086 </span><span class="lineCov">         12 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_NL_TO_BR, &quot;%s | %s | %s  \n&quot;, name, fileext, desc);</span>
<span class="lineNum">    3087 </span>            :                 }
<span class="lineNum">    3088 </span>            : 
<span class="lineNum">    3089 </span><span class="lineCov">          1 :                 idx=0;</span>
<span class="lineNum">    3090 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;# Stream types\n&quot;);</span>
<span class="lineNum">    3091 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot; Name | Description  \n&quot;);</span>
<span class="lineNum">    3092 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot; --- | ---  \n&quot;);</span>
<span class="lineNum">    3093 </span><span class="lineCov">         17 :                 while ( gf_stream_types_enum(&amp;idx, &amp;name, &amp;desc)) {</span>
<span class="lineNum">    3094 </span><span class="lineCov">         15 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_NL_TO_BR, &quot;%s | %s  \n&quot;, name, desc);</span>
<span class="lineNum">    3095 </span>            :                 }
<span class="lineNum">    3096 </span>            : 
<span class="lineNum">    3097 </span><span class="lineCov">          1 :                 idx=0;</span>
<span class="lineNum">    3098 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;# Codecs\n&quot;);</span>
<span class="lineNum">    3099 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;The codec name identifies a codec within GPAC. There can be several names for a given codec. The first name is used as a default file extension when dumping a raw media stream.\n&quot;</span>
<span class="lineNum">    3100 </span>            :                         &quot;  \n&quot;);
<span class="lineNum">    3101 </span>            : 
<span class="lineNum">    3102 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot; Name | Description  \n&quot;);</span>
<span class="lineNum">    3103 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot; --- | ---  \n&quot;);</span>
<span class="lineNum">    3104 </span><span class="lineCov">        108 :                 while ( gf_codecid_enum(idx, &amp;name, &amp;desc)) {</span>
<span class="lineNum">    3105 </span><span class="lineCov">        106 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_NL_TO_BR | GF_PRINTARG_ESCAPE_PIPE, &quot;%s | %s  \n&quot;, name, desc);</span>
<span class="lineNum">    3106 </span><span class="lineCov">        106 :                         idx++;</span>
<span class="lineNum">    3107 </span>            :                 }
<span class="lineNum">    3108 </span>            : 
<span class="lineNum">    3109 </span><span class="lineCov">          2 :         } else if (gen_doc==2) {</span>
<span class="lineNum">    3110 </span><span class="lineCov">          1 :                 u32 idx=0;</span>
<span class="lineNum">    3111 </span>            :                 const char *name, *fileext, *desc;
<span class="lineNum">    3112 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;# Pixel formats\n&quot;);</span>
<span class="lineNum">    3113 </span><span class="lineCov">         48 :                 while ( gf_pixel_fmt_enum(&amp;idx, &amp;name, &amp;fileext, &amp;desc)) {</span>
<span class="lineNum">    3114 </span><span class="lineCov">         46 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_NL_TO_BR, &quot;.TP\n.B %s (ext *.%s)\n%s\n&quot;, name, fileext, desc);</span>
<span class="lineNum">    3115 </span>            :                 }
<span class="lineNum">    3116 </span>            : 
<span class="lineNum">    3117 </span><span class="lineCov">          1 :                 idx=0;</span>
<span class="lineNum">    3118 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;# Audio formats\n&quot;);</span>
<span class="lineNum">    3119 </span><span class="lineCov">         14 :                 while ( gf_audio_fmt_enum(&amp;idx, &amp;name, &amp;fileext, &amp;desc)) {</span>
<span class="lineNum">    3120 </span><span class="lineCov">         12 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_NL_TO_BR, &quot;.TP\n.B %s (ext *.%s)\n%s\n&quot;, name, fileext, desc);</span>
<span class="lineNum">    3121 </span>            :                 }
<span class="lineNum">    3122 </span>            : 
<span class="lineNum">    3123 </span><span class="lineCov">          1 :                 idx=0;</span>
<span class="lineNum">    3124 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;# Stream types\n&quot;);</span>
<span class="lineNum">    3125 </span><span class="lineCov">         17 :                 while ( gf_stream_types_enum(&amp;idx, &amp;name, &amp;desc)) {</span>
<span class="lineNum">    3126 </span><span class="lineCov">         15 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_NL_TO_BR, &quot;.TP\n.B %s\n%s\n&quot;, name, desc);</span>
<span class="lineNum">    3127 </span>            :                 }
<span class="lineNum">    3128 </span>            : 
<span class="lineNum">    3129 </span><span class="lineCov">          1 :                 idx=0;</span>
<span class="lineNum">    3130 </span><span class="lineCov">          1 :                 gf_sys_format_help(helpout, help_flags, &quot;# Codecs\n&quot;);</span>
<span class="lineNum">    3131 </span><span class="lineCov">        108 :                 while ( gf_codecid_enum(idx, &amp;name, &amp;desc)) {</span>
<span class="lineNum">    3132 </span><span class="lineCov">        106 :                         gf_sys_format_help(helpout, help_flags | GF_PRINTARG_NL_TO_BR, &quot;.TP\n.B %s\n%s\n&quot;, name, desc);</span>
<span class="lineNum">    3133 </span><span class="lineCov">        106 :                         idx++;</span>
<span class="lineNum">    3134 </span>            :                 }
<span class="lineNum">    3135 </span>            :         }
<a name="3136"><span class="lineNum">    3136 </span><span class="lineCov">          3 : }</span></a>
<span class="lineNum">    3137 </span>            : #include &lt;gpac/color.h&gt;
<span class="lineNum">    3138 </span><span class="lineCov">          1 : static void dump_all_colors(void)</span>
<span class="lineNum">    3139 </span>            : {
<span class="lineNum">    3140 </span><span class="lineCov">          1 :         u32 i=0;</span>
<span class="lineNum">    3141 </span>            :         GF_Color color;
<span class="lineNum">    3142 </span>            :         const char *name;
<span class="lineNum">    3143 </span><span class="lineCov">        149 :         while (gf_color_enum(&amp;i, &amp;color, &amp;name)) {</span>
<span class="lineNum">    3144 </span><span class="lineCov">        147 :                 gf_sys_format_help(helpout, help_flags|GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s: 0x%08X\n&quot;, name, color);</span>
<span class="lineNum">    3145 </span>            :         }
<a name="3146"><span class="lineNum">    3146 </span><span class="lineCov">          1 : }</span></a>
<span class="lineNum">    3147 </span>            : 
<span class="lineNum">    3148 </span><span class="lineCov">          1 : static void dump_all_codec(GF_FilterSession *session)</span>
<span class="lineNum">    3149 </span>            : {
<span class="lineNum">    3150 </span>            :         GF_PropertyValue rawp, filep, stp;
<span class="lineNum">    3151 </span>            :         GF_PropertyValue cp, acp;
<span class="lineNum">    3152 </span>            :         char szFlags[10], szCap[2];
<span class="lineNum">    3153 </span>            :         u32 cidx=0;
<span class="lineNum">    3154 </span><span class="lineCov">          1 :         u32 count = gf_fs_filters_registers_count(session);</span>
<span class="lineNum">    3155 </span>            : 
<span class="lineNum">    3156 </span><span class="lineCov">          1 :         gf_sys_format_help(helpout, help_flags, &quot;Codec support in filters, listed as `built_in_name[|variant] [FLAGS]: full_name (mime)` with possible FLAGS values:\n&quot;);</span>
<span class="lineNum">    3157 </span><span class="lineCov">          1 :         gf_sys_format_help(helpout, help_flags, &quot;  - I: Raw format input (demux) support\n&quot;);</span>
<span class="lineNum">    3158 </span><span class="lineCov">          1 :         gf_sys_format_help(helpout, help_flags, &quot;  - O: Raw format output (mux) support\n&quot;);</span>
<span class="lineNum">    3159 </span><span class="lineCov">          1 :         gf_sys_format_help(helpout, help_flags, &quot;  - D: Decoder support\n&quot;);</span>
<span class="lineNum">    3160 </span><span class="lineCov">          1 :         gf_sys_format_help(helpout, help_flags, &quot;  - E: Encoder support\n&quot;);</span>
<span class="lineNum">    3161 </span><span class="lineCov">          1 :         gf_sys_format_help(helpout, help_flags, &quot;\nNote: Raw output may still be possible even when no output serializer is given\n\n&quot;);</span>
<span class="lineNum">    3162 </span>            : 
<span class="lineNum">    3163 </span><span class="lineCov">          1 :         rawp.type = cp.type = GF_PROP_UINT;</span>
<span class="lineNum">    3164 </span><span class="lineCov">          1 :         rawp.value.uint = GF_CODECID_RAW;</span>
<span class="lineNum">    3165 </span><span class="lineCov">          1 :         filep.type = cp.type = GF_PROP_UINT;</span>
<span class="lineNum">    3166 </span><span class="lineCov">          1 :         filep.value.uint = GF_STREAM_FILE;</span>
<span class="lineNum">    3167 </span><span class="lineCov">          1 :         stp.type = GF_PROP_UINT;</span>
<span class="lineNum">    3168 </span>            :         cp.type = GF_PROP_UINT;
<span class="lineNum">    3169 </span><span class="lineCov">          1 :         acp.type = GF_PROP_UINT;</span>
<span class="lineNum">    3170 </span><span class="lineCov">          1 :         szCap[1] = 0;</span>
<span class="lineNum">    3171 </span>            : 
<span class="lineNum">    3172 </span><span class="lineCov">        106 :         while (1) {</span>
<span class="lineNum">    3173 </span>            :                 u32 i;
<span class="lineNum">    3174 </span>            :                 const char *lname;
<span class="lineNum">    3175 </span>            :                 const char *sname;
<span class="lineNum">    3176 </span>            :                 const char *mime;
<span class="lineNum">    3177 </span>            :                 u32 rfc4cc;
<span class="lineNum">    3178 </span>            :                 Bool enc_found = GF_FALSE;
<span class="lineNum">    3179 </span>            :                 Bool dec_found = GF_FALSE;
<span class="lineNum">    3180 </span>            :                 Bool dmx_found = GF_FALSE;
<span class="lineNum">    3181 </span>            :                 Bool mx_found = GF_FALSE;
<span class="lineNum">    3182 </span><span class="lineCov">        107 :                 cp.value.uint = gf_codecid_enum(cidx, &amp;sname, &amp;lname);</span>
<span class="lineNum">    3183 </span><span class="lineCov">        107 :                 cidx++;</span>
<span class="lineNum">    3184 </span><span class="lineCov">        107 :                 if (cp.value.uint == GF_CODECID_NONE) break;</span>
<span class="lineNum">    3185 </span>            : //              if (cp.value.uint == GF_CODECID_RAW) continue;
<span class="lineNum">    3186 </span><span class="lineCov">        106 :                 if (!sname) break;</span>
<span class="lineNum">    3187 </span>            : 
<span class="lineNum">    3188 </span><span class="lineCov">        106 :                 stp.value.uint = gf_codecid_type(cp.value.uint);</span>
<span class="lineNum">    3189 </span><span class="lineCov">        106 :                 acp.value.uint = gf_codecid_alt(cp.value.uint);</span>
<span class="lineNum">    3190 </span>            : 
<span class="lineNum">    3191 </span><span class="lineCov">     127836 :                 for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    3192 </span><span class="lineCov">     127730 :                         const GF_FilterRegister *reg = gf_fs_get_filter_register(session, i);</span>
<span class="lineNum">    3193 </span><span class="lineCov">     127730 :                         if ( gf_fs_check_filter_register_cap(reg, GF_PROP_PID_STREAM_TYPE, &amp;stp, GF_PROP_PID_STREAM_TYPE, &amp;stp, GF_TRUE)) {</span>
<span class="lineNum">    3194 </span><span class="lineCov">      25455 :                                 if ( gf_fs_check_filter_register_cap(reg, GF_PROP_PID_CODECID, &amp;rawp, GF_PROP_PID_CODECID, &amp;cp, GF_TRUE)) {</span>
<span class="lineNum">    3195 </span>            :                                         enc_found = GF_TRUE;
<span class="lineNum">    3196 </span><span class="lineCov">      25400 :                                 } else if (acp.value.uint &amp;&amp; gf_fs_check_filter_register_cap(reg, GF_PROP_PID_CODECID, &amp;rawp, GF_PROP_PID_CODECID, &amp;acp, GF_TRUE)) {</span>
<span class="lineNum">    3197 </span>            :                                                 enc_found = GF_TRUE;
<span class="lineNum">    3198 </span>            :                                 }
<span class="lineNum">    3199 </span><span class="lineCov">      25455 :                                 if ( gf_fs_check_filter_register_cap(reg, GF_PROP_PID_CODECID, &amp;cp, GF_PROP_PID_CODECID, &amp;rawp, GF_TRUE)) {</span>
<span class="lineNum">    3200 </span>            :                                         dec_found = GF_TRUE;
<span class="lineNum">    3201 </span><span class="lineCov">      25366 :                                 } else if (acp.value.uint &amp;&amp; gf_fs_check_filter_register_cap(reg, GF_PROP_PID_CODECID, &amp;acp, GF_PROP_PID_CODECID, &amp;rawp, GF_TRUE)) {</span>
<span class="lineNum">    3202 </span>            :                                         dec_found = GF_TRUE;
<span class="lineNum">    3203 </span>            :                                 }
<span class="lineNum">    3204 </span>            :                         }
<span class="lineNum">    3205 </span>            : 
<span class="lineNum">    3206 </span><span class="lineCov">     127730 :                         if ( gf_fs_check_filter_register_cap(reg, GF_PROP_PID_STREAM_TYPE, &amp;filep, GF_PROP_PID_STREAM_TYPE, &amp;stp, GF_TRUE)) {</span>
<span class="lineNum">    3207 </span><span class="lineCov">       1652 :                                 if ( gf_fs_check_filter_register_cap(reg, GF_PROP_PID_STREAM_TYPE, &amp;filep, GF_PROP_PID_CODECID, &amp;cp, GF_TRUE))</span>
<span class="lineNum">    3208 </span>            :                                         dmx_found = GF_TRUE;
<span class="lineNum">    3209 </span>            :                         }
<span class="lineNum">    3210 </span><span class="lineCov">     127730 :                         if ( gf_fs_check_filter_register_cap(reg, GF_PROP_PID_STREAM_TYPE, &amp;stp, GF_PROP_PID_STREAM_TYPE, &amp;filep, GF_TRUE)) {</span>
<span class="lineNum">    3211 </span><span class="lineCov">        326 :                                 if ( gf_fs_check_filter_register_cap(reg, GF_PROP_PID_CODECID, &amp;cp, GF_PROP_PID_STREAM_TYPE, &amp;filep, GF_TRUE))</span>
<span class="lineNum">    3212 </span>            :                                         mx_found = GF_TRUE;
<span class="lineNum">    3213 </span>            :                         }
<span class="lineNum">    3214 </span>            :                 }
<span class="lineNum">    3215 </span>            : 
<span class="lineNum">    3216 </span><span class="lineCov">        106 :                 szFlags[0] = 0;</span>
<span class="lineNum">    3217 </span><span class="lineCov">        106 :                 if (enc_found || dec_found || dmx_found || mx_found) {</span>
<span class="lineNum">    3218 </span>            :                         strcpy(szFlags, &quot; [&quot;);
<span class="lineNum">    3219 </span><span class="lineCov">         69 :                         if (dmx_found) { szCap[0] = 'I'; strcat(szFlags, szCap); }</span>
<span class="lineNum">    3220 </span><span class="lineCov">         69 :                         if (mx_found) { szCap[0] = 'O'; strcat(szFlags, szCap); }</span>
<span class="lineNum">    3221 </span><span class="lineCov">         69 :                         if (dec_found) { szCap[0] = 'D'; strcat(szFlags, szCap); }</span>
<span class="lineNum">    3222 </span><span class="lineCov">         69 :                         if (enc_found) { szCap[0] = 'E'; strcat(szFlags, szCap); }</span>
<span class="lineNum">    3223 </span>            :                         strcat(szFlags, &quot;]&quot;);
<span class="lineNum">    3224 </span>            :                 }
<span class="lineNum">    3225 </span>            : 
<span class="lineNum">    3226 </span><span class="lineCov">        106 :                 mime = gf_codecid_mime(cp.value.uint);</span>
<span class="lineNum">    3227 </span><span class="lineCov">        106 :                 rfc4cc = gf_codecid_4cc_type(cp.value.uint);</span>
<span class="lineNum">    3228 </span><span class="lineCov">        106 :                 gf_sys_format_help(helpout, help_flags | GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%s%s: &quot;, sname, szFlags);</span>
<span class="lineNum">    3229 </span><span class="lineCov">        106 :                 gf_sys_format_help(helpout, help_flags, &quot;%s&quot;, lname);</span>
<span class="lineNum">    3230 </span><span class="lineCov">        106 :                 if (rfc4cc || mime) {</span>
<span class="lineNum">    3231 </span><span class="lineCov">        106 :                         gf_sys_format_help(helpout, help_flags, &quot; (&quot;);</span>
<span class="lineNum">    3232 </span><span class="lineCov">        106 :                         if (rfc4cc) gf_sys_format_help(helpout, help_flags, &quot;%s&quot;, gf_4cc_to_str(rfc4cc) );</span>
<span class="lineNum">    3233 </span><span class="lineCov">        106 :                         if (rfc4cc&amp;&amp;mime) gf_sys_format_help(helpout, help_flags, &quot;, &quot;);</span>
<span class="lineNum">    3234 </span><span class="lineCov">        106 :                         if (mime) gf_sys_format_help(helpout, help_flags, &quot;%s&quot;, mime);</span>
<span class="lineNum">    3235 </span><span class="lineCov">        106 :                         gf_sys_format_help(helpout, help_flags, &quot;)&quot;);</span>
<span class="lineNum">    3236 </span>            :                 }
<span class="lineNum">    3237 </span><span class="lineCov">        106 :                 gf_sys_format_help(helpout, help_flags, &quot;\n&quot;);</span>
<span class="lineNum">    3238 </span>            :         }
<span class="lineNum">    3239 </span><span class="lineCov">          1 :         gf_sys_format_help(helpout, help_flags, &quot;\n&quot;);</span>
<span class="lineNum">    3240 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">    3241 </span>            : 
<span class="lineNum">    3242 </span>            : /*********************************************************
<span class="lineNum">    3243 </span>            :                         Config file writing functions
<a name="3244"><span class="lineNum">    3244 </span>            : *********************************************************/</a>
<span class="lineNum">    3245 </span>            : 
<span class="lineNum">    3246 </span><span class="lineCov">          1 : static void write_core_options()</span>
<span class="lineNum">    3247 </span>            : {
<span class="lineNum">    3248 </span>            :         //print libgpac core help
<span class="lineNum">    3249 </span><span class="lineCov">          1 :         const GF_GPACArg *args = gf_sys_get_options();</span>
<span class="lineNum">    3250 </span>            :         u32 i = 0;
<span class="lineNum">    3251 </span>            : 
<span class="lineNum">    3252 </span><span class="lineCov">         92 :         while (args[i].name) {</span>
<span class="lineNum">    3253 </span><span class="lineCov">         90 :                 if (! gf_opts_get_key(&quot;core&quot;, args[i].name) &amp;&amp; args[i].val) {</span>
<span class="lineNum">    3254 </span><span class="lineCov">         16 :                         gf_opts_set_key(&quot;core&quot;, args[i].name, args[i].val);</span>
<span class="lineNum">    3255 </span>            :                 }
<span class="lineNum">    3256 </span><span class="lineCov">         90 :                 i++;</span>
<span class="lineNum">    3257 </span>            :         }
<a name="3258"><span class="lineNum">    3258 </span><span class="lineCov">          1 : }</span></a>
<span class="lineNum">    3259 </span>            : 
<span class="lineNum">    3260 </span><span class="lineCov">          1 : static void write_file_extensions()</span>
<span class="lineNum">    3261 </span>            : {
<span class="lineNum">    3262 </span>            :         u32 i = 0;
<span class="lineNum">    3263 </span>            : 
<span class="lineNum">    3264 </span><span class="lineCov">        106 :         while (1) {</span>
<span class="lineNum">    3265 </span>            :                 const char *short_name, *long_name, *mime ;
<span class="lineNum">    3266 </span><span class="lineCov">        107 :                 u32 cid = gf_codecid_enum(i, &amp;short_name, &amp;long_name);</span>
<span class="lineNum">    3267 </span><span class="lineCov">        107 :                 if (cid==GF_CODECID_NONE) break;</span>
<span class="lineNum">    3268 </span><span class="lineCov">        106 :                 mime = gf_codecid_mime(cid);</span>
<span class="lineNum">    3269 </span><span class="lineCov">        106 :                 if (mime &amp;&amp; ! gf_opts_get_key(&quot;file_extensions&quot;, mime) ) {</span>
<span class="lineNum">    3270 </span><span class="lineCov">         65 :                         gf_opts_set_key(&quot;file_extensions&quot;, mime, short_name);</span>
<span class="lineNum">    3271 </span>            :                 }
<span class="lineNum">    3272 </span><span class="lineCov">        106 :                 i++;</span>
<span class="lineNum">    3273 </span>            :         }
<a name="3274"><span class="lineNum">    3274 </span><span class="lineCov">          1 : }</span></a>
<span class="lineNum">    3275 </span>            : 
<span class="lineNum">    3276 </span><span class="lineCov">          1 : static void write_filters_options(GF_FilterSession *fsess)</span>
<span class="lineNum">    3277 </span>            : {
<span class="lineNum">    3278 </span>            :         u32 i, count;
<span class="lineNum">    3279 </span><span class="lineCov">          1 :         count = gf_fs_filters_registers_count(fsess);</span>
<span class="lineNum">    3280 </span><span class="lineCov">       1220 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    3281 </span>            :                 char *meta_sep;
<span class="lineNum">    3282 </span>            :                 u32 j=0;
<span class="lineNum">    3283 </span>            :                 char szSecName[200];
<span class="lineNum">    3284 </span>            : 
<span class="lineNum">    3285 </span><span class="lineCov">       1219 :                 const GF_FilterRegister *freg = gf_fs_get_filter_register(fsess, i);</span>
<span class="lineNum">    3286 </span><span class="lineCov">       1219 :                 sprintf(szSecName, &quot;filter@%s&quot;, freg-&gt;name);</span>
<span class="lineNum">    3287 </span><span class="lineCov">       1219 :                 meta_sep = strchr(szSecName + 7, ':');</span>
<span class="lineNum">    3288 </span><span class="lineCov">       1219 :                 if (meta_sep) meta_sep[0] = 0;</span>
<span class="lineNum">    3289 </span>            : 
<span class="lineNum">    3290 </span><span class="lineCov">       4406 :                 while (freg-&gt;args) {</span>
<span class="lineNum">    3291 </span><span class="lineCov">       3615 :                         const GF_FilterArgs *arg = &amp;freg-&gt;args[j];</span>
<span class="lineNum">    3292 </span><span class="lineCov">       3615 :                         if (!arg || !arg-&gt;arg_name) break;</span>
<span class="lineNum">    3293 </span><span class="lineCov">       3187 :                         j++;</span>
<span class="lineNum">    3294 </span>            : 
<span class="lineNum">    3295 </span><span class="lineCov">       3187 :                         if (arg-&gt;arg_default_val &amp;&amp; !gf_opts_get_key(szSecName, arg-&gt;arg_name)) {</span>
<span class="lineNum">    3296 </span><span class="lineCov">       1406 :                                 gf_opts_set_key(szSecName, arg-&gt;arg_name, arg-&gt;arg_default_val);</span>
<span class="lineNum">    3297 </span>            :                         }
<span class="lineNum">    3298 </span>            :                 }
<span class="lineNum">    3299 </span>            :         }
<span class="lineNum">    3300 </span><span class="lineCov">          1 : }</span>
<span class="lineNum">    3301 </span>            : 
<span class="lineNum">    3302 </span>            : /*********************************************************
<span class="lineNum">    3303 </span>            :                 Language file creation / update functions
<span class="lineNum">    3304 </span>            : *********************************************************/
<a name="3305"><span class="lineNum">    3305 </span>            : </a>
<span class="lineNum">    3306 </span>            : static Bool lang_updated = GF_FALSE;
<span class="lineNum">    3307 </span><span class="lineCov">       1383 : static void gpac_lang_set_key(GF_Config *cfg, const char *sec_name,  const char *key_name, const char *key_val)</span>
<span class="lineNum">    3308 </span>            : {
<span class="lineNum">    3309 </span>            :         char szKeyCRC[1024];
<span class="lineNum">    3310 </span><span class="lineCov">       1383 :         const char *opt = gf_cfg_get_key(cfg, sec_name, key_name);</span>
<span class="lineNum">    3311 </span>            :         u32 crc_key = 0;
<span class="lineNum">    3312 </span><span class="lineCov">       1383 :         if (opt) {</span>
<span class="lineNum">    3313 </span>            :                 sprintf(szKeyCRC, &quot;%s_crc&quot;, key_name);
<span class="lineNum">    3314 </span><span class="lineCov">          1 :                 const char *crc_opt = gf_cfg_get_key(cfg, sec_name, szKeyCRC);</span>
<span class="lineNum">    3315 </span><span class="lineCov">          1 :                 if (crc_opt) {</span>
<span class="lineNum">    3316 </span><span class="lineCov">          1 :                         u32 old_crc = atoi(crc_opt);</span>
<span class="lineNum">    3317 </span><span class="lineCov">          1 :                         crc_key = gf_crc_32((u8*)key_val, (u32) strlen(key_val));</span>
<span class="lineNum">    3318 </span><span class="lineCov">          1 :                         if (old_crc != crc_key) {</span>
<span class="lineNum">    3319 </span><span class="lineCov">          1 :                                 gf_sys_format_help(helpout, help_flags, &quot;Warning: description has changed for %s:%s (crc %d - crc in file %d) - please check translation\n&quot;, sec_name, key_name, crc_key, old_crc);</span>
<span class="lineNum">    3320 </span>            :                         }
<span class="lineNum">    3321 </span><span class="lineCov">          1 :                         return;</span>
<span class="lineNum">    3322 </span>            :                 }
<span class="lineNum">    3323 </span>            :         }
<span class="lineNum">    3324 </span><span class="lineCov">       1382 :         if (!opt) {</span>
<span class="lineNum">    3325 </span>            :                 char szKeyCRCVal[100];
<span class="lineNum">    3326 </span>            :                 if (!crc_key) {
<span class="lineNum">    3327 </span>            :                         sprintf(szKeyCRC, &quot;%s_crc&quot;, key_name);
<span class="lineNum">    3328 </span><span class="lineCov">       1382 :                         crc_key = gf_crc_32((u8*)key_val, (u32) strlen(key_val));</span>
<span class="lineNum">    3329 </span>            :                 }
<span class="lineNum">    3330 </span>            :                 sprintf(szKeyCRCVal, &quot;%u&quot;, crc_key);
<span class="lineNum">    3331 </span><span class="lineCov">       1382 :                 gf_cfg_set_key(cfg, sec_name, key_name, key_val);</span>
<span class="lineNum">    3332 </span><span class="lineCov">       1382 :                 gf_cfg_set_key(cfg, sec_name, szKeyCRC, szKeyCRCVal);</span>
<span class="lineNum">    3333 </span><span class="lineCov">       1382 :                 lang_updated = GF_TRUE;</span>
<a name="3334"><span class="lineNum">    3334 </span>            :         }</a>
<span class="lineNum">    3335 </span>            : }
<span class="lineNum">    3336 </span><span class="lineCov">          1 : static int gpac_make_lang(char *filename)</span>
<span class="lineNum">    3337 </span>            : {
<span class="lineNum">    3338 </span>            :         GF_Config *cfg;
<span class="lineNum">    3339 </span>            :         u32 i;
<span class="lineNum">    3340 </span><span class="lineCov">          1 :         gf_sys_init(GF_MemTrackerNone, NULL);</span>
<span class="lineNum">    3341 </span>            : 
<span class="lineNum">    3342 </span><span class="lineCov">          1 :         session = gf_fs_new_defaults(0);</span>
<span class="lineNum">    3343 </span><span class="lineCov">          1 :         if (!session) {</span>
<span class="lineNum">    3344 </span><span class="lineNoCov">          0 :                 gf_sys_format_help(helpout, help_flags, &quot;failed to load session, cannot create language file\n&quot;);</span>
<span class="lineNum">    3345 </span><span class="lineNoCov">          0 :                 return 1;</span>
<span class="lineNum">    3346 </span>            :         }
<span class="lineNum">    3347 </span><span class="lineCov">          1 :         if (!gf_file_exists(filename)) {</span>
<span class="lineNum">    3348 </span><span class="lineCov">          1 :                 FILE *f = gf_fopen(filename, &quot;wt&quot;);</span>
<span class="lineNum">    3349 </span><span class="lineCov">          1 :                 if (!f) {</span>
<span class="lineNum">    3350 </span><span class="lineNoCov">          0 :                         gf_sys_format_help(helpout, help_flags, &quot;failed to open %s in write mode\n&quot;, filename);</span>
<span class="lineNum">    3351 </span><span class="lineNoCov">          0 :                         gf_fs_del(session);</span>
<span class="lineNum">    3352 </span><span class="lineNoCov">          0 :                         return 1;</span>
<span class="lineNum">    3353 </span>            :                 }
<span class="lineNum">    3354 </span><span class="lineCov">          1 :                 gf_fclose(f);</span>
<span class="lineNum">    3355 </span>            :         }
<span class="lineNum">    3356 </span>            : 
<span class="lineNum">    3357 </span><span class="lineCov">          1 :         cfg = gf_cfg_new(NULL, filename);</span>
<span class="lineNum">    3358 </span>            : 
<span class="lineNum">    3359 </span>            :         //print gpac help
<span class="lineNum">    3360 </span>            :         i = 0;
<span class="lineNum">    3361 </span><span class="lineCov">         30 :         while (gpac_args[i].name) {</span>
<span class="lineNum">    3362 </span><span class="lineCov">         28 :                 gpac_lang_set_key(cfg, &quot;gpac&quot;, gpac_args[i].name, gpac_args[i].description);</span>
<span class="lineNum">    3363 </span><span class="lineCov">         28 :                 i++;</span>
<span class="lineNum">    3364 </span>            :         }
<span class="lineNum">    3365 </span>            : 
<span class="lineNum">    3366 </span>            :         //print gpac doc
<span class="lineNum">    3367 </span><span class="lineCov">          1 :         gpac_lang_set_key(cfg, &quot;gpac&quot;, &quot;doc&quot;, gpac_doc);</span>
<span class="lineNum">    3368 </span>            : 
<span class="lineNum">    3369 </span>            :         //print gpac alias doc
<span class="lineNum">    3370 </span><span class="lineCov">          1 :         gpac_lang_set_key(cfg, &quot;gpac&quot;, &quot;alias&quot;, gpac_alias);</span>
<span class="lineNum">    3371 </span>            : 
<span class="lineNum">    3372 </span>            :         //print libgpac core help
<span class="lineNum">    3373 </span><span class="lineCov">          1 :         const GF_GPACArg *args = gf_sys_get_options();</span>
<span class="lineNum">    3374 </span>            :         i = 0;
<span class="lineNum">    3375 </span>            : 
<span class="lineNum">    3376 </span><span class="lineCov">         92 :         while (args[i].name) {</span>
<span class="lineNum">    3377 </span><span class="lineCov">         90 :                 gpac_lang_set_key(cfg, &quot;core&quot;, args[i].name, args[i].description);</span>
<span class="lineNum">    3378 </span><span class="lineCov">         90 :                 i++;</span>
<span class="lineNum">    3379 </span>            :         }
<span class="lineNum">    3380 </span>            : 
<span class="lineNum">    3381 </span>            :         //print properties
<span class="lineNum">    3382 </span>            :         i=0;
<span class="lineNum">    3383 </span>            :         const GF_BuiltInProperty *prop_info;
<span class="lineNum">    3384 </span><span class="lineCov">        214 :         while ((prop_info = gf_props_get_description(i))) {</span>
<span class="lineNum">    3385 </span><span class="lineCov">        213 :                 i++;</span>
<span class="lineNum">    3386 </span><span class="lineCov">        213 :                 if (! prop_info-&gt;name || !prop_info-&gt;description) continue;</span>
<span class="lineNum">    3387 </span><span class="lineCov">        210 :                 gpac_lang_set_key(cfg, &quot;properties&quot;, prop_info-&gt;name, prop_info-&gt;description);</span>
<span class="lineNum">    3388 </span>            :         }
<span class="lineNum">    3389 </span>            : 
<span class="lineNum">    3390 </span>            :         //print filters
<span class="lineNum">    3391 </span><span class="lineCov">          1 :         u32 count = gf_fs_filters_registers_count(session);</span>
<span class="lineNum">    3392 </span><span class="lineCov">        105 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    3393 </span>            :                 u32 j=0;
<span class="lineNum">    3394 </span><span class="lineCov">        104 :                 const GF_FilterRegister *reg = gf_fs_get_filter_register(session, i);</span>
<span class="lineNum">    3395 </span>            : 
<span class="lineNum">    3396 </span><span class="lineCov">        104 :                 if (reg-&gt;description) {</span>
<span class="lineNum">    3397 </span><span class="lineCov">        104 :                         gpac_lang_set_key(cfg, reg-&gt;name, &quot;desc&quot;, reg-&gt;description);</span>
<span class="lineNum">    3398 </span>            :                 }
<span class="lineNum">    3399 </span><span class="lineCov">        104 :                 if (reg-&gt;help) {</span>
<span class="lineNum">    3400 </span><span class="lineCov">        104 :                         gpac_lang_set_key(cfg, reg-&gt;name, &quot;help&quot;, reg-&gt;help);</span>
<span class="lineNum">    3401 </span>            :                 }
<span class="lineNum">    3402 </span><span class="lineCov">        949 :                 while (reg-&gt;args &amp;&amp; reg-&gt;args[j].arg_name) {</span>
<span class="lineNum">    3403 </span><span class="lineCov">        845 :                         gpac_lang_set_key(cfg, reg-&gt;name, reg-&gt;args[j].arg_name, reg-&gt;args[j].arg_desc);</span>
<span class="lineNum">    3404 </span><span class="lineCov">        845 :                         j++;</span>
<span class="lineNum">    3405 </span>            :                 }
<span class="lineNum">    3406 </span>            :         }
<span class="lineNum">    3407 </span>            : 
<span class="lineNum">    3408 </span><span class="lineCov">          1 :         if (!lang_updated) {</span>
<span class="lineNum">    3409 </span><span class="lineNoCov">          0 :                 gf_cfg_discard_changes(cfg);</span>
<span class="lineNum">    3410 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;lang file %s has not been modified\n&quot;, filename);</span>
<span class="lineNum">    3411 </span>            :         } else {
<span class="lineNum">    3412 </span><span class="lineCov">          1 :                 fprintf(stderr, &quot;lang file generated in %s\n&quot;, filename);</span>
<span class="lineNum">    3413 </span>            :         }
<span class="lineNum">    3414 </span><span class="lineCov">          1 :         gf_cfg_del(cfg);</span>
<span class="lineNum">    3415 </span>            : 
<span class="lineNum">    3416 </span><span class="lineCov">          1 :         gf_fs_del(session);</span>
<span class="lineNum">    3417 </span><span class="lineCov">          1 :         gf_sys_close();</span>
<span class="lineNum">    3418 </span><span class="lineCov">          1 :         return 0;</span>
<span class="lineNum">    3419 </span>            : }
<span class="lineNum">    3420 </span>            : 
<span class="lineNum">    3421 </span>            : 
<span class="lineNum">    3422 </span>            : /*********************************************************
<span class="lineNum">    3423 </span>            :                         Alias functions
<a name="3424"><span class="lineNum">    3424 </span>            : *********************************************************/</a>
<span class="lineNum">    3425 </span>            : 
<span class="lineNum">    3426 </span><span class="lineCov">         19 : static GFINLINE void push_arg(char *_arg, Bool _dup)</span>
<span class="lineNum">    3427 </span>            : {
<span class="lineNum">    3428 </span><span class="lineCov">         19 :         alias_argv = gf_realloc(alias_argv, sizeof(char**) * (alias_argc+1));\</span>
<span class="lineNum">    3429 </span><span class="lineCov">         19 :         alias_argv[alias_argc] = _dup ? gf_strdup(_arg) : _arg; \</span>
<span class="lineNum">    3430 </span><span class="lineCov">         19 :         if (_dup) {</span>
<span class="lineNum">    3431 </span><span class="lineCov">          7 :                 if (!args_alloc) args_alloc = gf_list_new();</span>
<span class="lineNum">    3432 </span><span class="lineCov">          7 :                 gf_list_add(args_alloc, alias_argv[alias_argc]);</span>
<span class="lineNum">    3433 </span>            :         }
<span class="lineNum">    3434 </span><span class="lineCov">         19 :         alias_argc++;</span>
<span class="lineNum">    3435 </span><span class="lineCov">         19 : }</span>
<span class="lineNum">    3436 </span>            : 
<a name="3437"><span class="lineNum">    3437 </span>            : static Bool gpac_expand_alias_arg(char *param, char *prefix, char *suffix, int arg_idx, int argc, char **argv);</a>
<span class="lineNum">    3438 </span>            : 
<span class="lineNum">    3439 </span><span class="lineCov">         12 : static Bool check_param_extension(char *szArg, int arg_idx, int argc, char **argv)</span>
<span class="lineNum">    3440 </span>            : {
<span class="lineNum">    3441 </span><span class="lineCov">         12 :         char *par_start = strstr(szArg, &quot;@{&quot;);</span>
<span class="lineNum">    3442 </span><span class="lineCov">         12 :         if (par_start) {</span>
<span class="lineNum">    3443 </span>            :                 char szPar[100];
<span class="lineNum">    3444 </span>            :                 Bool ok;
<span class="lineNum">    3445 </span><span class="lineCov">          5 :                 char *par_end = strchr(par_start, '}');</span>
<span class="lineNum">    3446 </span><span class="lineCov">          5 :                 if (!par_end) {</span>
<span class="lineNum">    3447 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Bad format %s for alias parameter, expecting @{N}\n&quot;, szArg);</span>
<span class="lineNum">    3448 </span><span class="lineNoCov">          0 :                         return GF_FALSE;</span>
<span class="lineNum">    3449 </span>            :                 }
<span class="lineNum">    3450 </span><span class="lineCov">          5 :                 par_end[0] = 0;</span>
<span class="lineNum">    3451 </span><span class="lineCov">          5 :                 strcpy(szPar, par_start+2);</span>
<span class="lineNum">    3452 </span><span class="lineCov">          5 :                 par_start[0] = 0;</span>
<span class="lineNum">    3453 </span>            : 
<span class="lineNum">    3454 </span><span class="lineCov">          5 :                 ok = gpac_expand_alias_arg(szPar, szArg, par_end+1, arg_idx, argc, argv);</span>
<span class="lineNum">    3455 </span><span class="lineCov">          5 :                 if (!ok) return GF_FALSE;</span>
<span class="lineNum">    3456 </span><span class="lineCov">          5 :                 par_start[0] = '@';</span>
<span class="lineNum">    3457 </span><span class="lineCov">          5 :                 par_end[0] = '}';</span>
<span class="lineNum">    3458 </span><span class="lineCov">          5 :                 return GF_TRUE;</span>
<span class="lineNum">    3459 </span>            :         }
<span class="lineNum">    3460 </span>            :         //done, push arg
<span class="lineNum">    3461 </span><span class="lineCov">          7 :         push_arg(szArg, 1);</span>
<span class="lineNum">    3462 </span><span class="lineCov">          7 :         return GF_TRUE;</span>
<a name="3463"><span class="lineNum">    3463 </span>            : }</a>
<span class="lineNum">    3464 </span>            : 
<span class="lineNum">    3465 </span><span class="lineCov">          5 : static Bool gpac_expand_alias_arg(char *param, char *prefix, char *suffix, int arg_idx, int argc, char **argv)</span>
<span class="lineNum">    3466 </span>            : {
<span class="lineNum">    3467 </span>            :         char szArg[1024];
<span class="lineNum">    3468 </span>            :         char szSepList[2];
<span class="lineNum">    3469 </span>            :         char *oparam = param;
<span class="lineNum">    3470 </span><span class="lineCov">          5 :         szSepList[0] = separator_set[SEP_LIST];</span>
<span class="lineNum">    3471 </span><span class="lineCov">          5 :         szSepList[1] = 0;</span>
<span class="lineNum">    3472 </span>            : 
<span class="lineNum">    3473 </span><span class="lineCov">          5 :         Bool is_list = param[0]=='-';</span>
<span class="lineNum">    3474 </span><span class="lineCov">          5 :         Bool is_expand = param[0]=='+';</span>
<span class="lineNum">    3475 </span>            : 
<span class="lineNum">    3476 </span><span class="lineCov">          5 :         if (is_list || is_expand) param++;</span>
<span class="lineNum">    3477 </span>            :         strcpy(szArg, prefix);
<span class="lineNum">    3478 </span><span class="lineCov">          5 :         while (param) {</span>
<span class="lineNum">    3479 </span>            :                 u32 idx=0;
<span class="lineNum">    3480 </span>            :                 u32 last_idx=0;
<span class="lineNum">    3481 </span><span class="lineCov">          5 :                 char *sep = strchr(param, ',');</span>
<span class="lineNum">    3482 </span><span class="lineCov">          5 :                 if (sep) sep[0]=0;</span>
<span class="lineNum">    3483 </span>            : 
<span class="lineNum">    3484 </span><span class="lineCov">          5 :                 if ((param[0]=='n') || (param[0]=='N')) {</span>
<span class="lineNum">    3485 </span><span class="lineCov">          2 :                         idx = argc - arg_idx - 1;</span>
<span class="lineNum">    3486 </span><span class="lineCov">          2 :                         if (param[1]=='-') {</span>
<span class="lineNum">    3487 </span><span class="lineCov">          2 :                                 u32 diff = atoi(param+2);</span>
<span class="lineNum">    3488 </span><span class="lineCov">          1 :                                 if (diff&gt;=idx) {</span>
<span class="lineNum">    3489 </span><span class="lineNoCov">          0 :                                         if (sep) sep[0]=',';</span>
<span class="lineNum">    3490 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Bad usage for alias parameter %s: not enough parameters\n&quot;, oparam);</span>
<span class="lineNum">    3491 </span><span class="lineNoCov">          0 :                                         return GF_FALSE;</span>
<span class="lineNum">    3492 </span>            :                                 }
<span class="lineNum">    3493 </span><span class="lineCov">          1 :                                 idx -= diff;</span>
<span class="lineNum">    3494 </span>            :                         }
<span class="lineNum">    3495 </span>            :                 } else {
<span class="lineNum">    3496 </span><span class="lineCov">          3 :                         char *lsep = strchr(param, ':');</span>
<span class="lineNum">    3497 </span><span class="lineCov">          3 :                         if (lsep) {</span>
<span class="lineNum">    3498 </span><span class="lineCov">          2 :                                 lsep[0] = 0;</span>
<span class="lineNum">    3499 </span><span class="lineCov">          2 :                                 if (strlen(param))</span>
<span class="lineNum">    3500 </span><span class="lineCov">          1 :                                         idx = atoi(param);</span>
<span class="lineNum">    3501 </span>            :                                 else
<span class="lineNum">    3502 </span>            :                                         idx=1;
<span class="lineNum">    3503 </span>            : 
<span class="lineNum">    3504 </span><span class="lineCov">          2 :                                 lsep[0] = ':';</span>
<span class="lineNum">    3505 </span><span class="lineCov">          2 :                                 if ((lsep[1]=='n') || (lsep[1]=='N')) {</span>
<span class="lineNum">    3506 </span>            : 
<span class="lineNum">    3507 </span><span class="lineCov">          2 :                                         last_idx = argc - arg_idx - 1;</span>
<span class="lineNum">    3508 </span><span class="lineCov">          2 :                                         if (lsep[2]=='-') {</span>
<span class="lineNum">    3509 </span><span class="lineCov">          2 :                                                 u32 diff = atoi(lsep+3);</span>
<span class="lineNum">    3510 </span><span class="lineCov">          1 :                                                 if (diff&gt;=last_idx) {</span>
<span class="lineNum">    3511 </span><span class="lineNoCov">          0 :                                                         fprintf(stderr, &quot;Bad usage for alias parameter %s: not enough parameters\n&quot;, oparam);</span>
<span class="lineNum">    3512 </span><span class="lineNoCov">          0 :                                                         return GF_FALSE;</span>
<span class="lineNum">    3513 </span>            :                                                 }
<span class="lineNum">    3514 </span><span class="lineCov">          1 :                                                 last_idx -= diff;</span>
<span class="lineNum">    3515 </span>            :                                         }
<span class="lineNum">    3516 </span>            :                                 } else {
<span class="lineNum">    3517 </span><span class="lineNoCov">          0 :                                         last_idx = atoi(lsep+1);</span>
<span class="lineNum">    3518 </span>            :                                 }
<span class="lineNum">    3519 </span>            :                         } else {
<span class="lineNum">    3520 </span><span class="lineCov">          1 :                                 idx = atoi(param);</span>
<span class="lineNum">    3521 </span>            :                         }
<span class="lineNum">    3522 </span>            :                 }
<span class="lineNum">    3523 </span><span class="lineCov">          5 :                 if (!idx) {</span>
<span class="lineNum">    3524 </span><span class="lineNoCov">          0 :                         if (sep) sep[0]=',';</span>
<span class="lineNum">    3525 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Bad format for alias parameter %s: cannot extract argument index\n&quot;, oparam);</span>
<span class="lineNum">    3526 </span><span class="lineNoCov">          0 :                         return GF_FALSE;</span>
<span class="lineNum">    3527 </span>            :                 }
<span class="lineNum">    3528 </span><span class="lineCov">          5 :                 if ((int) idx + arg_idx &gt;= argc) {</span>
<span class="lineNum">    3529 </span><span class="lineNoCov">          0 :                         if (sep) sep[0]=',';</span>
<span class="lineNum">    3530 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Bad format for alias parameter %s: argment out of bounds (not enough paramteters?)\n&quot;, oparam);</span>
<span class="lineNum">    3531 </span><span class="lineNoCov">          0 :                         return GF_FALSE;</span>
<span class="lineNum">    3532 </span>            :                 }
<span class="lineNum">    3533 </span>            : 
<span class="lineNum">    3534 </span><span class="lineCov">          5 :                 if (!last_idx) last_idx=idx;</span>
<span class="lineNum">    3535 </span><span class="lineCov">          7 :                 for (; idx&lt;=last_idx;idx++) {</span>
<span class="lineNum">    3536 </span><span class="lineCov">          7 :                         char *an_arg = argv[idx+arg_idx];</span>
<span class="lineNum">    3537 </span>            : 
<span class="lineNum">    3538 </span><span class="lineCov">          7 :                         if (!args_used) args_used = gf_list_new();</span>
<span class="lineNum">    3539 </span><span class="lineCov">          7 :                         gf_list_add(args_used, an_arg);</span>
<span class="lineNum">    3540 </span>            : 
<span class="lineNum">    3541 </span><span class="lineCov">          7 :                         if (is_expand) {</span>
<span class="lineNum">    3542 </span>            :                                 strcpy(szArg, prefix);
<span class="lineNum">    3543 </span>            :                                 strcat(szArg, an_arg);
<span class="lineNum">    3544 </span>            :                                 strcat(szArg, suffix);
<span class="lineNum">    3545 </span>            : 
<span class="lineNum">    3546 </span><span class="lineCov">          2 :                                 Bool ok = check_param_extension(szArg, arg_idx, argc, argv);</span>
<span class="lineNum">    3547 </span><span class="lineCov">          2 :                                 if (!ok) {</span>
<span class="lineNum">    3548 </span><span class="lineNoCov">          0 :                                         if (sep) sep[0]=',';</span>
<span class="lineNum">    3549 </span>            :                                         return GF_FALSE;
<span class="lineNum">    3550 </span>            :                                 }
<span class="lineNum">    3551 </span>            :                         } else {
<span class="lineNum">    3552 </span>            :                                 strcat(szArg, an_arg);
<span class="lineNum">    3553 </span><span class="lineCov">          5 :                                 if (is_list &amp;&amp; (idx&lt;last_idx)) {</span>
<span class="lineNum">    3554 </span>            :                                         strcat(szArg, szSepList);
<span class="lineNum">    3555 </span>            :                                 }
<span class="lineNum">    3556 </span>            :                         }
<span class="lineNum">    3557 </span>            :                 }
<span class="lineNum">    3558 </span>            : 
<span class="lineNum">    3559 </span><span class="lineCov">          5 :                 if (!sep) break;</span>
<span class="lineNum">    3560 </span><span class="lineNoCov">          0 :                 sep[0]=',';</span>
<span class="lineNum">    3561 </span><span class="lineNoCov">          0 :                 param = sep+1;</span>
<span class="lineNum">    3562 </span><span class="lineNoCov">          0 :                 if (is_list) {</span>
<span class="lineNum">    3563 </span>            :                         strcat(szArg, szSepList);
<span class="lineNum">    3564 </span>            :                 }
<span class="lineNum">    3565 </span>            :         }
<span class="lineNum">    3566 </span>            : 
<span class="lineNum">    3567 </span><span class="lineCov">          5 :         if (is_expand)</span>
<span class="lineNum">    3568 </span>            :                 return GF_TRUE;
<span class="lineNum">    3569 </span>            : 
<span class="lineNum">    3570 </span>            :         strcat(szArg, suffix);
<span class="lineNum">    3571 </span>            : 
<span class="lineNum">    3572 </span><span class="lineCov">          4 :         return check_param_extension(szArg, arg_idx, argc, argv);</span>
<a name="3573"><span class="lineNum">    3573 </span>            : }</a>
<span class="lineNum">    3574 </span>            : 
<span class="lineNum">    3575 </span><span class="lineCov">          3 : static Bool gpac_expand_alias(int argc, char **argv)</span>
<span class="lineNum">    3576 </span>            : {
<span class="lineNum">    3577 </span>            :         u32 i;
<span class="lineNum">    3578 </span>            : 
<span class="lineNum">    3579 </span><span class="lineCov">         25 :         for (i=0; i&lt; (u32) argc; i++) {</span>
<span class="lineNum">    3580 </span><span class="lineCov">         22 :                 char *arg = argv[i];</span>
<span class="lineNum">    3581 </span><span class="lineCov">         22 :                 char *alias = (char *) gf_opts_get_key(&quot;gpac.alias&quot;, arg);</span>
<span class="lineNum">    3582 </span><span class="lineCov">         22 :                 if (alias == NULL) {</span>
<span class="lineNum">    3583 </span><span class="lineCov">         19 :                         if (gf_list_find(args_used, arg)&lt;0) {</span>
<span class="lineNum">    3584 </span><span class="lineCov">         12 :                                 push_arg(arg, 0);</span>
<span class="lineNum">    3585 </span>            :                         }
<span class="lineNum">    3586 </span><span class="lineCov">         19 :                         continue;</span>
<span class="lineNum">    3587 </span>            :                 }
<span class="lineNum">    3588 </span>            :                 char *sep;
<span class="lineNum">    3589 </span><span class="lineCov">          6 :                 while (alias) {</span>
<span class="lineNum">    3590 </span><span class="lineCov">          6 :                         sep = strchr(alias, ' ');</span>
<span class="lineNum">    3591 </span><span class="lineCov">          6 :                         if (sep) sep[0] = 0;</span>
<span class="lineNum">    3592 </span><span class="lineCov">          6 :                         Bool ok = check_param_extension(alias, i, argc, argv);</span>
<span class="lineNum">    3593 </span><span class="lineCov">          6 :                         if (sep) sep[0] = ' ';</span>
<span class="lineNum">    3594 </span><span class="lineCov">          6 :                         if (!ok) return GF_FALSE;</span>
<span class="lineNum">    3595 </span><span class="lineCov">          6 :                         if (!sep) break;</span>
<span class="lineNum">    3596 </span><span class="lineCov">          3 :                         alias = sep+1;</span>
<span class="lineNum">    3597 </span>            :                 }
<span class="lineNum">    3598 </span>            : 
<span class="lineNum">    3599 </span>            :         }
<span class="lineNum">    3600 </span>            :         return GF_TRUE;
<span class="lineNum">    3601 </span>            : }
<span class="lineNum">    3602 </span>            : 
<span class="lineNum">    3603 </span>            : #ifdef GPAC_ENABLE_COVERAGE
<span class="lineNum">    3604 </span>            : #include &lt;gpac/utf.h&gt;
<span class="lineNum">    3605 </span>            : #include &lt;gpac/base_coding.h&gt;
<span class="lineNum">    3606 </span>            : #include &lt;gpac/network.h&gt;
<span class="lineNum">    3607 </span>            : #include &lt;gpac/iso639.h&gt;
<span class="lineNum">    3608 </span>            : #include &lt;gpac/token.h&gt;
<span class="lineNum">    3609 </span>            : #include &lt;gpac/xml.h&gt;
<span class="lineNum">    3610 </span>            : #include &lt;gpac/thread.h&gt;
<span class="lineNum">    3611 </span>            : #include &lt;gpac/avparse.h&gt;
<span class="lineNum">    3612 </span>            : #include &lt;gpac/mpegts.h&gt;
<span class="lineNum">    3613 </span>            : #include &lt;gpac/rtp_streamer.h&gt;
<span class="lineNum">    3614 </span>            : #include &lt;gpac/internal/odf_dev.h&gt;
<span class="lineNum">    3615 </span>            : #include &lt;gpac/internal/media_dev.h&gt;
<a name="3616"><span class="lineNum">    3616 </span>            : #include &lt;gpac/internal/isomedia_dev.h&gt;</a>
<span class="lineNum">    3617 </span>            : #endif
<span class="lineNum">    3618 </span><span class="lineCov">          2 : static u32 gpac_unit_tests(GF_MemTrackerType mem_track)</span>
<span class="lineNum">    3619 </span>            : {
<span class="lineNum">    3620 </span>            : #ifdef GPAC_ENABLE_COVERAGE
<span class="lineNum">    3621 </span>            :         u32 ucs4_buf[4];
<span class="lineNum">    3622 </span>            :         u32 i;
<span class="lineNum">    3623 </span>            :         u8 utf8_buf[7];
<span class="lineNum">    3624 </span>            : 
<span class="lineNum">    3625 </span><span class="lineCov">          2 :         void *mem = gf_calloc(4, sizeof(u32));</span>
<span class="lineNum">    3626 </span><span class="lineCov">          2 :         gf_free(mem);</span>
<span class="lineNum">    3627 </span>            : 
<span class="lineNum">    3628 </span><span class="lineCov">          2 :         if (mem_track == GF_MemTrackerNone) return 0;</span>
<span class="lineNum">    3629 </span>            : 
<span class="lineNum">    3630 </span><span class="lineCov">          1 :         gpac_fsess_task_help(); //for coverage</span>
<span class="lineNum">    3631 </span><span class="lineCov">          1 :         gf_dm_sess_last_error(NULL);</span>
<span class="lineNum">    3632 </span><span class="lineCov">          1 :         gf_log_use_color();</span>
<span class="lineNum">    3633 </span><span class="lineCov">          1 :         gf_4cc_parse(&quot;abcd&quot;);</span>
<span class="lineNum">    3634 </span><span class="lineCov">          1 :         gf_gpac_abi_micro();</span>
<span class="lineNum">    3635 </span><span class="lineCov">          1 :         gf_audio_fmt_get_layout_from_name(&quot;3/2.1&quot;);</span>
<span class="lineNum">    3636 </span><span class="lineCov">          1 :         gf_audio_fmt_get_dolby_chanmap(4);</span>
<span class="lineNum">    3637 </span><span class="lineCov">          1 :         gf_itags_get_id3tag(1);</span>
<span class="lineNum">    3638 </span><span class="lineCov">          1 :         i=0;</span>
<span class="lineNum">    3639 </span><span class="lineCov">          1 :         gf_itags_enum_tags(&amp;i, NULL, NULL, NULL);</span>
<span class="lineNum">    3640 </span>            : 
<span class="lineNum">    3641 </span><span class="lineCov">          1 :         GF_LOG(GF_LOG_INFO, GF_LOG_CORE, (&quot;[CoreUnitTests] performing tests\n&quot;));</span>
<span class="lineNum">    3642 </span>            : 
<span class="lineNum">    3643 </span><span class="lineCov">          1 :         utf8_buf[0] = 'a';</span>
<span class="lineNum">    3644 </span><span class="lineCov">          1 :         utf8_buf[1] = 0;</span>
<span class="lineNum">    3645 </span><span class="lineCov">          1 :         if (! utf8_to_ucs4 (ucs4_buf, 1, (unsigned char *) utf8_buf)) {</span>
<span class="lineNum">    3646 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] UCS-4 translation failed for single char\n&quot;));</span>
<span class="lineNum">    3647 </span>            :                 return 1;
<span class="lineNum">    3648 </span>            :         }
<span class="lineNum">    3649 </span><span class="lineCov">          1 :         utf8_buf[0] = 0xc2;</span>
<span class="lineNum">    3650 </span><span class="lineCov">          1 :         utf8_buf[1] = 0xa3;</span>
<span class="lineNum">    3651 </span><span class="lineCov">          1 :         utf8_buf[2] = 'a';</span>
<span class="lineNum">    3652 </span><span class="lineCov">          1 :         utf8_buf[3] = 0;</span>
<span class="lineNum">    3653 </span><span class="lineCov">          1 :         if (! utf8_to_ucs4 (ucs4_buf, 3, (unsigned char *) utf8_buf)) {</span>
<span class="lineNum">    3654 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] UCS-4 translation failed for 2-byte + 1-byte char\n&quot;));</span>
<span class="lineNum">    3655 </span>            :                 return 1;
<span class="lineNum">    3656 </span>            :         }
<span class="lineNum">    3657 </span><span class="lineCov">          1 :         utf8_buf[0] = 0xe0;</span>
<span class="lineNum">    3658 </span><span class="lineCov">          1 :         utf8_buf[1] = 0xa4;</span>
<span class="lineNum">    3659 </span><span class="lineCov">          1 :         utf8_buf[2] = 0xb9;</span>
<span class="lineNum">    3660 </span><span class="lineCov">          1 :         utf8_buf[3] = 0;</span>
<span class="lineNum">    3661 </span><span class="lineCov">          1 :         if (! utf8_to_ucs4 (ucs4_buf, 3, (unsigned char *) utf8_buf)) {</span>
<span class="lineNum">    3662 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] UCS-4 translation failed for 3-byte char\n&quot;));</span>
<span class="lineNum">    3663 </span>            :                 return 1;
<span class="lineNum">    3664 </span>            :         }
<span class="lineNum">    3665 </span><span class="lineCov">          1 :         utf8_buf[0] = 0xf0;</span>
<span class="lineNum">    3666 </span><span class="lineCov">          1 :         utf8_buf[1] = 0x90;</span>
<span class="lineNum">    3667 </span><span class="lineCov">          1 :         utf8_buf[2] = 0x8d;</span>
<span class="lineNum">    3668 </span><span class="lineCov">          1 :         utf8_buf[3] = 0x88;</span>
<span class="lineNum">    3669 </span><span class="lineCov">          1 :         utf8_buf[4] = 0;</span>
<span class="lineNum">    3670 </span><span class="lineCov">          1 :         if (! utf8_to_ucs4 (ucs4_buf, 4, (unsigned char *) utf8_buf)) {</span>
<span class="lineNum">    3671 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] UCS-4 translation failed for 4-byte char\n&quot;));</span>
<span class="lineNum">    3672 </span>            :                 return 1;
<span class="lineNum">    3673 </span>            :         }
<span class="lineNum">    3674 </span>            : 
<span class="lineNum">    3675 </span><span class="lineCov">          1 :         utf8_buf[0] = 0xf8;</span>
<span class="lineNum">    3676 </span><span class="lineCov">          1 :         utf8_buf[1] = 0x80;</span>
<span class="lineNum">    3677 </span><span class="lineCov">          1 :         utf8_buf[2] = 0x80;</span>
<span class="lineNum">    3678 </span><span class="lineCov">          1 :         utf8_buf[3] = 0x80;</span>
<span class="lineNum">    3679 </span><span class="lineCov">          1 :         utf8_buf[4] = 0xaf;</span>
<span class="lineNum">    3680 </span><span class="lineCov">          1 :         utf8_buf[5] = 0;</span>
<span class="lineNum">    3681 </span><span class="lineCov">          1 :         if (! utf8_to_ucs4 (ucs4_buf, 5, (unsigned char *) utf8_buf)) {</span>
<span class="lineNum">    3682 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] UCS-4 translation failed for 5-byte char\n&quot;));</span>
<span class="lineNum">    3683 </span>            :                 return 1;
<span class="lineNum">    3684 </span>            :         }
<span class="lineNum">    3685 </span><span class="lineCov">          1 :         utf8_buf[0] = 0xfc;</span>
<span class="lineNum">    3686 </span><span class="lineCov">          1 :         utf8_buf[1] = 0x80;</span>
<span class="lineNum">    3687 </span><span class="lineCov">          1 :         utf8_buf[2] = 0x80;</span>
<span class="lineNum">    3688 </span><span class="lineCov">          1 :         utf8_buf[3] = 0x80;</span>
<span class="lineNum">    3689 </span><span class="lineCov">          1 :         utf8_buf[4] = 0x80;</span>
<span class="lineNum">    3690 </span><span class="lineCov">          1 :         utf8_buf[5] = 0xaf;</span>
<span class="lineNum">    3691 </span><span class="lineCov">          1 :         utf8_buf[6] = 0;</span>
<span class="lineNum">    3692 </span><span class="lineCov">          1 :         if (! utf8_to_ucs4 (ucs4_buf, 6, (unsigned char *) utf8_buf)) {</span>
<span class="lineNum">    3693 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] UCS-4 translation failed for 6-byte char\n&quot;));</span>
<span class="lineNum">    3694 </span>            :                 return 1;
<span class="lineNum">    3695 </span>            :         }
<span class="lineNum">    3696 </span>            :         //test error case
<span class="lineNum">    3697 </span><span class="lineCov">          1 :         utf8_buf[0] = 0xf8;</span>
<span class="lineNum">    3698 </span><span class="lineCov">          1 :         utf8_to_ucs4 (ucs4_buf, 6, (unsigned char *) utf8_buf);</span>
<span class="lineNum">    3699 </span>            : 
<span class="lineNum">    3700 </span>            :         char buf[5], obuf[3];
<span class="lineNum">    3701 </span><span class="lineCov">          1 :         obuf[0] = 1;</span>
<span class="lineNum">    3702 </span><span class="lineCov">          1 :         obuf[1] = 2;</span>
<span class="lineNum">    3703 </span><span class="lineCov">          1 :         u32 res = gf_base16_encode(obuf, 2, buf, 5);</span>
<span class="lineNum">    3704 </span><span class="lineCov">          1 :         if (res != 4) {</span>
<span class="lineNum">    3705 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] base16 encode fail\n&quot;));</span>
<span class="lineNum">    3706 </span>            :                 return 1;
<span class="lineNum">    3707 </span>            :         }
<span class="lineNum">    3708 </span><span class="lineCov">          1 :         u32 res2 = gf_base16_decode(buf, res, obuf, 3);</span>
<span class="lineNum">    3709 </span><span class="lineCov">          1 :         if (res2 != 2) {</span>
<span class="lineNum">    3710 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] base16 decode fail\n&quot;));</span>
<span class="lineNum">    3711 </span>            :                 return 1;
<span class="lineNum">    3712 </span>            :         }
<span class="lineNum">    3713 </span>            : 
<span class="lineNum">    3714 </span>            :         u8 *zbuf;
<span class="lineNum">    3715 </span>            :         u32 osize;
<span class="lineNum">    3716 </span>            :         GF_Err e;
<span class="lineNum">    3717 </span>            :         u8 *ozbuf;
<span class="lineNum">    3718 </span>            : 
<span class="lineNum">    3719 </span>            : #ifndef GPAC_DISABLE_ZLIB
<span class="lineNum">    3720 </span><span class="lineCov">          1 :         zbuf = gf_strdup(&quot;123451234512345123451234512345&quot;);</span>
<span class="lineNum">    3721 </span><span class="lineCov">          1 :         osize=0;</span>
<span class="lineNum">    3722 </span><span class="lineCov">          1 :         e = gf_gz_compress_payload(&amp;zbuf, 1 + (u32) strlen(zbuf), &amp;osize);</span>
<span class="lineNum">    3723 </span><span class="lineCov">          1 :         if (e) {</span>
<span class="lineNum">    3724 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] zlib compress fail\n&quot;));</span>
<span class="lineNum">    3725 </span><span class="lineNoCov">          0 :                 gf_free(zbuf);</span>
<span class="lineNum">    3726 </span><span class="lineNoCov">          0 :                 return 1;</span>
<span class="lineNum">    3727 </span>            :         }
<span class="lineNum">    3728 </span><span class="lineCov">          1 :         ozbuf=NULL;</span>
<span class="lineNum">    3729 </span><span class="lineCov">          1 :         res=0;</span>
<span class="lineNum">    3730 </span><span class="lineCov">          1 :         e = gf_gz_decompress_payload(zbuf, osize, &amp;ozbuf, &amp;res);</span>
<span class="lineNum">    3731 </span><span class="lineCov">          1 :         gf_free(zbuf);</span>
<span class="lineNum">    3732 </span><span class="lineCov">          1 :         if (ozbuf) gf_free(ozbuf);</span>
<span class="lineNum">    3733 </span><span class="lineCov">          1 :         if (e) {</span>
<span class="lineNum">    3734 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] zlib decompress fail\n&quot;));</span>
<span class="lineNum">    3735 </span>            :                 return 1;
<span class="lineNum">    3736 </span>            :         }
<span class="lineNum">    3737 </span>            : #endif
<span class="lineNum">    3738 </span>            : 
<span class="lineNum">    3739 </span><span class="lineCov">          1 :         zbuf = gf_strdup(&quot;123451234512345123451234512345&quot;);</span>
<span class="lineNum">    3740 </span><span class="lineCov">          1 :         osize=0;</span>
<span class="lineNum">    3741 </span><span class="lineCov">          1 :         e = gf_lz_compress_payload(&amp;zbuf, 1+(u32) strlen(zbuf), &amp;osize);</span>
<span class="lineNum">    3742 </span><span class="lineCov">          1 :         if (e &amp;&amp; (e!= GF_NOT_SUPPORTED)) {</span>
<span class="lineNum">    3743 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] lzma compress fail\n&quot;));</span>
<span class="lineNum">    3744 </span><span class="lineNoCov">          0 :                 gf_free(zbuf);</span>
<span class="lineNum">    3745 </span><span class="lineNoCov">          0 :                 return 1;</span>
<span class="lineNum">    3746 </span>            :         }
<span class="lineNum">    3747 </span><span class="lineCov">          1 :         ozbuf=NULL;</span>
<span class="lineNum">    3748 </span><span class="lineCov">          1 :         res=0;</span>
<span class="lineNum">    3749 </span><span class="lineCov">          1 :         e = gf_lz_decompress_payload(zbuf, osize, &amp;ozbuf, &amp;res);</span>
<span class="lineNum">    3750 </span><span class="lineCov">          1 :         gf_free(zbuf);</span>
<span class="lineNum">    3751 </span><span class="lineCov">          1 :         if (ozbuf) gf_free(ozbuf);</span>
<span class="lineNum">    3752 </span><span class="lineCov">          1 :         if (e &amp;&amp; (e!= GF_NOT_SUPPORTED)) {</span>
<span class="lineNum">    3753 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] lzma decompress fail\n&quot;));</span>
<span class="lineNum">    3754 </span>            :                 return 1;
<span class="lineNum">    3755 </span>            :         }
<span class="lineNum">    3756 </span>            : 
<span class="lineNum">    3757 </span><span class="lineCov">          1 :         gf_htonl(0xAABBCCDD);</span>
<span class="lineNum">    3758 </span><span class="lineCov">          1 :         gf_ntohl(0xAABBCCDD);</span>
<span class="lineNum">    3759 </span><span class="lineCov">          1 :         gf_htons(0xAABB);</span>
<span class="lineNum">    3760 </span><span class="lineCov">          1 :         gf_ntohs(0xAABB);</span>
<span class="lineNum">    3761 </span><span class="lineCov">          1 :         gf_errno_str(-1);</span>
<span class="lineNum">    3762 </span>            : 
<span class="lineNum">    3763 </span>            :         /* these two lock the bash shell in test mode
<span class="lineNum">    3764 </span>            :         gf_prompt_set_echo_off(GF_TRUE);
<span class="lineNum">    3765 </span>            :         gf_prompt_set_echo_off(GF_FALSE);
<span class="lineNum">    3766 </span>            :         */
<span class="lineNum">    3767 </span>            : 
<span class="lineNum">    3768 </span><span class="lineCov">          1 :         gf_net_set_ntp_shift(-1000);</span>
<span class="lineNum">    3769 </span><span class="lineCov">          1 :         gf_net_get_ntp_diff_ms(gf_net_get_ntp_ts() );</span>
<span class="lineNum">    3770 </span><span class="lineCov">          1 :         gf_net_get_timezone();</span>
<span class="lineNum">    3771 </span><span class="lineCov">          1 :         gf_net_get_utc_ts(70, 1, 0, 0, 0, 0);</span>
<span class="lineNum">    3772 </span><span class="lineCov">          1 :         gf_net_ntp_diff_ms(1000000, 1000000);</span>
<span class="lineNum">    3773 </span><span class="lineCov">          1 :         gf_lang_get_count();</span>
<span class="lineNum">    3774 </span><span class="lineCov">          1 :         gf_lang_get_2cc(2);</span>
<span class="lineNum">    3775 </span>            :         GF_Blob b;
<span class="lineNum">    3776 </span>            :         memset(&amp;b, 0, sizeof(GF_Blob));
<span class="lineNum">    3777 </span><span class="lineCov">          1 :         b.data = (u8 *) &quot;test&quot;;</span>
<span class="lineNum">    3778 </span><span class="lineCov">          1 :         b.size = 5;</span>
<span class="lineNum">    3779 </span>            :         char url[100];
<span class="lineNum">    3780 </span>            :         u8 *data;
<span class="lineNum">    3781 </span>            :         u32 size;
<span class="lineNum">    3782 </span>            :         sprintf(url, &quot;gmem://%p&quot;, &amp;b);
<span class="lineNum">    3783 </span>            : 
<span class="lineNum">    3784 </span><span class="lineCov">          1 :         gf_sys_profiler_set_callback(NULL, NULL);</span>
<span class="lineNum">    3785 </span>            : 
<span class="lineNum">    3786 </span><span class="lineCov">          1 :         gf_blob_get(url, &amp;data, &amp;size, NULL);</span>
<span class="lineNum">    3787 </span><span class="lineCov">          1 :         if (!data || strcmp((char *)data, &quot;test&quot;)) {</span>
<span class="lineNum">    3788 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_CORE, (&quot;[CoreUnitTests] blob url parsing fail\n&quot;));</span>
<span class="lineNum">    3789 </span>            :                 return 1;
<span class="lineNum">    3790 </span>            :         }
<span class="lineNum">    3791 </span><span class="lineCov">          1 :         gf_sys_get_battery_state(NULL, NULL, NULL, NULL, NULL);</span>
<span class="lineNum">    3792 </span><span class="lineCov">          1 :         gf_sys_get_process_id();</span>
<span class="lineNum">    3793 </span><span class="lineCov">          1 :         data = (u8 *) gf_log_get_tools_levels();</span>
<span class="lineNum">    3794 </span><span class="lineCov">          1 :         if (data) gf_free(data);</span>
<span class="lineNum">    3795 </span>            : 
<span class="lineNum">    3796 </span><span class="lineCov">          1 :         gf_sys_is_quiet();</span>
<span class="lineNum">    3797 </span><span class="lineCov">          1 :         gf_sys_get_argv();</span>
<span class="lineNum">    3798 </span><span class="lineCov">          1 :         gf_mx_get_num_locks(NULL);</span>
<span class="lineNum">    3799 </span><span class="lineCov">          1 :         sigint_catched = GF_TRUE;</span>
<span class="lineNum">    3800 </span>            : 
<span class="lineNum">    3801 </span>            : #ifdef WIN32
<span class="lineNum">    3802 </span>            :         gpac_sig_handler(CTRL_C_EVENT);
<span class="lineNum">    3803 </span>            : #else
<span class="lineNum">    3804 </span><span class="lineCov">          1 :         gpac_sig_handler(SIGINT);</span>
<span class="lineNum">    3805 </span>            : #endif
<span class="lineNum">    3806 </span>            : 
<span class="lineNum">    3807 </span><span class="lineCov">          1 :         gf_mkdir(&quot;testdir&quot;);</span>
<span class="lineNum">    3808 </span><span class="lineCov">          1 :         gf_mkdir(&quot;testdir/somedir&quot;);</span>
<span class="lineNum">    3809 </span>            :         strcpy(url, &quot;testdir/somedir/test.bin&quot;);
<span class="lineNum">    3810 </span><span class="lineCov">          1 :         FILE *f=gf_fopen(url, &quot;wb&quot;);</span>
<span class="lineNum">    3811 </span>            :         fprintf(f, &quot;some test\n&quot;);
<span class="lineNum">    3812 </span>            : #ifdef GPAC_MEMORY_TRACKING
<span class="lineNum">    3813 </span><span class="lineCov">          1 :         gf_memory_print();</span>
<span class="lineNum">    3814 </span>            : #endif
<span class="lineNum">    3815 </span><span class="lineCov">          1 :         gf_fclose(f);</span>
<span class="lineNum">    3816 </span><span class="lineCov">          1 :         gf_file_modification_time(url);</span>
<span class="lineNum">    3817 </span><span class="lineCov">          1 :         gf_m2ts_probe_file(url);</span>
<span class="lineNum">    3818 </span>            : 
<span class="lineNum">    3819 </span><span class="lineCov">          1 :         gf_dir_cleanup(&quot;testdir&quot;);</span>
<span class="lineNum">    3820 </span><span class="lineCov">          1 :         gf_rmdir(&quot;testdir&quot;);</span>
<span class="lineNum">    3821 </span>            : 
<span class="lineNum">    3822 </span>            :         //math.c not covered yet by our sample files
<span class="lineNum">    3823 </span>            :         GF_Matrix2D mx;
<span class="lineNum">    3824 </span><span class="lineCov">          1 :         gf_mx2d_init(mx);</span>
<span class="lineNum">    3825 </span><span class="lineCov">          1 :         gf_mx2d_add_skew(&amp;mx, FIX_ONE, FIX_ONE);</span>
<span class="lineNum">    3826 </span><span class="lineCov">          1 :         gf_mx2d_add_skew_x(&amp;mx, GF_PI/4);</span>
<span class="lineNum">    3827 </span><span class="lineCov">          1 :         gf_mx2d_add_skew_y(&amp;mx, GF_PI/4);</span>
<span class="lineNum">    3828 </span>            :         GF_Point2D scale, translate;
<span class="lineNum">    3829 </span>            :         Fixed rotate;
<span class="lineNum">    3830 </span><span class="lineCov">          1 :         gf_mx2d_decompose(&amp;mx, &amp;scale, &amp;rotate, &amp;translate);</span>
<span class="lineNum">    3831 </span>            :         GF_Rect rc1, rc2;
<span class="lineNum">    3832 </span>            :         memset(&amp;rc1, 0, sizeof(GF_Rect));
<span class="lineNum">    3833 </span>            :         memset(&amp;rc2, 0, sizeof(GF_Rect));
<span class="lineNum">    3834 </span><span class="lineCov">          1 :         gf_rect_equal(&amp;rc1, &amp;rc2);</span>
<span class="lineNum">    3835 </span>            : 
<span class="lineNum">    3836 </span>            :         GF_Matrix mat;
<span class="lineNum">    3837 </span><span class="lineCov">          1 :         gf_mx_init(mat);</span>
<span class="lineNum">    3838 </span>            :         Fixed yaw, pitch, roll;
<span class="lineNum">    3839 </span><span class="lineCov">          1 :         gf_mx_get_yaw_pitch_roll(&amp;mat, &amp;yaw, &amp;pitch, &amp;roll);</span>
<span class="lineNum">    3840 </span><span class="lineCov">          1 :         gf_mx_ortho_reverse_z(&amp;mat, -20, 20, -20, 20, 0.1, 100.0);</span>
<span class="lineNum">    3841 </span><span class="lineCov">          1 :         gf_mx_perspective_reverse_z(&amp;mat, 0.76, 1.0, 0.1, 100.0);</span>
<span class="lineNum">    3842 </span>            : 
<span class="lineNum">    3843 </span>            :         GF_Ray ray;
<span class="lineNum">    3844 </span>            :         GF_Vec center, outPoint;
<span class="lineNum">    3845 </span>            :         memset(&amp;ray, 0, sizeof(GF_Ray));
<span class="lineNum">    3846 </span><span class="lineCov">          1 :         ray.dir.z = FIX_ONE;</span>
<span class="lineNum">    3847 </span>            :         memset(&amp;center, 0, sizeof(GF_Vec));
<span class="lineNum">    3848 </span><span class="lineCov">          1 :         gf_ray_hit_sphere(&amp;ray, &amp;center, FIX_ONE, &amp;outPoint);</span>
<span class="lineNum">    3849 </span>            : 
<span class="lineNum">    3850 </span><span class="lineCov">          1 :         gf_closest_point_to_line(center, ray.dir, center);</span>
<span class="lineNum">    3851 </span>            : 
<span class="lineNum">    3852 </span>            :         GF_Plane plane;
<span class="lineNum">    3853 </span><span class="lineCov">          1 :         plane.d = FIX_ONE;</span>
<span class="lineNum">    3854 </span><span class="lineCov">          1 :         plane.normal = center;</span>
<span class="lineNum">    3855 </span><span class="lineCov">          1 :         gf_plane_intersect_line(&amp;plane, &amp;center, &amp;ray.dir, &amp;outPoint);</span>
<span class="lineNum">    3856 </span>            : 
<span class="lineNum">    3857 </span>            :         GF_Vec4 rot, quat;
<span class="lineNum">    3858 </span><span class="lineCov">          1 :         rot.x = rot.y = 0;</span>
<span class="lineNum">    3859 </span><span class="lineCov">          1 :         rot.z = FIX_ONE;</span>
<span class="lineNum">    3860 </span><span class="lineCov">          1 :         rot.q = GF_PI/4;</span>
<span class="lineNum">    3861 </span><span class="lineCov">          1 :         quat = gf_quat_from_rotation(rot);</span>
<span class="lineNum">    3862 </span><span class="lineCov">          1 :         gf_quat_get_inv(&amp;quat);</span>
<span class="lineNum">    3863 </span><span class="lineCov">          1 :         gf_quat_rotate(&amp;quat, &amp;ray.dir);</span>
<span class="lineNum">    3864 </span><span class="lineCov">          1 :         gf_quat_slerp(quat, quat, FIX_ONE/2);</span>
<span class="lineNum">    3865 </span>            :         GF_BBox bbox;
<span class="lineNum">    3866 </span>            :         memset(&amp;bbox, 0, sizeof(GF_BBox));
<span class="lineNum">    3867 </span><span class="lineCov">          1 :         gf_bbox_equal(&amp;bbox, &amp;bbox);</span>
<span class="lineNum">    3868 </span>            : 
<span class="lineNum">    3869 </span>            :         GF_Vec v;
<span class="lineNum">    3870 </span><span class="lineCov">          1 :         v.x = v.y = v.z = 0;</span>
<span class="lineNum">    3871 </span><span class="lineCov">          1 :         gf_vec_scale_p(&amp;v, 2*FIX_ONE);</span>
<span class="lineNum">    3872 </span>            : 
<span class="lineNum">    3873 </span>            :         //token.c
<span class="lineNum">    3874 </span>            :         char container[1024];
<span class="lineNum">    3875 </span><span class="lineCov">          1 :         gf_token_get_strip(&quot;12 34{ 56 : }&quot;, 0, &quot;{:&quot;, &quot; &quot;, container, 1024);</span>
<span class="lineNum">    3876 </span>            : 
<span class="lineNum">    3877 </span>            :         //netwok.c
<span class="lineNum">    3878 </span>            :         char name[GF_MAX_IP_NAME_LEN];
<span class="lineNum">    3879 </span><span class="lineCov">          1 :         gf_sk_get_host_name(name);</span>
<span class="lineNum">    3880 </span><span class="lineCov">          1 :         gf_sk_set_usec_wait(NULL, 1000);</span>
<span class="lineNum">    3881 </span>            :         u32 fam;
<span class="lineNum">    3882 </span>            :         u16 port;
<span class="lineNum">    3883 </span>            :         //to remove once we have rtsp server back
<span class="lineNum">    3884 </span><span class="lineCov">          1 :         gf_sk_get_local_info(NULL, &amp;port, &amp;fam);</span>
<span class="lineNum">    3885 </span><span class="lineCov">          1 :         gf_sk_receive_wait(NULL, NULL, 0, &amp;fam, 1);</span>
<span class="lineNum">    3886 </span><span class="lineCov">          1 :         gf_sk_send_wait(NULL, NULL, 0, 1);</span>
<span class="lineNum">    3887 </span>            : 
<span class="lineNum">    3888 </span>            :         //path2D
<span class="lineNum">    3889 </span><span class="lineCov">          1 :         GF_Path *path = gf_path_new();</span>
<span class="lineNum">    3890 </span><span class="lineCov">          1 :         gf_path_add_move_to(path, 0, 0);</span>
<span class="lineNum">    3891 </span><span class="lineCov">          1 :         gf_path_add_quadratic_to(path, 5, 5, 10, 0);</span>
<span class="lineNum">    3892 </span><span class="lineCov">          1 :         gf_path_point_over(path, 4, 0);</span>
<span class="lineNum">    3893 </span><span class="lineCov">          1 :         gf_path_del(path);</span>
<span class="lineNum">    3894 </span>            : 
<span class="lineNum">    3895 </span>            :         //xml dom - to update once we find a way to integrate atsc demux in tests
<span class="lineNum">    3896 </span><span class="lineCov">          1 :         GF_DOMParser *dom = gf_xml_dom_new();</span>
<span class="lineNum">    3897 </span><span class="lineCov">          1 :         gf_xml_dom_parse_string(dom, &quot;&lt;Dummy&gt;test&lt;/Dummy&gt;&quot;);</span>
<span class="lineNum">    3898 </span><span class="lineCov">          1 :         gf_xml_dom_get_error(dom);</span>
<span class="lineNum">    3899 </span><span class="lineCov">          1 :         gf_xml_dom_get_line(dom);</span>
<span class="lineNum">    3900 </span><span class="lineCov">          1 :         gf_xml_dom_get_root_nodes_count(dom);</span>
<span class="lineNum">    3901 </span><span class="lineCov">          1 :         gf_xml_dom_del(dom);</span>
<span class="lineNum">    3902 </span>            : 
<span class="lineNum">    3903 </span>            :         //downloader - to update once we find a way to integrate atsc demux in tests
<span class="lineNum">    3904 </span><span class="lineCov">          1 :         GF_DownloadManager *dm = gf_dm_new(NULL);</span>
<span class="lineNum">    3905 </span><span class="lineCov">          1 :         gf_dm_set_auth_callback(dm, NULL, NULL);</span>
<span class="lineNum">    3906 </span>            : 
<span class="lineNum">    3907 </span><span class="lineCov">          1 :         gf_dm_set_data_rate(dm, 0);</span>
<span class="lineNum">    3908 </span><span class="lineCov">          1 :         gf_dm_get_data_rate(dm);</span>
<span class="lineNum">    3909 </span><span class="lineCov">          1 :         gf_dm_set_localcache_provider(dm, NULL, NULL);</span>
<span class="lineNum">    3910 </span><span class="lineCov">          1 :         gf_dm_sess_abort(NULL);</span>
<span class="lineNum">    3911 </span><span class="lineCov">          1 :         gf_dm_del(dm);</span>
<span class="lineNum">    3912 </span>            : 
<span class="lineNum">    3913 </span>            :         //constants
<span class="lineNum">    3914 </span><span class="lineCov">          1 :         gf_stream_type_afx_name(GPAC_AFX_3DMC);</span>
<span class="lineNum">    3915 </span>            :         //thread
<span class="lineNum">    3916 </span><span class="lineCov">          1 :         gf_th_stop(NULL);</span>
<span class="lineNum">    3917 </span><span class="lineCov">          1 :         gf_list_swap(NULL, NULL);</span>
<span class="lineNum">    3918 </span>            :         //bitstream
<span class="lineNum">    3919 </span><span class="lineCov">          1 :         GF_BitStream *bs = gf_bs_new(&quot;test&quot;, 4, GF_BITSTREAM_READ);</span>
<span class="lineNum">    3920 </span><span class="lineCov">          1 :         gf_bs_bits_available(bs);</span>
<span class="lineNum">    3921 </span><span class="lineCov">          1 :         gf_bs_get_bit_offset(bs);</span>
<span class="lineNum">    3922 </span><span class="lineCov">          1 :         gf_bs_read_vluimsbf5(bs);</span>
<span class="lineNum">    3923 </span><span class="lineCov">          1 :         gf_bs_del(bs);</span>
<span class="lineNum">    3924 </span>            :         //module
<span class="lineNum">    3925 </span><span class="lineCov">          1 :         gf_module_load_static(NULL);</span>
<span class="lineNum">    3926 </span>            : 
<span class="lineNum">    3927 </span><span class="lineCov">          1 :         gf_mp3_version_name(0);</span>
<span class="lineNum">    3928 </span>            :         char tsbuf[188];
<span class="lineNum">    3929 </span><span class="lineCov">          1 :         u8 is_pes=GF_TRUE;</span>
<span class="lineNum">    3930 </span>            :         memset(tsbuf, 0, 188);
<span class="lineNum">    3931 </span><span class="lineCov">          1 :         tsbuf[0] = 0x47;</span>
<span class="lineNum">    3932 </span><span class="lineCov">          1 :         tsbuf[1] = 0x40;</span>
<span class="lineNum">    3933 </span>            :         tsbuf[4]=0x00;
<span class="lineNum">    3934 </span>            :         tsbuf[5]=0x00;
<span class="lineNum">    3935 </span><span class="lineCov">          1 :         tsbuf[6]=0x01;</span>
<span class="lineNum">    3936 </span><span class="lineCov">          1 :         tsbuf[10] = 0x80;</span>
<span class="lineNum">    3937 </span><span class="lineCov">          1 :         tsbuf[11] = 0xc0;</span>
<span class="lineNum">    3938 </span><span class="lineCov">          1 :         tsbuf[13] = 0x2 &lt;&lt; 4;</span>
<span class="lineNum">    3939 </span><span class="lineCov">          1 :         gf_m2ts_restamp(tsbuf, 188, 1000, &amp;is_pes);</span>
<span class="lineNum">    3940 </span>            : 
<span class="lineNum">    3941 </span>            : 
<span class="lineNum">    3942 </span><span class="lineCov">          1 :         gf_filter_post_task(NULL,NULL,NULL,NULL);</span>
<span class="lineNum">    3943 </span><span class="lineCov">          1 :         gf_filter_get_num_events_queued(NULL);</span>
<span class="lineNum">    3944 </span><span class="lineCov">          1 :         gf_filter_get_arg_str(NULL, NULL, NULL);</span>
<span class="lineNum">    3945 </span><span class="lineCov">          1 :         gf_filter_all_sinks_done(NULL);</span>
<span class="lineNum">    3946 </span>            : 
<span class="lineNum">    3947 </span><span class="lineCov">          1 :         gf_opts_discard_changes();</span>
<span class="lineNum">    3948 </span>            : 
<span class="lineNum">    3949 </span><span class="lineCov">          1 :         gf_rtp_reset_ssrc(NULL);</span>
<span class="lineNum">    3950 </span><span class="lineCov">          1 :         gf_rtp_enable_nat_keepalive(NULL, 0);</span>
<span class="lineNum">    3951 </span><span class="lineCov">          1 :         gf_rtp_stop(NULL);</span>
<span class="lineNum">    3952 </span><span class="lineCov">          1 :         gf_rtp_streamer_get_payload_type(NULL);</span>
<span class="lineNum">    3953 </span><span class="lineCov">          1 :         gf_rtsp_unregister_interleave(NULL, 0);</span>
<span class="lineNum">    3954 </span><span class="lineCov">          1 :         gf_rtsp_reset_aggregation(NULL);</span>
<span class="lineNum">    3955 </span>            : 
<span class="lineNum">    3956 </span>            :         get_cmd('h');
<span class="lineNum">    3957 </span><span class="lineCov">          1 :         gpac_suggest_arg(&quot;blcksize&quot;);</span>
<span class="lineNum">    3958 </span><span class="lineCov">          1 :         gpac_suggest_filter(&quot;outf&quot;, GF_FALSE, GF_FALSE);</span>
<span class="lineNum">    3959 </span>            :         //todo: build tests for these two
<span class="lineNum">    3960 </span><span class="lineCov">          1 :         gf_filter_pid_negociate_property_str(NULL, NULL, NULL);</span>
<span class="lineNum">    3961 </span><span class="lineCov">          1 :         gf_filter_pid_negociate_property_dyn(NULL, NULL, NULL);</span>
<span class="lineNum">    3962 </span>            : 
<span class="lineNum">    3963 </span><span class="lineCov">          1 :         gf_props_parse_type(&quot;uint&quot;);</span>
<span class="lineNum">    3964 </span>            :         //this one is just a wrapper around an internal function
<span class="lineNum">    3965 </span><span class="lineCov">          1 :         gf_filter_pck_new_copy(NULL, NULL, NULL);</span>
<span class="lineNum">    3966 </span><span class="lineCov">          1 :         gf_filter_get_max_extra_input_pids(NULL);</span>
<span class="lineNum">    3967 </span><span class="lineCov">          1 :         gf_filter_remove(NULL);</span>
<span class="lineNum">    3968 </span><span class="lineCov">          1 :         gf_filter_reconnect_output(NULL);</span>
<span class="lineNum">    3969 </span>            : 
<span class="lineNum">    3970 </span><span class="lineCov">          1 :         gf_audio_fmt_get_cicp_layout(2, 1, 1);</span>
<span class="lineNum">    3971 </span><span class="lineCov">          1 :         gf_audio_fmt_get_layout_from_cicp(3);</span>
<span class="lineNum">    3972 </span><span class="lineCov">          1 :         gf_audio_fmt_get_layout_name_from_cicp(3);</span>
<span class="lineNum">    3973 </span><span class="lineCov">          1 :         gf_audio_fmt_get_cicp_from_layout(GF_AUDIO_CH_FRONT_LEFT|GF_AUDIO_CH_FRONT_RIGHT);</span>
<span class="lineNum">    3974 </span>            : 
<span class="lineNum">    3975 </span>            :         //old bifs parsing stuff
<span class="lineNum">    3976 </span><span class="lineCov">          1 :         gf_odf_desc_del(gf_odf_desc_new(GF_ODF_ELEM_MASK_TAG));</span>
<span class="lineNum">    3977 </span><span class="lineCov">          1 :         GF_TextConfig *txtc = (GF_TextConfig *)gf_odf_desc_new(GF_ODF_TEXT_CFG_TAG);</span>
<span class="lineNum">    3978 </span><span class="lineCov">          1 :         gf_odf_get_text_config(NULL, 0, 0, txtc);</span>
<span class="lineNum">    3979 </span><span class="lineCov">          1 :         gf_odf_dump_txtcfg(txtc, NULL, 0, GF_FALSE);</span>
<span class="lineNum">    3980 </span><span class="lineCov">          1 :         gf_odf_desc_del((GF_Descriptor *) txtc);</span>
<span class="lineNum">    3981 </span>            : 
<span class="lineNum">    3982 </span>            :         //stuff only used by vtbdec
<span class="lineNum">    3983 </span><span class="lineCov">          1 :         gf_hevc_read_pps_bs(NULL, NULL);</span>
<span class="lineNum">    3984 </span><span class="lineCov">          1 :         gf_hevc_read_sps_bs(NULL, NULL);</span>
<span class="lineNum">    3985 </span><span class="lineCov">          1 :         gf_hevc_read_vps_bs(NULL, NULL);</span>
<span class="lineNum">    3986 </span><span class="lineCov">          1 :         gf_mpegv12_get_config(NULL, 0, NULL);</span>
<span class="lineNum">    3987 </span>            : 
<span class="lineNum">    3988 </span>            :         //hinting stuff
<span class="lineNum">    3989 </span><span class="lineCov">          1 :         GF_HintPacket *hpck = gf_isom_hint_pck_new(GF_ISOM_BOX_TYPE_RTCP_STSD);</span>
<span class="lineNum">    3990 </span><span class="lineCov">          1 :         gf_isom_hint_pck_length(hpck);</span>
<span class="lineNum">    3991 </span><span class="lineCov">          1 :         gf_isom_hint_pck_size(hpck);</span>
<span class="lineNum">    3992 </span><span class="lineCov">          1 :         GF_BitStream *hbs = gf_bs_new(NULL, 0, GF_BITSTREAM_WRITE);</span>
<span class="lineNum">    3993 </span><span class="lineCov">          1 :         gf_isom_hint_pck_write(hpck, hbs);</span>
<span class="lineNum">    3994 </span>            :         u8 *hbuf;
<span class="lineNum">    3995 </span>            :         u32 hsize;
<span class="lineNum">    3996 </span><span class="lineCov">          1 :         gf_bs_get_content(hbs, &amp;hbuf, &amp;hsize);</span>
<span class="lineNum">    3997 </span><span class="lineCov">          1 :         gf_bs_del(hbs);</span>
<span class="lineNum">    3998 </span><span class="lineCov">          1 :         hbs = gf_bs_new(hbuf, hsize, GF_BITSTREAM_READ);</span>
<span class="lineNum">    3999 </span><span class="lineCov">          1 :         gf_isom_hint_pck_read(hpck, hbs);</span>
<span class="lineNum">    4000 </span><span class="lineCov">          1 :         gf_bs_del(hbs);</span>
<span class="lineNum">    4001 </span><span class="lineCov">          1 :         gf_free(hbuf);</span>
<span class="lineNum">    4002 </span><span class="lineCov">          1 :         gf_isom_hint_pck_del(hpck);</span>
<span class="lineNum">    4003 </span>            : 
<span class="lineNum">    4004 </span><span class="lineCov">          1 :         gf_isom_last_error(NULL);</span>
<span class="lineNum">    4005 </span><span class="lineCov">          1 :         gf_isom_get_media_time(NULL, 0, 0, NULL);</span>
<span class="lineNum">    4006 </span><span class="lineCov">          1 :         gf_isom_get_sample_description_index(NULL, 0, 0);</span>
<span class="lineNum">    4007 </span>            : 
<span class="lineNum">    4008 </span>            : 
<span class="lineNum">    4009 </span>            : #endif
<span class="lineNum">    4010 </span><span class="lineCov">          1 :         return 0;</span>
<a name="4011"><span class="lineNum">    4011 </span>            : }</a>
<span class="lineNum">    4012 </span>            : 
<span class="lineNum">    4013 </span><span class="lineCov">         10 : static Bool revert_cache_file(void *cbck, char *item_name, char *item_path, GF_FileEnumInfo *file_info)</span>
<span class="lineNum">    4014 </span>            : {
<span class="lineNum">    4015 </span>            :         const char *url;
<span class="lineNum">    4016 </span>            :         GF_Config *cached;
<span class="lineNum">    4017 </span><span class="lineCov">         10 :         if (strncmp(item_name, &quot;gpac_cache_&quot;, 11)) return GF_FALSE;</span>
<span class="lineNum">    4018 </span><span class="lineCov">         10 :         cached = gf_cfg_new(NULL, item_path);</span>
<span class="lineNum">    4019 </span><span class="lineCov">         10 :         url = gf_cfg_get_key(cached, &quot;cache&quot;, &quot;url&quot;);</span>
<span class="lineNum">    4020 </span><span class="lineCov">         10 :         if (url) url = strstr(url, &quot;://&quot;);</span>
<span class="lineNum">    4021 </span><span class="lineCov">         10 :         if (url) {</span>
<span class="lineNum">    4022 </span>            :                 u32 i, len, dir_len=0, k=0;
<span class="lineNum">    4023 </span>            :                 char *dst_name;
<span class="lineNum">    4024 </span>            :                 char *sep;
<span class="lineNum">    4025 </span>            : 
<span class="lineNum">    4026 </span><span class="lineCov">         10 :                 sep = strstr(item_path, &quot;gpac_cache_&quot;);</span>
<span class="lineNum">    4027 </span><span class="lineCov">         10 :                 if (sep) {</span>
<span class="lineNum">    4028 </span><span class="lineCov">         10 :                         sep[0] = 0;</span>
<span class="lineNum">    4029 </span><span class="lineCov">         10 :                         dir_len = (u32) strlen(item_path);</span>
<span class="lineNum">    4030 </span><span class="lineCov">         10 :                         sep[0] = 'g';</span>
<span class="lineNum">    4031 </span>            :                 }
<span class="lineNum">    4032 </span><span class="lineCov">         10 :                 url+=3;</span>
<span class="lineNum">    4033 </span><span class="lineCov">         10 :                 len = (u32) strlen(url);</span>
<span class="lineNum">    4034 </span><span class="lineCov">         10 :                 dst_name = gf_malloc(len+dir_len+1);</span>
<span class="lineNum">    4035 </span>            :                 memset(dst_name, 0, len+dir_len+1);
<span class="lineNum">    4036 </span>            : 
<span class="lineNum">    4037 </span><span class="lineCov">         10 :                 strncpy(dst_name, item_path, dir_len);</span>
<span class="lineNum">    4038 </span>            :                 k=dir_len;
<span class="lineNum">    4039 </span><span class="lineCov">        956 :                 for (i=0; i&lt;len; i++) {</span>
<span class="lineNum">    4040 </span><span class="lineCov">        946 :                         dst_name[k] = url[i];</span>
<span class="lineNum">    4041 </span><span class="lineCov">        946 :                         if (dst_name[k]==':') dst_name[k]='_';</span>
<span class="lineNum">    4042 </span><span class="lineCov">        943 :                         else if (dst_name[k]=='/') {</span>
<span class="lineNum">    4043 </span><span class="lineCov">         47 :                                 if (!gf_dir_exists(dst_name))</span>
<span class="lineNum">    4044 </span><span class="lineCov">         33 :                                         gf_mkdir(dst_name);</span>
<span class="lineNum">    4045 </span>            :                         }
<span class="lineNum">    4046 </span><span class="lineCov">        946 :                         k++;</span>
<span class="lineNum">    4047 </span>            :                 }
<span class="lineNum">    4048 </span><span class="lineCov">         10 :                 sep = strrchr(item_path, '.');</span>
<span class="lineNum">    4049 </span><span class="lineCov">         10 :                 if (sep) {</span>
<span class="lineNum">    4050 </span><span class="lineCov">         10 :                         sep[0]=0;</span>
<span class="lineNum">    4051 </span><span class="lineCov">         10 :                         if (gf_file_exists(item_path)) {</span>
<span class="lineNum">    4052 </span><span class="lineCov">          9 :                                 gf_file_move(item_path, dst_name);</span>
<span class="lineNum">    4053 </span>            :                         }
<span class="lineNum">    4054 </span><span class="lineCov">         10 :                         sep[0]='.';</span>
<span class="lineNum">    4055 </span>            :                 }
<span class="lineNum">    4056 </span><span class="lineCov">         10 :                 gf_free(dst_name);</span>
<span class="lineNum">    4057 </span>            :         }
<span class="lineNum">    4058 </span><span class="lineCov">         10 :         gf_cfg_del(cached);</span>
<span class="lineNum">    4059 </span><span class="lineCov">         10 :         gf_file_delete(item_path);</span>
<span class="lineNum">    4060 </span><span class="lineCov">         10 :         return GF_FALSE;</span>
<span class="lineNum">    4061 </span>            : }
<span class="lineNum">    4062 </span>            : 
<span class="lineNum">    4063 </span>            : 
<span class="lineNum">    4064 </span>            : typedef struct
<span class="lineNum">    4065 </span>            : {
<span class="lineNum">    4066 </span>            :         FILE *filep;
<span class="lineNum">    4067 </span>            :         char *path;
<span class="lineNum">    4068 </span>            :         Bool write;
<span class="lineNum">    4069 </span>            :         u32 nb_refs;
<span class="lineNum">    4070 </span>            : } FileIOCtx;
<span class="lineNum">    4071 </span>            : 
<span class="lineNum">    4072 </span>            : static GF_List *all_gfio_defined = NULL;
<span class="lineNum">    4073 </span>            : 
<a name="4074"><span class="lineNum">    4074 </span>            : static GF_FileIO *fio_open(GF_FileIO *fileio_ref, const char *url, const char *mode, GF_Err *out_err);</a>
<span class="lineNum">    4075 </span>            : 
<span class="lineNum">    4076 </span><span class="lineCov">         63 : static GF_Err fio_seek(GF_FileIO *fileio, u64 offset, s32 whence)</span>
<span class="lineNum">    4077 </span>            : {
<span class="lineNum">    4078 </span><span class="lineCov">         63 :         FileIOCtx *ioctx = gf_fileio_get_udta(fileio);</span>
<span class="lineNum">    4079 </span><span class="lineCov">         63 :         if (!ioctx || !ioctx-&gt;filep) return GF_BAD_PARAM;</span>
<span class="lineNum">    4080 </span><span class="lineCov">         63 :         gf_fseek(ioctx-&gt;filep, offset, whence);</span>
<a name="4081"><span class="lineNum">    4081 </span><span class="lineCov">         63 :         return GF_OK;</span></a>
<span class="lineNum">    4082 </span>            : }
<span class="lineNum">    4083 </span><span class="lineCov">        249 : static u32 fio_read(GF_FileIO *fileio, u8 *buffer, u32 bytes)</span>
<span class="lineNum">    4084 </span>            : {
<span class="lineNum">    4085 </span><span class="lineCov">        249 :         FileIOCtx *ioctx = gf_fileio_get_udta(fileio);</span>
<span class="lineNum">    4086 </span><span class="lineCov">        249 :         if (!ioctx || !ioctx-&gt;filep) return 0;</span>
<a name="4087"><span class="lineNum">    4087 </span><span class="lineCov">        249 :         return (u32) gf_fread(buffer, bytes, ioctx-&gt;filep);</span></a>
<span class="lineNum">    4088 </span>            : }
<span class="lineNum">    4089 </span><span class="lineCov">        209 : static u32 fio_write(GF_FileIO *fileio, u8 *buffer, u32 bytes)</span>
<span class="lineNum">    4090 </span>            : {
<span class="lineNum">    4091 </span><span class="lineCov">        209 :         FileIOCtx *ioctx = gf_fileio_get_udta(fileio);</span>
<span class="lineNum">    4092 </span><span class="lineCov">        209 :         if (!ioctx || !ioctx-&gt;filep) return 0;</span>
<span class="lineNum">    4093 </span><span class="lineCov">        209 :         if (!bytes) {</span>
<span class="lineNum">    4094 </span><span class="lineCov">          1 :                 fflush(ioctx-&gt;filep);</span>
<span class="lineNum">    4095 </span><span class="lineCov">          1 :                 return 0;</span>
<span class="lineNum">    4096 </span>            :         }
<a name="4097"><span class="lineNum">    4097 </span><span class="lineCov">        208 :         return (u32) gf_fwrite(buffer, bytes, ioctx-&gt;filep);</span></a>
<span class="lineNum">    4098 </span>            : }
<span class="lineNum">    4099 </span><span class="lineCov">         13 : static s64 fio_tell(GF_FileIO *fileio)</span>
<span class="lineNum">    4100 </span>            : {
<span class="lineNum">    4101 </span><span class="lineCov">         13 :         FileIOCtx *ioctx = gf_fileio_get_udta(fileio);</span>
<span class="lineNum">    4102 </span><span class="lineCov">         13 :         if (!ioctx || !ioctx-&gt;filep) return -1;</span>
<a name="4103"><span class="lineNum">    4103 </span><span class="lineCov">         13 :         return gf_ftell(ioctx-&gt;filep);</span></a>
<span class="lineNum">    4104 </span>            : }
<span class="lineNum">    4105 </span><span class="lineCov">         45 : static Bool fio_eof(GF_FileIO *fileio)</span>
<span class="lineNum">    4106 </span>            : {
<span class="lineNum">    4107 </span><span class="lineCov">         45 :         FileIOCtx *ioctx = gf_fileio_get_udta(fileio);</span>
<span class="lineNum">    4108 </span><span class="lineCov">         45 :         if (!ioctx || !ioctx-&gt;filep) return GF_TRUE;</span>
<a name="4109"><span class="lineNum">    4109 </span><span class="lineCov">         45 :         return feof(ioctx-&gt;filep);</span></a>
<span class="lineNum">    4110 </span>            : }
<span class="lineNum">    4111 </span><span class="lineCov">       3545 : static int fio_printf(GF_FileIO *fileio, const char *format, va_list args)</span>
<span class="lineNum">    4112 </span>            : {
<span class="lineNum">    4113 </span><span class="lineCov">       3545 :         FileIOCtx *ioctx = gf_fileio_get_udta(fileio);</span>
<span class="lineNum">    4114 </span><span class="lineCov">       3545 :         if (!ioctx || !ioctx-&gt;filep) return -1;</span>
<span class="lineNum">    4115 </span><span class="lineCov">       3545 :         return vfprintf(ioctx-&gt;filep, format, args);</span>
<a name="4116"><span class="lineNum">    4116 </span>            : }</a>
<span class="lineNum">    4117 </span>            : 
<span class="lineNum">    4118 </span><span class="lineCov">         63 : static GF_FileIO *fio_open(GF_FileIO *fileio_ref, const char *url, const char *mode, GF_Err *out_err)</span>
<span class="lineNum">    4119 </span>            : {
<span class="lineNum">    4120 </span>            :         GF_FileIO *gfio;
<span class="lineNum">    4121 </span>            :         FileIOCtx *ioctx;
<span class="lineNum">    4122 </span>            :         u32 i, count;
<span class="lineNum">    4123 </span>            :         u64 file_size;
<span class="lineNum">    4124 </span>            :         Bool no_concatenate = GF_FALSE;
<span class="lineNum">    4125 </span><span class="lineCov">         63 :         FileIOCtx *ioctx_ref = gf_fileio_get_udta(fileio_ref);</span>
<span class="lineNum">    4126 </span>            : 
<span class="lineNum">    4127 </span><span class="lineCov">         63 :         *out_err = GF_OK;</span>
<span class="lineNum">    4128 </span>            : 
<span class="lineNum">    4129 </span><span class="lineCov">         63 :         if (!strcmp(mode, &quot;ref&quot;)) {</span>
<span class="lineNum">    4130 </span><span class="lineCov">          3 :                 ioctx_ref-&gt;nb_refs++;</span>
<span class="lineNum">    4131 </span><span class="lineCov">          3 :                 return fileio_ref;</span>
<span class="lineNum">    4132 </span>            :         }
<span class="lineNum">    4133 </span><span class="lineCov">         60 :         if (!strcmp(mode, &quot;unref&quot;)) {</span>
<span class="lineNum">    4134 </span><span class="lineCov">          3 :                 if (!ioctx_ref-&gt;nb_refs) return NULL;</span>
<span class="lineNum">    4135 </span><span class="lineCov">          3 :                 ioctx_ref-&gt;nb_refs--;</span>
<span class="lineNum">    4136 </span><span class="lineCov">          3 :                 if (ioctx_ref-&gt;nb_refs)</span>
<span class="lineNum">    4137 </span>            :                         return fileio_ref;
<span class="lineNum">    4138 </span>            : 
<span class="lineNum">    4139 </span>            :                 url = NULL;
<span class="lineNum">    4140 </span>            :         }
<span class="lineNum">    4141 </span>            : 
<span class="lineNum">    4142 </span><span class="lineCov">         58 :         if (!strcmp(mode, &quot;url&quot;)) {</span>
<span class="lineNum">    4143 </span><span class="lineCov">          4 :                 if (!url) return NULL;</span>
<span class="lineNum">    4144 </span><span class="lineCov">          4 :                 GF_SAFEALLOC(ioctx, FileIOCtx);</span>
<span class="lineNum">    4145 </span><span class="lineCov">          4 :                 if (!ioctx) return NULL;</span>
<span class="lineNum">    4146 </span><span class="lineCov">          4 :                 ioctx-&gt;path = gf_url_concatenate(ioctx_ref-&gt;path, url);</span>
<span class="lineNum">    4147 </span><span class="lineCov">          4 :                 gfio = gf_fileio_new(ioctx-&gt;path, ioctx, fio_open, fio_seek, fio_read, fio_write, fio_tell, fio_eof, fio_printf);</span>
<span class="lineNum">    4148 </span><span class="lineCov">          4 :                 if (!gfio) {</span>
<span class="lineNum">    4149 </span><span class="lineNoCov">          0 :                         if (ioctx-&gt;path) gf_free(ioctx-&gt;path);</span>
<span class="lineNum">    4150 </span><span class="lineNoCov">          0 :                         gf_free(ioctx);</span>
<span class="lineNum">    4151 </span><span class="lineNoCov">          0 :                         return NULL;</span>
<span class="lineNum">    4152 </span>            :                 }
<span class="lineNum">    4153 </span>            :                 //remember it but no need to keep a ref on it
<span class="lineNum">    4154 </span><span class="lineCov">          4 :                 gf_list_add(all_gfio_defined, gfio);</span>
<span class="lineNum">    4155 </span><span class="lineCov">          4 :                 return gfio;</span>
<span class="lineNum">    4156 </span>            :         }
<span class="lineNum">    4157 </span><span class="lineCov">         54 :         if (!strcmp(mode, &quot;probe&quot;)) {</span>
<span class="lineNum">    4158 </span><span class="lineNoCov">          0 :                 if (!gf_file_exists(url)) *out_err = GF_URL_ERROR;</span>
<span class="lineNum">    4159 </span>            :                 return NULL;
<span class="lineNum">    4160 </span>            :         }
<span class="lineNum">    4161 </span>            : 
<span class="lineNum">    4162 </span><span class="lineCov">         54 :         if (!url) {</span>
<span class="lineNum">    4163 </span><span class="lineCov">         27 :                 if (ioctx_ref-&gt;filep) gf_fclose(ioctx_ref-&gt;filep);</span>
<span class="lineNum">    4164 </span><span class="lineCov">         27 :                 ioctx_ref-&gt;filep = NULL;</span>
<span class="lineNum">    4165 </span>            : 
<span class="lineNum">    4166 </span><span class="lineCov">         27 :                 if (!ioctx_ref-&gt;nb_refs) {</span>
<span class="lineNum">    4167 </span><span class="lineCov">         18 :                         gf_list_del_item(all_gfio_defined, fileio_ref);</span>
<span class="lineNum">    4168 </span><span class="lineCov">         18 :                         gf_fileio_del(fileio_ref);</span>
<span class="lineNum">    4169 </span><span class="lineCov">         18 :                         if (ioctx_ref-&gt;path) gf_free(ioctx_ref-&gt;path);</span>
<span class="lineNum">    4170 </span><span class="lineCov">         18 :                         gf_free(ioctx_ref);</span>
<span class="lineNum">    4171 </span>            :                 }
<span class="lineNum">    4172 </span>            :                 return NULL;
<span class="lineNum">    4173 </span>            :         }
<span class="lineNum">    4174 </span>            : 
<span class="lineNum">    4175 </span>            :         //file handle not opened, we can use the current gfio
<span class="lineNum">    4176 </span><span class="lineCov">         27 :         if (!ioctx_ref-&gt;filep &amp;&amp; (!strnicmp(url, &quot;gfio://&quot;, 7) || !strcmp(url, ioctx_ref-&gt;path)) ) {</span>
<span class="lineNum">    4177 </span><span class="lineCov">         10 :                 ioctx_ref-&gt;filep = gf_fopen(ioctx_ref-&gt;path, mode);</span>
<span class="lineNum">    4178 </span><span class="lineCov">         10 :                 if (!ioctx_ref-&gt;filep) {</span>
<span class="lineNum">    4179 </span><span class="lineNoCov">          0 :                         *out_err = GF_IO_ERR;</span>
<span class="lineNum">    4180 </span><span class="lineNoCov">          0 :                         return NULL;</span>
<span class="lineNum">    4181 </span>            :                 }
<span class="lineNum">    4182 </span><span class="lineCov">         10 :                 file_size = gf_fsize(ioctx_ref-&gt;filep);</span>
<span class="lineNum">    4183 </span>            :                 //in test mode we want to use our ftell and fseek wrappers
<span class="lineNum">    4184 </span><span class="lineCov">         10 :                 if (strchr(mode, 'r')) {</span>
<span class="lineNum">    4185 </span><span class="lineCov">          5 :                         gf_fileio_set_stats(fileio_ref, file_size, file_size, GF_TRUE, 0);</span>
<span class="lineNum">    4186 </span>            :                 }
<span class="lineNum">    4187 </span>            :                 return fileio_ref;
<span class="lineNum">    4188 </span>            :         }
<span class="lineNum">    4189 </span>            : 
<span class="lineNum">    4190 </span>            :         //file handle already open (file is being opened twice), create a new gfio or check if we have already created one
<span class="lineNum">    4191 </span>            :         gfio = NULL;
<span class="lineNum">    4192 </span>            :         ioctx = NULL;
<span class="lineNum">    4193 </span><span class="lineCov">         17 :         count = gf_list_count(all_gfio_defined);</span>
<span class="lineNum">    4194 </span><span class="lineCov">         55 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    4195 </span><span class="lineCov">         40 :                 GF_FileIO *a_gfio = gf_list_get(all_gfio_defined, i);</span>
<span class="lineNum">    4196 </span><span class="lineCov">         40 :                 ioctx = gf_fileio_get_udta(a_gfio);</span>
<span class="lineNum">    4197 </span><span class="lineCov">         40 :                 if (ioctx &amp;&amp; !strcmp(ioctx-&gt;path, url)) {</span>
<span class="lineNum">    4198 </span><span class="lineCov">          2 :                         if (ioctx-&gt;filep) {</span>
<span class="lineNum">    4199 </span>            :                                 no_concatenate = GF_TRUE;
<span class="lineNum">    4200 </span>            :                                 ioctx = NULL;
<span class="lineNum">    4201 </span>            :                         }
<span class="lineNum">    4202 </span>            :                         gfio = a_gfio;
<span class="lineNum">    4203 </span>            :                         break;
<span class="lineNum">    4204 </span>            :                 }
<span class="lineNum">    4205 </span>            :                 ioctx = NULL;
<span class="lineNum">    4206 </span>            :         }
<span class="lineNum">    4207 </span><span class="lineCov">         17 :         if (!ioctx) {</span>
<span class="lineNum">    4208 </span><span class="lineCov">         15 :                 GF_SAFEALLOC(ioctx, FileIOCtx);</span>
<span class="lineNum">    4209 </span><span class="lineCov">         15 :                 if (!ioctx) {</span>
<span class="lineNum">    4210 </span><span class="lineNoCov">          0 :                         *out_err = GF_OUT_OF_MEM;</span>
<span class="lineNum">    4211 </span><span class="lineNoCov">          0 :                         return NULL;</span>
<span class="lineNum">    4212 </span>            :                 }
<span class="lineNum">    4213 </span><span class="lineCov">         15 :                 if (strnicmp(url, &quot;gfio://&quot;, 7)) {</span>
<span class="lineNum">    4214 </span><span class="lineCov">          3 :                         if (no_concatenate)</span>
<span class="lineNum">    4215 </span><span class="lineNoCov">          0 :                                 ioctx-&gt;path = gf_strdup(url);</span>
<span class="lineNum">    4216 </span>            :                         else
<span class="lineNum">    4217 </span><span class="lineCov">          3 :                                 ioctx-&gt;path = gf_url_concatenate(ioctx_ref-&gt;path, url);</span>
<span class="lineNum">    4218 </span>            :                 } else {
<span class="lineNum">    4219 </span><span class="lineCov">         12 :                         ioctx-&gt;path = gf_strdup(ioctx_ref-&gt;path);</span>
<span class="lineNum">    4220 </span>            :                 }
<span class="lineNum">    4221 </span><span class="lineCov">         15 :                 gfio = gf_fileio_new(ioctx-&gt;path, ioctx, fio_open, fio_seek, fio_read, fio_write, fio_tell, fio_eof, fio_printf);</span>
<span class="lineNum">    4222 </span><span class="lineCov">         15 :                 if (!gfio) {</span>
<span class="lineNum">    4223 </span><span class="lineNoCov">          0 :                         if (ioctx-&gt;path) gf_free(ioctx-&gt;path);</span>
<span class="lineNum">    4224 </span><span class="lineNoCov">          0 :                         gf_free(ioctx);</span>
<span class="lineNum">    4225 </span><span class="lineNoCov">          0 :                         *out_err = GF_OUT_OF_MEM;</span>
<span class="lineNum">    4226 </span>            :                 }
<span class="lineNum">    4227 </span>            :         }
<span class="lineNum">    4228 </span>            : 
<span class="lineNum">    4229 </span><span class="lineCov">         17 :         if (strnicmp(url, &quot;gfio://&quot;, 7)) {</span>
<span class="lineNum">    4230 </span><span class="lineCov">          5 :                 ioctx-&gt;filep = gf_fopen(ioctx-&gt;path, mode);</span>
<span class="lineNum">    4231 </span>            :         } else {
<span class="lineNum">    4232 </span><span class="lineCov">         12 :                 ioctx-&gt;filep = gf_fopen(ioctx_ref-&gt;path, mode);</span>
<span class="lineNum">    4233 </span>            :         }
<span class="lineNum">    4234 </span>            : 
<span class="lineNum">    4235 </span><span class="lineCov">         17 :         if (!ioctx-&gt;filep) {</span>
<span class="lineNum">    4236 </span><span class="lineCov">          1 :                 *out_err = GF_IO_ERR;</span>
<span class="lineNum">    4237 </span><span class="lineCov">          1 :                 gf_list_del_item(all_gfio_defined, gfio);</span>
<span class="lineNum">    4238 </span><span class="lineCov">          1 :                 gf_fileio_del(gfio);</span>
<span class="lineNum">    4239 </span><span class="lineCov">          1 :                 if (ioctx-&gt;path) gf_free(ioctx-&gt;path);</span>
<span class="lineNum">    4240 </span><span class="lineCov">          1 :                 gf_free(ioctx);</span>
<span class="lineNum">    4241 </span><span class="lineCov">          1 :                 return NULL;</span>
<span class="lineNum">    4242 </span>            :         }
<span class="lineNum">    4243 </span>            : 
<span class="lineNum">    4244 </span><span class="lineCov">         16 :         file_size = gf_fsize(ioctx-&gt;filep);</span>
<span class="lineNum">    4245 </span><span class="lineCov">         16 :         if (strchr(mode, 'r'))</span>
<span class="lineNum">    4246 </span><span class="lineCov">         14 :                 gf_fileio_set_stats(gfio, file_size,file_size, GF_TRUE, 0);</span>
<span class="lineNum">    4247 </span>            :         return gfio;
<span class="lineNum">    4248 </span>            : }
<a name="4249"><span class="lineNum">    4249 </span>            : </a>
<span class="lineNum">    4250 </span>            : 
<span class="lineNum">    4251 </span><span class="lineCov">          8 : static const char *make_fileio(const char *inargs, const char **out_arg, Bool is_input, GF_Err *e)</span>
<span class="lineNum">    4252 </span>            : {
<span class="lineNum">    4253 </span>            :         FileIOCtx *ioctx;
<span class="lineNum">    4254 </span>            :         GF_FileIO *fio;
<span class="lineNum">    4255 </span><span class="lineCov">          8 :         char *sep = (char *) gf_url_colon_suffix(inargs);</span>
<span class="lineNum">    4256 </span><span class="lineCov">          8 :         *out_arg = NULL;</span>
<span class="lineNum">    4257 </span><span class="lineCov">          8 :         if (sep) sep[0] = 0;</span>
<span class="lineNum">    4258 </span>            : 
<span class="lineNum">    4259 </span><span class="lineCov">          8 :         GF_SAFEALLOC(ioctx, FileIOCtx);</span>
<span class="lineNum">    4260 </span><span class="lineCov">          8 :         if (!ioctx) return NULL;</span>
<span class="lineNum">    4261 </span><span class="lineCov">          8 :         ioctx-&gt;path = gf_strdup(inargs);</span>
<span class="lineNum">    4262 </span><span class="lineCov">          8 :         if (!ioctx-&gt;path) {</span>
<span class="lineNum">    4263 </span><span class="lineNoCov">          0 :                 gf_free(ioctx);</span>
<span class="lineNum">    4264 </span>            :                 return NULL;
<span class="lineNum">    4265 </span>            :         }
<span class="lineNum">    4266 </span><span class="lineCov">          8 :         if (sep) {</span>
<span class="lineNum">    4267 </span><span class="lineCov">          1 :                 sep[0] = ':';</span>
<span class="lineNum">    4268 </span><span class="lineCov">          1 :                 *out_arg = sep+1;</span>
<span class="lineNum">    4269 </span>            :         }
<span class="lineNum">    4270 </span><span class="lineCov">          8 :         fio = gf_fileio_new(ioctx-&gt;path, ioctx, fio_open, fio_seek, fio_read, fio_write, fio_tell, fio_eof, fio_printf);</span>
<span class="lineNum">    4271 </span><span class="lineCov">          8 :         if (!fio) {</span>
<span class="lineNum">    4272 </span><span class="lineNoCov">          0 :                 gf_free(ioctx-&gt;path);</span>
<span class="lineNum">    4273 </span><span class="lineNoCov">          0 :                 gf_free(ioctx);</span>
<span class="lineNum">    4274 </span><span class="lineNoCov">          0 :                 *e = GF_OUT_OF_MEM;</span>
<span class="lineNum">    4275 </span>            :                 return NULL;
<span class="lineNum">    4276 </span>            :         }
<span class="lineNum">    4277 </span><span class="lineCov">          8 :         if (!all_gfio_defined) {</span>
<span class="lineNum">    4278 </span><span class="lineCov">          4 :                 all_gfio_defined = gf_list_new();</span>
<span class="lineNum">    4279 </span><span class="lineCov">          4 :                 if (!all_gfio_defined) return NULL;</span>
<span class="lineNum">    4280 </span>            :         }
<span class="lineNum">    4281 </span><span class="lineCov">          8 :         gf_list_add(all_gfio_defined, fio);</span>
<span class="lineNum">    4282 </span>            :         //keep alive until end
<span class="lineNum">    4283 </span><span class="lineCov">          8 :         ioctx-&gt;nb_refs = 1;</span>
<span class="lineNum">    4284 </span><span class="lineCov">          8 :         return gf_fileio_url(fio);</span>
<a name="4285"><span class="lineNum">    4285 </span>            : }</a>
<span class="lineNum">    4286 </span>            : 
<span class="lineNum">    4287 </span><span class="lineCov">       1715 : static void cleanup_file_io()</span>
<span class="lineNum">    4288 </span>            : {
<span class="lineNum">    4289 </span><span class="lineCov">       1715 :         if (!all_gfio_defined) return;</span>
<span class="lineNum">    4290 </span><span class="lineCov">         12 :         while (gf_list_count(all_gfio_defined)) {</span>
<span class="lineNum">    4291 </span><span class="lineCov">          8 :                 GF_FileIO *gfio = gf_list_pop_back(all_gfio_defined);</span>
<span class="lineNum">    4292 </span><span class="lineCov">          8 :                 FileIOCtx *ioctx = gf_fileio_get_udta(gfio);</span>
<span class="lineNum">    4293 </span><span class="lineCov">          8 :                 gf_fileio_del(gfio);</span>
<span class="lineNum">    4294 </span>            : 
<span class="lineNum">    4295 </span><span class="lineCov">          8 :                 if (ioctx-&gt;filep) {</span>
<span class="lineNum">    4296 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Warning: file IO for %s still opened!\n&quot;, ioctx-&gt;path);</span>
<span class="lineNum">    4297 </span><span class="lineNoCov">          0 :                         gf_fclose(ioctx-&gt;filep);</span>
<span class="lineNum">    4298 </span>            :                 }
<span class="lineNum">    4299 </span><span class="lineCov">          8 :                 if (ioctx-&gt;path) gf_free(ioctx-&gt;path);</span>
<span class="lineNum">    4300 </span><span class="lineCov">          8 :                 gf_free(ioctx);</span>
<span class="lineNum">    4301 </span>            :         }
<span class="lineNum">    4302 </span><span class="lineCov">          4 :         gf_list_del(all_gfio_defined);</span>
<span class="lineNum">    4303 </span><span class="lineCov">          4 :         all_gfio_defined = NULL;</span>
<a name="4304"><span class="lineNum">    4304 </span>            : }</a>
<span class="lineNum">    4305 </span>            : 
<span class="lineNum">    4306 </span><span class="lineCov">          1 : static GF_Err cust_configure_pid(GF_Filter *filter, GF_FilterPid *pid, Bool is_remove)</span>
<span class="lineNum">    4307 </span>            : {
<span class="lineNum">    4308 </span>            :         GF_FilterEvent evt;
<span class="lineNum">    4309 </span><span class="lineCov">          1 :         if (is_remove) return GF_OK;</span>
<span class="lineNum">    4310 </span>            : 
<span class="lineNum">    4311 </span><span class="lineCov">          1 :         GF_FEVT_INIT(evt, GF_FEVT_PLAY, pid);</span>
<span class="lineNum">    4312 </span><span class="lineCov">          1 :         gf_filter_pid_send_event(pid, &amp;evt);</span>
<span class="lineNum">    4313 </span><span class="lineCov">          1 :         gf_filter_pid_set_framing_mode(pid, GF_TRUE);</span>
<a name="4314"><span class="lineNum">    4314 </span><span class="lineCov">          1 :         return GF_OK;</span></a>
<span class="lineNum">    4315 </span>            : }
<span class="lineNum">    4316 </span><span class="lineCov">        173 : static GF_Err cust_process(GF_Filter *filter)</span>
<span class="lineNum">    4317 </span>            : {
<span class="lineNum">    4318 </span>            :         u32 i;
<span class="lineNum">    4319 </span><span class="lineCov">        346 :         for (i=0; i&lt;gf_filter_get_ipid_count(filter); i++) {</span>
<span class="lineNum">    4320 </span><span class="lineCov">        173 :                 GF_FilterPid *pid = gf_filter_get_ipid(filter, i);</span>
<span class="lineNum">    4321 </span><span class="lineCov">        173 :                 const char *name = gf_filter_pid_get_name(pid);</span>
<span class="lineNum">    4322 </span><span class="lineCov">        173 :                 while (1) {</span>
<span class="lineNum">    4323 </span><span class="lineCov">        346 :                         GF_FilterPacket *pck = gf_filter_pid_get_packet(pid);</span>
<span class="lineNum">    4324 </span><span class="lineCov">        346 :                         if (!pck) break;</span>
<span class="lineNum">    4325 </span><span class="lineCov">        173 :                         fprintf(stderr, &quot;PID %s Got packet CTS &quot;LLU&quot;\n&quot;, name, gf_filter_pck_get_cts(pck));</span>
<span class="lineNum">    4326 </span><span class="lineCov">        173 :                         gf_filter_pid_drop_packet(pid);</span>
<span class="lineNum">    4327 </span>            :                 }
<span class="lineNum">    4328 </span>            :         }
<span class="lineNum">    4329 </span><span class="lineCov">        173 :         return GF_OK;</span>
<a name="4330"><span class="lineNum">    4330 </span>            : }</a>
<span class="lineNum">    4331 </span>            : 
<span class="lineNum">    4332 </span><span class="lineCov">          1 : static GF_Filter *load_custom_filter(GF_FilterSession *sess, char *opts, GF_Err *e)</span>
<span class="lineNum">    4333 </span>            : {
<span class="lineNum">    4334 </span><span class="lineCov">          1 :         GF_Filter *f = gf_fs_new_filter(sess, &quot;custom&quot;, e);</span>
<span class="lineNum">    4335 </span><span class="lineCov">          1 :         if (!f) return NULL;</span>
<span class="lineNum">    4336 </span>            : 
<span class="lineNum">    4337 </span><span class="lineCov">          1 :         *e = gf_filter_push_caps(f, GF_PROP_PID_STREAM_TYPE, &amp;PROP_UINT(GF_STREAM_VISUAL), NULL, GF_CAPS_INPUT, 0);</span>
<span class="lineNum">    4338 </span><span class="lineCov">          1 :         if (*e) return NULL;</span>
<span class="lineNum">    4339 </span><span class="lineCov">          1 :         *e = gf_filter_set_configure_ckb(f, cust_configure_pid);</span>
<span class="lineNum">    4340 </span><span class="lineCov">          1 :         if (*e) return NULL;</span>
<span class="lineNum">    4341 </span><span class="lineCov">          1 :         *e = gf_filter_set_process_ckb(f, cust_process);</span>
<span class="lineNum">    4342 </span><span class="lineCov">          1 :         if (*e) return NULL;</span>
<span class="lineNum">    4343 </span><span class="lineCov">          1 :         *e = gf_filter_set_process_event_ckb(f, NULL);</span>
<span class="lineNum">    4344 </span><span class="lineCov">          1 :         if (*e) return NULL;</span>
<span class="lineNum">    4345 </span><span class="lineCov">          1 :         *e = gf_filter_set_reconfigure_output_ckb(f, NULL);</span>
<span class="lineNum">    4346 </span><span class="lineCov">          1 :         if (*e) return NULL;</span>
<span class="lineNum">    4347 </span><span class="lineCov">          1 :         *e = gf_filter_set_probe_data_cbk(f, NULL);</span>
<span class="lineNum">    4348 </span><span class="lineCov">          1 :         if (*e) return NULL;</span>
<span class="lineNum">    4349 </span>            : 
<span class="lineNum">    4350 </span>            :         return f;
<span class="lineNum">    4351 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
