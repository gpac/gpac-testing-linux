<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - /home/travis/build/gpac/gpac/applications/mp4client/main.c</title>
  <link rel="stylesheet" type="text/css" href="../../../../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../../../../index.html">top level</a> - <a href="index.html">home/travis/build/gpac/gpac/applications/mp4client</a> - main.c<span style="font-size: 80%;"> (source / <a href="main.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">567</td>
            <td class="headerCovTableEntry">1334</td>
            <td class="headerCovTableEntryLo">42.5 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2021-04-29 23:48:07</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">21</td>
            <td class="headerCovTableEntry">24</td>
            <td class="headerCovTableEntryMed">87.5 %</td>
          </tr>
          <tr><td><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<span class="lineNum">       2 </span>            :  *                      GPAC - Multimedia Framework C SDK
<span class="lineNum">       3 </span>            :  *
<span class="lineNum">       4 </span>            :  *                      Authors: Jean Le Feuvre
<span class="lineNum">       5 </span>            :  *                      Copyright (c) Telecom ParisTech 2005-2020
<span class="lineNum">       6 </span>            :  *                                      All rights reserved
<span class="lineNum">       7 </span>            :  *
<span class="lineNum">       8 </span>            :  *  This file is part of GPAC / command-line client
<span class="lineNum">       9 </span>            :  *
<span class="lineNum">      10 </span>            :  *  GPAC is free software; you can redistribute it and/or modify
<span class="lineNum">      11 </span>            :  *  it under the terms of the GNU Lesser General Public License as published by
<span class="lineNum">      12 </span>            :  *  the Free Software Foundation; either version 2, or (at your option)
<span class="lineNum">      13 </span>            :  *  any later version.
<span class="lineNum">      14 </span>            :  *
<span class="lineNum">      15 </span>            :  *  GPAC is distributed in the hope that it will be useful,
<span class="lineNum">      16 </span>            :  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
<span class="lineNum">      17 </span>            :  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<span class="lineNum">      18 </span>            :  *  GNU Lesser General Public License for more details.
<span class="lineNum">      19 </span>            :  *
<span class="lineNum">      20 </span>            :  *  You should have received a copy of the GNU Lesser General Public
<span class="lineNum">      21 </span>            :  *  License along with this library; see the file COPYING.  If not, write to
<span class="lineNum">      22 </span>            :  *  the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
<span class="lineNum">      23 </span>            :  *
<span class="lineNum">      24 </span>            :  */
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            : 
<span class="lineNum">      27 </span>            : /*includes both terminal and od browser*/
<span class="lineNum">      28 </span>            : #include &lt;gpac/terminal.h&gt;
<span class="lineNum">      29 </span>            : #include &lt;gpac/term_info.h&gt;
<span class="lineNum">      30 </span>            : #include &lt;gpac/constants.h&gt;
<span class="lineNum">      31 </span>            : #include &lt;gpac/events.h&gt;
<span class="lineNum">      32 </span>            : #include &lt;gpac/media_tools.h&gt;
<span class="lineNum">      33 </span>            : #include &lt;gpac/options.h&gt;
<span class="lineNum">      34 </span>            : #include &lt;gpac/main.h&gt;
<span class="lineNum">      35 </span>            : 
<span class="lineNum">      36 </span>            : #include &lt;gpac/avparse.h&gt;
<span class="lineNum">      37 </span>            : #include &lt;gpac/network.h&gt;
<span class="lineNum">      38 </span>            : #include &lt;gpac/utf.h&gt;
<span class="lineNum">      39 </span>            : 
<span class="lineNum">      40 </span>            : /*ISO 639 languages*/
<span class="lineNum">      41 </span>            : #include &lt;gpac/iso639.h&gt;
<span class="lineNum">      42 </span>            : 
<span class="lineNum">      43 </span>            : 
<span class="lineNum">      44 </span>            : #ifndef WIN32
<span class="lineNum">      45 </span>            : #include &lt;dlfcn.h&gt;
<span class="lineNum">      46 </span>            : #include &lt;pwd.h&gt;
<span class="lineNum">      47 </span>            : #include &lt;unistd.h&gt;
<span class="lineNum">      48 </span>            : #if defined(__DARWIN__) || defined(__APPLE__)
<span class="lineNum">      49 </span>            : #include &lt;sys/types.h&gt;
<span class="lineNum">      50 </span>            : #include &lt;sys/stat.h&gt;
<span class="lineNum">      51 </span>            : 
<span class="lineNum">      52 </span>            : void carbon_init();
<span class="lineNum">      53 </span>            : void carbon_uninit();
<span class="lineNum">      54 </span>            : 
<span class="lineNum">      55 </span>            : #endif
<span class="lineNum">      56 </span>            : 
<span class="lineNum">      57 </span>            : #else
<span class="lineNum">      58 </span>            : #include &lt;windows.h&gt; /*for GetModuleFileName*/
<span class="lineNum">      59 </span>            : #endif  //WIN32
<span class="lineNum">      60 </span>            : 
<span class="lineNum">      61 </span>            : /*local prototypes*/
<span class="lineNum">      62 </span>            : static void PrintWorldInfo(GF_Terminal *term);
<span class="lineNum">      63 </span>            : static void ViewOD(GF_Terminal *term, u32 OD_ID, u32 number, const char *URL);
<span class="lineNum">      64 </span>            : static void PrintODList(GF_Terminal *term, GF_ObjectManager *root_odm, u32 num, u32 indent, char *root_name);
<span class="lineNum">      65 </span>            : 
<span class="lineNum">      66 </span>            : static void ViewODs(GF_Terminal *term, Bool show_timing);
<span class="lineNum">      67 </span>            : static void MakeScreenshot(Bool for_coverage);
<span class="lineNum">      68 </span>            : static void PrintAVInfo(Bool final);
<span class="lineNum">      69 </span>            : 
<span class="lineNum">      70 </span>            : static u32 gui_mode = 0;
<span class="lineNum">      71 </span>            : static int ret_val = 0;
<span class="lineNum">      72 </span>            : 
<span class="lineNum">      73 </span>            : static Bool restart = GF_FALSE;
<span class="lineNum">      74 </span>            : static Bool reload = GF_FALSE;
<span class="lineNum">      75 </span>            : Bool do_coverage = GF_FALSE;
<span class="lineNum">      76 </span>            : 
<span class="lineNum">      77 </span>            : Bool no_prog = 0;
<span class="lineNum">      78 </span>            : 
<span class="lineNum">      79 </span>            : static FILE *helpout = NULL;
<span class="lineNum">      80 </span>            : u32 help_flags = 0;
<span class="lineNum">      81 </span>            : 
<span class="lineNum">      82 </span>            : #if defined(__DARWIN__) || defined(__APPLE__)
<span class="lineNum">      83 </span>            : #define VK_MOD  GF_KEY_MOD_ALT
<span class="lineNum">      84 </span>            : #else
<span class="lineNum">      85 </span>            : #define VK_MOD  GF_KEY_MOD_CTRL
<span class="lineNum">      86 </span>            : #endif
<span class="lineNum">      87 </span>            : 
<span class="lineNum">      88 </span>            : static Bool no_audio = GF_FALSE;
<span class="lineNum">      89 </span>            : static u32 bench_mode = 0;
<span class="lineNum">      90 </span>            : static u32 bench_mode_start = 0;
<span class="lineNum">      91 </span>            : static u32 bench_buffer = 0;
<span class="lineNum">      92 </span>            : static Bool eos_seen = GF_FALSE;
<span class="lineNum">      93 </span>            : static Bool addon_visible = GF_TRUE;
<span class="lineNum">      94 </span>            : Bool is_connected = GF_FALSE;
<span class="lineNum">      95 </span>            : Bool startup_file = GF_FALSE;
<span class="lineNum">      96 </span>            : GF_User user;
<span class="lineNum">      97 </span>            : GF_Terminal *term;
<span class="lineNum">      98 </span>            : u64 Duration;
<span class="lineNum">      99 </span>            : GF_Err last_error = GF_OK;
<span class="lineNum">     100 </span>            : static Bool enable_add_ons = GF_TRUE;
<span class="lineNum">     101 </span>            : static Fixed playback_speed = FIX_ONE;
<span class="lineNum">     102 </span>            : 
<span class="lineNum">     103 </span>            : static s32 request_next_playlist_item = GF_FALSE;
<span class="lineNum">     104 </span>            : FILE *playlist = NULL;
<span class="lineNum">     105 </span>            : static Bool readonly_playlist = GF_FALSE;
<span class="lineNum">     106 </span>            : 
<span class="lineNum">     107 </span>            : static u32 display_rti = 0;
<span class="lineNum">     108 </span>            : static Bool Run;
<span class="lineNum">     109 </span>            : static Bool CanSeek = GF_FALSE;
<span class="lineNum">     110 </span>            : static char the_url[GF_MAX_PATH];
<span class="lineNum">     111 </span>            : static char pl_path[GF_MAX_PATH];
<span class="lineNum">     112 </span>            : static Bool no_mime_check = GF_TRUE;
<span class="lineNum">     113 </span>            : static u64 log_rti_time_start = 0;
<span class="lineNum">     114 </span>            : static Bool loop_at_end = GF_FALSE;
<span class="lineNum">     115 </span>            : static u32 forced_width=0;
<span class="lineNum">     116 </span>            : static u32 forced_height=0;
<span class="lineNum">     117 </span>            : 
<span class="lineNum">     118 </span>            : /*windowless options*/
<span class="lineNum">     119 </span>            : u32 align_mode = 0;
<span class="lineNum">     120 </span>            : u32 init_w = 0;
<span class="lineNum">     121 </span>            : u32 init_h = 0;
<span class="lineNum">     122 </span>            : u32 last_x, last_y;
<span class="lineNum">     123 </span>            : Bool right_down = GF_FALSE;
<span class="lineNum">     124 </span>            : 
<span class="lineNum">     125 </span>            : Float scale = 1;
<span class="lineNum">     126 </span>            : 
<span class="lineNum">     127 </span>            : static Bool shell_visible = GF_TRUE;
<span class="lineNum">     128 </span>            : #if defined(WIN32) &amp;&amp; !defined(_WIN32_WCE)
<span class="lineNum">     129 </span>            : 
<span class="lineNum">     130 </span>            : static HWND console_hwnd = NULL;
<span class="lineNum">     131 </span>            : static Bool owns_wnd = GF_FALSE;
<span class="lineNum">     132 </span>            : #include &lt;tlhelp32.h&gt;
<span class="lineNum">     133 </span>            : #include &lt;Psapi.h&gt;
<span class="lineNum">     134 </span>            : static DWORD getParentPID(DWORD pid)
<span class="lineNum">     135 </span>            : {
<span class="lineNum">     136 </span>            :         DWORD ppid = 0;
<span class="lineNum">     137 </span>            :         HANDLE h = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);
<span class="lineNum">     138 </span>            :         if (h) {
<span class="lineNum">     139 </span>            :                 PROCESSENTRY32 pe = { 0 };
<span class="lineNum">     140 </span>            :                 pe.dwSize = sizeof(PROCESSENTRY32);
<span class="lineNum">     141 </span>            :                 if (Process32First(h, &amp;pe)) {
<span class="lineNum">     142 </span>            :                         do {
<span class="lineNum">     143 </span>            :                                 if (pe.th32ProcessID == pid) {
<span class="lineNum">     144 </span>            :                                         ppid = pe.th32ParentProcessID;
<span class="lineNum">     145 </span>            :                                         break;
<span class="lineNum">     146 </span>            :                                 }
<span class="lineNum">     147 </span>            :                         } while (Process32Next(h, &amp;pe));
<span class="lineNum">     148 </span>            :                 }
<span class="lineNum">     149 </span>            :                 CloseHandle(h);
<span class="lineNum">     150 </span>            :         }
<span class="lineNum">     151 </span>            :         return (ppid);
<span class="lineNum">     152 </span>            : }
<span class="lineNum">     153 </span>            : 
<span class="lineNum">     154 </span>            : static void getProcessName(DWORD pid, PUCHAR fname, DWORD sz)
<span class="lineNum">     155 </span>            : {
<span class="lineNum">     156 </span>            :         HANDLE h = OpenProcess(PROCESS_QUERY_INFORMATION | PROCESS_VM_READ, FALSE, pid);
<span class="lineNum">     157 </span>            :         if (h) {
<span class="lineNum">     158 </span>            :                 GetModuleFileNameEx(h, NULL, fname, sz);
<span class="lineNum">     159 </span>            :                 CloseHandle(h);
<span class="lineNum">     160 </span>            :         }
<span class="lineNum">     161 </span>            : }
<span class="lineNum">     162 </span>            : static void w32_hide_shell(u32 cmd_type)
<span class="lineNum">     163 </span>            : {
<span class="lineNum">     164 </span>            :         typedef HWND (WINAPI *GetConsoleWindowT)(void);
<span class="lineNum">     165 </span>            :         HMODULE hk32 = GetModuleHandle(&quot;kernel32.dll&quot;);
<span class="lineNum">     166 </span>            :         if (!console_hwnd) {
<span class="lineNum">     167 </span>            :                 char parentName[GF_MAX_PATH];
<span class="lineNum">     168 </span>            :                 DWORD dwProcessId = 0;
<span class="lineNum">     169 </span>            :                 DWORD dwParentProcessId = 0;
<span class="lineNum">     170 </span>            :                 DWORD dwParentParentProcessId = 0;
<span class="lineNum">     171 </span>            :                 GetConsoleWindowT GetConsoleWindow = (GetConsoleWindowT)GetProcAddress(hk32, &quot;GetConsoleWindow&quot;);
<span class="lineNum">     172 </span>            :                 console_hwnd = GetConsoleWindow();
<span class="lineNum">     173 </span>            :                 dwProcessId = GetCurrentProcessId();
<span class="lineNum">     174 </span>            :                 dwParentProcessId = getParentPID(dwProcessId);
<span class="lineNum">     175 </span>            :                 if (dwParentProcessId)
<span class="lineNum">     176 </span>            :                                 dwParentParentProcessId = getParentPID(dwParentProcessId);
<span class="lineNum">     177 </span>            :                 //get parent process name, check for explorer
<span class="lineNum">     178 </span>            :                 parentName[0] = 0;
<span class="lineNum">     179 </span>            :                 getProcessName(dwParentProcessId, parentName, GF_MAX_PATH);
<span class="lineNum">     180 </span>            :                 if (strstr(parentName, &quot;explorer&quot;)) {
<span class="lineNum">     181 </span>            :                         owns_wnd = GF_TRUE;
<span class="lineNum">     182 </span>            :                 }
<span class="lineNum">     183 </span>            :                 //get parent parent process name, check for devenv (or any other ide name ...)
<span class="lineNum">     184 </span>            :                 else if (dwParentParentProcessId) {
<span class="lineNum">     185 </span>            :                         owns_wnd = GF_FALSE;
<span class="lineNum">     186 </span>            :                         parentName[0] = 0;
<span class="lineNum">     187 </span>            :                         getProcessName(dwParentParentProcessId, parentName, GF_MAX_PATH);
<span class="lineNum">     188 </span>            :                         if (strstr(parentName, &quot;devenv&quot;)) {
<span class="lineNum">     189 </span>            :                                 owns_wnd = GF_TRUE;
<span class="lineNum">     190 </span>            :                         }
<span class="lineNum">     191 </span>            :                 } else {
<span class="lineNum">     192 </span>            :                         owns_wnd = GF_FALSE;
<span class="lineNum">     193 </span>            :                 }
<span class="lineNum">     194 </span>            :         }
<span class="lineNum">     195 </span>            :         if (!owns_wnd || !console_hwnd) return;
<span class="lineNum">     196 </span>            : 
<span class="lineNum">     197 </span>            :         if (cmd_type==0) {
<span class="lineNum">     198 </span>            :                 ShowWindow(console_hwnd, SW_SHOW);
<span class="lineNum">     199 </span>            :                 shell_visible = GF_TRUE;
<span class="lineNum">     200 </span>            :         }
<span class="lineNum">     201 </span>            :         else if (cmd_type==1) {
<span class="lineNum">     202 </span>            :                 ShowWindow(console_hwnd, SW_HIDE);
<span class="lineNum">     203 </span>            :                 shell_visible = GF_FALSE;
<span class="lineNum">     204 </span>            :         }
<span class="lineNum">     205 </span>            :         else if (cmd_type == 2) {
<span class="lineNum">     206 </span>            :                 PostMessage(GetConsoleWindow(), WM_CLOSE, 0, 0);
<span class="lineNum">     207 </span>            :         }
<span class="lineNum">     208 </span>            : }
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span>            : #define hide_shell w32_hide_shell
<span class="lineNum">     211 </span>            : #else
<span class="lineNum">     212 </span>            : 
<span class="lineNum">     213 </span>            : #define hide_shell(_var)
<span class="lineNum">     214 </span>            : 
<span class="lineNum">     215 </span>            : #endif
<a name="216"><span class="lineNum">     216 </span>            : </a>
<span class="lineNum">     217 </span>            : 
<span class="lineNum">     218 </span><span class="lineCov">          2 : void send_open_url(const char *url)</span>
<span class="lineNum">     219 </span>            : {
<span class="lineNum">     220 </span>            :         GF_Event evt;
<span class="lineNum">     221 </span>            :         memset(&amp;evt, 0, sizeof(GF_Event));
<span class="lineNum">     222 </span><span class="lineCov">          2 :         evt.type = GF_EVENT_NAVIGATE;</span>
<span class="lineNum">     223 </span><span class="lineCov">          2 :         evt.navigate.to_url = url;</span>
<span class="lineNum">     224 </span><span class="lineCov">          2 :         gf_term_send_event(term, &amp;evt);</span>
<span class="lineNum">     225 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">     226 </span>            : 
<span class="lineNum">     227 </span>            : GF_GPACArg mp4client_args[] =
<span class="lineNum">     228 </span>            : {
<span class="lineNum">     229 </span>            : #ifdef GPAC_MEMORY_TRACKING
<span class="lineNum">     230 </span>            :         GF_DEF_ARG(&quot;mem-track&quot;, NULL, &quot;enable memory tracker&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     231 </span>            :         GF_DEF_ARG(&quot;mem-track-stack&quot;, NULL, &quot;enable memory tracker with stack dumping&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     232 </span>            : #endif
<span class="lineNum">     233 </span>            :          GF_DEF_ARG(&quot;rti&quot;, NULL, &quot;log run-time info (FPS, CPU, Mem usage) to given file&quot;, NULL, NULL, GF_ARG_STRING, GF_ARG_HINT_EXPERT),
<span class="lineNum">     234 </span>            :          GF_DEF_ARG(&quot;rtix&quot;, NULL, &quot;same as -rti but driven by GPAC logs&quot;, NULL, NULL, GF_ARG_STRING, GF_ARG_HINT_EXPERT),
<span class="lineNum">     235 </span>            :          GF_DEF_ARG(&quot;size&quot;, NULL, &quot;specify visual size WxH. If not set, scene size or video size is used&quot;, NULL, NULL, GF_ARG_STRING, GF_ARG_HINT_ADVANCED),
<span class="lineNum">     236 </span>            :          GF_DEF_ARG(&quot;rti-refresh&quot;, NULL, &quot;set refresh time in ms between two runt-time counters queries (default is 200)&quot;, NULL, NULL, GF_ARG_INT, 0),
<span class="lineNum">     237 </span>            : 
<span class="lineNum">     238 </span>            :         GF_DEF_ARG(&quot;no-thread&quot;, NULL, &quot;disable thread usage (except for depending on driver audio)&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     239 </span>            :         GF_DEF_ARG(&quot;no-audio&quot;, NULL, &quot;disable audio&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_ADVANCED),
<span class="lineNum">     240 </span>            : 
<span class="lineNum">     241 </span>            : #ifdef GPAC_CONFIG_WIN32
<span class="lineNum">     242 </span>            :         GF_DEF_ARG(&quot;no-wnd&quot;, NULL, &quot;use windowless mode (Win32 only)&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERIMENTAL),
<span class="lineNum">     243 </span>            :         GF_DEF_ARG(&quot;no-back&quot;, NULL, &quot;use transparent background for output window when no background is specified (Win32 only)&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERIMENTAL),
<span class="lineNum">     244 </span>            :         GF_DEF_ARG(&quot;align&quot;, NULL, &quot;specify v and h alignment for windowless mode\n&quot;
<span class="lineNum">     245 </span>            :         &quot;- tl: top/left\n&quot;
<span class="lineNum">     246 </span>            :         &quot;- tm: top/horizontal middle\n&quot;
<span class="lineNum">     247 </span>            :         &quot;- tr: top/right\n&quot;
<span class="lineNum">     248 </span>            :         &quot;- ml: vertical middle/left\n&quot;
<span class="lineNum">     249 </span>            :         &quot;- mm: vertical middle/horizontal middle\n&quot;
<span class="lineNum">     250 </span>            :         &quot;- mr: vertical middle/right\n&quot;
<span class="lineNum">     251 </span>            :         &quot;- bl: bottom/left\n&quot;
<span class="lineNum">     252 </span>            :         &quot;- bm: bottom/horizontal middle\n&quot;
<span class="lineNum">     253 </span>            :         &quot;- br: bottom/right&quot;, &quot;tl&quot;, &quot;tl|tm|tr|ml|mm|mr|bl|bm|br&quot;, GF_ARG_INT, GF_ARG_HINT_EXPERIMENTAL),
<span class="lineNum">     254 </span>            : #endif // GPAC_CONFIG_WIN32
<span class="lineNum">     255 </span>            : 
<span class="lineNum">     256 </span>            :         GF_DEF_ARG(&quot;pause&quot;, NULL, &quot;pause at first frame&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_ADVANCED),
<span class="lineNum">     257 </span>            :         GF_DEF_ARG(&quot;play-from&quot;, NULL, &quot;start playback from given time in seconds in media&quot;, NULL, NULL, GF_ARG_DOUBLE, 0),
<span class="lineNum">     258 </span>            :         GF_DEF_ARG(&quot;speed&quot;, NULL, &quot;start playback wit given speed&quot;, NULL, NULL, GF_ARG_DOUBLE, 0),
<span class="lineNum">     259 </span>            :         GF_DEF_ARG(&quot;loop&quot;, NULL, &quot;loop playback&quot;, NULL, NULL, GF_ARG_BOOL, 0),
<span class="lineNum">     260 </span>            :         GF_DEF_ARG(&quot;fs&quot;, NULL, &quot;start in fullscreen mode&quot;, NULL, NULL, GF_ARG_BOOL, 0),
<span class="lineNum">     261 </span>            :         GF_DEF_ARG(&quot;exit&quot;, NULL, &quot;exit when presentation is over&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_ADVANCED),
<span class="lineNum">     262 </span>            :         GF_DEF_ARG(&quot;run-for&quot;, NULL, &quot;run for indicated time in seconds and exits&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_ADVANCED),
<span class="lineNum">     263 </span>            :         GF_DEF_ARG(&quot;service&quot;, NULL, &quot;auto-tune to given service ID in a multiplex&quot;, NULL, NULL, GF_ARG_INT, GF_ARG_HINT_ADVANCED),
<span class="lineNum">     264 </span>            :         GF_DEF_ARG(&quot;no-save&quot;, NULL, &quot;do not save configuration file on exit&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     265 </span>            :         GF_DEF_ARG(&quot;no-addon&quot;, NULL, &quot;disable automatic loading of media addons declared in source URL&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     266 </span>            :         GF_DEF_ARG(&quot;gui&quot;, NULL, &quot;start in GUI mode. The GUI is indicated in the [configuration](core_config) file __[General]StartupFile__&quot;, NULL, NULL, GF_ARG_BOOL, 0),
<span class="lineNum">     267 </span>            :         GF_DEF_ARG(&quot;p&quot;, NULL, &quot;use indicated profile for the global GPAC config. If not found, config file is created. If a file path is indicated, this will load profile from that file. Otherwise, this will create a directory of the specified name and store new config there. Reserved name `0` means a new profile, not stored to disk. Works using -p=NAME or -p NAME&quot;, NULL, NULL, GF_ARG_STRING, GF_ARG_HINT_ADVANCED),
<span class="lineNum">     268 </span>            :         GF_DEF_ARG(&quot;stats&quot;, NULL, &quot;dump filter session stats after playback&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     269 </span>            :         GF_DEF_ARG(&quot;graph&quot;, NULL, &quot;dump filter session graph after playback&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_EXPERT),
<span class="lineNum">     270 </span>            :         GF_DEF_ARG(&quot;nk&quot;, NULL, &quot;disable keyboard interaction&quot;, NULL, NULL, GF_ARG_BOOL, GF_ARG_HINT_ADVANCED),
<span class="lineNum">     271 </span>            :         GF_DEF_ARG(&quot;h&quot;, &quot;help&quot;, &quot;show this help. Use `-hx` to show expert help&quot;, NULL, NULL, GF_ARG_BOOL, 0),
<span class="lineNum">     272 </span>            :         GF_DEF_ARG(&quot;hc&quot;, NULL, &quot;show libgpac core options&quot;, NULL, NULL, GF_ARG_BOOL, 0),
<span class="lineNum">     273 </span>            :         GF_DEF_ARG(&quot;hr&quot;, NULL, &quot;show runtime options when keybard interaction is enabled&quot;, NULL, NULL, GF_ARG_BOOL, 0),
<span class="lineNum">     274 </span>            :         {0}
<span class="lineNum">     275 </span>            : };
<a name="276"><span class="lineNum">     276 </span>            : </a>
<span class="lineNum">     277 </span>            : 
<span class="lineNum">     278 </span><span class="lineCov">          4 : void PrintUsage(Bool show_all)</span>
<span class="lineNum">     279 </span>            : {
<span class="lineNum">     280 </span>            :         u32 i=0;
<span class="lineNum">     281 </span>            : 
<span class="lineNum">     282 </span><span class="lineCov">          4 :         if (help_flags &amp; GF_PRINTARG_MAN) {</span>
<span class="lineNum">     283 </span><span class="lineCov">          1 :                 fprintf(helpout, &quot;.SH \&quot;DESCRIPTION\&quot;\n.LP\nMP4Client is GPAC command-line media player. It supports all GPAC playback features (2D and 3D support, local playback, RTP streaming, HTTP faststart, many audio and video codecs ...).\n.br\nSpecific URLs shortcuts are available, see gpac -h compositor\n.\n.\n.SH OPTIONS\n&quot;);</span>
<span class="lineNum">     284 </span>            :         } else {
<span class="lineNum">     285 </span><span class="lineCov">          6 :                 gf_sys_format_help(helpout, help_flags, &quot;Usage: MP4Client [options] [filename]\n&quot;</span>
<span class="lineNum">     286 </span>            :                         &quot;# General\n&quot;
<span class="lineNum">     287 </span>            :                         &quot;The player accepts any URL supported by GPAC.\n&quot;
<span class="lineNum">     288 </span>            :                         &quot;Specific URLs shortcuts are available, see [GPAC Compositor (gpac -h compositor)](compositor)\n&quot;
<span class="lineNum">     289 </span>            :                         &quot;Version: %s\n&quot;
<span class="lineNum">     290 </span>            :                         &quot;%s\n&quot;
<span class="lineNum">     291 </span>            :                         &quot;For more info on GPAC configuration, use `gpac ` [-h](GPAC) `bin`  \n  \n&quot;
<span class="lineNum">     292 </span>            :                         &quot;# Options  \n  \n&quot;,
<span class="lineNum">     293 </span><span class="lineCov">          3 :                         (help_flags == GF_PRINTARG_MD) ? GPAC_VERSION : gf_gpac_version(),</span>
<span class="lineNum">     294 </span>            :                         gf_gpac_copyright_cite()
<span class="lineNum">     295 </span>            :                 );
<span class="lineNum">     296 </span>            :         }
<span class="lineNum">     297 </span>            : 
<span class="lineNum">     298 </span><span class="lineCov">        108 :         while (mp4client_args[i].name) {</span>
<span class="lineNum">     299 </span><span class="lineCov">        104 :                 GF_GPACArg *arg = &amp;mp4client_args[i];</span>
<span class="lineNum">     300 </span><span class="lineCov">        104 :                 i++;</span>
<span class="lineNum">     301 </span><span class="lineCov">        104 :                 if (!show_all &amp;&amp; (arg-&gt;flags &amp; (GF_ARG_HINT_EXPERIMENTAL|GF_ARG_HINT_EXPERT) ))</span>
<span class="lineNum">     302 </span><span class="lineCov">         18 :                         continue;</span>
<span class="lineNum">     303 </span><span class="lineCov">         86 :                 gf_sys_print_arg(helpout, help_flags, arg, &quot;mp4client&quot;);</span>
<span class="lineNum">     304 </span>            :         }
<span class="lineNum">     305 </span><span class="lineCov">          4 : }</span>
<span class="lineNum">     306 </span>            : 
<span class="lineNum">     307 </span>            : typedef enum
<span class="lineNum">     308 </span>            : {
<span class="lineNum">     309 </span>            :         MP4C_QUIT = 0,
<span class="lineNum">     310 </span>            :         MP4C_KILL,
<span class="lineNum">     311 </span>            :         MP4C_RELOAD,
<span class="lineNum">     312 </span>            :         MP4C_OPEN,
<span class="lineNum">     313 </span>            :         MP4C_OPEN_PL,
<span class="lineNum">     314 </span>            :         MP4C_PL_NEXT,
<span class="lineNum">     315 </span>            :         MP4C_PL_JUMP,
<span class="lineNum">     316 </span>            :         MP4C_DISCONNECT,
<span class="lineNum">     317 </span>            :         MP4C_SELECT,
<span class="lineNum">     318 </span>            :         MP4C_PAUSE_RESUME,
<span class="lineNum">     319 </span>            :         MP4C_STEP,
<span class="lineNum">     320 </span>            :         MP4C_SEEK,
<span class="lineNum">     321 </span>            :         MP4C_SEEK_TIME,
<span class="lineNum">     322 </span>            :         MP4C_TIME,
<span class="lineNum">     323 </span>            :         MP4C_UPDATE,
<span class="lineNum">     324 </span>            :         MP4C_EVALJS,
<span class="lineNum">     325 </span>            :         MP4C_SCREENSHOT,
<span class="lineNum">     326 </span>            :         MP4C_WORLDINFO,
<span class="lineNum">     327 </span>            :         MP4C_ODLIST,
<span class="lineNum">     328 </span>            :         MP4C_ODINFO_ID,
<span class="lineNum">     329 </span>            :         MP4C_ODINFO_NUM,
<span class="lineNum">     330 </span>            :         MP4C_ODTIME,
<span class="lineNum">     331 </span>            :         MP4C_ODBUF,
<span class="lineNum">     332 </span>            :         MP4C_DUMPSCENE,
<span class="lineNum">     333 </span>            :         MP4C_STRESSMODE,
<span class="lineNum">     334 </span>            :         MP4C_NAVMODE,
<span class="lineNum">     335 </span>            :         MP4C_LASTVP,
<span class="lineNum">     336 </span>            :         MP4C_OGL2D,
<span class="lineNum">     337 </span>            :         MP4C_AR_4_3,
<span class="lineNum">     338 </span>            :         MP4C_AR_16_9,
<span class="lineNum">     339 </span>            :         MP4C_AR_NONE,
<span class="lineNum">     340 </span>            :         MP4C_AR_ORIG,
<span class="lineNum">     341 </span>            :         MP4C_LOGS,
<span class="lineNum">     342 </span>            :         MP4C_RELOAD_OPTS,
<span class="lineNum">     343 </span>            :         MP4C_DISP_RTI,
<span class="lineNum">     344 </span>            :         MP4C_DISP_FPS,
<span class="lineNum">     345 </span>            :         MP4C_DISP_STATS,
<span class="lineNum">     346 </span>            :         MP4C_DISP_GRAPH,
<span class="lineNum">     347 </span>            :         MP4C_HELP,
<span class="lineNum">     348 </span>            :         MP4C_DOWNRATE,
<span class="lineNum">     349 </span>            :         MP4C_VMEM_CACHE,
<span class="lineNum">     350 </span>            : 
<span class="lineNum">     351 </span>            : } MP4C_Command;
<span class="lineNum">     352 </span>            : 
<span class="lineNum">     353 </span>            : struct _mp4c_key
<span class="lineNum">     354 </span>            : {
<span class="lineNum">     355 </span>            :  u8 char_code;
<span class="lineNum">     356 </span>            :  MP4C_Command cmd_type;
<span class="lineNum">     357 </span>            :  const char *cmd_help;
<span class="lineNum">     358 </span>            :  u32 flags;
<span class="lineNum">     359 </span>            : } MP4C_Keys[] = {
<span class="lineNum">     360 </span>            :         {'q', MP4C_QUIT, &quot;quit&quot;, 0},
<span class="lineNum">     361 </span>            :         {'X', MP4C_KILL, &quot;kill&quot;, 0},
<span class="lineNum">     362 </span>            :         {'r', MP4C_KILL, &quot;reload current presentation&quot;, 0},
<span class="lineNum">     363 </span>            :         {'o', MP4C_OPEN, &quot;connect to the specified URL&quot;, 0},
<span class="lineNum">     364 </span>            :         {'O', MP4C_OPEN_PL, &quot;connect to the specified playlist&quot;, 0},
<span class="lineNum">     365 </span>            :         {'N', MP4C_PL_NEXT, &quot;switch to the next URL in the playlist. Also works with `\\n`&quot;, 0},
<span class="lineNum">     366 </span>            :         {'P', MP4C_PL_JUMP, &quot;jump to a given number ahead in the playlist&quot;, 0},
<span class="lineNum">     367 </span>            :         {'D', MP4C_DISCONNECT, &quot;disconnect the current presentation&quot;, 0},
<span class="lineNum">     368 </span>            :         {'G', MP4C_SELECT, &quot;select object or service ID&quot;, 0},
<span class="lineNum">     369 </span>            :         {'p', MP4C_PAUSE_RESUME, &quot;play/pause the presentation&quot;, 0},
<span class="lineNum">     370 </span>            :         {'s', MP4C_STEP, &quot;step one frame ahead&quot;, 0},
<span class="lineNum">     371 </span>            :         {'z', MP4C_SEEK, &quot;seek into presentation by percentage&quot;, 0},
<span class="lineNum">     372 </span>            :         {'T', MP4C_SEEK_TIME, &quot;seek into presentation by time&quot;, 0},
<span class="lineNum">     373 </span>            :         {'t', MP4C_TIME, &quot;print current timing&quot;, 0},
<span class="lineNum">     374 </span>            :         {'u', MP4C_UPDATE, &quot;send a command (BIFS or LASeR) to the main scene&quot;, 0},
<span class="lineNum">     375 </span>            :         {'e', MP4C_EVALJS, &quot;evaluate JavaScript code in the main scene&quot;, 0},
<span class="lineNum">     376 </span>            :         {'Z', MP4C_SCREENSHOT, &quot;dump current output frame to PNG&quot;, 0},
<span class="lineNum">     377 </span>            :         {'w', MP4C_WORLDINFO, &quot;view world info&quot;, 0},
<span class="lineNum">     378 </span>            :         { 'v', MP4C_ODLIST, &quot;view list of active media objects in scene&quot;, 0},
<span class="lineNum">     379 </span>            :         { 'i', MP4C_ODINFO_ID, &quot;view Object Descriptor info (by ID)&quot;, 0},
<span class="lineNum">     380 </span>            :         { 'j', MP4C_ODINFO_NUM, &quot;view Object Descriptor info (by number)&quot;, 0},
<span class="lineNum">     381 </span>            :         { 'b', MP4C_ODTIME, &quot;view media objects timing and buffering info&quot;, 0},
<span class="lineNum">     382 </span>            :         { 'm', MP4C_ODBUF, &quot;view media objects buffering and memory info&quot;, 0},
<span class="lineNum">     383 </span>            :         { 'd', MP4C_DUMPSCENE, &quot;dump scene graph&quot;, 0},
<span class="lineNum">     384 </span>            :         { 'k', MP4C_STRESSMODE, &quot;turn stress mode on/off&quot;, 0},
<span class="lineNum">     385 </span>            :         { 'n', MP4C_NAVMODE, &quot;change navigation mode&quot;, 0},
<span class="lineNum">     386 </span>            :         { 'x', MP4C_LASTVP, &quot;reset to last active viewpoint&quot;, 0},
<span class="lineNum">     387 </span>            :         { '3', MP4C_OGL2D, &quot;switch OpenGL on or off for 2D scenes&quot;, 0},
<span class="lineNum">     388 </span>            :         { '4', MP4C_AR_4_3, &quot;force 4/3 Aspect Ratio&quot;, 0},
<span class="lineNum">     389 </span>            :         { '5', MP4C_AR_16_9, &quot;force 16/9 Aspect Ratio&quot;, 0},
<span class="lineNum">     390 </span>            :         { '6', MP4C_AR_NONE, &quot;force no Aspect Ratio (always fill screen)&quot;, 0},
<span class="lineNum">     391 </span>            :         { '7', MP4C_AR_ORIG, &quot;force original Aspect Ratio (default)&quot;, 0},
<span class="lineNum">     392 </span>            :         { 'H', MP4C_DOWNRATE, &quot;set HTTP max download rate&quot;, 0},
<span class="lineNum">     393 </span>            :         { 'E', MP4C_RELOAD_OPTS, &quot;force reload of compositor options&quot;, 0},
<span class="lineNum">     394 </span>            : 
<span class="lineNum">     395 </span>            :         { 'L', MP4C_LOGS, &quot;change to new log tool/level. CF MP4Client usage for possible values&quot;, 0},
<span class="lineNum">     396 </span>            :         { 'R', MP4C_DISP_RTI, &quot;toggle run-time info display in window title bar on/off&quot;, 0},
<span class="lineNum">     397 </span>            :         { 'F', MP4C_DISP_FPS, &quot;toggle displaying of FPS in stderr on/off&quot;, 0},
<span class="lineNum">     398 </span>            :         { 'f', MP4C_DISP_STATS, &quot;print filter session stats&quot;, 0},
<span class="lineNum">     399 </span>            :         { 'g', MP4C_DISP_GRAPH, &quot;print filter session graph&quot;, 0},
<span class="lineNum">     400 </span>            : 
<span class="lineNum">     401 </span>            :         { 'h', MP4C_HELP, &quot;print this message&quot;, 0},
<span class="lineNum">     402 </span>            :         //below this, only experimental features
<span class="lineNum">     403 </span>            :         { 'M', MP4C_VMEM_CACHE, &quot;specify video cache memory for 2D objects&quot;, 1},
<span class="lineNum">     404 </span>            :         {0}
<a name="405"><span class="lineNum">     405 </span>            : };</a>
<span class="lineNum">     406 </span>            : 
<span class="lineNum">     407 </span><span class="lineNoCov">          0 : MP4C_Command get_cmd(u8 char_code)</span>
<span class="lineNum">     408 </span>            : {
<span class="lineNum">     409 </span>            :         u32 i=0;
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :         while (MP4C_Keys[i].char_code) {</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :                 if (MP4C_Keys[i].char_code == char_code)</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :                         return MP4C_Keys[i].cmd_type;</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :                 i++;</span>
<span class="lineNum">     414 </span>            :         }
<span class="lineNum">     415 </span>            :         return 0;
<a name="416"><span class="lineNum">     416 </span>            : }</a>
<span class="lineNum">     417 </span>            : 
<span class="lineNum">     418 </span><span class="lineCov">          4 : void PrintHelp()</span>
<span class="lineNum">     419 </span>            : {
<span class="lineNum">     420 </span>            :         u32 i=0;
<span class="lineNum">     421 </span>            : 
<span class="lineNum">     422 </span><span class="lineCov">          4 :         gf_sys_format_help(helpout, help_flags, &quot;# MP4Client runtime commands\n&quot;</span>
<span class="lineNum">     423 </span>            :                 &quot;## Prompt Interaction\n&quot;
<span class="lineNum">     424 </span>            :                 &quot;The following keys are used for prompt interaction:\n&quot;);
<span class="lineNum">     425 </span>            : 
<span class="lineNum">     426 </span><span class="lineCov">        172 :         while (MP4C_Keys[i].char_code) {</span>
<span class="lineNum">     427 </span>            :                 struct _mp4c_key *k = &amp;MP4C_Keys[i];
<span class="lineNum">     428 </span><span class="lineCov">        164 :                 i++;</span>
<span class="lineNum">     429 </span><span class="lineCov">        164 :                 gf_sys_format_help(helpout, help_flags|GF_PRINTARG_HIGHLIGHT_FIRST, &quot;%c: %s%s\n&quot;, k-&gt;char_code, k-&gt;cmd_help, k-&gt;flags ? &quot; **! experimental !**&quot; : &quot;&quot;);</span>
<span class="lineNum">     430 </span>            :         }
<span class="lineNum">     431 </span>            : 
<span class="lineNum">     432 </span><span class="lineCov">          4 :         gf_sys_format_help(helpout, help_flags, &quot;\n&quot;</span>
<span class="lineNum">     433 </span>            :                 &quot;## Content interaction\n&quot;
<span class="lineNum">     434 </span>            :                 &quot;It is possible to interact with content (interactive or not) using mouse and keyboard.\n&quot;
<span class="lineNum">     435 </span>            :                 &quot;The following commands are available:\n&quot;
<span class="lineNum">     436 </span>            :                 &quot;TODO\n&quot;
<span class="lineNum">     437 </span>            :                 &quot;\n&quot;
<span class="lineNum">     438 </span>            :         );
<span class="lineNum">     439 </span><span class="lineCov">          4 : }</span>
<a name="440"><span class="lineNum">     440 </span>            : </a>
<span class="lineNum">     441 </span>            : 
<span class="lineNum">     442 </span><span class="lineCov">          2 : static void PrintTime(u64 time)</span>
<span class="lineNum">     443 </span>            : {
<span class="lineNum">     444 </span>            :         u32 ms, h, m, s;
<span class="lineNum">     445 </span><span class="lineCov">          2 :         h = (u32) (time / 1000 / 3600);</span>
<span class="lineNum">     446 </span><span class="lineCov">          2 :         m = (u32) (time / 1000 / 60 - h*60);</span>
<span class="lineNum">     447 </span><span class="lineCov">          2 :         s = (u32) (time / 1000 - h*3600 - m*60);</span>
<span class="lineNum">     448 </span><span class="lineCov">          2 :         ms = (u32) (time - (h*3600 + m*60 + s) * 1000);</span>
<span class="lineNum">     449 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;%02d:%02d:%02d.%03d&quot;, h, m, s, ms);</span>
<span class="lineNum">     450 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">     451 </span>            : 
<span class="lineNum">     452 </span>            : 
<span class="lineNum">     453 </span>            : static u32 rti_update_time_ms = 200;
<a name="454"><span class="lineNum">     454 </span>            : static FILE *rti_logs = NULL;</a>
<span class="lineNum">     455 </span>            : 
<span class="lineNum">     456 </span><span class="lineCov">        404 : static void UpdateRTInfo(const char *legend)</span>
<span class="lineNum">     457 </span>            : {
<span class="lineNum">     458 </span>            :         GF_SystemRTInfo rti;
<span class="lineNum">     459 </span>            : 
<span class="lineNum">     460 </span>            :         /*refresh every second*/
<span class="lineNum">     461 </span><span class="lineCov">        808 :         if (!Run) return;</span>
<span class="lineNum">     462 </span><span class="lineCov">        404 :         if (!display_rti &amp;&amp; !rti_logs) return;</span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :         if (!gf_sys_get_rti(rti_update_time_ms, &amp;rti, 0) &amp;&amp; !legend)</span>
<span class="lineNum">     464 </span>            :                 return;
<span class="lineNum">     465 </span>            : 
<span class="lineNum">     466 </span><span class="lineNoCov">          0 :         if (display_rti) {</span>
<span class="lineNum">     467 </span>            :                 char szMsg[1024];
<span class="lineNum">     468 </span>            : 
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :                 if (rti.total_cpu_usage &amp;&amp; (bench_mode&lt;2) ) {</span>
<span class="lineNum">     470 </span><span class="lineNoCov">          0 :                         sprintf(szMsg, &quot;FPS %02.02f CPU %2d (%02d) Mem %d kB&quot;,</span>
<span class="lineNum">     471 </span><span class="lineNoCov">          0 :                                 gf_term_get_framerate(term, 0), rti.total_cpu_usage, rti.process_cpu_usage, (u32) (rti.gpac_memory / 1024));</span>
<span class="lineNum">     472 </span>            :                 } else {
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :                         sprintf(szMsg, &quot;FPS %02.02f CPU %02d Mem %d kB&quot;,</span>
<span class="lineNum">     474 </span><span class="lineNoCov">          0 :                                 gf_term_get_framerate(term, 0), rti.process_cpu_usage, (u32) (rti.gpac_memory / 1024) );</span>
<span class="lineNum">     475 </span>            :                 }
<span class="lineNum">     476 </span>            : 
<span class="lineNum">     477 </span><span class="lineNoCov">          0 :                 if (display_rti==2) {</span>
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :                         if (bench_mode&gt;=2) {</span>
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :                                 PrintAVInfo(GF_FALSE);</span>
<span class="lineNum">     480 </span>            :                         }
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;%s\r&quot;, szMsg);</span>
<span class="lineNum">     482 </span>            :                 } else {
<span class="lineNum">     483 </span>            :                         GF_Event evt;
<span class="lineNum">     484 </span><span class="lineNoCov">          0 :                         evt.type = GF_EVENT_SET_CAPTION;</span>
<span class="lineNum">     485 </span><span class="lineNoCov">          0 :                         evt.caption.caption = szMsg;</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :                         gf_term_user_event(term, &amp;evt);</span>
<span class="lineNum">     487 </span>            :                 }
<span class="lineNum">     488 </span>            :         }
<span class="lineNum">     489 </span><span class="lineNoCov">          0 :         if (rti_logs) {</span>
<span class="lineNum">     490 </span><span class="lineNoCov">          0 :                 fprintf(rti_logs, &quot;% 8d\t% 8d\t% 8d\t% 4d\t% 8d\t%s&quot;,</span>
<span class="lineNum">     491 </span>            :                         gf_sys_clock(),
<span class="lineNum">     492 </span>            :                         gf_term_get_time_in_ms(term),
<span class="lineNum">     493 </span>            :                         rti.total_cpu_usage,
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :                         (u32) gf_term_get_framerate(term, 0),</span>
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :                         (u32) (rti.gpac_memory / 1024),</span>
<span class="lineNum">     496 </span>            :                         legend ? legend : &quot;&quot;
<span class="lineNum">     497 </span>            :                        );
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :                 if (!legend) fprintf(rti_logs, &quot;\n&quot;);</span>
<span class="lineNum">     499 </span>            :         }
<span class="lineNum">     500 </span>            : }
<span class="lineNum">     501 </span>            : 
<span class="lineNum">     502 </span>            : #include &lt;gpac/revision.h&gt;
<a name="503"><span class="lineNum">     503 </span>            : #define MP4CLIENT_CAPTION       &quot;GPAC MP4Client &quot;GPAC_VERSION &quot;-rev&quot; GPAC_GIT_REVISION</a>
<span class="lineNum">     504 </span>            : 
<span class="lineNum">     505 </span><span class="lineCov">         16 : static void ResetCaption()</span>
<span class="lineNum">     506 </span>            : {
<span class="lineNum">     507 </span>            :         GF_Event event;
<span class="lineNum">     508 </span><span class="lineCov">         20 :         if (display_rti) return;</span>
<span class="lineNum">     509 </span><span class="lineCov">         12 :         event.type = GF_EVENT_SET_CAPTION;</span>
<span class="lineNum">     510 </span><span class="lineCov">         12 :         event.caption.caption = NULL;</span>
<span class="lineNum">     511 </span>            : 
<span class="lineNum">     512 </span><span class="lineCov">         12 :         if (is_connected) {</span>
<span class="lineNum">     513 </span>            :                 char szName[1024];
<span class="lineNum">     514 </span>            :                 GF_TermURLInfo urli;
<span class="lineNum">     515 </span>            : 
<span class="lineNum">     516 </span>            :                 /*get any service info*/
<span class="lineNum">     517 </span><span class="lineCov">          6 :                 if (!startup_file &amp;&amp; gf_term_get_service_info(term, gf_term_get_root_object(term), &amp;urli) == GF_OK) {</span>
<span class="lineNum">     518 </span>            :                         strcpy(szName, &quot;&quot;);
<span class="lineNum">     519 </span><span class="lineCov">          4 :                         if (urli.track_num) {</span>
<span class="lineNum">     520 </span>            :                                 char szBuf[10];
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :                                 sprintf(szBuf, &quot;%02d &quot;, (u32) urli.track_num );</span>
<span class="lineNum">     522 </span>            :                                 strcat(szName, szBuf);
<span class="lineNum">     523 </span>            :                         }
<span class="lineNum">     524 </span><span class="lineCov">          4 :                         if (urli.artist) {</span>
<span class="lineNum">     525 </span>            :                                 strcat(szName, urli.artist);
<span class="lineNum">     526 </span>            :                                 strcat(szName, &quot; &quot;);
<span class="lineNum">     527 </span>            :                         }
<span class="lineNum">     528 </span><span class="lineCov">          4 :                         if (urli.name) {</span>
<span class="lineNum">     529 </span>            :                                 strcat(szName, urli.name);
<span class="lineNum">     530 </span>            :                                 strcat(szName, &quot; &quot;);
<span class="lineNum">     531 </span>            :                         }
<span class="lineNum">     532 </span><span class="lineCov">          4 :                         if (urli.album) {</span>
<span class="lineNum">     533 </span>            :                                 strcat(szName, &quot;(&quot;);
<span class="lineNum">     534 </span>            :                                 strcat(szName, urli.album);
<span class="lineNum">     535 </span>            :                                 strcat(szName, &quot;)&quot;);
<span class="lineNum">     536 </span>            :                         }
<span class="lineNum">     537 </span><span class="lineCov">          4 :                         if (urli.provider) {</span>
<span class="lineNum">     538 </span>            :                                 strcat(szName, &quot;(&quot;);
<span class="lineNum">     539 </span>            :                                 strcat(szName, urli.provider);
<span class="lineNum">     540 </span>            :                                 strcat(szName, &quot;)&quot;);
<span class="lineNum">     541 </span>            :                         }
<span class="lineNum">     542 </span><span class="lineCov">          4 :                         if (strlen(szName)) event.caption.caption = szName;</span>
<span class="lineNum">     543 </span>            :                 }
<span class="lineNum">     544 </span><span class="lineCov">          6 :                 if (!event.caption.caption) {</span>
<span class="lineNum">     545 </span><span class="lineCov">          6 :                         char *str = strrchr(the_url, '\\');</span>
<span class="lineNum">     546 </span><span class="lineCov">          6 :                         if (!str) str = strrchr(the_url, '/');</span>
<span class="lineNum">     547 </span><span class="lineCov">          6 :                         event.caption.caption = str ? str+1 : the_url;</span>
<span class="lineNum">     548 </span>            :                 }
<span class="lineNum">     549 </span>            :         } else {
<span class="lineNum">     550 </span><span class="lineCov">          6 :                 event.caption.caption = MP4CLIENT_CAPTION;</span>
<span class="lineNum">     551 </span>            :         }
<span class="lineNum">     552 </span><span class="lineCov">         12 :         gf_term_user_event(term, &amp;event);</span>
<span class="lineNum">     553 </span>            : }
<span class="lineNum">     554 </span>            : 
<span class="lineNum">     555 </span>            : #ifdef WIN32
<span class="lineNum">     556 </span>            : u32 get_sys_col(int idx)
<span class="lineNum">     557 </span>            : {
<span class="lineNum">     558 </span>            :         u32 res;
<span class="lineNum">     559 </span>            :         DWORD val = GetSysColor(idx);
<span class="lineNum">     560 </span>            :         res = (val)&amp;0xFF;
<span class="lineNum">     561 </span>            :         res&lt;&lt;=8;
<span class="lineNum">     562 </span>            :         res |= (val&gt;&gt;8)&amp;0xFF;
<span class="lineNum">     563 </span>            :         res&lt;&lt;=8;
<span class="lineNum">     564 </span>            :         res |= (val&gt;&gt;16)&amp;0xFF;
<span class="lineNum">     565 </span>            :         return res;
<span class="lineNum">     566 </span>            : }
<a name="567"><span class="lineNum">     567 </span>            : #endif</a>
<span class="lineNum">     568 </span>            : 
<span class="lineNum">     569 </span><span class="lineCov">          2 : void switch_bench(u32 is_on)</span>
<span class="lineNum">     570 </span>            : {
<span class="lineNum">     571 </span><span class="lineCov">          2 :         bench_mode = is_on;</span>
<span class="lineNum">     572 </span><span class="lineCov">          2 :         display_rti = is_on ? 2 : 0;</span>
<span class="lineNum">     573 </span><span class="lineCov">          2 :         ResetCaption();</span>
<span class="lineNum">     574 </span><span class="lineCov">          2 :         gf_term_set_option(term, GF_OPT_VIDEO_BENCH, is_on);</span>
<span class="lineNum">     575 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">     576 </span>            : 
<span class="lineNum">     577 </span>            : #ifdef GPAC_ENABLE_COVERAGE
<span class="lineNum">     578 </span>            : #define getch() 0
<span class="lineNum">     579 </span>            : #define read_line_input(_line, _maxSize, _showContent) GF_FALSE
<span class="lineNum">     580 </span>            : 
<span class="lineNum">     581 </span>            : #else
<span class="lineNum">     582 </span>            : 
<span class="lineNum">     583 </span>            : #ifndef WIN32
<span class="lineNum">     584 </span>            : #include &lt;termios.h&gt;
<span class="lineNum">     585 </span>            : int getch() {
<span class="lineNum">     586 </span>            :         struct termios old;
<span class="lineNum">     587 </span>            :         struct termios new;
<span class="lineNum">     588 </span>            :         int rc;
<span class="lineNum">     589 </span>            :         if (tcgetattr(0, &amp;old) == -1) {
<span class="lineNum">     590 </span>            :                 return -1;
<span class="lineNum">     591 </span>            :         }
<span class="lineNum">     592 </span>            :         new = old;
<span class="lineNum">     593 </span>            :         new.c_lflag &amp;= ~(ICANON | ECHO);
<span class="lineNum">     594 </span>            :         new.c_cc[VMIN] = 1;
<span class="lineNum">     595 </span>            :         new.c_cc[VTIME] = 0;
<span class="lineNum">     596 </span>            :         if (tcsetattr(0, TCSANOW, &amp;new) == -1) {
<span class="lineNum">     597 </span>            :                 return -1;
<span class="lineNum">     598 </span>            :         }
<span class="lineNum">     599 </span>            :         rc = getchar();
<span class="lineNum">     600 </span>            :         (void) tcsetattr(0, TCSANOW, &amp;old);
<span class="lineNum">     601 </span>            :         return rc;
<span class="lineNum">     602 </span>            : }
<span class="lineNum">     603 </span>            : #else
<span class="lineNum">     604 </span>            : int getch() {
<span class="lineNum">     605 </span>            :         return getchar();
<span class="lineNum">     606 </span>            : }
<span class="lineNum">     607 </span>            : #endif
<span class="lineNum">     608 </span>            : 
<span class="lineNum">     609 </span>            : /**
<span class="lineNum">     610 </span>            :  * Reads a line of input from stdin
<span class="lineNum">     611 </span>            :  * @param line the buffer to fill
<span class="lineNum">     612 </span>            :  * @param maxSize the maximum size of the line to read
<span class="lineNum">     613 </span>            :  * @param showContent boolean indicating if the line read should be printed on stderr or not
<span class="lineNum">     614 </span>            :  */
<span class="lineNum">     615 </span>            : static Bool read_line_input(char * line, int maxSize, Bool showContent) {
<span class="lineNum">     616 </span>            :         char read;
<span class="lineNum">     617 </span>            :         int i = 0;
<span class="lineNum">     618 </span>            :         if (fflush( stderr ))
<span class="lineNum">     619 </span>            :                 perror(&quot;Failed to flush buffer %s&quot;);
<span class="lineNum">     620 </span>            :         do {
<span class="lineNum">     621 </span>            :                 line[i] = '\0';
<span class="lineNum">     622 </span>            :                 if (i &gt;= maxSize - 1)
<span class="lineNum">     623 </span>            :                         return GF_FALSE;
<span class="lineNum">     624 </span>            :                 read = getch();
<span class="lineNum">     625 </span>            :                 if (read == 8 || read == 127) {
<span class="lineNum">     626 </span>            :                         if (i &gt; 0) {
<span class="lineNum">     627 </span>            :                                 fprintf(stderr, &quot;\b \b&quot;);
<span class="lineNum">     628 </span>            :                                 i--;
<span class="lineNum">     629 </span>            :                         }
<span class="lineNum">     630 </span>            :                 } else if (read &gt; 32) {
<span class="lineNum">     631 </span>            :                         fputc(showContent ? read : '*', stderr);
<span class="lineNum">     632 </span>            :                         line[i++] = read;
<span class="lineNum">     633 </span>            :                 }
<span class="lineNum">     634 </span>            :                 fflush(stderr);
<span class="lineNum">     635 </span>            :         } while (read != '\n');
<span class="lineNum">     636 </span>            :         if (!read)
<span class="lineNum">     637 </span>            :                 return GF_FALSE;
<span class="lineNum">     638 </span>            :         return GF_TRUE;
<span class="lineNum">     639 </span>            : }
<a name="640"><span class="lineNum">     640 </span>            : #endif //!GPAC_ENABLE_COVERAGE</a>
<span class="lineNum">     641 </span>            : 
<span class="lineNum">     642 </span><span class="lineCov">          2 : static void do_set_speed(Fixed desired_speed)</span>
<span class="lineNum">     643 </span>            : {
<span class="lineNum">     644 </span><span class="lineCov">          2 :         if (gf_term_set_speed(term, desired_speed) == GF_OK) {</span>
<span class="lineNum">     645 </span><span class="lineCov">          2 :                 playback_speed = desired_speed;</span>
<span class="lineNum">     646 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;Playing at %g speed\n&quot;, FIX2FLT(playback_speed));</span>
<span class="lineNum">     647 </span>            :         } else {
<span class="lineNum">     648 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Adjusting speed to %g not supported for this content\n&quot;, FIX2FLT(desired_speed));</span>
<span class="lineNum">     649 </span>            :         }
<a name="650"><span class="lineNum">     650 </span><span class="lineCov">          2 : }</span></a>
<span class="lineNum">     651 </span>            : 
<span class="lineNum">     652 </span><span class="lineCov">        202 : Bool GPAC_EventProc(void *ptr, GF_Event *evt)</span>
<span class="lineNum">     653 </span>            : {
<span class="lineNum">     654 </span><span class="lineCov">        202 :         if (!term) return 0;</span>
<span class="lineNum">     655 </span>            : 
<span class="lineNum">     656 </span><span class="lineCov">        202 :         if (gui_mode==1) {</span>
<span class="lineNum">     657 </span><span class="lineCov">         34 :                 if (evt-&gt;type==GF_EVENT_QUIT) {</span>
<span class="lineNum">     658 </span><span class="lineCov">          1 :                         Run = 0;</span>
<span class="lineNum">     659 </span><span class="lineCov">          1 :                         if (evt-&gt;message.error&gt;0)</span>
<span class="lineNum">     660 </span><span class="lineCov">          1 :                                 ret_val = evt-&gt;message.error;</span>
<span class="lineNum">     661 </span><span class="lineCov">         33 :                 } else if (evt-&gt;type==GF_EVENT_KEYDOWN) {</span>
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :                         switch (evt-&gt;key.key_code) {</span>
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :                         case GF_KEY_C:</span>
<span class="lineNum">     664 </span><span class="lineNoCov">          0 :                                 if (evt-&gt;key.flags &amp; (GF_KEY_MOD_CTRL|GF_KEY_MOD_ALT)) {</span>
<span class="lineNum">     665 </span>            :                                         hide_shell(shell_visible ? 1 : 0);
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :                                         if (shell_visible) gui_mode=2;</span>
<span class="lineNum">     667 </span>            :                                 }
<span class="lineNum">     668 </span>            :                                 break;
<span class="lineNum">     669 </span>            :                         default:
<span class="lineNum">     670 </span>            :                                 break;
<span class="lineNum">     671 </span>            :                         }
<span class="lineNum">     672 </span><span class="lineCov">         33 :                 }</span>
<span class="lineNum">     673 </span>            :                 return 0;
<span class="lineNum">     674 </span>            :         }
<span class="lineNum">     675 </span>            : 
<span class="lineNum">     676 </span><span class="lineCov">        168 :         switch (evt-&gt;type) {</span>
<span class="lineNum">     677 </span><span class="lineCov">          2 :         case GF_EVENT_DURATION:</span>
<span class="lineNum">     678 </span><span class="lineCov">          2 :                 Duration = (u64) ( 1000 * (s64) evt-&gt;duration.duration);</span>
<span class="lineNum">     679 </span><span class="lineCov">          2 :                 CanSeek = evt-&gt;duration.can_seek;</span>
<span class="lineNum">     680 </span><span class="lineCov">          2 :                 break;</span>
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :         case GF_EVENT_MESSAGE:</span>
<span class="lineNum">     682 </span>            :         {
<span class="lineNum">     683 </span>            :                 const char *servName;
<span class="lineNum">     684 </span><span class="lineNoCov">          0 :                 if (!evt-&gt;message.service || !strcmp(evt-&gt;message.service, the_url)) {</span>
<span class="lineNum">     685 </span>            :                         servName = &quot;&quot;;
<span class="lineNum">     686 </span><span class="lineNoCov">          0 :                 } else if (!strnicmp(evt-&gt;message.service, &quot;data:&quot;, 5)) {</span>
<span class="lineNum">     687 </span>            :                         servName = &quot;(embedded data)&quot;;
<span class="lineNum">     688 </span>            :                 } else {
<span class="lineNum">     689 </span>            :                         servName = evt-&gt;message.service;
<span class="lineNum">     690 </span>            :                 }
<span class="lineNum">     691 </span>            : 
<span class="lineNum">     692 </span>            : 
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :                 if (!evt-&gt;message.message) return 0;</span>
<span class="lineNum">     694 </span>            : 
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :                 if (evt-&gt;message.error) {</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :                         if (!is_connected) last_error = evt-&gt;message.error;</span>
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :                         if (evt-&gt;message.error==GF_SCRIPT_INFO) {</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :                                 GF_LOG(GF_LOG_INFO, GF_LOG_CONSOLE, (&quot;%s\n&quot;, evt-&gt;message.message));</span>
<span class="lineNum">     699 </span>            :                         } else {
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :                                 GF_LOG(GF_LOG_ERROR, GF_LOG_CONSOLE, (&quot;%s %s: %s\n&quot;, servName, evt-&gt;message.message, gf_error_to_string(evt-&gt;message.error)));</span>
<span class="lineNum">     701 </span>            :                         }
<span class="lineNum">     702 </span>            :                 } else {
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :                         GF_LOG(GF_LOG_INFO, GF_LOG_CONSOLE, (&quot;%s %s\n&quot;, servName, evt-&gt;message.message));</span>
<span class="lineNum">     704 </span>            :                 }
<span class="lineNum">     705 </span>            :         }
<span class="lineNum">     706 </span>            :         break;
<span class="lineNum">     707 </span><span class="lineCov">          6 :         case GF_EVENT_PROGRESS:</span>
<span class="lineNum">     708 </span>            :         {
<span class="lineNum">     709 </span>            :                 char *szTitle = &quot;&quot;;
<span class="lineNum">     710 </span><span class="lineCov">          6 :                 if (evt-&gt;progress.progress_type==0) {</span>
<span class="lineNum">     711 </span>            :                         szTitle = &quot;Buffer &quot;;
<span class="lineNum">     712 </span><span class="lineCov">          6 :                         if (bench_mode &amp;&amp; (bench_mode!=3) ) {</span>
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :                                 if (evt-&gt;progress.done &gt;= evt-&gt;progress.total) bench_buffer = 0;</span>
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :                                 else bench_buffer = 1 + 100*evt-&gt;progress.done / evt-&gt;progress.total;</span>
<span class="lineNum">     715 </span>            :                                 break;
<span class="lineNum">     716 </span>            :                         }
<span class="lineNum">     717 </span>            :                 }
<span class="lineNum">     718 </span><span class="lineNoCov">          0 :                 else if (evt-&gt;progress.progress_type==1) {</span>
<span class="lineNum">     719 </span><span class="lineNoCov">          0 :                         if (bench_mode) break;</span>
<span class="lineNum">     720 </span>            :                         szTitle = &quot;Download &quot;;
<span class="lineNum">     721 </span>            :                 }
<span class="lineNum">     722 </span><span class="lineNoCov">          0 :                 else if (evt-&gt;progress.progress_type==2) szTitle = &quot;Import &quot;;</span>
<span class="lineNum">     723 </span><span class="lineCov">          6 :                 gf_set_progress(szTitle, evt-&gt;progress.done, evt-&gt;progress.total);</span>
<span class="lineNum">     724 </span>            :         }
<span class="lineNum">     725 </span><span class="lineCov">          6 :         break;</span>
<span class="lineNum">     726 </span>            : 
<span class="lineNum">     727 </span>            : 
<span class="lineNum">     728 </span><span class="lineNoCov">          0 :         case GF_EVENT_DBLCLICK:</span>
<span class="lineNum">     729 </span><span class="lineNoCov">          0 :                 gf_term_set_option(term, GF_OPT_FULLSCREEN, !gf_term_get_option(term, GF_OPT_FULLSCREEN));</span>
<span class="lineNum">     730 </span><span class="lineNoCov">          0 :                 return 0;</span>
<span class="lineNum">     731 </span>            : 
<span class="lineNum">     732 </span><span class="lineCov">         16 :         case GF_EVENT_MOUSEDOWN:</span>
<span class="lineNum">     733 </span><span class="lineCov">         16 :                 if (evt-&gt;mouse.button==GF_MOUSE_RIGHT) {</span>
<span class="lineNum">     734 </span><span class="lineNoCov">          0 :                         right_down = 1;</span>
<span class="lineNum">     735 </span><span class="lineNoCov">          0 :                         last_x = evt-&gt;mouse.x;</span>
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :                         last_y = evt-&gt;mouse.y;</span>
<span class="lineNum">     737 </span>            :                 }
<span class="lineNum">     738 </span>            :                 return 0;
<span class="lineNum">     739 </span><span class="lineCov">          2 :         case GF_EVENT_MOUSEUP:</span>
<span class="lineNum">     740 </span><span class="lineCov">          2 :                 if (evt-&gt;mouse.button==GF_MOUSE_RIGHT) {</span>
<span class="lineNum">     741 </span><span class="lineNoCov">          0 :                         right_down = 0;</span>
<span class="lineNum">     742 </span><span class="lineNoCov">          0 :                         last_x = evt-&gt;mouse.x;</span>
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :                         last_y = evt-&gt;mouse.y;</span>
<span class="lineNum">     744 </span>            :                 }
<span class="lineNum">     745 </span>            :                 return 0;
<span class="lineNum">     746 </span><span class="lineCov">         48 :         case GF_EVENT_MOUSEMOVE:</span>
<span class="lineNum">     747 </span><span class="lineCov">         48 :                 if (right_down &amp;&amp; (user.init_flags &amp; GF_TERM_WINDOWLESS) ) {</span>
<span class="lineNum">     748 </span>            :                         GF_Event move;
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :                         move.move.x = evt-&gt;mouse.x - last_x;</span>
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :                         move.move.y = last_y-evt-&gt;mouse.y;</span>
<span class="lineNum">     751 </span><span class="lineNoCov">          0 :                         move.type = GF_EVENT_MOVE;</span>
<span class="lineNum">     752 </span><span class="lineNoCov">          0 :                         move.move.relative = 1;</span>
<span class="lineNum">     753 </span><span class="lineNoCov">          0 :                         gf_term_user_event(term, &amp;move);</span>
<span class="lineNum">     754 </span>            :                 }
<span class="lineNum">     755 </span>            :                 return 0;
<span class="lineNum">     756 </span>            : 
<span class="lineNum">     757 </span><span class="lineCov">         16 :         case GF_EVENT_KEYUP:</span>
<span class="lineNum">     758 </span><span class="lineCov">         16 :                 switch (evt-&gt;key.key_code) {</span>
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :                 case GF_KEY_SPACE:</span>
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :                         if (evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL) switch_bench(!bench_mode);</span>
<span class="lineNum">     761 </span>            :                         break;
<span class="lineNum">     762 </span>            :                 }
<span class="lineNum">     763 </span>            :                 break;
<span class="lineNum">     764 </span><span class="lineCov">         32 :         case GF_EVENT_KEYDOWN:</span>
<span class="lineNum">     765 </span><span class="lineCov">         32 :                 switch (evt-&gt;key.key_code) {</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :                 case GF_KEY_SPACE:</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :                         if (evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL) {</span>
<span class="lineNum">     768 </span>            :                                 /*ignore key repeat*/
<span class="lineNum">     769 </span><span class="lineNoCov">          0 :                                 if (!bench_mode) switch_bench(!bench_mode);</span>
<span class="lineNum">     770 </span>            :                         }
<span class="lineNum">     771 </span>            :                         break;
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :                 case GF_KEY_PAGEDOWN:</span>
<span class="lineNum">     773 </span>            :                 case GF_KEY_MEDIANEXTTRACK:
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :                         request_next_playlist_item = 1;</span>
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     776 </span>            :                 case GF_KEY_MEDIAPREVIOUSTRACK:
<span class="lineNum">     777 </span>            :                         break;
<span class="lineNum">     778 </span><span class="lineNoCov">          0 :                 case GF_KEY_ESCAPE:</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :                         gf_term_set_option(term, GF_OPT_FULLSCREEN, !gf_term_get_option(term, GF_OPT_FULLSCREEN));</span>
<span class="lineNum">     780 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     781 </span><span class="lineNoCov">          0 :                 case GF_KEY_C:</span>
<span class="lineNum">     782 </span><span class="lineNoCov">          0 :                         if (evt-&gt;key.flags &amp; (GF_KEY_MOD_CTRL|GF_KEY_MOD_ALT)) {</span>
<span class="lineNum">     783 </span>            :                                 hide_shell(shell_visible ? 1 : 0);
<span class="lineNum">     784 </span><span class="lineNoCov">          0 :                                 if (!shell_visible) gui_mode=1;</span>
<span class="lineNum">     785 </span>            :                         }
<span class="lineNum">     786 </span>            :                         break;
<span class="lineNum">     787 </span><span class="lineNoCov">          0 :                 case GF_KEY_F:</span>
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :                         if (evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL) fprintf(stderr, &quot;Rendering rate: %f FPS\n&quot;, gf_term_get_framerate(term, 0));</span>
<span class="lineNum">     789 </span>            :                         break;
<span class="lineNum">     790 </span><span class="lineNoCov">          0 :                 case GF_KEY_T:</span>
<span class="lineNum">     791 </span><span class="lineNoCov">          0 :                         if (evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL) fprintf(stderr, &quot;Scene Time: %f \n&quot;, gf_term_get_time_in_ms(term)/1000.0);</span>
<span class="lineNum">     792 </span>            :                         break;
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :                 case GF_KEY_D:</span>
<span class="lineNum">     794 </span><span class="lineNoCov">          0 :                         if (evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL) gf_term_set_option(term, GF_OPT_DRAW_MODE, (gf_term_get_option(term, GF_OPT_DRAW_MODE)==GF_DRAW_MODE_DEFER) ? GF_DRAW_MODE_IMMEDIATE : GF_DRAW_MODE_DEFER );</span>
<span class="lineNum">     795 </span>            :                         break;
<span class="lineNum">     796 </span><span class="lineNoCov">          0 :                 case GF_KEY_4:</span>
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :                         if (evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL)</span>
<span class="lineNum">     798 </span><span class="lineNoCov">          0 :                                 gf_term_set_option(term, GF_OPT_ASPECT_RATIO, GF_ASPECT_RATIO_4_3);</span>
<span class="lineNum">     799 </span>            :                         break;
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :                 case GF_KEY_5:</span>
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :                         if (evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL)</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :                                 gf_term_set_option(term, GF_OPT_ASPECT_RATIO, GF_ASPECT_RATIO_16_9);</span>
<span class="lineNum">     803 </span>            :                         break;
<span class="lineNum">     804 </span><span class="lineNoCov">          0 :                 case GF_KEY_6:</span>
<span class="lineNum">     805 </span><span class="lineNoCov">          0 :                         if (evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL)</span>
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :                                 gf_term_set_option(term, GF_OPT_ASPECT_RATIO, GF_ASPECT_RATIO_FILL_SCREEN);</span>
<span class="lineNum">     807 </span>            :                         break;
<span class="lineNum">     808 </span><span class="lineNoCov">          0 :                 case GF_KEY_7:</span>
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :                         if (evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL)</span>
<span class="lineNum">     810 </span><span class="lineNoCov">          0 :                                 gf_term_set_option(term, GF_OPT_ASPECT_RATIO, GF_ASPECT_RATIO_KEEP);</span>
<span class="lineNum">     811 </span>            :                         break;
<span class="lineNum">     812 </span><span class="lineNoCov">          0 :                 case GF_KEY_O:</span>
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :                         if ((evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL) &amp;&amp; is_connected) {</span>
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :                                 if (gf_term_get_option(term, GF_OPT_MAIN_ADDON)) {</span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Resuming to main content\n&quot;);</span>
<span class="lineNum">     816 </span><span class="lineNoCov">          0 :                                         gf_term_set_option(term, GF_OPT_PLAY_STATE, GF_STATE_PLAY_LIVE);</span>
<span class="lineNum">     817 </span>            :                                 } else {
<span class="lineNum">     818 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Main addon not enabled\n&quot;);</span>
<span class="lineNum">     819 </span>            :                                 }
<span class="lineNum">     820 </span>            :                         }
<span class="lineNum">     821 </span>            :                         break;
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :                 case GF_KEY_P:</span>
<span class="lineNum">     823 </span><span class="lineNoCov">          0 :                         if ((evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL) &amp;&amp; is_connected) {</span>
<span class="lineNum">     824 </span><span class="lineNoCov">          0 :                                 u32 pause_state = gf_term_get_option(term, GF_OPT_PLAY_STATE) ;</span>
<span class="lineNum">     825 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;[Status: %s]\n&quot;, pause_state ? &quot;Playing&quot; : &quot;Paused&quot;);</span>
<span class="lineNum">     826 </span><span class="lineNoCov">          0 :                                 if ((pause_state == GF_STATE_PAUSED) &amp;&amp; (evt-&gt;key.flags &amp; GF_KEY_MOD_SHIFT)) {</span>
<span class="lineNum">     827 </span><span class="lineNoCov">          0 :                                         gf_term_set_option(term, GF_OPT_PLAY_STATE, GF_STATE_PLAY_LIVE);</span>
<span class="lineNum">     828 </span>            :                                 } else {
<span class="lineNum">     829 </span><span class="lineNoCov">          0 :                                         gf_term_set_option(term, GF_OPT_PLAY_STATE, (pause_state==GF_STATE_PAUSED) ? GF_STATE_PLAYING : GF_STATE_PAUSED);</span>
<span class="lineNum">     830 </span>            :                                 }
<span class="lineNum">     831 </span>            :                         }
<span class="lineNum">     832 </span>            :                         break;
<span class="lineNum">     833 </span><span class="lineNoCov">          0 :                 case GF_KEY_S:</span>
<span class="lineNum">     834 </span><span class="lineNoCov">          0 :                         if ((evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL) &amp;&amp; is_connected) {</span>
<span class="lineNum">     835 </span><span class="lineNoCov">          0 :                                 gf_term_set_option(term, GF_OPT_PLAY_STATE, GF_STATE_STEP_PAUSE);</span>
<span class="lineNum">     836 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Step time: &quot;);</span>
<span class="lineNum">     837 </span><span class="lineNoCov">          0 :                                 PrintTime(gf_term_get_time_in_ms(term));</span>
<span class="lineNum">     838 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">     839 </span>            :                         }
<span class="lineNum">     840 </span>            :                         break;
<span class="lineNum">     841 </span><span class="lineNoCov">          0 :                 case GF_KEY_B:</span>
<span class="lineNum">     842 </span><span class="lineNoCov">          0 :                         if ((evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL) &amp;&amp; is_connected)</span>
<span class="lineNum">     843 </span><span class="lineNoCov">          0 :                                 ViewODs(term, 1);</span>
<span class="lineNum">     844 </span>            :                         break;
<span class="lineNum">     845 </span><span class="lineNoCov">          0 :                 case GF_KEY_M:</span>
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :                         if ((evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL) &amp;&amp; is_connected)</span>
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :                                 ViewODs(term, 0);</span>
<span class="lineNum">     848 </span>            :                         break;
<span class="lineNum">     849 </span><span class="lineNoCov">          0 :                 case GF_KEY_H:</span>
<span class="lineNum">     850 </span><span class="lineNoCov">          0 :                         if ((evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL) &amp;&amp; is_connected) {</span>
<span class="lineNum">     851 </span><span class="lineNoCov">          0 :                                 gf_term_switch_quality(term, 1);</span>
<span class="lineNum">     852 </span>            :                         //      gf_term_set_option(term, GF_OPT_MULTIVIEW_MODE, 0);
<span class="lineNum">     853 </span>            :                         }
<span class="lineNum">     854 </span>            :                         break;
<span class="lineNum">     855 </span><span class="lineNoCov">          0 :                 case GF_KEY_L:</span>
<span class="lineNum">     856 </span><span class="lineNoCov">          0 :                         if ((evt-&gt;key.flags &amp; GF_KEY_MOD_CTRL) &amp;&amp; is_connected) {</span>
<span class="lineNum">     857 </span><span class="lineNoCov">          0 :                                 gf_term_switch_quality(term, 0);</span>
<span class="lineNum">     858 </span>            :                         //      gf_term_set_option(term, GF_OPT_MULTIVIEW_MODE, 1);
<span class="lineNum">     859 </span>            :                         }
<span class="lineNum">     860 </span>            :                         break;
<span class="lineNum">     861 </span><span class="lineNoCov">          0 :                 case GF_KEY_F5:</span>
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :                         if (is_connected)</span>
<span class="lineNum">     863 </span><span class="lineNoCov">          0 :                                 reload = 1;</span>
<span class="lineNum">     864 </span>            :                         break;
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :                 case GF_KEY_A:</span>
<span class="lineNum">     866 </span><span class="lineNoCov">          0 :                         addon_visible = !addon_visible;</span>
<span class="lineNum">     867 </span><span class="lineNoCov">          0 :                         gf_term_toggle_addons(term, addon_visible);</span>
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     869 </span><span class="lineNoCov">          0 :                 case GF_KEY_UP:</span>
<span class="lineNum">     870 </span><span class="lineNoCov">          0 :                         if ((evt-&gt;key.flags &amp; VK_MOD) &amp;&amp; is_connected) {</span>
<span class="lineNum">     871 </span><span class="lineNoCov">          0 :                                 do_set_speed(playback_speed * 2);</span>
<span class="lineNum">     872 </span>            :                         }
<span class="lineNum">     873 </span>            :                         break;
<span class="lineNum">     874 </span><span class="lineNoCov">          0 :                 case GF_KEY_DOWN:</span>
<span class="lineNum">     875 </span><span class="lineNoCov">          0 :                         if ((evt-&gt;key.flags &amp; VK_MOD) &amp;&amp; is_connected) {</span>
<span class="lineNum">     876 </span><span class="lineNoCov">          0 :                                 do_set_speed(playback_speed / 2);</span>
<span class="lineNum">     877 </span>            :                         }
<span class="lineNum">     878 </span>            :                         break;
<span class="lineNum">     879 </span><span class="lineNoCov">          0 :                 case GF_KEY_LEFT:</span>
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :                         if ((evt-&gt;key.flags &amp; VK_MOD) &amp;&amp; is_connected) {</span>
<span class="lineNum">     881 </span><span class="lineNoCov">          0 :                                 do_set_speed(-1 * playback_speed );</span>
<span class="lineNum">     882 </span>            :                         }
<span class="lineNum">     883 </span>            :                         break;
<span class="lineNum">     884 </span>            : 
<span class="lineNum">     885 </span>            :                 }
<span class="lineNum">     886 </span>            :                 break;
<span class="lineNum">     887 </span>            : 
<span class="lineNum">     888 </span><span class="lineCov">         14 :         case GF_EVENT_CONNECT:</span>
<span class="lineNum">     889 </span><span class="lineCov">         14 :                 if (evt-&gt;connect.is_connected) {</span>
<span class="lineNum">     890 </span><span class="lineCov">          6 :                         is_connected = 1;</span>
<span class="lineNum">     891 </span><span class="lineCov">          6 :                         fprintf(stderr, &quot;Service Connected\n&quot;);</span>
<span class="lineNum">     892 </span><span class="lineCov">          6 :                         eos_seen = GF_FALSE;</span>
<span class="lineNum">     893 </span><span class="lineCov">          6 :                         if (playback_speed != FIX_ONE)</span>
<span class="lineNum">     894 </span><span class="lineNoCov">          0 :                                 gf_term_set_speed(term, playback_speed);</span>
<span class="lineNum">     895 </span>            : 
<span class="lineNum">     896 </span><span class="lineCov">          6 :                         if (do_coverage) {</span>
<span class="lineNum">     897 </span><span class="lineCov">          2 :                                 gf_term_switch_quality(term, 1);</span>
<span class="lineNum">     898 </span>            :                         }
<span class="lineNum">     899 </span>            : 
<span class="lineNum">     900 </span><span class="lineCov">          8 :                 } else if (is_connected) {</span>
<span class="lineNum">     901 </span><span class="lineCov">          6 :                         fprintf(stderr, &quot;Service %s\n&quot;, is_connected ? &quot;Disconnected&quot; : &quot;Connection Failed&quot;);</span>
<span class="lineNum">     902 </span><span class="lineCov">          6 :                         is_connected = 0;</span>
<span class="lineNum">     903 </span><span class="lineCov">          6 :                         Duration = 0;</span>
<span class="lineNum">     904 </span>            :                 }
<span class="lineNum">     905 </span><span class="lineCov">         14 :                 if (init_w &amp;&amp; init_h) {</span>
<span class="lineNum">     906 </span><span class="lineNoCov">          0 :                         gf_term_set_size(term, init_w, init_h);</span>
<span class="lineNum">     907 </span>            :                 }
<span class="lineNum">     908 </span><span class="lineCov">         14 :                 ResetCaption();</span>
<span class="lineNum">     909 </span><span class="lineCov">         14 :                 break;</span>
<span class="lineNum">     910 </span><span class="lineNoCov">          0 :         case GF_EVENT_EOS:</span>
<span class="lineNum">     911 </span><span class="lineNoCov">          0 :                 eos_seen = GF_TRUE;</span>
<span class="lineNum">     912 </span><span class="lineNoCov">          0 :                 if (playlist) {</span>
<span class="lineNum">     913 </span><span class="lineNoCov">          0 :                         if (Duration&gt;1500)</span>
<span class="lineNum">     914 </span><span class="lineNoCov">          0 :                                 request_next_playlist_item = GF_TRUE;</span>
<span class="lineNum">     915 </span>            :                 }
<span class="lineNum">     916 </span><span class="lineNoCov">          0 :                 else if (loop_at_end) {</span>
<span class="lineNum">     917 </span><span class="lineNoCov">          0 :                         restart = 1;</span>
<span class="lineNum">     918 </span>            :                 }
<span class="lineNum">     919 </span>            :                 break;
<span class="lineNum">     920 </span><span class="lineNoCov">          0 :         case GF_EVENT_SIZE:</span>
<span class="lineNum">     921 </span><span class="lineNoCov">          0 :                 if (user.init_flags &amp; GF_TERM_WINDOWLESS) {</span>
<span class="lineNum">     922 </span>            :                         GF_Event move;
<span class="lineNum">     923 </span><span class="lineNoCov">          0 :                         move.type = GF_EVENT_MOVE;</span>
<span class="lineNum">     924 </span><span class="lineNoCov">          0 :                         move.move.align_x = align_mode &amp; 0xFF;</span>
<span class="lineNum">     925 </span><span class="lineNoCov">          0 :                         move.move.align_y = (align_mode&gt;&gt;8) &amp; 0xFF;</span>
<span class="lineNum">     926 </span><span class="lineNoCov">          0 :                         move.move.relative = 2;</span>
<span class="lineNum">     927 </span><span class="lineNoCov">          0 :                         gf_term_user_event(term, &amp;move);</span>
<span class="lineNum">     928 </span>            :                 }
<span class="lineNum">     929 </span>            :                 break;
<span class="lineNum">     930 </span><span class="lineCov">         20 :         case GF_EVENT_SCENE_SIZE:</span>
<span class="lineNum">     931 </span>            : 
<span class="lineNum">     932 </span><span class="lineCov">         20 :                 if ((forced_width &amp;&amp; forced_height) || scale) {</span>
<span class="lineNum">     933 </span>            :                         GF_Event size;
<span class="lineNum">     934 </span><span class="lineCov">         20 :                         u32 nw = forced_width ? forced_width : evt-&gt;size.width;</span>
<span class="lineNum">     935 </span><span class="lineCov">         20 :                         u32 nh = forced_height ? forced_height : evt-&gt;size.height;</span>
<span class="lineNum">     936 </span>            : 
<span class="lineNum">     937 </span><span class="lineCov">         20 :                         if (scale != 1) {</span>
<span class="lineNum">     938 </span><span class="lineNoCov">          0 :                                 nw  = (u32)(nw * scale);</span>
<span class="lineNum">     939 </span><span class="lineNoCov">          0 :                                 nh = (u32)(nh * scale);</span>
<span class="lineNum">     940 </span>            :                         }
<span class="lineNum">     941 </span><span class="lineCov">         20 :                         if ((nw != evt-&gt;size.width) || (nh != evt-&gt;size.height)) {</span>
<span class="lineNum">     942 </span><span class="lineNoCov">          0 :                                 size.type = GF_EVENT_SIZE;</span>
<span class="lineNum">     943 </span><span class="lineNoCov">          0 :                                 size.size.width = nw;</span>
<span class="lineNum">     944 </span><span class="lineNoCov">          0 :                                 size.size.height = nh;</span>
<span class="lineNum">     945 </span><span class="lineNoCov">          0 :                                 gf_term_user_event(term, &amp;size);</span>
<span class="lineNum">     946 </span>            :                         }
<span class="lineNum">     947 </span>            :                 }
<span class="lineNum">     948 </span>            :                 break;
<span class="lineNum">     949 </span>            : 
<span class="lineNum">     950 </span><span class="lineNoCov">          0 :         case GF_EVENT_METADATA:</span>
<span class="lineNum">     951 </span><span class="lineNoCov">          0 :                 ResetCaption();</span>
<span class="lineNum">     952 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">     953 </span><span class="lineNoCov">          0 :         case GF_EVENT_DROPFILE:</span>
<span class="lineNum">     954 </span>            :         {
<span class="lineNum">     955 </span>            :                 u32 i, pos;
<span class="lineNum">     956 </span>            :                 /*todo - force playlist mode*/
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :                 if (readonly_playlist) {</span>
<span class="lineNum">     958 </span><span class="lineNoCov">          0 :                         gf_fclose(playlist);</span>
<span class="lineNum">     959 </span><span class="lineNoCov">          0 :                         playlist = NULL;</span>
<span class="lineNum">     960 </span>            :                 }
<span class="lineNum">     961 </span><span class="lineNoCov">          0 :                 readonly_playlist = 0;</span>
<span class="lineNum">     962 </span><span class="lineNoCov">          0 :                 if (!playlist) {</span>
<span class="lineNum">     963 </span>            :                         readonly_playlist = 0;
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :                         playlist = gf_file_temp(NULL);</span>
<span class="lineNum">     965 </span>            :                 }
<span class="lineNum">     966 </span><span class="lineNoCov">          0 :                 pos = (u32) gf_ftell(playlist);</span>
<span class="lineNum">     967 </span>            :                 i=0;
<span class="lineNum">     968 </span><span class="lineNoCov">          0 :                 while (i&lt;evt-&gt;open_file.nb_files) {</span>
<span class="lineNum">     969 </span><span class="lineNoCov">          0 :                         if (evt-&gt;open_file.files[i] != NULL) {</span>
<span class="lineNum">     970 </span><span class="lineNoCov">          0 :                                 fprintf(playlist, &quot;%s\n&quot;, evt-&gt;open_file.files[i]);</span>
<span class="lineNum">     971 </span>            :                         }
<span class="lineNum">     972 </span><span class="lineNoCov">          0 :                         i++;</span>
<span class="lineNum">     973 </span>            :                 }
<span class="lineNum">     974 </span><span class="lineNoCov">          0 :                 gf_fseek(playlist, pos, SEEK_SET);</span>
<span class="lineNum">     975 </span><span class="lineNoCov">          0 :                 request_next_playlist_item = 1;</span>
<span class="lineNum">     976 </span>            :         }
<span class="lineNum">     977 </span><span class="lineNoCov">          0 :         return 1;</span>
<span class="lineNum">     978 </span>            : 
<span class="lineNum">     979 </span><span class="lineNoCov">          0 :         case GF_EVENT_QUIT:</span>
<span class="lineNum">     980 </span><span class="lineNoCov">          0 :                 if (evt-&gt;message.error&lt;0)  {</span>
<span class="lineNum">     981 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;A fatal error was encoutered: %s (%s) - exiting ...\n&quot;, evt-&gt;message.message ? evt-&gt;message.message : &quot;no details&quot;, gf_error_to_string(evt-&gt;message.error) );</span>
<span class="lineNum">     982 </span>            :                 } else {
<span class="lineNum">     983 </span><span class="lineNoCov">          0 :                         ret_val = evt-&gt;message.error;</span>
<span class="lineNum">     984 </span>            :                 }
<span class="lineNum">     985 </span><span class="lineNoCov">          0 :                 Run = 0;</span>
<span class="lineNum">     986 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">     987 </span><span class="lineNoCov">          0 :         case GF_EVENT_DISCONNECT:</span>
<span class="lineNum">     988 </span><span class="lineNoCov">          0 :                 gf_term_disconnect(term);</span>
<span class="lineNum">     989 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">     990 </span>            :         case GF_EVENT_MIGRATE:
<span class="lineNum">     991 </span>            :         {
<span class="lineNum">     992 </span>            :         }
<span class="lineNum">     993 </span>            :         break;
<span class="lineNum">     994 </span><span class="lineNoCov">          0 :         case GF_EVENT_NAVIGATE_INFO:</span>
<span class="lineNum">     995 </span><span class="lineNoCov">          0 :                 if (evt-&gt;navigate.to_url)</span>
<span class="lineNum">     996 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Go to URL: \&quot;%s\&quot;\r&quot;, evt-&gt;navigate.to_url);</span>
<span class="lineNum">     997 </span>            :                 break;
<span class="lineNum">     998 </span><span class="lineCov">          2 :         case GF_EVENT_NAVIGATE:</span>
<span class="lineNum">     999 </span><span class="lineCov">          2 :                 if (gf_term_is_supported_url(term, evt-&gt;navigate.to_url, 1, no_mime_check)) {</span>
<span class="lineNum">    1000 </span><span class="lineCov">          2 :                         strncpy(the_url, evt-&gt;navigate.to_url, sizeof(the_url)-1);</span>
<span class="lineNum">    1001 </span><span class="lineCov">          2 :                         the_url[sizeof(the_url) - 1] = 0;</span>
<span class="lineNum">    1002 </span><span class="lineCov">          2 :                         fprintf(stderr, &quot;Navigating to URL %s\n&quot;, the_url);</span>
<span class="lineNum">    1003 </span><span class="lineCov">          2 :                         gf_term_navigate_to(term, evt-&gt;navigate.to_url);</span>
<span class="lineNum">    1004 </span><span class="lineCov">          2 :                         return 1;</span>
<span class="lineNum">    1005 </span>            :                 } else {
<span class="lineNum">    1006 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Navigation destination not supported\nGo to URL: %s\n&quot;, evt-&gt;navigate.to_url);</span>
<span class="lineNum">    1007 </span>            :                 }
<span class="lineNum">    1008 </span>            :                 break;
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 :         case GF_EVENT_SET_CAPTION:</span>
<span class="lineNum">    1010 </span><span class="lineNoCov">          0 :                 gf_term_user_event(term, evt);</span>
<span class="lineNum">    1011 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1012 </span>            :         case GF_EVENT_AUTHORIZATION:
<span class="lineNum">    1013 </span>            :         {
<span class="lineNum">    1014 </span>            :                 u32 nb_retry = 4;
<span class="lineNum">    1015 </span>            :                 assert( evt-&gt;type == GF_EVENT_AUTHORIZATION);
<span class="lineNum">    1016 </span>            :                 assert( evt-&gt;auth.user);
<span class="lineNum">    1017 </span>            :                 assert( evt-&gt;auth.password);
<span class="lineNum">    1018 </span>            :                 assert( evt-&gt;auth.site_url);
<span class="lineNum">    1019 </span><span class="lineNoCov">          0 :                 while ((!strlen(evt-&gt;auth.user) || !strlen(evt-&gt;auth.password)) &amp;&amp; (nb_retry &gt; 0) ) {</span>
<span class="lineNum">    1020 </span><span class="lineNoCov">          0 :                         nb_retry--;</span>
<span class="lineNum">    1021 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;**** Authorization required for site %s ****\n&quot;, evt-&gt;auth.site_url);</span>
<span class="lineNum">    1022 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;login   : &quot;);</span>
<span class="lineNum">    1023 </span>            :                         if (!read_line_input(evt-&gt;auth.user, 50, 1))
<span class="lineNum">    1024 </span><span class="lineNoCov">          0 :                                 continue;</span>
<span class="lineNum">    1025 </span>            :                         fprintf(stderr, &quot;\npassword: &quot;);
<span class="lineNum">    1026 </span>            :                         if (!read_line_input(evt-&gt;auth.password, 50, 0))
<span class="lineNum">    1027 </span>            :                                 continue;
<span class="lineNum">    1028 </span>            :                         fprintf(stderr, &quot;*********\n&quot;);
<span class="lineNum">    1029 </span>            :                 }
<span class="lineNum">    1030 </span><span class="lineNoCov">          0 :                 if (nb_retry == 0) {</span>
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;**** No User or password has been filled, aborting ***\n&quot;);</span>
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :                         return 0;</span>
<span class="lineNum">    1033 </span>            :                 }
<span class="lineNum">    1034 </span>            :                 return 1;
<span class="lineNum">    1035 </span>            :         }
<span class="lineNum">    1036 </span><span class="lineNoCov">          0 :         case GF_EVENT_ADDON_DETECTED:</span>
<span class="lineNum">    1037 </span><span class="lineNoCov">          0 :                 if (enable_add_ons) {</span>
<span class="lineNum">    1038 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Media Addon %s detected - enabling it\n&quot;, evt-&gt;addon_connect.addon_url);</span>
<span class="lineNum">    1039 </span><span class="lineNoCov">          0 :                         addon_visible = 1;</span>
<span class="lineNum">    1040 </span>            :                 }
<span class="lineNum">    1041 </span><span class="lineNoCov">          0 :                 return enable_add_ons;</span>
<span class="lineNum">    1042 </span>            :         }
<span class="lineNum">    1043 </span>            :         return 0;
<span class="lineNum">    1044 </span>            : }
<a name="1045"><span class="lineNum">    1045 </span>            : </a>
<span class="lineNum">    1046 </span>            : 
<span class="lineNum">    1047 </span><span class="lineCov">          2 : void list_modules()</span>
<span class="lineNum">    1048 </span>            : {
<span class="lineNum">    1049 </span>            :         u32 i;
<span class="lineNum">    1050 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;\rAvailable modules:\n&quot;);</span>
<span class="lineNum">    1051 </span><span class="lineCov">         16 :         for (i=0; i&lt;gf_modules_count(); i++) {</span>
<span class="lineNum">    1052 </span><span class="lineCov">         14 :                 char *str = (char *) gf_modules_get_file_name(i);</span>
<span class="lineNum">    1053 </span><span class="lineCov">         14 :                 if (str) fprintf(stderr, &quot;\t%s\n&quot;, str);</span>
<span class="lineNum">    1054 </span>            :         }
<span class="lineNum">    1055 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;\n&quot;);</span>
<a name="1056"><span class="lineNum">    1056 </span><span class="lineCov">          2 : }</span></a>
<span class="lineNum">    1057 </span>            : 
<span class="lineNum">    1058 </span><span class="lineCov">          2 : void set_navigation()</span>
<span class="lineNum">    1059 </span>            : {
<span class="lineNum">    1060 </span>            :         GF_Err e;
<span class="lineNum">    1061 </span>            :         char nav;
<span class="lineNum">    1062 </span><span class="lineCov">          2 :         u32 type = gf_term_get_option(term, GF_OPT_NAVIGATION_TYPE);</span>
<span class="lineNum">    1063 </span>            :         e = GF_OK;
<span class="lineNum">    1064 </span>            : //      fflush(stdin);
<span class="lineNum">    1065 </span>            : 
<span class="lineNum">    1066 </span><span class="lineCov">          2 :         if (!type) {</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Content/compositor doesn't allow user-selectable navigation\n&quot;);</span>
<span class="lineNum">    1068 </span><span class="lineCov">          2 :         } else if (type==1) {</span>
<span class="lineNum">    1069 </span><span class="lineCov">          1 :                 fprintf(stderr, &quot;Select Navigation (\'N\'one, \'E\'xamine, \'S\'lide): &quot;);</span>
<span class="lineNum">    1070 </span><span class="lineCov">          1 :                 nav = do_coverage ? 'N' : getch();</span>
<span class="lineNum">    1071 </span><span class="lineCov">          1 :                 if (nav=='N') e = gf_term_set_option(term, GF_OPT_NAVIGATION, GF_NAVIGATE_NONE);</span>
<span class="lineNum">    1072 </span>            :                 else if (nav=='E') e = gf_term_set_option(term, GF_OPT_NAVIGATION, GF_NAVIGATE_EXAMINE);
<span class="lineNum">    1073 </span>            :                 else if (nav=='S') e = gf_term_set_option(term, GF_OPT_NAVIGATION, GF_NAVIGATE_SLIDE);
<span class="lineNum">    1074 </span><span class="lineNoCov">          0 :                 else fprintf(stderr, &quot;Unknown selector \'%c\' - only \'N\',\'E\',\'S\' allowed\n&quot;, nav);</span>
<span class="lineNum">    1075 </span><span class="lineCov">          1 :         } else if (type==2) {</span>
<span class="lineNum">    1076 </span><span class="lineCov">          1 :                 fprintf(stderr, &quot;Select Navigation (\'N\'one, \'W\'alk, \'F\'ly, \'E\'xamine, \'P\'an, \'S\'lide, \'G\'ame, \'V\'R, \'O\'rbit): &quot;);</span>
<span class="lineNum">    1077 </span><span class="lineCov">          1 :                 nav = do_coverage ? 'N' : getch();</span>
<span class="lineNum">    1078 </span><span class="lineCov">          1 :                 if (nav=='N') e = gf_term_set_option(term, GF_OPT_NAVIGATION, GF_NAVIGATE_NONE);</span>
<span class="lineNum">    1079 </span>            :                 else if (nav=='W') e = gf_term_set_option(term, GF_OPT_NAVIGATION, GF_NAVIGATE_WALK);
<span class="lineNum">    1080 </span>            :                 else if (nav=='F') e = gf_term_set_option(term, GF_OPT_NAVIGATION, GF_NAVIGATE_FLY);
<span class="lineNum">    1081 </span>            :                 else if (nav=='E') e = gf_term_set_option(term, GF_OPT_NAVIGATION, GF_NAVIGATE_EXAMINE);
<span class="lineNum">    1082 </span>            :                 else if (nav=='P') e = gf_term_set_option(term, GF_OPT_NAVIGATION, GF_NAVIGATE_PAN);
<span class="lineNum">    1083 </span>            :                 else if (nav=='S') e = gf_term_set_option(term, GF_OPT_NAVIGATION, GF_NAVIGATE_SLIDE);
<span class="lineNum">    1084 </span>            :                 else if (nav=='G') e = gf_term_set_option(term, GF_OPT_NAVIGATION, GF_NAVIGATE_GAME);
<span class="lineNum">    1085 </span>            :                 else if (nav=='O') e = gf_term_set_option(term, GF_OPT_NAVIGATION, GF_NAVIGATE_ORBIT);
<span class="lineNum">    1086 </span>            :                 else if (nav=='V') e = gf_term_set_option(term, GF_OPT_NAVIGATION, GF_NAVIGATE_VR);
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :                 else fprintf(stderr, &quot;Unknown selector %c - only \'N\',\'W\',\'F\',\'E\',\'P\',\'S\',\'G\', \'V\', \'O\' allowed\n&quot;, nav);</span>
<span class="lineNum">    1088 </span>            :         }
<span class="lineNum">    1089 </span><span class="lineCov">          2 :         if (e) fprintf(stderr, &quot;Error setting mode: %s\n&quot;, gf_error_to_string(e));</span>
<span class="lineNum">    1090 </span><span class="lineCov">          2 : }</span>
<a name="1091"><span class="lineNum">    1091 </span>            : </a>
<span class="lineNum">    1092 </span>            : 
<span class="lineNum">    1093 </span><span class="lineNoCov">          0 : static void on_rti_log(void *cbk, GF_LOG_Level ll, GF_LOG_Tool lm, const char *fmt, va_list list)</span>
<span class="lineNum">    1094 </span>            : {
<span class="lineNum">    1095 </span><span class="lineNoCov">          0 :         if (rti_logs &amp;&amp; (lm &amp; GF_LOG_RTI)) {</span>
<span class="lineNum">    1096 </span>            :                 char szMsg[2048];
<span class="lineNum">    1097 </span>            :                 vsnprintf(szMsg, 2048, fmt, list);
<span class="lineNum">    1098 </span><span class="lineNoCov">          0 :                 UpdateRTInfo(szMsg + 6 /*&quot;[RTI] &quot;*/);</span>
<span class="lineNum">    1099 </span>            :         }
<a name="1100"><span class="lineNum">    1100 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    1101 </span>            : 
<span class="lineNum">    1102 </span><span class="lineNoCov">          0 : static void init_rti_logs(char *rti_file, char *url, Bool use_rtix)</span>
<span class="lineNum">    1103 </span>            : {
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :         if (rti_logs) gf_fclose(rti_logs);</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :         rti_logs = gf_fopen(rti_file, &quot;wt&quot;);</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :         if (rti_logs) {</span>
<span class="lineNum">    1107 </span>            :                 fprintf(rti_logs, &quot;!! GPAC RunTime Info &quot;);
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :                 if (url) fprintf(rti_logs, &quot;for file %s&quot;, url);</span>
<span class="lineNum">    1109 </span><span class="lineNoCov">          0 :                 fprintf(rti_logs, &quot; !!\n&quot;);</span>
<span class="lineNum">    1110 </span><span class="lineNoCov">          0 :                 fprintf(rti_logs, &quot;SysTime(ms)\tSceneTime(ms)\tCPU\tFPS\tMemory(kB)\tObservation\n&quot;);</span>
<span class="lineNum">    1111 </span>            : 
<span class="lineNum">    1112 </span>            :                 /*turn on RTI loging*/
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :                 if (use_rtix) {</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :                         gf_log_set_callback(NULL, on_rti_log);</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :                         gf_log_set_tool_level(GF_LOG_RTI, GF_LOG_DEBUG);</span>
<span class="lineNum">    1116 </span>            : 
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :                         GF_LOG(GF_LOG_DEBUG, GF_LOG_RTI, (&quot;[RTI] System state when enabling log\n&quot;));</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">          0 :                 } else if (log_rti_time_start) {</span>
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 :                         log_rti_time_start = gf_sys_clock_high_res();</span>
<span class="lineNum">    1120 </span>            :                 }
<span class="lineNum">    1121 </span>            :         }
<span class="lineNum">    1122 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1123 </span>            : 
<span class="lineNum">    1124 </span>            : 
<span class="lineNum">    1125 </span>            : #ifdef WIN32
<span class="lineNum">    1126 </span>            : #include &lt;wincon.h&gt;
<a name="1127"><span class="lineNum">    1127 </span>            : #endif</a>
<span class="lineNum">    1128 </span>            : 
<span class="lineNum">    1129 </span><span class="lineCov">          9 : int mp4client_main(int argc, char **argv)</span>
<span class="lineNum">    1130 </span>            : {
<span class="lineNum">    1131 </span>            :         char c;
<span class="lineNum">    1132 </span>            :         MP4C_Command cmdtype;
<span class="lineNum">    1133 </span>            :         const char *str;
<span class="lineNum">    1134 </span>            :         GF_Err e;
<span class="lineNum">    1135 </span>            :         u32 i, ll;
<span class="lineNum">    1136 </span>            :         u32 simulation_time_in_ms = 0;
<span class="lineNum">    1137 </span>            :         u32 initial_service_id = 0;
<span class="lineNum">    1138 </span>            :         Bool auto_exit = GF_FALSE;
<span class="lineNum">    1139 </span>            :         Bool start_fs = GF_FALSE;
<span class="lineNum">    1140 </span>            :         Bool use_rtix = GF_FALSE;
<span class="lineNum">    1141 </span>            :         Bool pause_at_first = GF_FALSE;
<span class="lineNum">    1142 </span>            :         Bool no_cfg_save = GF_FALSE;
<span class="lineNum">    1143 </span>            :         Bool print_stats = GF_FALSE;
<span class="lineNum">    1144 </span>            :         Bool print_graph = GF_FALSE;
<span class="lineNum">    1145 </span>            :         Bool no_keyboard = GF_FALSE;
<span class="lineNum">    1146 </span>            :         Double play_from = 0;
<span class="lineNum">    1147 </span>            : #ifdef GPAC_MEMORY_TRACKING
<span class="lineNum">    1148 </span>            :     GF_MemTrackerType mem_track = GF_MemTrackerNone;
<span class="lineNum">    1149 </span>            : #endif
<span class="lineNum">    1150 </span>            :         Bool has_command;
<span class="lineNum">    1151 </span>            :         char *url_arg, *gpac_profile, *rti_file;
<span class="lineNum">    1152 </span>            :         FILE *logfile = NULL;
<span class="lineNum">    1153 </span>            : #ifndef WIN32
<span class="lineNum">    1154 </span><span class="lineCov">          9 :         dlopen(NULL, RTLD_NOW|RTLD_GLOBAL);</span>
<span class="lineNum">    1155 </span>            : #endif
<span class="lineNum">    1156 </span>            : 
<span class="lineNum">    1157 </span><span class="lineCov">          9 :         helpout = stdout;</span>
<span class="lineNum">    1158 </span>            : 
<span class="lineNum">    1159 </span>            :         /*by default use current dir*/
<span class="lineNum">    1160 </span>            :         strcpy(the_url, &quot;.&quot;);
<span class="lineNum">    1161 </span>            : 
<span class="lineNum">    1162 </span>            :         memset(&amp;user, 0, sizeof(GF_User));
<span class="lineNum">    1163 </span>            : 
<span class="lineNum">    1164 </span>            :         has_command = GF_FALSE;
<span class="lineNum">    1165 </span>            :         url_arg = gpac_profile = rti_file = NULL;
<span class="lineNum">    1166 </span>            : 
<span class="lineNum">    1167 </span>            :         /*first identify profile and mem tracking */
<span class="lineNum">    1168 </span><span class="lineCov">         80 :         for (i=1; i&lt;(u32) argc; i++) {</span>
<span class="lineNum">    1169 </span><span class="lineCov">         71 :                 char *arg = argv[i];</span>
<span class="lineNum">    1170 </span><span class="lineCov">         71 :                 if (!strcmp(arg, &quot;-p&quot;)) {</span>
<span class="lineNum">    1171 </span><span class="lineNoCov">          0 :                         gpac_profile = argv[i+1];</span>
<span class="lineNum">    1172 </span>            :                         i++;
<span class="lineNum">    1173 </span><span class="lineCov">         71 :                 } else if (!strncmp(arg, &quot;-p=&quot;, 3)) {</span>
<span class="lineNum">    1174 </span><span class="lineCov">          9 :                         gpac_profile = argv[i]+3;</span>
<span class="lineNum">    1175 </span><span class="lineCov">         62 :                 } else if (!strcmp(arg, &quot;-mem-track&quot;) || !strcmp(arg, &quot;-mem-track-stack&quot;)) {</span>
<span class="lineNum">    1176 </span>            : #ifdef GPAC_MEMORY_TRACKING
<span class="lineNum">    1177 </span><span class="lineCov">          9 :             mem_track = !strcmp(arg, &quot;-mem-track-stack&quot;) ? GF_MemTrackerBackTrace : GF_MemTrackerSimple;</span>
<span class="lineNum">    1178 </span>            : #else
<span class="lineNum">    1179 </span>            :                         fprintf(stderr, &quot;WARNING - GPAC not compiled with Memory Tracker - ignoring \&quot;%s\&quot;\n&quot;, arg);
<span class="lineNum">    1180 </span>            : #endif
<span class="lineNum">    1181 </span><span class="lineCov">         53 :                 } else if (!strcmp(arg, &quot;-gui&quot;)) {</span>
<span class="lineNum">    1182 </span><span class="lineCov">          1 :                         gui_mode = 1;</span>
<span class="lineNum">    1183 </span><span class="lineCov">         52 :                 } else if (!strcmp(arg, &quot;-guid&quot;)) {</span>
<span class="lineNum">    1184 </span><span class="lineCov">          2 :                         gui_mode = 2;</span>
<span class="lineNum">    1185 </span><span class="lineCov">         50 :                 } else if (!strcmp(arg, &quot;-h&quot;) || !strcmp(arg, &quot;-help&quot;)) {</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :                         PrintUsage(GF_FALSE);</span>
<span class="lineNum">    1187 </span><span class="lineNoCov">          0 :                         return 0;</span>
<span class="lineNum">    1188 </span><span class="lineCov">         50 :                 } else if (!strcmp(arg, &quot;-hx&quot;)) {</span>
<span class="lineNum">    1189 </span><span class="lineNoCov">          0 :                         PrintUsage(GF_TRUE);</span>
<span class="lineNum">    1190 </span><span class="lineNoCov">          0 :                         return 0;</span>
<span class="lineNum">    1191 </span><span class="lineCov">         50 :                 } else if (!strcmp(arg, &quot;-hr&quot;)) {</span>
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :                         PrintHelp();</span>
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 :                         return 0;</span>
<span class="lineNum">    1194 </span><span class="lineCov">         50 :                 } else if (!strcmp(arg, &quot;-hc&quot;)) {</span>
<span class="lineNum">    1195 </span>            :                         fprintf(helpout, &quot;libgpac options:\n&quot;);
<span class="lineNum">    1196 </span><span class="lineNoCov">          0 :                         gf_sys_print_core_help(helpout, help_flags, GF_ARGMODE_ALL, 0);</span>
<span class="lineNum">    1197 </span><span class="lineNoCov">          0 :                         return 0;</span>
<span class="lineNum">    1198 </span>            :                 }
<span class="lineNum">    1199 </span>            :         }
<span class="lineNum">    1200 </span>            : 
<span class="lineNum">    1201 </span>            : #ifdef GPAC_MEMORY_TRACKING
<span class="lineNum">    1202 </span><span class="lineCov">          9 :         gf_sys_init(mem_track, gpac_profile);</span>
<span class="lineNum">    1203 </span>            : #else
<span class="lineNum">    1204 </span>            :         gf_sys_init(GF_MemTrackerNone, gpac_profile);
<span class="lineNum">    1205 </span>            : #endif
<span class="lineNum">    1206 </span>            : 
<span class="lineNum">    1207 </span><span class="lineCov">          9 :         gf_log_set_tool_level(GF_LOG_ALL, GF_LOG_WARNING);</span>
<span class="lineNum">    1208 </span>            :         //we by default want 2 additional threads:
<span class="lineNum">    1209 </span>            :         //main thread might get locked on vsync
<span class="lineNum">    1210 </span>            :         //second thread might be busy decoding audio/video
<span class="lineNum">    1211 </span>            :         //third thread will then be able to refill all buffers/perform networks tasks
<span class="lineNum">    1212 </span><span class="lineCov">          9 :         gf_opts_set_key(&quot;temp&quot;, &quot;threads&quot;, &quot;2&quot;);</span>
<span class="lineNum">    1213 </span>            : 
<span class="lineNum">    1214 </span><span class="lineCov">          9 :         e = gf_sys_set_args(argc, (const char **) argv);</span>
<span class="lineNum">    1215 </span><span class="lineCov">          9 :         if (e) {</span>
<span class="lineNum">    1216 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Error assigning libgpac arguments: %s\n&quot;, gf_error_to_string(e) );</span>
<span class="lineNum">    1217 </span><span class="lineNoCov">          0 :                 gf_sys_close();</span>
<span class="lineNum">    1218 </span><span class="lineNoCov">          0 :                 return 1;</span>
<span class="lineNum">    1219 </span>            :         }
<span class="lineNum">    1220 </span>            : 
<span class="lineNum">    1221 </span><span class="lineCov">          9 :         if (!gui_mode) {</span>
<span class="lineNum">    1222 </span><span class="lineCov">          6 :                 str = gf_opts_get_key(&quot;General&quot;, &quot;ForceGUI&quot;);</span>
<span class="lineNum">    1223 </span><span class="lineCov">          6 :                 if (str &amp;&amp; !strcmp(str, &quot;yes&quot;)) gui_mode = 1;</span>
<span class="lineNum">    1224 </span>            :         }
<span class="lineNum">    1225 </span>            : 
<span class="lineNum">    1226 </span><span class="lineCov">         63 :         for (i=1; i&lt;(u32) argc; i++) {</span>
<span class="lineNum">    1227 </span><span class="lineCov">         65 :                 char *arg = argv[i];</span>
<span class="lineNum">    1228 </span>            : 
<span class="lineNum">    1229 </span><span class="lineCov">         65 :                 if (!strcmp(arg, &quot;-genmd&quot;)) {</span>
<span class="lineNum">    1230 </span><span class="lineCov">          1 :                         help_flags = GF_PRINTARG_MD;</span>
<span class="lineNum">    1231 </span><span class="lineCov">          1 :                         helpout = gf_fopen(&quot;mp4client.md&quot;, &quot;w&quot;);</span>
<span class="lineNum">    1232 </span>            : 
<span class="lineNum">    1233 </span>            :                         fprintf(helpout, &quot;[**HOME**](Home) » MP4Client  \n&quot;);
<span class="lineNum">    1234 </span><span class="lineCov">          1 :                         fprintf(helpout, &quot;&lt;!-- automatically generated - do not edit, patch gpac/applications/mp4client/main.c --&gt;\n&quot;);</span>
<span class="lineNum">    1235 </span><span class="lineCov">          1 :                         PrintUsage(GF_TRUE);</span>
<span class="lineNum">    1236 </span><span class="lineCov">          1 :                         PrintHelp();</span>
<span class="lineNum">    1237 </span><span class="lineCov">          1 :                         gf_fclose(helpout);</span>
<span class="lineNum">    1238 </span><span class="lineCov">          1 :                         gf_sys_close();</span>
<span class="lineNum">    1239 </span><span class="lineCov">          1 :                         return 0;</span>
<span class="lineNum">    1240 </span><span class="lineCov">         64 :                 } else if (!strcmp(arg, &quot;-genman&quot;)) {</span>
<span class="lineNum">    1241 </span><span class="lineCov">          1 :                         help_flags = GF_PRINTARG_MAN;</span>
<span class="lineNum">    1242 </span><span class="lineCov">          1 :                         helpout = gf_fopen(&quot;mp4client.1&quot;, &quot;w&quot;);</span>
<span class="lineNum">    1243 </span>            : 
<span class="lineNum">    1244 </span>            : 
<span class="lineNum">    1245 </span>            :                         fprintf(helpout, &quot;.TH MP4Client 1 2019 MP4Client GPAC\n&quot;);
<span class="lineNum">    1246 </span><span class="lineCov">          1 :                         fprintf(helpout, &quot;.\n.SH NAME\n.LP\nMP4Client \\- GPAC command-line media player\n.SH SYNOPSIS\n.LP\n.B MP4Client\n.RI [options] \\ [file]\n.br\n.\n&quot;);</span>
<span class="lineNum">    1247 </span>            : 
<span class="lineNum">    1248 </span><span class="lineCov">          1 :                         PrintUsage(GF_TRUE);</span>
<span class="lineNum">    1249 </span><span class="lineCov">          1 :                         PrintHelp();</span>
<span class="lineNum">    1250 </span>            : 
<span class="lineNum">    1251 </span><span class="lineCov">          1 :                         fprintf(helpout, &quot;.SH EXAMPLES\n.TP\nBasic and advanced examples are available at https://wiki.gpac.io/mp4client\n&quot;);</span>
<span class="lineNum">    1252 </span><span class="lineCov">          1 :                         fprintf(helpout, &quot;.SH MORE\n.LP\nAuthors: GPAC developers, see git repo history (-log)\n&quot;</span>
<span class="lineNum">    1253 </span>            :                         &quot;.br\nFor bug reports, feature requests, more information and source code, visit https://github.com/gpac/gpac\n&quot;
<span class="lineNum">    1254 </span>            :                         &quot;.br\nbuild: %s\n&quot;
<span class="lineNum">    1255 </span>            :                         &quot;.br\nCopyright: %s\n.br\n&quot;
<span class="lineNum">    1256 </span>            :                         &quot;.SH SEE ALSO\n&quot;
<span class="lineNum">    1257 </span>            :                         &quot;.LP\ngpac(1), MP4Box(1)\n&quot;, gf_gpac_version(), gf_gpac_copyright());
<span class="lineNum">    1258 </span>            : 
<span class="lineNum">    1259 </span><span class="lineCov">          1 :                         gf_fclose(helpout);</span>
<span class="lineNum">    1260 </span><span class="lineCov">          1 :                         gf_sys_close();</span>
<span class="lineNum">    1261 </span><span class="lineCov">          1 :                         return 0;</span>
<span class="lineNum">    1262 </span><span class="lineCov">         63 :                 } else if (!strcmp(arg, &quot;-rti&quot;)) {</span>
<span class="lineNum">    1263 </span><span class="lineNoCov">          0 :                         rti_file = argv[i+1];</span>
<span class="lineNum">    1264 </span>            :                         i++;
<span class="lineNum">    1265 </span><span class="lineCov">         63 :                 } else if (!strcmp(arg, &quot;-rtix&quot;)) {</span>
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :                         rti_file = argv[i+1];</span>
<span class="lineNum">    1267 </span>            :                         i++;
<span class="lineNum">    1268 </span>            :                         use_rtix = GF_TRUE;
<span class="lineNum">    1269 </span><span class="lineCov">         63 :                 } else if (!strcmp(arg, &quot;-rti-refresh&quot;)) {</span>
<span class="lineNum">    1270 </span><span class="lineNoCov">          0 :                         rti_update_time_ms = atoi(argv[i+1]);</span>
<span class="lineNum">    1271 </span>            :                         i++;
<span class="lineNum">    1272 </span><span class="lineCov">         63 :                 } else if (!stricmp(arg, &quot;-size&quot;)) {</span>
<span class="lineNum">    1273 </span>            :                         /*usage of %ud breaks sscanf on MSVC*/
<span class="lineNum">    1274 </span><span class="lineNoCov">          0 :                         if (sscanf(argv[i+1], &quot;%dx%d&quot;, &amp;forced_width, &amp;forced_height) != 2) {</span>
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :                                 forced_width = forced_height = 0;</span>
<span class="lineNum">    1276 </span>            :                         }
<span class="lineNum">    1277 </span>            :                         i++;
<span class="lineNum">    1278 </span>            :                 }
<span class="lineNum">    1279 </span>            :                 //libgpac opts using an argument
<span class="lineNum">    1280 </span><span class="lineCov">         63 :                 else if (!strcmp(arg, &quot;-log-file&quot;) || !strcmp(arg, &quot;-lf&quot;) || !strcmp(arg, &quot;-logs&quot;) || !strcmp(arg, &quot;-cfg&quot;)  || !strcmp(arg, &quot;-ifce&quot;) ) {</span>
<span class="lineNum">    1281 </span><span class="lineNoCov">          0 :                         i++;</span>
<span class="lineNum">    1282 </span>            :                 }
<span class="lineNum">    1283 </span>            : 
<span class="lineNum">    1284 </span><span class="lineCov">         63 :                 else if (!strcmp(arg, &quot;-no-thread&quot;)) {</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">          0 :                         gf_opts_set_key(&quot;temp&quot;, &quot;threads&quot;, &quot;0&quot;);</span>
<span class="lineNum">    1286 </span>            :                 }
<span class="lineNum">    1287 </span><span class="lineCov">         63 :                 else if (!strcmp(arg, &quot;-no-audio&quot;)) {</span>
<span class="lineNum">    1288 </span><span class="lineCov">          2 :                         no_audio = GF_TRUE;</span>
<span class="lineNum">    1289 </span>            :                 }
<span class="lineNum">    1290 </span><span class="lineCov">         61 :                 else if (!strcmp(arg, &quot;-fs&quot;)) start_fs = 1;</span>
<span class="lineNum">    1291 </span><span class="lineCov">         60 :                 else if (!stricmp(arg, &quot;-no-save&quot;) || !stricmp(arg, &quot;--no-save&quot;) /*old versions used --n-save ...*/) {</span>
<span class="lineNum">    1292 </span>            :                         no_cfg_save=1;
<span class="lineNum">    1293 </span>            :                 }
<span class="lineNum">    1294 </span><span class="lineCov">         60 :                 else if (!stricmp(arg, &quot;-run-for&quot;)) {</span>
<span class="lineNum">    1295 </span><span class="lineCov">         12 :                         simulation_time_in_ms = (u32) (atof(argv[i+1]) * 1000);</span>
<span class="lineNum">    1296 </span><span class="lineCov">          6 :                         if (!simulation_time_in_ms)</span>
<span class="lineNum">    1297 </span>            :                                 simulation_time_in_ms = 1; /*1ms*/
<span class="lineNum">    1298 </span>            :                         i++;
<span class="lineNum">    1299 </span><span class="lineCov">         54 :                 } else if (!stricmp(arg, &quot;-scale&quot;)) {</span>
<span class="lineNum">    1300 </span><span class="lineNoCov">          0 :                         sscanf(argv[i+1], &quot;%f&quot;, &amp;scale);</span>
<span class="lineNum">    1301 </span>            :                         i++;
<span class="lineNum">    1302 </span>            :                 }
<span class="lineNum">    1303 </span>            :                 /* already parsed */
<span class="lineNum">    1304 </span><span class="lineCov">         54 :                 else if (!strcmp(arg, &quot;-nk&quot;)) {</span>
<span class="lineNum">    1305 </span>            :                         no_keyboard = GF_TRUE;
<span class="lineNum">    1306 </span>            :                 }
<span class="lineNum">    1307 </span>            :                 /* already parsed */
<span class="lineNum">    1308 </span><span class="lineCov">         54 :                 else if (!strcmp(arg, &quot;-p&quot;)) {</span>
<span class="lineNum">    1309 </span><span class="lineNoCov">          0 :                         i++;</span>
<span class="lineNum">    1310 </span>            :                 }
<span class="lineNum">    1311 </span>            :                 /* already parsed */
<span class="lineNum">    1312 </span><span class="lineCov">         54 :                 else if (!strcmp(arg, &quot;-mem-track&quot;) || !strcmp(arg, &quot;-mem-track-stack&quot;) || !strcmp(arg, &quot;-gui&quot;) || !strcmp(arg, &quot;-guid&quot;)</span>
<span class="lineNum">    1313 </span><span class="lineCov">         42 :                          || !strncmp(arg, &quot;-p=&quot;, 3)</span>
<span class="lineNum">    1314 </span>            :                 ) {
<span class="lineNum">    1315 </span>            :                 }
<span class="lineNum">    1316 </span>            : 
<span class="lineNum">    1317 </span>            :                 /*arguments only used in non-gui mode*/
<span class="lineNum">    1318 </span><span class="lineCov">         33 :                 else if (!gui_mode) {</span>
<span class="lineNum">    1319 </span><span class="lineCov">         20 :                         if (arg[0] != '-') {</span>
<span class="lineNum">    1320 </span><span class="lineCov">          4 :                                 if (url_arg) {</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Several input URLs provided (\&quot;%s\&quot;, \&quot;%s\&quot;). Check your command-line.\n&quot;, url_arg, arg);</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">          0 :                                         return 1;</span>
<span class="lineNum">    1323 </span>            :                                 }
<span class="lineNum">    1324 </span>            :                                 url_arg = arg;
<span class="lineNum">    1325 </span>            :                         }
<span class="lineNum">    1326 </span><span class="lineCov">         16 :                         else if (!strcmp(arg, &quot;-loop&quot;)) loop_at_end = 1;</span>
<span class="lineNum">    1327 </span><span class="lineCov">         16 :                         else if (!strcmp(arg, &quot;-bench&quot;)) bench_mode = 1;</span>
<span class="lineNum">    1328 </span><span class="lineCov">         16 :                         else if (!strcmp(arg, &quot;-vbench&quot;)) bench_mode = 2;</span>
<span class="lineNum">    1329 </span><span class="lineCov">         16 :                         else if (!strcmp(arg, &quot;-sbench&quot;)) bench_mode = 3;</span>
<span class="lineNum">    1330 </span><span class="lineCov">         16 :                         else if (!strcmp(arg, &quot;-no-addon&quot;)) enable_add_ons = GF_FALSE;</span>
<span class="lineNum">    1331 </span>            : 
<span class="lineNum">    1332 </span><span class="lineCov">         16 :                         else if (!strcmp(arg, &quot;-pause&quot;)) pause_at_first = 1;</span>
<span class="lineNum">    1333 </span><span class="lineCov">         16 :                         else if (!strcmp(arg, &quot;-play-from&quot;)) {</span>
<span class="lineNum">    1334 </span><span class="lineNoCov">          0 :                                 play_from = atof((const char *) argv[i+1]);</span>
<span class="lineNum">    1335 </span>            :                                 i++;
<span class="lineNum">    1336 </span>            :                         }
<span class="lineNum">    1337 </span><span class="lineCov">         16 :                         else if (!strcmp(arg, &quot;-speed&quot;)) {</span>
<span class="lineNum">    1338 </span><span class="lineNoCov">          0 :                                 playback_speed = FLT2FIX( atof((const char *) argv[i+1]) );</span>
<span class="lineNum">    1339 </span><span class="lineNoCov">          0 :                                 if (playback_speed &lt;= 0) playback_speed = FIX_ONE;</span>
<span class="lineNum">    1340 </span>            :                                 i++;
<span class="lineNum">    1341 </span>            :                         }
<span class="lineNum">    1342 </span><span class="lineCov">         16 :                         else if (!strcmp(arg, &quot;-no-wnd&quot;)) user.init_flags |= GF_TERM_WINDOWLESS;</span>
<span class="lineNum">    1343 </span><span class="lineCov">         16 :                         else if (!strcmp(arg, &quot;-no-back&quot;)) user.init_flags |= GF_TERM_WINDOW_TRANSPARENT;</span>
<span class="lineNum">    1344 </span><span class="lineCov">         16 :                         else if (!strcmp(arg, &quot;-align&quot;)) {</span>
<span class="lineNum">    1345 </span><span class="lineNoCov">          0 :                                 if (argv[i+1][0]=='m') align_mode = 1;</span>
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :                                 else if (argv[i+1][0]=='b') align_mode = 2;</span>
<span class="lineNum">    1347 </span><span class="lineNoCov">          0 :                                 align_mode &lt;&lt;= 8;</span>
<span class="lineNum">    1348 </span><span class="lineNoCov">          0 :                                 if (argv[i+1][1]=='m') align_mode |= 1;</span>
<span class="lineNum">    1349 </span><span class="lineNoCov">          0 :                                 else if (argv[i+1][1]=='r') align_mode |= 2;</span>
<span class="lineNum">    1350 </span>            :                                 i++;
<span class="lineNum">    1351 </span>            :                         }
<span class="lineNum">    1352 </span><span class="lineCov">         16 :                         else if (!strcmp(arg, &quot;-exit&quot;)) auto_exit = GF_TRUE;</span>
<span class="lineNum">    1353 </span><span class="lineCov">         16 :                         else if (!stricmp(arg, &quot;-com&quot;)) {</span>
<span class="lineNum">    1354 </span>            :                                 has_command = GF_TRUE;
<span class="lineNum">    1355 </span><span class="lineNoCov">          0 :                                 i++;</span>
<span class="lineNum">    1356 </span>            :                         }
<span class="lineNum">    1357 </span><span class="lineCov">         16 :                         else if (!stricmp(arg, &quot;-service&quot;)) {</span>
<span class="lineNum">    1358 </span><span class="lineNoCov">          0 :                                 initial_service_id = atoi(argv[i+1]);</span>
<span class="lineNum">    1359 </span>            :                                 i++;
<span class="lineNum">    1360 </span><span class="lineCov">         16 :                         } else if (!stricmp(arg, &quot;-stats&quot;)) {</span>
<span class="lineNum">    1361 </span>            :                                 print_stats=GF_TRUE;
<span class="lineNum">    1362 </span><span class="lineCov">         16 :                         } else if (!stricmp(arg, &quot;-graph&quot;)) {</span>
<span class="lineNum">    1363 </span>            :                                 print_graph=GF_TRUE;
<span class="lineNum">    1364 </span><span class="lineCov">         16 :                         } else if (!stricmp(arg, &quot;-cov&quot;)) {</span>
<span class="lineNum">    1365 </span><span class="lineCov">          2 :                                 do_coverage = GF_TRUE;</span>
<span class="lineNum">    1366 </span>            :                                 print_stats = GF_TRUE;
<span class="lineNum">    1367 </span>            :                                 print_graph = GF_TRUE;
<span class="lineNum">    1368 </span>            :                         } else {
<span class="lineNum">    1369 </span><span class="lineCov">         14 :                                 u32 res = gf_sys_is_gpac_arg(arg);</span>
<span class="lineNum">    1370 </span><span class="lineCov">         14 :                                 if (!res) {</span>
<span class="lineNum">    1371 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Unrecognized option %s\n&quot;, arg);</span>
<span class="lineNum">    1372 </span><span class="lineCov">         14 :                                 } else if (res==2) {</span>
<span class="lineNum">    1373 </span><span class="lineNoCov">          0 :                                         i++;</span>
<span class="lineNum">    1374 </span>            :                                 }
<span class="lineNum">    1375 </span>            :                         }
<span class="lineNum">    1376 </span><span class="lineCov">         13 :                 } else if (gf_sys_is_gpac_arg(arg)==2) {</span>
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :                         i++;</span>
<span class="lineNum">    1378 </span>            :                 }
<span class="lineNum">    1379 </span>            :         }
<span class="lineNum">    1380 </span>            : 
<span class="lineNum">    1381 </span>            :         //will run switch helpout to stderr
<span class="lineNum">    1382 </span><span class="lineCov">          7 :         helpout = stderr;</span>
<span class="lineNum">    1383 </span>            : 
<span class="lineNum">    1384 </span><span class="lineCov">          7 :         if (!gui_mode &amp;&amp; !url_arg &amp;&amp; (gf_opts_get_key(&quot;General&quot;, &quot;StartupFile&quot;) != NULL)) {</span>
<span class="lineNum">    1385 </span><span class="lineNoCov">          0 :                 gui_mode=1;</span>
<span class="lineNum">    1386 </span>            :         }
<span class="lineNum">    1387 </span>            : 
<span class="lineNum">    1388 </span>            : #ifdef WIN32
<span class="lineNum">    1389 </span>            :         if (gui_mode==1) {
<span class="lineNum">    1390 </span>            :                 const char *opt;
<span class="lineNum">    1391 </span>            :                 TCHAR buffer[1024];
<span class="lineNum">    1392 </span>            :                 DWORD res = GetCurrentDirectory(1024, buffer);
<span class="lineNum">    1393 </span>            :                 buffer[res] = 0;
<span class="lineNum">    1394 </span>            :                 opt = gf_opts_get_key(&quot;core&quot;, &quot;module-dir&quot;);
<span class="lineNum">    1395 </span>            :                 if (strstr(opt, buffer)) {
<span class="lineNum">    1396 </span>            :                         gui_mode=1;
<span class="lineNum">    1397 </span>            :                 } else {
<span class="lineNum">    1398 </span>            :                         gui_mode=2;
<span class="lineNum">    1399 </span>            :                 }
<span class="lineNum">    1400 </span>            :         }
<span class="lineNum">    1401 </span>            : #endif
<span class="lineNum">    1402 </span>            : 
<span class="lineNum">    1403 </span><span class="lineCov">          7 :         if (gui_mode==1) {</span>
<span class="lineNum">    1404 </span>            :                 hide_shell(1);
<span class="lineNum">    1405 </span>            :         }
<span class="lineNum">    1406 </span><span class="lineCov">          7 :         if (gui_mode) {</span>
<span class="lineNum">    1407 </span><span class="lineCov">          3 :                 gf_sys_set_cfg_option(&quot;core:noprog=yes&quot;);</span>
<span class="lineNum">    1408 </span>            :         }
<span class="lineNum">    1409 </span>            : 
<span class="lineNum">    1410 </span>            : #if defined(__DARWIN__) || defined(__APPLE__)
<span class="lineNum">    1411 </span>            :         carbon_init();
<span class="lineNum">    1412 </span>            : #endif
<span class="lineNum">    1413 </span>            : 
<span class="lineNum">    1414 </span>            : 
<span class="lineNum">    1415 </span><span class="lineCov">          7 :         if (rti_file) init_rti_logs(rti_file, url_arg, use_rtix);</span>
<span class="lineNum">    1416 </span>            : 
<span class="lineNum">    1417 </span>            :         {
<span class="lineNum">    1418 </span>            :                 GF_SystemRTInfo rti;
<span class="lineNum">    1419 </span><span class="lineCov">          7 :                 if (gf_sys_get_rti(0, &amp;rti, 0))</span>
<span class="lineNum">    1420 </span><span class="lineCov">          7 :                         fprintf(stderr, &quot;System info: %d MB RAM - %d cores\n&quot;, (u32) (rti.physical_memory/1024/1024), rti.nb_cores);</span>
<span class="lineNum">    1421 </span>            :         }
<span class="lineNum">    1422 </span>            : 
<span class="lineNum">    1423 </span>            : 
<span class="lineNum">    1424 </span><span class="lineCov">          7 :         init_w = forced_width;</span>
<span class="lineNum">    1425 </span><span class="lineCov">          7 :         init_h = forced_height;</span>
<span class="lineNum">    1426 </span>            : 
<span class="lineNum">    1427 </span><span class="lineCov">          7 :         user.EventProc = GPAC_EventProc;</span>
<span class="lineNum">    1428 </span>            :         /*dummy in this case (global vars) but MUST be non-NULL*/
<span class="lineNum">    1429 </span><span class="lineCov">          7 :         user.opaque = &amp;user;</span>
<span class="lineNum">    1430 </span>            : 
<span class="lineNum">    1431 </span><span class="lineCov">          7 :         if (no_audio) user.init_flags |= GF_TERM_NO_AUDIO;</span>
<span class="lineNum">    1432 </span>            : 
<span class="lineNum">    1433 </span><span class="lineCov">          7 :         if (bench_mode) {</span>
<span class="lineNum">    1434 </span><span class="lineNoCov">          0 :                 gf_opts_discard_changes();</span>
<span class="lineNum">    1435 </span>            :                 auto_exit = GF_TRUE;
<span class="lineNum">    1436 </span><span class="lineNoCov">          0 :                 if (bench_mode!=2) user.init_flags |= GF_TERM_NO_VIDEO;</span>
<span class="lineNum">    1437 </span>            :         }
<span class="lineNum">    1438 </span>            : 
<span class="lineNum">    1439 </span><span class="lineCov">          7 :         if (forced_width &amp;&amp; forced_height) {</span>
<span class="lineNum">    1440 </span>            :                 char dim[50];
<span class="lineNum">    1441 </span>            :                 sprintf(dim, &quot;%d&quot;, forced_width);
<span class="lineNum">    1442 </span><span class="lineNoCov">          0 :                 gf_opts_set_key(&quot;Temp&quot;, &quot;DefaultWidth&quot;, dim);</span>
<span class="lineNum">    1443 </span><span class="lineNoCov">          0 :                 sprintf(dim, &quot;%d&quot;, forced_height);</span>
<span class="lineNum">    1444 </span><span class="lineNoCov">          0 :                 gf_opts_set_key(&quot;Temp&quot;, &quot;DefaultHeight&quot;, dim);</span>
<span class="lineNum">    1445 </span>            :         }
<span class="lineNum">    1446 </span>            : 
<span class="lineNum">    1447 </span><span class="lineCov">          7 :         fprintf(stderr, &quot;Loading GPAC Terminal\n&quot;);</span>
<span class="lineNum">    1448 </span><span class="lineCov">          7 :         i = gf_sys_clock();</span>
<span class="lineNum">    1449 </span>            : 
<span class="lineNum">    1450 </span><span class="lineCov">          7 :         term = gf_term_new(&amp;user);</span>
<span class="lineNum">    1451 </span><span class="lineCov">          7 :         if (!term) {</span>
<span class="lineNum">    1452 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;\nInit error - check you have at least one video out and one rasterizer...\nFound modules:\n&quot;);</span>
<span class="lineNum">    1453 </span><span class="lineNoCov">          0 :                 list_modules();</span>
<span class="lineNum">    1454 </span><span class="lineNoCov">          0 :                 gf_opts_discard_changes();</span>
<span class="lineNum">    1455 </span><span class="lineNoCov">          0 :                 gf_sys_close();</span>
<span class="lineNum">    1456 </span>            :                 if (logfile) gf_fclose(logfile);
<span class="lineNum">    1457 </span><span class="lineNoCov">          0 :                 return 1;</span>
<span class="lineNum">    1458 </span>            :         }
<span class="lineNum">    1459 </span><span class="lineCov">          7 :         fprintf(stderr, &quot;Terminal Loaded in %d ms\n&quot;, gf_sys_clock()-i);</span>
<span class="lineNum">    1460 </span>            : 
<span class="lineNum">    1461 </span><span class="lineCov">          7 :         if (bench_mode) {</span>
<span class="lineNum">    1462 </span><span class="lineNoCov">          0 :                 display_rti = 2;</span>
<span class="lineNum">    1463 </span><span class="lineNoCov">          0 :                 gf_term_set_option(term, GF_OPT_VIDEO_BENCH, (bench_mode==3) ? 2 : 1);</span>
<span class="lineNum">    1464 </span><span class="lineNoCov">          0 :                 if (bench_mode==1) bench_mode=2;</span>
<span class="lineNum">    1465 </span>            :         }
<span class="lineNum">    1466 </span>            : 
<span class="lineNum">    1467 </span><span class="lineCov">          7 :         str = gf_opts_get_key(&quot;General&quot;, &quot;NoMIMETypeFetch&quot;);</span>
<span class="lineNum">    1468 </span><span class="lineCov">          7 :         no_mime_check = (str &amp;&amp; !stricmp(str, &quot;yes&quot;)) ? 1 : 0;</span>
<span class="lineNum">    1469 </span>            : 
<span class="lineNum">    1470 </span><span class="lineCov">          7 :         if (gf_opts_get_bool(&quot;core&quot;, &quot;proxy-on&quot;)) {</span>
<span class="lineNum">    1471 </span><span class="lineNoCov">          0 :                 str = gf_opts_get_key(&quot;core&quot;, &quot;proxy-name&quot;);</span>
<span class="lineNum">    1472 </span><span class="lineNoCov">          0 :                 if (str) fprintf(stderr, &quot;HTTP Proxy %s enabled\n&quot;, str);</span>
<span class="lineNum">    1473 </span>            :         }
<span class="lineNum">    1474 </span>            : 
<span class="lineNum">    1475 </span><span class="lineCov">          7 :         if (rti_file) {</span>
<span class="lineNum">    1476 </span><span class="lineNoCov">          0 :                 UpdateRTInfo(&quot;At GPAC load time\n&quot;);</span>
<span class="lineNum">    1477 </span>            :         }
<span class="lineNum">    1478 </span>            : 
<span class="lineNum">    1479 </span><span class="lineCov">          7 :         Run = 1;</span>
<span class="lineNum">    1480 </span>            : 
<span class="lineNum">    1481 </span><span class="lineCov">          7 :         if (url_arg &amp;&amp; !strcmp(url_arg, &quot;NOGUI&quot;)) {</span>
<span class="lineNum">    1482 </span>            :                 url_arg = NULL;
<span class="lineNum">    1483 </span>            :         }
<span class="lineNum">    1484 </span>            :         /*connect if requested*/
<span class="lineNum">    1485 </span><span class="lineCov">          7 :         else if (!gui_mode &amp;&amp; url_arg) {</span>
<span class="lineNum">    1486 </span>            :                 char *ext;
<span class="lineNum">    1487 </span>            : 
<span class="lineNum">    1488 </span><span class="lineCov">          4 :                 if (strlen(url_arg) &gt;= sizeof(the_url)) {</span>
<span class="lineNum">    1489 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Input url %s is too long, truncating to %d chars.\n&quot;, url_arg, (int)(sizeof(the_url) - 1));</span>
<span class="lineNum">    1490 </span>            :                         strncpy(the_url, url_arg, sizeof(the_url)-1);
<span class="lineNum">    1491 </span><span class="lineNoCov">          0 :                         the_url[sizeof(the_url) - 1] = 0;</span>
<span class="lineNum">    1492 </span>            :                 }
<span class="lineNum">    1493 </span>            :                 else {
<span class="lineNum">    1494 </span>            :                         strcpy(the_url, url_arg);
<span class="lineNum">    1495 </span>            :                 }
<span class="lineNum">    1496 </span><span class="lineCov">          4 :                 ext = strrchr(the_url, '.');</span>
<span class="lineNum">    1497 </span><span class="lineCov">          4 :                 if (ext &amp;&amp; (!stricmp(ext, &quot;.m3u&quot;) || !stricmp(ext, &quot;.pls&quot;))) {</span>
<span class="lineNum">    1498 </span>            :                         e = GF_OK;
<span class="lineNum">    1499 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Opening Playlist %s\n&quot;, the_url);</span>
<span class="lineNum">    1500 </span>            : 
<span class="lineNum">    1501 </span>            :                         strcpy(pl_path, the_url);
<span class="lineNum">    1502 </span>            :                         /*this is not clean, we need to have a plugin handle playlist for ourselves*/
<span class="lineNum">    1503 </span>            :                         if (!strncmp(&quot;http:&quot;, the_url, 5)) {
<span class="lineNum">    1504 </span>            : #ifdef FILTER_FIXME
<span class="lineNum">    1505 </span>            :                                 GF_DownloadSession *sess = gf_dm_sess_new(term-&gt;downloader, the_url, GF_NETIO_SESSION_NOT_THREADED, NULL, NULL, &amp;e);
<span class="lineNum">    1506 </span>            :                                 if (sess) {
<span class="lineNum">    1507 </span>            :                                         e = gf_dm_sess_process(sess);
<span class="lineNum">    1508 </span>            :                                         if (!e) {
<span class="lineNum">    1509 </span>            :                                                 strncpy(the_url, gf_dm_sess_get_cache_name(sess), sizeof(the_url) - 1);
<span class="lineNum">    1510 </span>            :                                                 the_url[sizeof(the_url) - 1] = 0;
<span class="lineNum">    1511 </span>            :                                         }
<span class="lineNum">    1512 </span>            :                                         gf_dm_sess_del(sess);
<span class="lineNum">    1513 </span>            :                                 }
<span class="lineNum">    1514 </span>            : #endif
<span class="lineNum">    1515 </span>            :                         }
<span class="lineNum">    1516 </span>            : 
<span class="lineNum">    1517 </span><span class="lineNoCov">          0 :                         playlist = e ? NULL : gf_fopen(the_url, &quot;rt&quot;);</span>
<span class="lineNum">    1518 </span><span class="lineNoCov">          0 :                         readonly_playlist = 1;</span>
<span class="lineNum">    1519 </span><span class="lineNoCov">          0 :                         if (playlist) {</span>
<span class="lineNum">    1520 </span><span class="lineNoCov">          0 :                                 request_next_playlist_item = GF_TRUE;</span>
<span class="lineNum">    1521 </span>            :                         } else {
<span class="lineNum">    1522 </span>            :                                 if (e)
<span class="lineNum">    1523 </span>            :                                         fprintf(stderr, &quot;Failed to open playlist %s: %s\n&quot;, the_url, gf_error_to_string(e) );
<span class="lineNum">    1524 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Hit 'h' for help\n\n&quot;);</span>
<span class="lineNum">    1525 </span>            :                         }
<span class="lineNum">    1526 </span>            :                 } else {
<span class="lineNum">    1527 </span><span class="lineCov">          4 :                         fprintf(stderr, &quot;Opening URL %s\n&quot;, the_url);</span>
<span class="lineNum">    1528 </span><span class="lineCov">          4 :                         if (pause_at_first) fprintf(stderr, &quot;[Status: Paused]\n&quot;);</span>
<span class="lineNum">    1529 </span><span class="lineCov">          4 :                         gf_term_connect_from_time(term, the_url, (u64) (play_from*1000), pause_at_first);</span>
<span class="lineNum">    1530 </span>            :                 }
<span class="lineNum">    1531 </span>            :         } else {
<span class="lineNum">    1532 </span><span class="lineCov">          3 :                 fprintf(stderr, &quot;Hit 'h' for help\n\n&quot;);</span>
<span class="lineNum">    1533 </span><span class="lineCov">          3 :                 str = gf_opts_get_key(&quot;General&quot;, &quot;StartupFile&quot;);</span>
<span class="lineNum">    1534 </span><span class="lineCov">          3 :                 if (str) {</span>
<span class="lineNum">    1535 </span><span class="lineCov">          3 :                         snprintf(the_url, sizeof(the_url)-1, &quot;MP4Client %s&quot;, gf_gpac_version() );</span>
<span class="lineNum">    1536 </span><span class="lineCov">          3 :                         the_url[sizeof(the_url) - 1] = 0;</span>
<span class="lineNum">    1537 </span><span class="lineCov">          3 :                         gf_term_connect(term, str);</span>
<span class="lineNum">    1538 </span><span class="lineCov">          3 :                         startup_file = 1;</span>
<span class="lineNum">    1539 </span><span class="lineCov">          3 :                         is_connected = 1;</span>
<span class="lineNum">    1540 </span>            :                 }
<span class="lineNum">    1541 </span>            :         }
<span class="lineNum">    1542 </span><span class="lineCov">          7 :         if (gui_mode==2) gui_mode=0;</span>
<span class="lineNum">    1543 </span>            : 
<span class="lineNum">    1544 </span><span class="lineCov">          7 :         if (start_fs) gf_term_set_option(term, GF_OPT_FULLSCREEN, 1);</span>
<span class="lineNum">    1545 </span>            : 
<span class="lineNum">    1546 </span><span class="lineCov">          7 :         if (bench_mode) {</span>
<span class="lineNum">    1547 </span><span class="lineNoCov">          0 :                 rti_update_time_ms = 500;</span>
<span class="lineNum">    1548 </span><span class="lineNoCov">          0 :                 bench_mode_start = gf_sys_clock();</span>
<span class="lineNum">    1549 </span>            :         }
<span class="lineNum">    1550 </span>            : 
<span class="lineNum">    1551 </span><span class="lineCov">          7 :         if (simulation_time_in_ms)</span>
<span class="lineNum">    1552 </span><span class="lineCov">          6 :                 simulation_time_in_ms += gf_sys_clock();</span>
<span class="lineNum">    1553 </span>            : 
<span class="lineNum">    1554 </span>            : 
<span class="lineNum">    1555 </span><span class="lineCov">        411 :         while (Run) {</span>
<span class="lineNum">    1556 </span>            : 
<span class="lineNum">    1557 </span>            :                 /*we don't want getchar to block*/
<span class="lineNum">    1558 </span><span class="lineCov">        404 :                 if ((gui_mode==1) || (no_keyboard || !gf_prompt_has_input()) ) {</span>
<span class="lineNum">    1559 </span><span class="lineCov">        404 :                         if (reload) {</span>
<span class="lineNum">    1560 </span><span class="lineNoCov">          0 :                                 reload = 0;</span>
<span class="lineNum">    1561 </span><span class="lineNoCov">          0 :                                 gf_term_disconnect(term);</span>
<span class="lineNum">    1562 </span><span class="lineNoCov">          0 :                                 gf_term_connect(term, startup_file ? gf_opts_get_key(&quot;General&quot;, &quot;StartupFile&quot;) : the_url);</span>
<span class="lineNum">    1563 </span>            :                         }
<span class="lineNum">    1564 </span><span class="lineCov">        404 :                         if (restart &amp;&amp; gf_term_get_option(term, GF_OPT_IS_OVER)) {</span>
<span class="lineNum">    1565 </span><span class="lineNoCov">          0 :                                 restart = 0;</span>
<span class="lineNum">    1566 </span><span class="lineNoCov">          0 :                                 gf_term_play_from_time(term, 0, 0);</span>
<span class="lineNum">    1567 </span>            :                         }
<span class="lineNum">    1568 </span><span class="lineCov">        404 :                         if (request_next_playlist_item) {</span>
<span class="lineNum">    1569 </span>            :                                 c = '\n';
<span class="lineNum">    1570 </span><span class="lineNoCov">          0 :                                 request_next_playlist_item = 0;</span>
<span class="lineNum">    1571 </span>            :                                 goto force_input;
<span class="lineNum">    1572 </span>            :                         }
<span class="lineNum">    1573 </span>            : 
<span class="lineNum">    1574 </span><span class="lineCov">        404 :                         if (has_command &amp;&amp; is_connected) {</span>
<span class="lineNum">    1575 </span>            :                                 has_command = GF_FALSE;
<span class="lineNum">    1576 </span><span class="lineNoCov">          0 :                                 for (i=0; i&lt;(u32)argc; i++) {</span>
<span class="lineNum">    1577 </span><span class="lineNoCov">          0 :                                         if (!strcmp(argv[i], &quot;-com&quot;)) {</span>
<span class="lineNum">    1578 </span><span class="lineNoCov">          0 :                                                 gf_term_scene_update(term, NULL, argv[i+1]);</span>
<span class="lineNum">    1579 </span>            :                                                 i++;
<span class="lineNum">    1580 </span>            :                                         }
<span class="lineNum">    1581 </span>            :                                 }
<span class="lineNum">    1582 </span>            :                         }
<span class="lineNum">    1583 </span><span class="lineCov">        404 :                         if (initial_service_id &amp;&amp; is_connected) {</span>
<span class="lineNum">    1584 </span><span class="lineNoCov">          0 :                                 GF_ObjectManager *root_od = gf_term_get_root_object(term);</span>
<span class="lineNum">    1585 </span><span class="lineNoCov">          0 :                                 if (root_od) {</span>
<span class="lineNum">    1586 </span><span class="lineNoCov">          0 :                                         gf_term_select_service(term, root_od, initial_service_id);</span>
<span class="lineNum">    1587 </span>            :                                         initial_service_id = 0;
<span class="lineNum">    1588 </span>            :                                 }
<span class="lineNum">    1589 </span>            :                         }
<span class="lineNum">    1590 </span>            : 
<span class="lineNum">    1591 </span><span class="lineCov">        404 :                         if (!use_rtix || display_rti) UpdateRTInfo(NULL);</span>
<span class="lineNum">    1592 </span>            : 
<span class="lineNum">    1593 </span>            : 
<span class="lineNum">    1594 </span><span class="lineCov">        404 :                         gf_term_process_step(term);</span>
<span class="lineNum">    1595 </span>            : 
<span class="lineNum">    1596 </span><span class="lineCov">        404 :                         if (auto_exit &amp;&amp; eos_seen &amp;&amp; gf_term_get_option(term, GF_OPT_IS_OVER)) {</span>
<span class="lineNum">    1597 </span><span class="lineNoCov">          0 :                                 Run = GF_FALSE;</span>
<span class="lineNum">    1598 </span>            :                         }
<span class="lineNum">    1599 </span>            : 
<span class="lineNum">    1600 </span>            :                         /*sim time*/
<span class="lineNum">    1601 </span><span class="lineCov">        404 :                         if (simulation_time_in_ms</span>
<span class="lineNum">    1602 </span><span class="lineCov">        256 :                                 &amp;&amp; ( (gf_term_get_elapsed_time_in_ms(term)&gt;simulation_time_in_ms) || (!url_arg &amp;&amp; gf_sys_clock()&gt;simulation_time_in_ms))</span>
<span class="lineNum">    1603 </span>            :                            ) {
<span class="lineNum">    1604 </span><span class="lineCov">          6 :                                 Run = GF_FALSE;</span>
<span class="lineNum">    1605 </span>            :                         }
<span class="lineNum">    1606 </span><span class="lineCov">        404 :                         continue;</span>
<span class="lineNum">    1607 </span>            :                 }
<span class="lineNum">    1608 </span>            : 
<span class="lineNum">    1609 </span><span class="lineNoCov">          0 :                 c = gf_prompt_get_char();</span>
<span class="lineNum">    1610 </span>            : 
<span class="lineNum">    1611 </span>            : force_input:
<span class="lineNum">    1612 </span><span class="lineNoCov">          0 :                 if (c=='\n') cmdtype=MP4C_PL_NEXT;</span>
<span class="lineNum">    1613 </span><span class="lineNoCov">          0 :                 else cmdtype = get_cmd(c);</span>
<span class="lineNum">    1614 </span>            : 
<span class="lineNum">    1615 </span><span class="lineNoCov">          0 :                 switch (cmdtype) {</span>
<span class="lineNum">    1616 </span>            :                 case MP4C_QUIT:
<span class="lineNum">    1617 </span>            :                 {
<span class="lineNum">    1618 </span>            :                         GF_Event evt;
<span class="lineNum">    1619 </span>            :                         memset(&amp;evt, 0, sizeof(GF_Event));
<span class="lineNum">    1620 </span><span class="lineNoCov">          0 :                         evt.type = GF_EVENT_QUIT;</span>
<span class="lineNum">    1621 </span><span class="lineNoCov">          0 :                         gf_term_send_event(term, &amp;evt);</span>
<span class="lineNum">    1622 </span>            :                 }
<span class="lineNum">    1623 </span>            : //                      Run = 0;
<span class="lineNum">    1624 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1625 </span><span class="lineNoCov">          0 :                 case MP4C_KILL:</span>
<span class="lineNum">    1626 </span><span class="lineNoCov">          0 :                         exit(0);</span>
<span class="lineNum">    1627 </span>            :                         break;
<span class="lineNum">    1628 </span>            : 
<span class="lineNum">    1629 </span><span class="lineNoCov">          0 :                 case MP4C_OPEN:</span>
<span class="lineNum">    1630 </span><span class="lineNoCov">          0 :                         startup_file = 0;</span>
<span class="lineNum">    1631 </span><span class="lineNoCov">          0 :                         gf_term_disconnect(term);</span>
<span class="lineNum">    1632 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Enter the absolute URL\n&quot;);</span>
<span class="lineNum">    1633 </span><span class="lineNoCov">          0 :                         if (1 &gt; scanf(&quot;%1023s&quot;, the_url)) {</span>
<span class="lineNum">    1634 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Cannot read absolute URL, aborting\n&quot;);</span>
<span class="lineNum">    1635 </span>            :                                 break;
<span class="lineNum">    1636 </span>            :                         }
<span class="lineNum">    1637 </span><span class="lineNoCov">          0 :                         if (rti_file) init_rti_logs(rti_file, the_url, use_rtix);</span>
<span class="lineNum">    1638 </span><span class="lineNoCov">          0 :                         gf_term_connect(term, the_url);</span>
<span class="lineNum">    1639 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1640 </span><span class="lineNoCov">          0 :                 case MP4C_OPEN_PL:</span>
<span class="lineNum">    1641 </span><span class="lineNoCov">          0 :                         gf_term_disconnect(term);</span>
<span class="lineNum">    1642 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Enter the absolute URL to the playlist\n&quot;);</span>
<span class="lineNum">    1643 </span><span class="lineNoCov">          0 :                         if (1 &gt; scanf(&quot;%1023s&quot;, the_url)) {</span>
<span class="lineNum">    1644 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Cannot read the absolute URL, aborting.\n&quot;);</span>
<span class="lineNum">    1645 </span>            :                                 break;
<span class="lineNum">    1646 </span>            :                         }
<span class="lineNum">    1647 </span><span class="lineNoCov">          0 :                         playlist = gf_fopen(the_url, &quot;rt&quot;);</span>
<span class="lineNum">    1648 </span><span class="lineNoCov">          0 :                         if (playlist) {</span>
<span class="lineNum">    1649 </span><span class="lineNoCov">          0 :                                 if (1 &gt;      fscanf(playlist, &quot;%1023s&quot;, the_url)) {</span>
<span class="lineNum">    1650 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Cannot read any URL from playlist, aborting.\n&quot;);</span>
<span class="lineNum">    1651 </span><span class="lineNoCov">          0 :                                         gf_fclose( playlist);</span>
<span class="lineNum">    1652 </span><span class="lineNoCov">          0 :                                         break;</span>
<span class="lineNum">    1653 </span>            :                                 }
<span class="lineNum">    1654 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Opening URL %s\n&quot;, the_url);</span>
<span class="lineNum">    1655 </span><span class="lineNoCov">          0 :                                 gf_term_connect(term, the_url);</span>
<span class="lineNum">    1656 </span>            :                         }
<span class="lineNum">    1657 </span>            :                         break;
<span class="lineNum">    1658 </span><span class="lineNoCov">          0 :                 case MP4C_PL_NEXT:</span>
<span class="lineNum">    1659 </span><span class="lineNoCov">          0 :                         if (playlist) {</span>
<span class="lineNum">    1660 </span>            :                                 int res;
<span class="lineNum">    1661 </span><span class="lineNoCov">          0 :                                 gf_term_disconnect(term);</span>
<span class="lineNum">    1662 </span>            : 
<span class="lineNum">    1663 </span><span class="lineNoCov">          0 :                                 res = fscanf(playlist, &quot;%1023s&quot;, the_url);</span>
<span class="lineNum">    1664 </span><span class="lineNoCov">          0 :                                 if ((res == EOF) &amp;&amp; loop_at_end) {</span>
<span class="lineNum">    1665 </span><span class="lineNoCov">          0 :                                         gf_fseek(playlist, 0, SEEK_SET);</span>
<span class="lineNum">    1666 </span><span class="lineNoCov">          0 :                                         res = fscanf(playlist, &quot;%1023s&quot;, the_url);</span>
<span class="lineNum">    1667 </span>            :                                 }
<span class="lineNum">    1668 </span><span class="lineNoCov">          0 :                                 if (res == EOF) {</span>
<span class="lineNum">    1669 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;No more items - exiting\n&quot;);</span>
<span class="lineNum">    1670 </span><span class="lineNoCov">          0 :                                         Run = 0;</span>
<span class="lineNum">    1671 </span><span class="lineNoCov">          0 :                                 } else if (the_url[0] == '#') {</span>
<span class="lineNum">    1672 </span><span class="lineNoCov">          0 :                                         request_next_playlist_item = GF_TRUE;</span>
<span class="lineNum">    1673 </span>            :                                 } else {
<span class="lineNum">    1674 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Opening URL %s\n&quot;, the_url);</span>
<span class="lineNum">    1675 </span><span class="lineNoCov">          0 :                                         gf_term_connect_with_path(term, the_url, pl_path);</span>
<span class="lineNum">    1676 </span>            :                                 }
<span class="lineNum">    1677 </span>            :                         }
<span class="lineNum">    1678 </span>            :                         break;
<span class="lineNum">    1679 </span><span class="lineNoCov">          0 :                 case MP4C_PL_JUMP:</span>
<span class="lineNum">    1680 </span><span class="lineNoCov">          0 :                         if (playlist) {</span>
<span class="lineNum">    1681 </span>            :                                 u32 count;
<span class="lineNum">    1682 </span><span class="lineNoCov">          0 :                                 gf_term_disconnect(term);</span>
<span class="lineNum">    1683 </span><span class="lineNoCov">          0 :                                 if (1 &gt; scanf(&quot;%u&quot;, &amp;count)) {</span>
<span class="lineNum">    1684 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Cannot read number, aborting.\n&quot;);</span>
<span class="lineNum">    1685 </span><span class="lineNoCov">          0 :                                         break;</span>
<span class="lineNum">    1686 </span>            :                                 }
<span class="lineNum">    1687 </span><span class="lineNoCov">          0 :                                 while (count) {</span>
<span class="lineNum">    1688 </span><span class="lineNoCov">          0 :                                         if (fscanf(playlist, &quot;%1023s&quot;, the_url)) {</span>
<span class="lineNum">    1689 </span><span class="lineNoCov">          0 :                                                 fprintf(stderr, &quot;Failed to read line, aborting\n&quot;);</span>
<span class="lineNum">    1690 </span>            :                                                 break;
<span class="lineNum">    1691 </span>            :                                         }
<span class="lineNum">    1692 </span><span class="lineNoCov">          0 :                                         count--;</span>
<span class="lineNum">    1693 </span>            :                                 }
<span class="lineNum">    1694 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Opening URL %s\n&quot;, the_url);</span>
<span class="lineNum">    1695 </span><span class="lineNoCov">          0 :                                 gf_term_connect(term, the_url);</span>
<span class="lineNum">    1696 </span>            :                         }
<span class="lineNum">    1697 </span>            :                         break;
<span class="lineNum">    1698 </span><span class="lineNoCov">          0 :                 case MP4C_RELOAD:</span>
<span class="lineNum">    1699 </span><span class="lineNoCov">          0 :                         if (is_connected)</span>
<span class="lineNum">    1700 </span><span class="lineNoCov">          0 :                                 reload = 1;</span>
<span class="lineNum">    1701 </span>            :                         break;
<span class="lineNum">    1702 </span>            : 
<span class="lineNum">    1703 </span><span class="lineNoCov">          0 :                 case MP4C_DISCONNECT:</span>
<span class="lineNum">    1704 </span><span class="lineNoCov">          0 :                         if (is_connected) gf_term_disconnect(term);</span>
<span class="lineNum">    1705 </span>            :                         break;
<span class="lineNum">    1706 </span>            : 
<span class="lineNum">    1707 </span><span class="lineNoCov">          0 :                 case MP4C_PAUSE_RESUME:</span>
<span class="lineNum">    1708 </span><span class="lineNoCov">          0 :                         if (is_connected) {</span>
<span class="lineNum">    1709 </span><span class="lineNoCov">          0 :                                 Bool is_pause = gf_term_get_option(term, GF_OPT_PLAY_STATE);</span>
<span class="lineNum">    1710 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;[Status: %s]\n&quot;, is_pause ? &quot;Playing&quot; : &quot;Paused&quot;);</span>
<span class="lineNum">    1711 </span><span class="lineNoCov">          0 :                                 gf_term_set_option(term, GF_OPT_PLAY_STATE, is_pause ? GF_STATE_PLAYING : GF_STATE_PAUSED);</span>
<span class="lineNum">    1712 </span>            :                         }
<span class="lineNum">    1713 </span>            :                         break;
<span class="lineNum">    1714 </span><span class="lineNoCov">          0 :                 case MP4C_STEP:</span>
<span class="lineNum">    1715 </span><span class="lineNoCov">          0 :                         if (is_connected) {</span>
<span class="lineNum">    1716 </span><span class="lineNoCov">          0 :                                 gf_term_set_option(term, GF_OPT_PLAY_STATE, GF_STATE_STEP_PAUSE);</span>
<span class="lineNum">    1717 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Step time: &quot;);</span>
<span class="lineNum">    1718 </span><span class="lineNoCov">          0 :                                 PrintTime(gf_term_get_time_in_ms(term));</span>
<span class="lineNum">    1719 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    1720 </span>            :                         }
<span class="lineNum">    1721 </span>            :                         break;
<span class="lineNum">    1722 </span>            : 
<span class="lineNum">    1723 </span><span class="lineNoCov">          0 :                 case MP4C_SEEK:</span>
<span class="lineNum">    1724 </span>            :                 case MP4C_SEEK_TIME:
<span class="lineNum">    1725 </span><span class="lineNoCov">          0 :                         if (!CanSeek || (Duration&lt;=2000)) {</span>
<span class="lineNum">    1726 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;scene not seekable\n&quot;);</span>
<span class="lineNum">    1727 </span>            :                         } else {
<span class="lineNum">    1728 </span>            :                                 Double res;
<span class="lineNum">    1729 </span>            :                                 s32 seekTo;
<span class="lineNum">    1730 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Duration: &quot;);</span>
<span class="lineNum">    1731 </span><span class="lineNoCov">          0 :                                 PrintTime(Duration);</span>
<span class="lineNum">    1732 </span><span class="lineNoCov">          0 :                                 res = gf_term_get_time_in_ms(term);</span>
<span class="lineNum">    1733 </span><span class="lineNoCov">          0 :                                 if (cmdtype==MP4C_SEEK) {</span>
<span class="lineNum">    1734 </span><span class="lineNoCov">          0 :                                         res *= 100;</span>
<span class="lineNum">    1735 </span><span class="lineNoCov">          0 :                                         res /= (s64)Duration;</span>
<span class="lineNum">    1736 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot; (current %.2f %%)\nEnter Seek percentage:\n&quot;, res);</span>
<span class="lineNum">    1737 </span><span class="lineNoCov">          0 :                                         if (scanf(&quot;%d&quot;, &amp;seekTo) == 1) {</span>
<span class="lineNum">    1738 </span><span class="lineNoCov">          0 :                                                 if (seekTo &gt; 100) seekTo = 100;</span>
<span class="lineNum">    1739 </span><span class="lineNoCov">          0 :                                                 res = (Double)(s64)Duration;</span>
<span class="lineNum">    1740 </span><span class="lineNoCov">          0 :                                                 res /= 100;</span>
<span class="lineNum">    1741 </span><span class="lineNoCov">          0 :                                                 res *= seekTo;</span>
<span class="lineNum">    1742 </span><span class="lineNoCov">          0 :                                                 gf_term_play_from_time(term, (u64) (s64) res, 0);</span>
<span class="lineNum">    1743 </span>            :                                         }
<span class="lineNum">    1744 </span>            :                                 } else {
<span class="lineNum">    1745 </span>            :                                         u32 r, h, m, s;
<span class="lineNum">    1746 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot; - Current Time: &quot;);</span>
<span class="lineNum">    1747 </span><span class="lineNoCov">          0 :                                         PrintTime((u64) res);</span>
<span class="lineNum">    1748 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;\nEnter seek time (Format: s, m:s or h:m:s):\n&quot;);</span>
<span class="lineNum">    1749 </span><span class="lineNoCov">          0 :                                         h = m = s = 0;</span>
<span class="lineNum">    1750 </span><span class="lineNoCov">          0 :                                         r =scanf(&quot;%d:%d:%d&quot;, &amp;h, &amp;m, &amp;s);</span>
<span class="lineNum">    1751 </span><span class="lineNoCov">          0 :                                         if (r==2) {</span>
<span class="lineNum">    1752 </span><span class="lineNoCov">          0 :                                                 s = m;</span>
<span class="lineNum">    1753 </span><span class="lineNoCov">          0 :                                                 m = h;</span>
<span class="lineNum">    1754 </span><span class="lineNoCov">          0 :                                                 h = 0;</span>
<span class="lineNum">    1755 </span>            :                                         }
<span class="lineNum">    1756 </span><span class="lineNoCov">          0 :                                         else if (r==1) {</span>
<span class="lineNum">    1757 </span><span class="lineNoCov">          0 :                                                 s = h;</span>
<span class="lineNum">    1758 </span><span class="lineNoCov">          0 :                                                 m = h = 0;</span>
<span class="lineNum">    1759 </span>            :                                         }
<span class="lineNum">    1760 </span>            : 
<span class="lineNum">    1761 </span><span class="lineNoCov">          0 :                                         if (r &amp;&amp; (r&lt;=3)) {</span>
<span class="lineNum">    1762 </span><span class="lineNoCov">          0 :                                                 u64 time = h*3600 + m*60 + s;</span>
<span class="lineNum">    1763 </span><span class="lineNoCov">          0 :                                                 gf_term_play_from_time(term, time*1000, 0);</span>
<span class="lineNum">    1764 </span>            :                                         }
<span class="lineNum">    1765 </span>            :                                 }
<span class="lineNum">    1766 </span>            :                         }
<span class="lineNum">    1767 </span>            :                         break;
<span class="lineNum">    1768 </span>            : 
<span class="lineNum">    1769 </span><span class="lineNoCov">          0 :                 case MP4C_TIME:</span>
<span class="lineNum">    1770 </span>            :                 {
<span class="lineNum">    1771 </span><span class="lineNoCov">          0 :                         if (is_connected) {</span>
<span class="lineNum">    1772 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Current Time: &quot;);</span>
<span class="lineNum">    1773 </span><span class="lineNoCov">          0 :                                 PrintTime(gf_term_get_time_in_ms(term));</span>
<span class="lineNum">    1774 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot; - Duration: &quot;);</span>
<span class="lineNum">    1775 </span><span class="lineNoCov">          0 :                                 PrintTime(Duration);</span>
<span class="lineNum">    1776 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    1777 </span>            :                         }
<span class="lineNum">    1778 </span>            :                 }
<span class="lineNum">    1779 </span>            :                 break;
<span class="lineNum">    1780 </span><span class="lineNoCov">          0 :                 case MP4C_WORLDINFO:</span>
<span class="lineNum">    1781 </span><span class="lineNoCov">          0 :                         if (is_connected) PrintWorldInfo(term);</span>
<span class="lineNum">    1782 </span>            :                         break;
<span class="lineNum">    1783 </span><span class="lineNoCov">          0 :                 case MP4C_ODLIST:</span>
<span class="lineNum">    1784 </span><span class="lineNoCov">          0 :                         if (is_connected) PrintODList(term, NULL, 0, 0, &quot;Root&quot;);</span>
<span class="lineNum">    1785 </span>            :                         break;
<span class="lineNum">    1786 </span><span class="lineNoCov">          0 :                 case MP4C_ODINFO_ID:</span>
<span class="lineNum">    1787 </span><span class="lineNoCov">          0 :                         if (is_connected) {</span>
<span class="lineNum">    1788 </span>            :                                 u32 ID;
<span class="lineNum">    1789 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Enter OD ID (0 for main OD): &quot;);</span>
<span class="lineNum">    1790 </span><span class="lineNoCov">          0 :                                 fflush(stderr);</span>
<span class="lineNum">    1791 </span><span class="lineNoCov">          0 :                                 if (scanf(&quot;%ud&quot;, &amp;ID) == 1) {</span>
<span class="lineNum">    1792 </span><span class="lineNoCov">          0 :                                         ViewOD(term, ID, (u32)-1, NULL);</span>
<span class="lineNum">    1793 </span>            :                                 } else {
<span class="lineNum">    1794 </span>            :                                         char str_url[GF_MAX_PATH];
<span class="lineNum">    1795 </span><span class="lineNoCov">          0 :                                         if (scanf(&quot;%1023s&quot;, str_url) == 1)</span>
<span class="lineNum">    1796 </span><span class="lineNoCov">          0 :                                                 ViewOD(term, 0, (u32)-1, str_url);</span>
<span class="lineNum">    1797 </span>            :                                 }
<span class="lineNum">    1798 </span>            :                         }
<span class="lineNum">    1799 </span>            :                         break;
<span class="lineNum">    1800 </span><span class="lineNoCov">          0 :                 case MP4C_ODINFO_NUM:</span>
<span class="lineNum">    1801 </span><span class="lineNoCov">          0 :                         if (is_connected) {</span>
<span class="lineNum">    1802 </span>            :                                 u32 num;
<span class="lineNum">    1803 </span>            :                                 do {
<span class="lineNum">    1804 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Enter OD number (0 for main OD): &quot;);</span>
<span class="lineNum">    1805 </span><span class="lineNoCov">          0 :                                         fflush(stderr);</span>
<span class="lineNum">    1806 </span><span class="lineNoCov">          0 :                                 } while( 1 &gt; scanf(&quot;%ud&quot;, &amp;num));</span>
<span class="lineNum">    1807 </span><span class="lineNoCov">          0 :                                 ViewOD(term, (u32)-1, num, NULL);</span>
<span class="lineNum">    1808 </span>            :                         }
<span class="lineNum">    1809 </span>            :                         break;
<span class="lineNum">    1810 </span><span class="lineNoCov">          0 :                 case MP4C_ODTIME:</span>
<span class="lineNum">    1811 </span><span class="lineNoCov">          0 :                         if (is_connected) ViewODs(term, 1);</span>
<span class="lineNum">    1812 </span>            :                         break;
<span class="lineNum">    1813 </span>            : 
<span class="lineNum">    1814 </span><span class="lineNoCov">          0 :                 case MP4C_ODBUF:</span>
<span class="lineNum">    1815 </span><span class="lineNoCov">          0 :                         if (is_connected) ViewODs(term, 0);</span>
<span class="lineNum">    1816 </span>            :                         break;
<span class="lineNum">    1817 </span>            : 
<span class="lineNum">    1818 </span><span class="lineNoCov">          0 :                 case MP4C_NAVMODE:</span>
<span class="lineNum">    1819 </span><span class="lineNoCov">          0 :                         if (is_connected) set_navigation();</span>
<span class="lineNum">    1820 </span>            :                         break;
<span class="lineNum">    1821 </span><span class="lineNoCov">          0 :                 case MP4C_LASTVP:</span>
<span class="lineNum">    1822 </span><span class="lineNoCov">          0 :                         if (is_connected) gf_term_set_option(term, GF_OPT_NAVIGATION_TYPE, 0);</span>
<span class="lineNum">    1823 </span>            :                         break;
<span class="lineNum">    1824 </span>            : 
<span class="lineNum">    1825 </span><span class="lineNoCov">          0 :                 case MP4C_DUMPSCENE:</span>
<span class="lineNum">    1826 </span><span class="lineNoCov">          0 :                         if (is_connected) {</span>
<span class="lineNum">    1827 </span>            :                                 GF_ObjectManager *odm = NULL;
<span class="lineNum">    1828 </span>            :                                 char radname[GF_MAX_PATH], *sExt;
<span class="lineNum">    1829 </span>            :                                 u32 count, odid;
<span class="lineNum">    1830 </span>            :                                 Bool xml_dump, std_out;
<span class="lineNum">    1831 </span><span class="lineNoCov">          0 :                                 radname[0] = 0;</span>
<span class="lineNum">    1832 </span>            :                                 do {
<span class="lineNum">    1833 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Enter Inline OD ID if any or 0 : &quot;);</span>
<span class="lineNum">    1834 </span><span class="lineNoCov">          0 :                                         fflush(stderr);</span>
<span class="lineNum">    1835 </span><span class="lineNoCov">          0 :                                 } while( 1 &gt;  scanf(&quot;%ud&quot;, &amp;odid));</span>
<span class="lineNum">    1836 </span><span class="lineNoCov">          0 :                                 if (odid) {</span>
<span class="lineNum">    1837 </span><span class="lineNoCov">          0 :                                         GF_ObjectManager *root_odm = gf_term_get_root_object(term);</span>
<span class="lineNum">    1838 </span><span class="lineNoCov">          0 :                                         if (!root_odm) break;</span>
<span class="lineNum">    1839 </span><span class="lineNoCov">          0 :                                         count = gf_term_get_object_count(term, root_odm);</span>
<span class="lineNum">    1840 </span><span class="lineNoCov">          0 :                                         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    1841 </span>            :                                                 GF_MediaInfo info;
<span class="lineNum">    1842 </span><span class="lineNoCov">          0 :                                                 odm = gf_term_get_object(term, root_odm, i);</span>
<span class="lineNum">    1843 </span><span class="lineNoCov">          0 :                                                 if (gf_term_get_object_info(term, odm, &amp;info) == GF_OK) {</span>
<span class="lineNum">    1844 </span><span class="lineNoCov">          0 :                                                         if (info.ODID==odid) break;</span>
<span class="lineNum">    1845 </span>            :                                                 }
<span class="lineNum">    1846 </span>            :                                                 odm = NULL;
<span class="lineNum">    1847 </span>            :                                         }
<span class="lineNum">    1848 </span>            :                                 }
<span class="lineNum">    1849 </span>            :                                 do {
<span class="lineNum">    1850 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Enter file radical name (+\'.x\' for XML dumping) - \&quot;std\&quot; for stderr: &quot;);</span>
<span class="lineNum">    1851 </span><span class="lineNoCov">          0 :                                         fflush(stderr);</span>
<span class="lineNum">    1852 </span><span class="lineNoCov">          0 :                                 } while( 1 &gt; scanf(&quot;%1023s&quot;, radname));</span>
<span class="lineNum">    1853 </span><span class="lineNoCov">          0 :                                 sExt = strrchr(radname, '.');</span>
<span class="lineNum">    1854 </span>            :                                 xml_dump = 0;
<span class="lineNum">    1855 </span><span class="lineNoCov">          0 :                                 if (sExt) {</span>
<span class="lineNum">    1856 </span><span class="lineNoCov">          0 :                                         if (!stricmp(sExt, &quot;.x&quot;)) xml_dump = 1;</span>
<span class="lineNum">    1857 </span><span class="lineNoCov">          0 :                                         sExt[0] = 0;</span>
<span class="lineNum">    1858 </span>            :                                 }
<span class="lineNum">    1859 </span><span class="lineNoCov">          0 :                                 std_out = strnicmp(radname, &quot;std&quot;, 3) ? 0 : 1;</span>
<span class="lineNum">    1860 </span><span class="lineNoCov">          0 :                                 e = gf_term_dump_scene(term, std_out ? NULL : radname, NULL, xml_dump, 0, odm);</span>
<span class="lineNum">    1861 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Dump done (%s)\n&quot;, gf_error_to_string(e));</span>
<span class="lineNum">    1862 </span>            :                         }
<span class="lineNum">    1863 </span>            :                         break;
<span class="lineNum">    1864 </span>            : 
<span class="lineNum">    1865 </span><span class="lineNoCov">          0 :                 case MP4C_OGL2D:</span>
<span class="lineNum">    1866 </span>            :                 {
<span class="lineNum">    1867 </span><span class="lineNoCov">          0 :                         Bool use_3d = !gf_term_get_option(term, GF_OPT_USE_OPENGL);</span>
<span class="lineNum">    1868 </span><span class="lineNoCov">          0 :                         if (gf_term_set_option(term, GF_OPT_USE_OPENGL, use_3d)==GF_OK) {</span>
<span class="lineNum">    1869 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Using %s for 2D drawing\n&quot;, use_3d ? &quot;OpenGL&quot; : &quot;2D rasterizer&quot;);</span>
<span class="lineNum">    1870 </span>            :                         }
<span class="lineNum">    1871 </span>            :                 }
<span class="lineNum">    1872 </span>            :                 break;
<span class="lineNum">    1873 </span><span class="lineNoCov">          0 :                 case MP4C_STRESSMODE:</span>
<span class="lineNum">    1874 </span>            :                 {
<span class="lineNum">    1875 </span><span class="lineNoCov">          0 :                         Bool opt = gf_term_get_option(term, GF_OPT_STRESS_MODE);</span>
<span class="lineNum">    1876 </span><span class="lineNoCov">          0 :                         opt = !opt;</span>
<span class="lineNum">    1877 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Turning stress mode %s\n&quot;, opt ? &quot;on&quot; : &quot;off&quot;);</span>
<span class="lineNum">    1878 </span><span class="lineNoCov">          0 :                         gf_term_set_option(term, GF_OPT_STRESS_MODE, opt);</span>
<span class="lineNum">    1879 </span>            :                 }
<span class="lineNum">    1880 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1881 </span><span class="lineNoCov">          0 :                 case MP4C_AR_4_3:</span>
<span class="lineNum">    1882 </span><span class="lineNoCov">          0 :                         gf_term_set_option(term, GF_OPT_ASPECT_RATIO, GF_ASPECT_RATIO_4_3);</span>
<span class="lineNum">    1883 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1884 </span><span class="lineNoCov">          0 :                 case MP4C_AR_16_9:</span>
<span class="lineNum">    1885 </span><span class="lineNoCov">          0 :                         gf_term_set_option(term, GF_OPT_ASPECT_RATIO, GF_ASPECT_RATIO_16_9);</span>
<span class="lineNum">    1886 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1887 </span><span class="lineNoCov">          0 :                 case MP4C_AR_NONE:</span>
<span class="lineNum">    1888 </span><span class="lineNoCov">          0 :                         gf_term_set_option(term, GF_OPT_ASPECT_RATIO, GF_ASPECT_RATIO_FILL_SCREEN);</span>
<span class="lineNum">    1889 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1890 </span><span class="lineNoCov">          0 :                 case MP4C_AR_ORIG:</span>
<span class="lineNum">    1891 </span><span class="lineNoCov">          0 :                         gf_term_set_option(term, GF_OPT_ASPECT_RATIO, GF_ASPECT_RATIO_KEEP);</span>
<span class="lineNum">    1892 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1893 </span>            : 
<span class="lineNum">    1894 </span><span class="lineNoCov">          0 :                 case MP4C_DISP_RTI:</span>
<span class="lineNum">    1895 </span><span class="lineNoCov">          0 :                         display_rti = !display_rti;</span>
<span class="lineNum">    1896 </span><span class="lineNoCov">          0 :                         ResetCaption();</span>
<span class="lineNum">    1897 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1898 </span><span class="lineNoCov">          0 :                 case MP4C_DISP_FPS:</span>
<span class="lineNum">    1899 </span><span class="lineNoCov">          0 :                         if (display_rti) display_rti = 0;</span>
<span class="lineNum">    1900 </span><span class="lineNoCov">          0 :                         else display_rti = 2;</span>
<span class="lineNum">    1901 </span><span class="lineNoCov">          0 :                         ResetCaption();</span>
<span class="lineNum">    1902 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1903 </span><span class="lineNoCov">          0 :                 case MP4C_DISP_STATS:</span>
<span class="lineNum">    1904 </span>            :                 case MP4C_DISP_GRAPH:
<span class="lineNum">    1905 </span><span class="lineNoCov">          0 :                         ll = gf_log_get_tool_level(GF_LOG_APP);</span>
<span class="lineNum">    1906 </span><span class="lineNoCov">          0 :                         gf_log_set_tool_level(GF_LOG_APP, GF_LOG_INFO);</span>
<span class="lineNum">    1907 </span><span class="lineNoCov">          0 :                         if (cmdtype==MP4C_DISP_STATS)</span>
<span class="lineNum">    1908 </span><span class="lineNoCov">          0 :                                 gf_term_print_stats(term);</span>
<span class="lineNum">    1909 </span>            :                         else
<span class="lineNum">    1910 </span><span class="lineNoCov">          0 :                                 gf_term_print_graph(term);</span>
<span class="lineNum">    1911 </span><span class="lineNoCov">          0 :                         gf_log_set_tool_level(GF_LOG_APP, ll);</span>
<span class="lineNum">    1912 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1913 </span><span class="lineNoCov">          0 :                 case MP4C_UPDATE:</span>
<span class="lineNum">    1914 </span>            :                 {
<span class="lineNum">    1915 </span>            :                         char szCom[8192];
<span class="lineNum">    1916 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Enter command to send:\n&quot;);</span>
<span class="lineNum">    1917 </span>            : //                      fflush(stdin);
<span class="lineNum">    1918 </span><span class="lineNoCov">          0 :                         szCom[0] = 0;</span>
<span class="lineNum">    1919 </span><span class="lineNoCov">          0 :                         if (1 &gt; scanf(&quot;%8191[^\t\n]&quot;, szCom)) {</span>
<span class="lineNum">    1920 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Cannot read command to send, aborting.\n&quot;);</span>
<span class="lineNum">    1921 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    1922 </span>            :                         }
<span class="lineNum">    1923 </span><span class="lineNoCov">          0 :                         e = gf_term_scene_update(term, NULL, szCom);</span>
<span class="lineNum">    1924 </span><span class="lineNoCov">          0 :                         if (e) fprintf(stderr, &quot;Processing command failed: %s\n&quot;, gf_error_to_string(e));</span>
<span class="lineNum">    1925 </span>            :                 }
<span class="lineNum">    1926 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1927 </span><span class="lineNoCov">          0 :                 case MP4C_EVALJS:</span>
<span class="lineNum">    1928 </span>            :                 {
<span class="lineNum">    1929 </span>            :                         char jsCode[8192];
<span class="lineNum">    1930 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Enter JavaScript code to evaluate:\n&quot;);</span>
<span class="lineNum">    1931 </span>            : //                      fflush(stdin);
<span class="lineNum">    1932 </span><span class="lineNoCov">          0 :                         jsCode[0] = 0;</span>
<span class="lineNum">    1933 </span><span class="lineNoCov">          0 :                         if (1 &gt; scanf(&quot;%8191[^\t\n]&quot;, jsCode)) {</span>
<span class="lineNum">    1934 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Cannot read code to evaluate, aborting.\n&quot;);</span>
<span class="lineNum">    1935 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    1936 </span>            :                         }
<span class="lineNum">    1937 </span><span class="lineNoCov">          0 :                         e = gf_term_scene_update(term, &quot;application/ecmascript&quot;, jsCode);</span>
<span class="lineNum">    1938 </span><span class="lineNoCov">          0 :                         if (e) fprintf(stderr, &quot;Processing JS code failed: %s\n&quot;, gf_error_to_string(e));</span>
<span class="lineNum">    1939 </span>            :                 }
<span class="lineNum">    1940 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1941 </span>            : 
<span class="lineNum">    1942 </span><span class="lineNoCov">          0 :                 case MP4C_LOGS:</span>
<span class="lineNum">    1943 </span>            :                 {
<span class="lineNum">    1944 </span>            :                         char szLog[1024], *cur_logs;
<span class="lineNum">    1945 </span><span class="lineNoCov">          0 :                         cur_logs = gf_log_get_tools_levels();</span>
<span class="lineNum">    1946 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Enter new log level (current tools %s):\n&quot;, cur_logs);</span>
<span class="lineNum">    1947 </span><span class="lineNoCov">          0 :                         gf_free(cur_logs);</span>
<span class="lineNum">    1948 </span><span class="lineNoCov">          0 :                         if (scanf(&quot;%1023s&quot;, szLog) &lt; 1) {</span>
<span class="lineNum">    1949 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Cannot read new log level, aborting.\n&quot;);</span>
<span class="lineNum">    1950 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    1951 </span>            :                         }
<span class="lineNum">    1952 </span><span class="lineNoCov">          0 :                         gf_log_modify_tools_levels(szLog);</span>
<span class="lineNum">    1953 </span>            :                 }
<span class="lineNum">    1954 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1955 </span>            : 
<span class="lineNum">    1956 </span><span class="lineNoCov">          0 :                 case MP4C_VMEM_CACHE:</span>
<span class="lineNum">    1957 </span>            :                 {
<span class="lineNum">    1958 </span>            :                         u32 size;
<span class="lineNum">    1959 </span>            :                         do {
<span class="lineNum">    1960 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Enter new video cache memory in kBytes (current %ud):\n&quot;, gf_term_get_option(term, GF_OPT_VIDEO_CACHE_SIZE));</span>
<span class="lineNum">    1961 </span><span class="lineNoCov">          0 :                         } while (1 &gt; scanf(&quot;%ud&quot;, &amp;size));</span>
<span class="lineNum">    1962 </span><span class="lineNoCov">          0 :                         gf_term_set_option(term, GF_OPT_VIDEO_CACHE_SIZE, size);</span>
<span class="lineNum">    1963 </span>            :                 }
<span class="lineNum">    1964 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1965 </span>            : 
<span class="lineNum">    1966 </span><span class="lineNoCov">          0 :                 case MP4C_DOWNRATE:</span>
<span class="lineNum">    1967 </span>            :                 {
<span class="lineNum">    1968 </span><span class="lineNoCov">          0 :                         u32 http_bitrate = gf_term_get_option(term, GF_OPT_HTTP_MAX_RATE);</span>
<span class="lineNum">    1969 </span>            :                         do {
<span class="lineNum">    1970 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Enter new http bitrate in bps (0 for none) - current limit: %d\n&quot;, http_bitrate);</span>
<span class="lineNum">    1971 </span><span class="lineNoCov">          0 :                         } while (1 &gt; scanf(&quot;%ud&quot;, &amp;http_bitrate));</span>
<span class="lineNum">    1972 </span>            : 
<span class="lineNum">    1973 </span><span class="lineNoCov">          0 :                         gf_term_set_option(term, GF_OPT_HTTP_MAX_RATE, http_bitrate);</span>
<span class="lineNum">    1974 </span>            :                 }
<span class="lineNum">    1975 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    1976 </span>            : 
<span class="lineNum">    1977 </span><span class="lineNoCov">          0 :                 case MP4C_RELOAD_OPTS:</span>
<span class="lineNum">    1978 </span><span class="lineNoCov">          0 :                         gf_term_set_option(term, GF_OPT_RELOAD_CONFIG, 1);</span>
<span class="lineNum">    1979 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1980 </span>            : 
<span class="lineNum">    1981 </span>            :                 /*extract to PNG*/
<span class="lineNum">    1982 </span><span class="lineNoCov">          0 :                 case MP4C_SCREENSHOT:</span>
<span class="lineNum">    1983 </span><span class="lineNoCov">          0 :                         MakeScreenshot(GF_FALSE);</span>
<span class="lineNum">    1984 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    1985 </span>            : 
<span class="lineNum">    1986 </span><span class="lineNoCov">          0 :                 case MP4C_SELECT:</span>
<span class="lineNum">    1987 </span>            :                 {
<span class="lineNum">    1988 </span>            :                         GF_ObjectManager *root_od, *odm;
<span class="lineNum">    1989 </span>            :                         u32 index;
<span class="lineNum">    1990 </span>            :                         char szOpt[8192];
<span class="lineNum">    1991 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Enter 0-based index of object to select or service ID:\n&quot;);</span>
<span class="lineNum">    1992 </span>            : //                      fflush(stdin);
<span class="lineNum">    1993 </span><span class="lineNoCov">          0 :                         szOpt[0] = 0;</span>
<span class="lineNum">    1994 </span><span class="lineNoCov">          0 :                         if (1 &gt; scanf(&quot;%8191[^\t\n]&quot;, szOpt)) {</span>
<span class="lineNum">    1995 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Cannot read OD ID\n&quot;);</span>
<span class="lineNum">    1996 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    1997 </span>            :                         }
<span class="lineNum">    1998 </span><span class="lineNoCov">          0 :                         index = atoi(szOpt);</span>
<span class="lineNum">    1999 </span>            :                         odm = NULL;
<span class="lineNum">    2000 </span><span class="lineNoCov">          0 :                         root_od = gf_term_get_root_object(term);</span>
<span class="lineNum">    2001 </span><span class="lineNoCov">          0 :                         if (root_od) {</span>
<span class="lineNum">    2002 </span><span class="lineNoCov">          0 :                                 if ( gf_term_find_service(term, root_od, index)) {</span>
<span class="lineNum">    2003 </span><span class="lineNoCov">          0 :                                         gf_term_select_service(term, root_od, index);</span>
<span class="lineNum">    2004 </span>            :                                 } else {
<span class="lineNum">    2005 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Cannot find service %d - trying with object index\n&quot;, index);</span>
<span class="lineNum">    2006 </span><span class="lineNoCov">          0 :                                         odm = gf_term_get_object(term, root_od, index);</span>
<span class="lineNum">    2007 </span><span class="lineNoCov">          0 :                                         if (odm) {</span>
<span class="lineNum">    2008 </span><span class="lineNoCov">          0 :                                                 gf_term_select_object(term, odm);</span>
<span class="lineNum">    2009 </span>            :                                         } else {
<span class="lineNum">    2010 </span><span class="lineNoCov">          0 :                                                 fprintf(stderr, &quot;Cannot find object at index %d\n&quot;, index);</span>
<span class="lineNum">    2011 </span>            :                                         }
<span class="lineNum">    2012 </span>            :                                 }
<span class="lineNum">    2013 </span>            :                         }
<span class="lineNum">    2014 </span>            :                 }
<span class="lineNum">    2015 </span><span class="lineNoCov">          0 :                 break;</span>
<span class="lineNum">    2016 </span>            : 
<span class="lineNum">    2017 </span><span class="lineNoCov">          0 :                 case MP4C_HELP:</span>
<span class="lineNum">    2018 </span><span class="lineNoCov">          0 :                         PrintHelp();</span>
<span class="lineNum">    2019 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">    2020 </span>            :                 default:
<span class="lineNum">    2021 </span>            :                         break;
<span class="lineNum">    2022 </span>            :                 }
<span class="lineNum">    2023 </span>            :         }
<span class="lineNum">    2024 </span>            : 
<span class="lineNum">    2025 </span><span class="lineCov">          7 :         if (bench_mode) {</span>
<span class="lineNum">    2026 </span><span class="lineNoCov">          0 :                 PrintAVInfo(GF_TRUE);</span>
<span class="lineNum">    2027 </span>            :         }
<span class="lineNum">    2028 </span>            : 
<span class="lineNum">    2029 </span>            :         /*FIXME: we have an issue in cleaning up after playing in bench mode and run-for 0 (buildbot tests). We for now disable error checks after run-for is done*/
<span class="lineNum">    2030 </span><span class="lineCov">          7 :         if (simulation_time_in_ms) {</span>
<span class="lineNum">    2031 </span><span class="lineCov">          6 :                 gf_log_set_strict_error(0);</span>
<span class="lineNum">    2032 </span>            :         }
<span class="lineNum">    2033 </span>            : 
<span class="lineNum">    2034 </span><span class="lineCov">          7 :         if (print_graph || print_stats) {</span>
<span class="lineNum">    2035 </span><span class="lineCov">          2 :                 ll = gf_log_get_tool_level(GF_LOG_APP);</span>
<span class="lineNum">    2036 </span><span class="lineCov">          2 :                 gf_log_set_tool_level(GF_LOG_APP, GF_LOG_INFO);</span>
<span class="lineNum">    2037 </span><span class="lineCov">          2 :                 if (print_graph)</span>
<span class="lineNum">    2038 </span><span class="lineCov">          2 :                         gf_term_print_graph(term);</span>
<span class="lineNum">    2039 </span><span class="lineCov">          2 :                 if (print_stats)</span>
<span class="lineNum">    2040 </span><span class="lineCov">          2 :                         gf_term_print_stats(term);</span>
<span class="lineNum">    2041 </span><span class="lineCov">          2 :                 gf_log_set_tool_level(GF_LOG_APP, ll);</span>
<span class="lineNum">    2042 </span>            :         }
<span class="lineNum">    2043 </span>            : 
<span class="lineNum">    2044 </span>            : #ifdef GPAC_ENABLE_COVERAGE
<span class="lineNum">    2045 </span><span class="lineCov">          7 :         if (do_coverage) {</span>
<span class="lineNum">    2046 </span>            :                 u32 w, h, k, nb_drawn;
<span class="lineNum">    2047 </span>            :                 GF_Event evt;
<span class="lineNum">    2048 </span>            :                 Bool is_bound;
<span class="lineNum">    2049 </span>            :                 const char *outName;
<span class="lineNum">    2050 </span>            :                 GF_ObjectManager *root_odm, *odm;
<span class="lineNum">    2051 </span><span class="lineCov">          2 :                 PrintAVInfo(GF_TRUE);</span>
<span class="lineNum">    2052 </span><span class="lineCov">          2 :                 PrintODList(term, NULL, 0, 0, &quot;Root&quot;);</span>
<span class="lineNum">    2053 </span><span class="lineCov">          2 :                 ViewODs(term, GF_TRUE);</span>
<span class="lineNum">    2054 </span><span class="lineCov">          2 :                 ViewODs(term, GF_FALSE);</span>
<span class="lineNum">    2055 </span><span class="lineCov">          2 :                 ViewOD(term, 0, (u32) -1, NULL);</span>
<span class="lineNum">    2056 </span><span class="lineCov">          2 :                 ViewOD(term, 0, 1, NULL);</span>
<span class="lineNum">    2057 </span><span class="lineCov">          2 :                 PrintUsage(0);</span>
<span class="lineNum">    2058 </span><span class="lineCov">          2 :                 PrintHelp();</span>
<span class="lineNum">    2059 </span><span class="lineCov">          2 :                 PrintWorldInfo(term);</span>
<span class="lineNum">    2060 </span><span class="lineCov">          2 :                 gf_term_dump_scene(term, NULL, NULL, GF_FALSE, 0, NULL);</span>
<span class="lineNum">    2061 </span><span class="lineCov">          2 :                 gf_term_get_current_service_id(term);</span>
<span class="lineNum">    2062 </span><span class="lineCov">          2 :                 gf_term_toggle_addons(term, GF_FALSE);</span>
<span class="lineNum">    2063 </span><span class="lineCov">          2 :                 set_navigation();</span>
<span class="lineNum">    2064 </span>            :                 get_cmd('v');
<span class="lineNum">    2065 </span>            : 
<span class="lineNum">    2066 </span><span class="lineCov">          2 :                 gf_term_play_from_time(term, 0, 0);</span>
<span class="lineNum">    2067 </span>            : 
<span class="lineNum">    2068 </span>            :                 memset(&amp;evt, 0, sizeof(GF_Event));
<span class="lineNum">    2069 </span><span class="lineCov">          2 :                 evt.type = GF_EVENT_MOUSEUP;</span>
<span class="lineNum">    2070 </span><span class="lineCov">          2 :                 evt.mouse.x = 20;</span>
<span class="lineNum">    2071 </span><span class="lineCov">          2 :                 evt.mouse.y = 20;</span>
<span class="lineNum">    2072 </span><span class="lineCov">          2 :                 gf_term_send_event(term, &amp;evt);</span>
<span class="lineNum">    2073 </span>            : 
<span class="lineNum">    2074 </span><span class="lineCov">          2 :                 gf_term_set_option(term, GF_OPT_PLAY_STATE, GF_STATE_STEP_PAUSE);</span>
<span class="lineNum">    2075 </span>            :                 //exercise step clocks
<span class="lineNum">    2076 </span><span class="lineCov">          2 :                 gf_term_set_option(term, GF_OPT_PLAY_STATE, GF_STATE_STEP_PAUSE);</span>
<span class="lineNum">    2077 </span><span class="lineCov">          2 :                 root_odm = gf_term_get_root_object(term);</span>
<span class="lineNum">    2078 </span><span class="lineCov">          2 :                 gf_term_find_service(term, root_odm, 0);</span>
<span class="lineNum">    2079 </span><span class="lineCov">          2 :                 gf_term_select_service(term, root_odm, 0);</span>
<span class="lineNum">    2080 </span><span class="lineCov">          2 :                 odm = gf_term_get_object(term, root_odm, 0);</span>
<span class="lineNum">    2081 </span><span class="lineCov">          2 :                 gf_term_select_object(term, odm );</span>
<span class="lineNum">    2082 </span><span class="lineCov">          2 :                 gf_term_object_subscene_type(term, odm);</span>
<span class="lineNum">    2083 </span><span class="lineCov">          2 :                 gf_term_get_visual_output_size(term, &amp;w, &amp;h);</span>
<span class="lineNum">    2084 </span>            : 
<span class="lineNum">    2085 </span><span class="lineCov">          2 :                 gf_term_is_type_supported(term, &quot;video/mp4&quot;);</span>
<span class="lineNum">    2086 </span><span class="lineCov">          2 :                 gf_term_get_url(term);</span>
<span class="lineNum">    2087 </span><span class="lineCov">          2 :                 gf_term_get_simulation_frame_rate(term, &amp;nb_drawn);</span>
<span class="lineNum">    2088 </span>            : 
<span class="lineNum">    2089 </span><span class="lineCov">          2 :                 gf_term_get_text_selection(term, GF_TRUE);</span>
<span class="lineNum">    2090 </span><span class="lineCov">          2 :                 gf_term_paste_text(term, &quot;test&quot;, GF_TRUE);</span>
<span class="lineNum">    2091 </span>            : 
<span class="lineNum">    2092 </span><span class="lineCov">          2 :                 gf_term_set_option(term, GF_OPT_AUDIO_MUTE, 1);</span>
<span class="lineNum">    2093 </span>            : 
<span class="lineNum">    2094 </span>            : 
<span class="lineNum">    2095 </span><span class="lineCov">          2 :                 MakeScreenshot(GF_TRUE);</span>
<span class="lineNum">    2096 </span>            : 
<span class="lineNum">    2097 </span><span class="lineCov">          2 :                 gf_term_scene_update(term, NULL, &quot;REPLACE DYN_TRANS.translation BY 10 10&quot;);</span>
<span class="lineNum">    2098 </span><span class="lineCov">          2 :                 gf_term_add_object(term, NULL, GF_TRUE);</span>
<span class="lineNum">    2099 </span>            : 
<span class="lineNum">    2100 </span><span class="lineCov">          2 :                 gf_term_get_viewpoint(term, 1, &amp;outName, &amp;is_bound);</span>
<span class="lineNum">    2101 </span><span class="lineCov">          2 :                 gf_term_set_viewpoint(term, 1, &quot;testvp&quot;);</span>
<span class="lineNum">    2102 </span>            : 
<span class="lineNum">    2103 </span><span class="lineCov">         18 :                 for (k=GF_NAVIGATE_WALK; k&lt;=GF_NAVIGATE_VR; k++) {</span>
<span class="lineNum">    2104 </span><span class="lineCov">         16 :                         gf_term_set_option(term, GF_OPT_NAVIGATION, k);</span>
<span class="lineNum">    2105 </span>            :                         memset(&amp;evt, 0, sizeof(GF_Event));
<span class="lineNum">    2106 </span><span class="lineCov">         16 :                         evt.type = GF_EVENT_MOUSEDOWN;</span>
<span class="lineNum">    2107 </span><span class="lineCov">         16 :                         evt.mouse.x = 100;</span>
<span class="lineNum">    2108 </span><span class="lineCov">         16 :                         evt.mouse.y = 100;</span>
<span class="lineNum">    2109 </span><span class="lineCov">         16 :                         gf_term_user_event(term, &amp;evt);</span>
<span class="lineNum">    2110 </span><span class="lineCov">         16 :                         evt.type = GF_EVENT_MOUSEMOVE;</span>
<span class="lineNum">    2111 </span><span class="lineCov">         16 :                         evt.mouse.x += 10;</span>
<span class="lineNum">    2112 </span><span class="lineCov">         16 :                         gf_term_user_event(term, &amp;evt);</span>
<span class="lineNum">    2113 </span><span class="lineCov">         16 :                         evt.mouse.y += 10;</span>
<span class="lineNum">    2114 </span><span class="lineCov">         16 :                         gf_term_user_event(term, &amp;evt);</span>
<span class="lineNum">    2115 </span>            : 
<span class="lineNum">    2116 </span><span class="lineCov">         16 :                         evt.type = GF_EVENT_KEYDOWN;</span>
<span class="lineNum">    2117 </span><span class="lineCov">         16 :                         evt.key.key_code = GF_KEY_CONTROL;</span>
<span class="lineNum">    2118 </span><span class="lineCov">         16 :                         gf_term_user_event(term, &amp;evt);</span>
<span class="lineNum">    2119 </span>            : 
<span class="lineNum">    2120 </span><span class="lineCov">         16 :                         evt.type = GF_EVENT_MOUSEMOVE;</span>
<span class="lineNum">    2121 </span><span class="lineCov">         16 :                         evt.mouse.x = 120;</span>
<span class="lineNum">    2122 </span><span class="lineCov">         16 :                         evt.mouse.y = 110;</span>
<span class="lineNum">    2123 </span><span class="lineCov">         16 :                         gf_term_user_event(term, &amp;evt);</span>
<span class="lineNum">    2124 </span>            : 
<span class="lineNum">    2125 </span><span class="lineCov">         16 :                         evt.type = GF_EVENT_KEYUP;</span>
<span class="lineNum">    2126 </span><span class="lineCov">         16 :                         evt.key.key_code = GF_KEY_CONTROL;</span>
<span class="lineNum">    2127 </span><span class="lineCov">         16 :                         gf_term_user_event(term, &amp;evt);</span>
<span class="lineNum">    2128 </span>            : 
<span class="lineNum">    2129 </span><span class="lineCov">         16 :                         evt.type = GF_EVENT_KEYDOWN;</span>
<span class="lineNum">    2130 </span><span class="lineCov">         16 :                         evt.key.key_code = GF_KEY_J;</span>
<span class="lineNum">    2131 </span><span class="lineCov">         16 :                         gf_term_user_event(term, &amp;evt);</span>
<span class="lineNum">    2132 </span>            : 
<span class="lineNum">    2133 </span>            :                 }
<span class="lineNum">    2134 </span><span class="lineCov">          2 :                 gf_term_set_option(term, GF_OPT_NAVIGATION_TYPE, 0);</span>
<span class="lineNum">    2135 </span>            : 
<span class="lineNum">    2136 </span><span class="lineCov">          2 :                 gf_term_connect_with_path(term, &quot;logo.jpg&quot;, &quot;./media/auxiliary_files/&quot;);</span>
<span class="lineNum">    2137 </span><span class="lineCov">          2 :                 gf_term_navigate_to(term, &quot;./media/auxiliary_files/logo.jpg&quot;);</span>
<span class="lineNum">    2138 </span><span class="lineCov">          2 :                 send_open_url(&quot;./media/auxiliary_files/logo.jpg&quot;);</span>
<span class="lineNum">    2139 </span><span class="lineCov">          2 :                 switch_bench(1);</span>
<span class="lineNum">    2140 </span><span class="lineCov">          2 :                 do_set_speed(1.0);</span>
<span class="lineNum">    2141 </span>            :                 hide_shell(0);
<span class="lineNum">    2142 </span><span class="lineCov">          2 :                 list_modules();</span>
<span class="lineNum">    2143 </span>            :         }
<span class="lineNum">    2144 </span>            : #endif
<span class="lineNum">    2145 </span>            : 
<span class="lineNum">    2146 </span><span class="lineCov">          7 :         i = gf_sys_clock();</span>
<span class="lineNum">    2147 </span><span class="lineCov">          7 :         gf_term_disconnect(term);</span>
<span class="lineNum">    2148 </span><span class="lineCov">          7 :         if (rti_file) UpdateRTInfo(&quot;Disconnected\n&quot;);</span>
<span class="lineNum">    2149 </span>            : 
<span class="lineNum">    2150 </span><span class="lineCov">          7 :         if (playlist) gf_fclose(playlist);</span>
<span class="lineNum">    2151 </span>            : 
<span class="lineNum">    2152 </span>            : #if defined(__DARWIN__) || defined(__APPLE__)
<span class="lineNum">    2153 </span>            :         carbon_uninit();
<span class="lineNum">    2154 </span>            : #endif
<span class="lineNum">    2155 </span>            : 
<span class="lineNum">    2156 </span>            :         //special condition for immediate exit without terminal deletion
<span class="lineNum">    2157 </span><span class="lineCov">          7 :         if (ret_val==3) {</span>
<span class="lineNum">    2158 </span><span class="lineCov">          1 :                 fprintf(stderr, &quot;Exit forced, no cleanup\n&quot;);</span>
<span class="lineNum">    2159 </span><span class="lineCov">          1 :                 exit(0);</span>
<span class="lineNum">    2160 </span>            :         }
<span class="lineNum">    2161 </span>            : 
<span class="lineNum">    2162 </span><span class="lineCov">          6 :         fprintf(stderr, &quot;Deleting terminal... &quot;);</span>
<span class="lineNum">    2163 </span><span class="lineCov">          6 :         gf_term_del(term);</span>
<span class="lineNum">    2164 </span><span class="lineCov">          6 :         fprintf(stderr, &quot;done (in %d ms) - ran for %d ms\n&quot;, gf_sys_clock() - i, gf_sys_clock());</span>
<span class="lineNum">    2165 </span>            : 
<span class="lineNum">    2166 </span><span class="lineCov">          6 :         fprintf(stderr, &quot;GPAC cleanup ...\n&quot;);</span>
<span class="lineNum">    2167 </span>            : 
<span class="lineNum">    2168 </span><span class="lineCov">          6 :         if (no_cfg_save)</span>
<span class="lineNum">    2169 </span><span class="lineNoCov">          0 :                 gf_opts_discard_changes();</span>
<span class="lineNum">    2170 </span>            : 
<span class="lineNum">    2171 </span><span class="lineCov">          6 :         gf_sys_close();</span>
<span class="lineNum">    2172 </span>            : 
<span class="lineNum">    2173 </span><span class="lineCov">          6 :         if (rti_logs) gf_fclose(rti_logs);</span>
<span class="lineNum">    2174 </span>            :         if (logfile) gf_fclose(logfile);
<span class="lineNum">    2175 </span>            : 
<span class="lineNum">    2176 </span>            :         if (gui_mode) {
<span class="lineNum">    2177 </span>            :                 hide_shell(2);
<span class="lineNum">    2178 </span>            :         }
<span class="lineNum">    2179 </span>            : 
<span class="lineNum">    2180 </span>            : #ifdef GPAC_MEMORY_TRACKING
<span class="lineNum">    2181 </span><span class="lineCov">          6 :         if (mem_track &amp;&amp; (gf_memory_size() || gf_file_handles_count() )) {</span>
<span class="lineNum">    2182 </span><span class="lineNoCov">          0 :                 gf_log_set_tool_level(GF_LOG_MEMORY, GF_LOG_INFO);</span>
<span class="lineNum">    2183 </span><span class="lineNoCov">          0 :                 gf_memory_print();</span>
<span class="lineNum">    2184 </span><span class="lineNoCov">          0 :                 return 2;</span>
<span class="lineNum">    2185 </span>            :         }
<span class="lineNum">    2186 </span>            : #endif
<span class="lineNum">    2187 </span>            : 
<span class="lineNum">    2188 </span><span class="lineCov">          6 :         return ret_val;</span>
<a name="2189"><span class="lineNum">    2189 </span>            : }</a>
<span class="lineNum">    2190 </span>            : 
<span class="lineNum">    2191 </span><span class="lineCov">          9 : GF_MAIN_FUNC(mp4client_main)</span>
<a name="2192"><span class="lineNum">    2192 </span>            : </a>
<span class="lineNum">    2193 </span>            : 
<span class="lineNum">    2194 </span><span class="lineCov">          2 : static void MakeScreenshot(Bool for_coverage)</span>
<span class="lineNum">    2195 </span>            : {
<span class="lineNum">    2196 </span>            :         char szFileName[100];
<span class="lineNum">    2197 </span><span class="lineCov">          2 :         u32 nb_pass, nb_views, offscreen_view = 0;</span>
<span class="lineNum">    2198 </span>            :         GF_VideoSurface fb;
<span class="lineNum">    2199 </span>            :         GF_Err e;
<span class="lineNum">    2200 </span>            :         nb_pass = 1;
<span class="lineNum">    2201 </span><span class="lineCov">          2 :         nb_views = gf_term_get_option(term, GF_OPT_NUM_STEREO_VIEWS);</span>
<span class="lineNum">    2202 </span><span class="lineCov">          2 :         if (nb_views&gt;1) {</span>
<span class="lineNum">    2203 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Auto-stereo mode detected - type number of view to dump (0 is main output, 1 to %d offscreen view, %d for all offscreen, %d for all offscreen and main)\n&quot;, nb_views, nb_views+1, nb_views+2);</span>
<span class="lineNum">    2204 </span><span class="lineNoCov">          0 :                 if (!for_coverage) {</span>
<span class="lineNum">    2205 </span><span class="lineNoCov">          0 :                         if (scanf(&quot;%d&quot;, &amp;offscreen_view) != 1) {</span>
<span class="lineNum">    2206 </span><span class="lineNoCov">          0 :                                 offscreen_view = 0;</span>
<span class="lineNum">    2207 </span>            :                         }
<span class="lineNum">    2208 </span>            :                 }
<span class="lineNum">    2209 </span><span class="lineNoCov">          0 :                 if (offscreen_view==nb_views+1) {</span>
<span class="lineNum">    2210 </span><span class="lineNoCov">          0 :                         offscreen_view = 1;</span>
<span class="lineNum">    2211 </span>            :                         nb_pass = nb_views;
<span class="lineNum">    2212 </span>            :                 }
<span class="lineNum">    2213 </span><span class="lineNoCov">          0 :                 else if (offscreen_view==nb_views+2) {</span>
<span class="lineNum">    2214 </span><span class="lineNoCov">          0 :                         offscreen_view = 0;</span>
<span class="lineNum">    2215 </span>            :                         nb_pass = nb_views+1;
<span class="lineNum">    2216 </span>            :                 }
<span class="lineNum">    2217 </span>            :         }
<span class="lineNum">    2218 </span><span class="lineCov">          2 :         if (for_coverage &amp;&amp; !offscreen_view) {</span>
<span class="lineNum">    2219 </span><span class="lineCov">          2 :                 if (gf_term_get_offscreen_buffer(term, &amp;fb, 0, 0)==GF_OK)</span>
<span class="lineNum">    2220 </span><span class="lineNoCov">          0 :                         gf_term_release_screen_buffer(term, &amp;fb);</span>
<span class="lineNum">    2221 </span>            :         }
<span class="lineNum">    2222 </span><span class="lineCov">          4 :         while (nb_pass) {</span>
<span class="lineNum">    2223 </span><span class="lineCov">          2 :                 nb_pass--;</span>
<span class="lineNum">    2224 </span><span class="lineCov">          2 :                 if (offscreen_view) {</span>
<span class="lineNum">    2225 </span>            :                         sprintf(szFileName, &quot;view%d_dump.png&quot;, offscreen_view);
<span class="lineNum">    2226 </span><span class="lineNoCov">          0 :                         e = gf_term_get_offscreen_buffer(term, &amp;fb, offscreen_view-1, 0);</span>
<span class="lineNum">    2227 </span>            :                 } else {
<span class="lineNum">    2228 </span><span class="lineCov">          2 :                         sprintf(szFileName, &quot;gpac_video_dump_&quot;LLU&quot;.png&quot;, gf_net_get_utc() );</span>
<span class="lineNum">    2229 </span><span class="lineCov">          2 :                         e = gf_term_get_screen_buffer(term, &amp;fb);</span>
<span class="lineNum">    2230 </span>            :                 }
<span class="lineNum">    2231 </span><span class="lineCov">          2 :                 offscreen_view++;</span>
<span class="lineNum">    2232 </span><span class="lineCov">          2 :                 if (e) {</span>
<span class="lineNum">    2233 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Error dumping screen buffer %s\n&quot;, gf_error_to_string(e) );</span>
<span class="lineNum">    2234 </span>            :                         nb_pass = 0;
<span class="lineNum">    2235 </span>            :                 } else {
<span class="lineNum">    2236 </span>            : #ifndef GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    2237 </span><span class="lineCov">          2 :                         u32 dst_size = fb.width*fb.height*4;</span>
<span class="lineNum">    2238 </span><span class="lineCov">          2 :                         char *dst = (char*)gf_malloc(sizeof(char)*dst_size);</span>
<span class="lineNum">    2239 </span>            : 
<span class="lineNum">    2240 </span><span class="lineCov">          2 :                         e = gf_img_png_enc(fb.video_buffer, fb.width, fb.height, fb.pitch_y, fb.pixel_format, dst, &amp;dst_size);</span>
<span class="lineNum">    2241 </span><span class="lineCov">          2 :                         if (e) {</span>
<span class="lineNum">    2242 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Error encoding PNG %s\n&quot;, gf_error_to_string(e) );</span>
<span class="lineNum">    2243 </span>            :                                 nb_pass = 0;
<span class="lineNum">    2244 </span>            :                         } else {
<span class="lineNum">    2245 </span><span class="lineCov">          2 :                                 FILE *png = gf_fopen(szFileName, &quot;wb&quot;);</span>
<span class="lineNum">    2246 </span><span class="lineCov">          2 :                                 if (!png) {</span>
<span class="lineNum">    2247 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;Error writing file %s\n&quot;, szFileName);</span>
<span class="lineNum">    2248 </span>            :                                         nb_pass = 0;
<span class="lineNum">    2249 </span>            :                                 } else {
<span class="lineNum">    2250 </span><span class="lineCov">          2 :                                         gf_fwrite(dst, dst_size, png);</span>
<span class="lineNum">    2251 </span><span class="lineCov">          2 :                                         gf_fclose(png);</span>
<span class="lineNum">    2252 </span><span class="lineCov">          2 :                                         fprintf(stderr, &quot;Dump to %s\n&quot;, szFileName);</span>
<span class="lineNum">    2253 </span>            :                                 }
<span class="lineNum">    2254 </span>            :                         }
<span class="lineNum">    2255 </span><span class="lineCov">          2 :                         if (dst) gf_free(dst);</span>
<span class="lineNum">    2256 </span><span class="lineCov">          2 :                         gf_term_release_screen_buffer(term, &amp;fb);</span>
<span class="lineNum">    2257 </span>            : 
<span class="lineNum">    2258 </span><span class="lineCov">          2 :                         if (for_coverage) gf_file_delete(szFileName);</span>
<span class="lineNum">    2259 </span>            : #endif //GPAC_DISABLE_AV_PARSERS
<span class="lineNum">    2260 </span>            :                 }
<span class="lineNum">    2261 </span>            :         }
<span class="lineNum">    2262 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;Done: %s\n&quot;, szFileName);</span>
<span class="lineNum">    2263 </span><span class="lineCov">          2 : }</span>
<span class="lineNum">    2264 </span>            : 
<span class="lineNum">    2265 </span>            : static GF_ObjectManager *video_odm = NULL;
<span class="lineNum">    2266 </span>            : static GF_ObjectManager *audio_odm = NULL;
<span class="lineNum">    2267 </span>            : static GF_ObjectManager *scene_odm = NULL;
<a name="2268"><span class="lineNum">    2268 </span>            : static u32 last_odm_count = 0;</a>
<span class="lineNum">    2269 </span>            : 
<span class="lineNum">    2270 </span><span class="lineCov">          2 : static void PrintAVInfo(Bool final)</span>
<span class="lineNum">    2271 </span>            : {
<span class="lineNum">    2272 </span>            :         GF_MediaInfo a_odi, v_odi, s_odi;
<span class="lineNum">    2273 </span>            :         Double avg_dec_time;
<span class="lineNum">    2274 </span>            :         u32 tot_time;
<span class="lineNum">    2275 </span>            : 
<span class="lineNum">    2276 </span><span class="lineCov">          2 :         if (scene_odm) {</span>
<span class="lineNum">    2277 </span><span class="lineNoCov">          0 :                 GF_ObjectManager *root_odm = gf_term_get_root_object(term);</span>
<span class="lineNum">    2278 </span><span class="lineNoCov">          0 :                 u32 count = gf_term_get_object_count(term, root_odm);</span>
<span class="lineNum">    2279 </span><span class="lineNoCov">          0 :                 if (last_odm_count != count) {</span>
<span class="lineNum">    2280 </span><span class="lineNoCov">          0 :                         last_odm_count = count;</span>
<span class="lineNum">    2281 </span><span class="lineNoCov">          0 :                         scene_odm = NULL;</span>
<span class="lineNum">    2282 </span>            :                 }
<span class="lineNum">    2283 </span>            :         }
<span class="lineNum">    2284 </span><span class="lineCov">          2 :         if (!video_odm &amp;&amp; !audio_odm &amp;&amp; !scene_odm) {</span>
<span class="lineNum">    2285 </span>            :                 u32 count, i;
<span class="lineNum">    2286 </span><span class="lineCov">          2 :                 GF_ObjectManager *root_odm = gf_term_get_root_object(term);</span>
<span class="lineNum">    2287 </span><span class="lineCov">          4 :                 if (!root_odm) return;</span>
<span class="lineNum">    2288 </span>            : 
<span class="lineNum">    2289 </span><span class="lineCov">          2 :                 if (gf_term_get_object_info(term, root_odm, &amp;v_odi)==GF_OK) {</span>
<span class="lineNum">    2290 </span><span class="lineCov">          2 :                         if (!scene_odm  &amp;&amp; (v_odi.generated_scene== 0)) {</span>
<span class="lineNum">    2291 </span><span class="lineCov">          2 :                                 scene_odm = root_odm;</span>
<span class="lineNum">    2292 </span>            :                         }
<span class="lineNum">    2293 </span>            :                 }
<span class="lineNum">    2294 </span>            : 
<span class="lineNum">    2295 </span><span class="lineCov">          2 :                 count = gf_term_get_object_count(term, root_odm);</span>
<span class="lineNum">    2296 </span><span class="lineCov">          2 :                 for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    2297 </span><span class="lineNoCov">          0 :                         GF_ObjectManager *odm = gf_term_get_object(term, root_odm, i);</span>
<span class="lineNum">    2298 </span><span class="lineNoCov">          0 :                         if (!odm) break;</span>
<span class="lineNum">    2299 </span><span class="lineNoCov">          0 :                         if (gf_term_get_object_info(term, odm, &amp;v_odi) == GF_OK) {</span>
<span class="lineNum">    2300 </span><span class="lineNoCov">          0 :                                 if (!video_odm &amp;&amp; (v_odi.od_type == GF_STREAM_VISUAL) &amp;&amp; (v_odi.raw_media || (v_odi.cb_max_count&gt;1) || v_odi.direct_video_memory || (bench_mode == 3) )) {</span>
<span class="lineNum">    2301 </span><span class="lineNoCov">          0 :                                         video_odm = odm;</span>
<span class="lineNum">    2302 </span>            :                                 }
<span class="lineNum">    2303 </span><span class="lineNoCov">          0 :                                 else if (!audio_odm &amp;&amp; (v_odi.od_type == GF_STREAM_AUDIO)) {</span>
<span class="lineNum">    2304 </span><span class="lineNoCov">          0 :                                         audio_odm = odm;</span>
<span class="lineNum">    2305 </span>            :                                 }
<span class="lineNum">    2306 </span><span class="lineNoCov">          0 :                                 else if (!scene_odm &amp;&amp; (v_odi.od_type == GF_STREAM_SCENE)) {</span>
<span class="lineNum">    2307 </span><span class="lineNoCov">          0 :                                         scene_odm = odm;</span>
<span class="lineNum">    2308 </span>            :                                 }
<span class="lineNum">    2309 </span>            :                         }
<span class="lineNum">    2310 </span>            :                 }
<span class="lineNum">    2311 </span>            :         }
<span class="lineNum">    2312 </span>            : 
<span class="lineNum">    2313 </span>            :         if (0 &amp;&amp; bench_buffer) {
<span class="lineNum">    2314 </span>            :                 fprintf(stderr, &quot;Buffering %d %% &quot;, bench_buffer-1);
<span class="lineNum">    2315 </span>            :                 return;
<span class="lineNum">    2316 </span>            :         }
<span class="lineNum">    2317 </span>            : 
<span class="lineNum">    2318 </span><span class="lineCov">          2 :         if (video_odm) {</span>
<span class="lineNum">    2319 </span><span class="lineNoCov">          0 :                 if (gf_term_get_object_info(term, video_odm, &amp;v_odi)!= GF_OK) {</span>
<span class="lineNum">    2320 </span><span class="lineNoCov">          0 :                         video_odm = NULL;</span>
<span class="lineNum">    2321 </span><span class="lineNoCov">          0 :                         return;</span>
<span class="lineNum">    2322 </span>            :                 }
<span class="lineNum">    2323 </span>            :         } else {
<span class="lineNum">    2324 </span>            :                 memset(&amp;v_odi, 0, sizeof(v_odi));
<span class="lineNum">    2325 </span>            :         }
<span class="lineNum">    2326 </span><span class="lineCov">          2 :         if (audio_odm) {</span>
<span class="lineNum">    2327 </span><span class="lineNoCov">          0 :                 gf_term_get_object_info(term, audio_odm, &amp;a_odi);</span>
<span class="lineNum">    2328 </span>            :         } else {
<span class="lineNum">    2329 </span>            :                 memset(&amp;a_odi, 0, sizeof(a_odi));
<span class="lineNum">    2330 </span>            :         }
<span class="lineNum">    2331 </span><span class="lineCov">          2 :         if (!video_odm &amp;&amp; scene_odm) {</span>
<span class="lineNum">    2332 </span><span class="lineCov">          2 :                 gf_term_get_object_info(term, scene_odm, &amp;s_odi);</span>
<span class="lineNum">    2333 </span>            :         } else {
<span class="lineNum">    2334 </span>            :                 memset(&amp;s_odi, 0, sizeof(s_odi));
<span class="lineNum">    2335 </span>            :         }
<span class="lineNum">    2336 </span>            : 
<span class="lineNum">    2337 </span><span class="lineCov">          2 :         if (final) {</span>
<span class="lineNum">    2338 </span><span class="lineCov">          2 :                 tot_time = gf_sys_clock() - bench_mode_start;</span>
<span class="lineNum">    2339 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;                                                                                     \r&quot;);</span>
<span class="lineNum">    2340 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;************** Bench Mode Done in %d ms ********************\n&quot;, tot_time);</span>
<span class="lineNum">    2341 </span><span class="lineCov">          2 :                 if (bench_mode==3) fprintf(stderr, &quot;** Systems layer only (no decoding) **\n&quot;);</span>
<span class="lineNum">    2342 </span>            : 
<span class="lineNum">    2343 </span><span class="lineCov">          2 :                 if (!video_odm) {</span>
<span class="lineNum">    2344 </span>            :                         u32 nb_frames_drawn;
<span class="lineNum">    2345 </span><span class="lineCov">          2 :                         Double FPS = gf_term_get_simulation_frame_rate(term, &amp;nb_frames_drawn);</span>
<span class="lineNum">    2346 </span><span class="lineCov">          2 :                         fprintf(stderr, &quot;Drawn %d frames FPS %.2f (simulation FPS %.2f) - duration %d ms\n&quot;, nb_frames_drawn, ((Float)nb_frames_drawn*1000)/tot_time,(Float) FPS, gf_term_get_time_in_ms(term)  );</span>
<span class="lineNum">    2347 </span>            :                 }
<span class="lineNum">    2348 </span>            :         }
<span class="lineNum">    2349 </span><span class="lineCov">          2 :         if (video_odm) {</span>
<span class="lineNum">    2350 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;%s %dx%d sar=%d:%d duration %.2fs\n&quot;, v_odi.codec_name, v_odi.width, v_odi.height, v_odi.par ? (v_odi.par&gt;&gt;16)&amp;0xFF : 1, v_odi.par ? (v_odi.par)&amp;0xFF : 1, v_odi.duration);</span>
<span class="lineNum">    2351 </span><span class="lineNoCov">          0 :                 if (final) {</span>
<span class="lineNum">    2352 </span><span class="lineNoCov">          0 :                         u32 dec_run_time = v_odi.last_frame_time - v_odi.first_frame_time;</span>
<span class="lineNum">    2353 </span><span class="lineNoCov">          0 :                         if (!dec_run_time) dec_run_time = 1;</span>
<span class="lineNum">    2354 </span><span class="lineNoCov">          0 :                         if (v_odi.duration) fprintf(stderr, &quot;%d%% &quot;, (u32) (100*v_odi.current_time / v_odi.duration ) );</span>
<span class="lineNum">    2355 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;%d frames FPS %.2f (max %d us/f) rate avg %d max %d&quot;, v_odi.nb_dec_frames, ((Float)v_odi.nb_dec_frames*1000) / dec_run_time, v_odi.max_dec_time, (u32) v_odi.avg_bitrate/1000, (u32) v_odi.max_bitrate/1000);</span>
<span class="lineNum">    2356 </span><span class="lineNoCov">          0 :                         if (v_odi.nb_dropped) {</span>
<span class="lineNum">    2357 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot; (Error during bench: %d frames drop)&quot;, v_odi.nb_dropped);</span>
<span class="lineNum">    2358 </span>            :                         }
<span class="lineNum">    2359 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    2360 </span>            :                 }
<span class="lineNum">    2361 </span>            :         }
<span class="lineNum">    2362 </span><span class="lineCov">          2 :         if (audio_odm) {</span>
<span class="lineNum">    2363 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;%s SR %d num channels %d %s duration %.2fs\n&quot;, a_odi.codec_name, a_odi.sample_rate, a_odi.num_channels, gf_audio_fmt_name(a_odi.afmt), a_odi.duration);</span>
<span class="lineNum">    2364 </span><span class="lineNoCov">          0 :                 if (final) {</span>
<span class="lineNum">    2365 </span><span class="lineNoCov">          0 :                         u32 dec_run_time = a_odi.last_frame_time - a_odi.first_frame_time;</span>
<span class="lineNum">    2366 </span><span class="lineNoCov">          0 :                         if (!dec_run_time) dec_run_time = 1;</span>
<span class="lineNum">    2367 </span><span class="lineNoCov">          0 :                         if (a_odi.duration) fprintf(stderr, &quot;%d%% &quot;, (u32) (100*a_odi.current_time / a_odi.duration ) );</span>
<span class="lineNum">    2368 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;%d frames (ms/f %.2f avg %.2f max) rate avg %d max %d&quot;, a_odi.nb_dec_frames, ((Float)dec_run_time)/a_odi.nb_dec_frames, a_odi.max_dec_time/1000.0, (u32) a_odi.avg_bitrate/1000, (u32) a_odi.max_bitrate/1000);</span>
<span class="lineNum">    2369 </span><span class="lineNoCov">          0 :                         if (a_odi.nb_dropped) {</span>
<span class="lineNum">    2370 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot; (Error during bench: %d frames drop)&quot;, a_odi.nb_dropped);</span>
<span class="lineNum">    2371 </span>            :                         }
<span class="lineNum">    2372 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    2373 </span>            :                 }
<span class="lineNum">    2374 </span>            :         }
<span class="lineNum">    2375 </span><span class="lineCov">          2 :         if (scene_odm) {</span>
<span class="lineNum">    2376 </span>            :                 u32 w, h;
<span class="lineNum">    2377 </span><span class="lineCov">          2 :                 gf_term_get_visual_output_size(term, &amp;w, &amp;h);</span>
<span class="lineNum">    2378 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;%s scene size %dx%d rastered to %dx%d duration %.2fs\n&quot;, s_odi.codec_name ? s_odi.codec_name : &quot;&quot;, s_odi.width, s_odi.height, w, h, s_odi.duration);</span>
<span class="lineNum">    2379 </span><span class="lineCov">          2 :                 if (final) {</span>
<span class="lineNum">    2380 </span><span class="lineCov">          2 :                         if (s_odi.nb_dec_frames&gt;2 &amp;&amp; s_odi.total_dec_time) {</span>
<span class="lineNum">    2381 </span><span class="lineNoCov">          0 :                                 u32 dec_run_time = s_odi.last_frame_time - s_odi.first_frame_time;</span>
<span class="lineNum">    2382 </span><span class="lineNoCov">          0 :                                 if (!dec_run_time) dec_run_time = 1;</span>
<span class="lineNum">    2383 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;%d frames FPS %.2f (max %d us/f) rate avg %d max %d&quot;, s_odi.nb_dec_frames, ((Float)s_odi.nb_dec_frames*1000) / dec_run_time, s_odi.max_dec_time, (u32) s_odi.avg_bitrate/1000, (u32) s_odi.max_bitrate/1000);</span>
<span class="lineNum">    2384 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    2385 </span>            :                         } else {
<span class="lineNum">    2386 </span>            :                                 u32 nb_frames_drawn;
<span class="lineNum">    2387 </span>            :                                 Double FPS;
<span class="lineNum">    2388 </span><span class="lineCov">          2 :                                 gf_term_get_simulation_frame_rate(term, &amp;nb_frames_drawn);</span>
<span class="lineNum">    2389 </span><span class="lineCov">          2 :                                 tot_time = gf_sys_clock() - bench_mode_start;</span>
<span class="lineNum">    2390 </span><span class="lineCov">          2 :                                 FPS = gf_term_get_framerate(term, 0);</span>
<span class="lineNum">    2391 </span><span class="lineCov">          2 :                                 fprintf(stderr, &quot;%d frames FPS %.2f (abs %.2f)\n&quot;, nb_frames_drawn, (1000.0*nb_frames_drawn / tot_time), FPS);</span>
<span class="lineNum">    2392 </span>            :                         }
<span class="lineNum">    2393 </span>            : 
<span class="lineNum">    2394 </span><span class="lineCov">          2 :                         fprintf(stderr, &quot;**********************************************************\n\n&quot;);</span>
<span class="lineNum">    2395 </span><span class="lineCov">          2 :                         return;</span>
<span class="lineNum">    2396 </span>            :                 }
<span class="lineNum">    2397 </span>            :         }
<span class="lineNum">    2398 </span>            : 
<span class="lineNum">    2399 </span><span class="lineNoCov">          0 :         if (video_odm) {</span>
<span class="lineNum">    2400 </span><span class="lineNoCov">          0 :                 tot_time = v_odi.last_frame_time - v_odi.first_frame_time;</span>
<span class="lineNum">    2401 </span><span class="lineNoCov">          0 :                 if (!tot_time) tot_time=1;</span>
<span class="lineNum">    2402 </span><span class="lineNoCov">          0 :                 if (v_odi.duration) fprintf(stderr, &quot;%d%% &quot;, (u32) (100*v_odi.current_time / v_odi.duration ) );</span>
<span class="lineNum">    2403 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;%d f FPS %.2f (%.2f ms max) rate %d &quot;, v_odi.nb_dec_frames, ((Float)v_odi.nb_dec_frames*1000) / tot_time, v_odi.max_dec_time/1000.0, (u32) v_odi.avg_bitrate/1000);</span>
<span class="lineNum">    2404 </span>            :         }
<span class="lineNum">    2405 </span><span class="lineNoCov">          0 :         else if (scene_odm) {</span>
<span class="lineNum">    2406 </span>            : 
<span class="lineNum">    2407 </span><span class="lineNoCov">          0 :                 if (s_odi.nb_dec_frames&gt;2 &amp;&amp; s_odi.total_dec_time) {</span>
<span class="lineNum">    2408 </span><span class="lineNoCov">          0 :                         avg_dec_time = (Float) 1000000 * s_odi.nb_dec_frames;</span>
<span class="lineNum">    2409 </span><span class="lineNoCov">          0 :                         avg_dec_time /= s_odi.total_dec_time;</span>
<span class="lineNum">    2410 </span><span class="lineNoCov">          0 :                         if (s_odi.duration) fprintf(stderr, &quot;%d%% &quot;, (u32) (100*s_odi.current_time / s_odi.duration ) );</span>
<span class="lineNum">    2411 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;%d f %.2f (%d us max) - rate %d &quot;, s_odi.nb_dec_frames, avg_dec_time, s_odi.max_dec_time, (u32) s_odi.avg_bitrate/1000);</span>
<span class="lineNum">    2412 </span>            :                 } else {
<span class="lineNum">    2413 </span>            :                         u32 nb_frames_drawn;
<span class="lineNum">    2414 </span>            :                         Double FPS;
<span class="lineNum">    2415 </span><span class="lineNoCov">          0 :                         gf_term_get_simulation_frame_rate(term, &amp;nb_frames_drawn);</span>
<span class="lineNum">    2416 </span><span class="lineNoCov">          0 :                         tot_time = gf_sys_clock() - bench_mode_start;</span>
<span class="lineNum">    2417 </span><span class="lineNoCov">          0 :                         FPS = gf_term_get_framerate(term, 1);</span>
<span class="lineNum">    2418 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;%d f FPS %.2f (abs %.2f) &quot;, nb_frames_drawn, (1000.0*nb_frames_drawn / tot_time), FPS);</span>
<span class="lineNum">    2419 </span>            :                 }
<span class="lineNum">    2420 </span>            :         }
<span class="lineNum">    2421 </span><span class="lineNoCov">          0 :         else if (audio_odm) {</span>
<span class="lineNum">    2422 </span><span class="lineNoCov">          0 :                 gf_term_get_object_info(term, audio_odm, &amp;a_odi);</span>
<span class="lineNum">    2423 </span>            : 
<span class="lineNum">    2424 </span><span class="lineNoCov">          0 :                 tot_time = a_odi.last_frame_time - a_odi.first_frame_time;</span>
<span class="lineNum">    2425 </span><span class="lineNoCov">          0 :                 if (!tot_time) tot_time=1;</span>
<span class="lineNum">    2426 </span><span class="lineNoCov">          0 :                 if (a_odi.duration) fprintf(stderr, &quot;%d%% &quot;, (u32) (100*a_odi.current_time / a_odi.duration ) );</span>
<span class="lineNum">    2427 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;%d frames (ms/f %.2f avg %.2f max)&quot;, a_odi.nb_dec_frames, ((Float)tot_time)/a_odi.nb_dec_frames, a_odi.max_dec_time/1000.0);</span>
<span class="lineNum">    2428 </span>            :         }
<a name="2429"><span class="lineNum">    2429 </span>            : }</a>
<span class="lineNum">    2430 </span>            : 
<span class="lineNum">    2431 </span><span class="lineCov">          2 : static void PrintWorldInfo(GF_Terminal *term)</span>
<span class="lineNum">    2432 </span>            : {
<span class="lineNum">    2433 </span>            :         u32 i;
<span class="lineNum">    2434 </span>            :         const char *title;
<span class="lineNum">    2435 </span>            :         GF_List *descs;
<span class="lineNum">    2436 </span><span class="lineCov">          2 :         descs = gf_list_new();</span>
<span class="lineNum">    2437 </span><span class="lineCov">          2 :         title = gf_term_get_world_info(term, NULL, descs);</span>
<span class="lineNum">    2438 </span><span class="lineCov">          2 :         if (!title &amp;&amp; !gf_list_count(descs)) {</span>
<span class="lineNum">    2439 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;No World Info available\n&quot;);</span>
<span class="lineNum">    2440 </span>            :         } else {
<span class="lineNum">    2441 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;\t%s\n&quot;, title ? title : &quot;No title available&quot;);</span>
<span class="lineNum">    2442 </span><span class="lineCov">         22 :                 for (i=0; i&lt;gf_list_count(descs); i++) {</span>
<span class="lineNum">    2443 </span><span class="lineCov">         20 :                         char *str = gf_list_get(descs, i);</span>
<span class="lineNum">    2444 </span><span class="lineCov">         20 :                         fprintf(stderr, &quot;%s\n&quot;, str);</span>
<span class="lineNum">    2445 </span>            :                 }
<span class="lineNum">    2446 </span>            :         }
<span class="lineNum">    2447 </span><span class="lineCov">          2 :         gf_list_del(descs);</span>
<a name="2448"><span class="lineNum">    2448 </span><span class="lineCov">          2 : }</span></a>
<span class="lineNum">    2449 </span>            : 
<span class="lineNum">    2450 </span><span class="lineCov">          2 : static void PrintODList(GF_Terminal *term, GF_ObjectManager *root_odm, u32 num, u32 indent, char *root_name)</span>
<span class="lineNum">    2451 </span>            : {
<span class="lineNum">    2452 </span>            :         GF_MediaInfo odi;
<span class="lineNum">    2453 </span>            :         u32 i, count;
<span class="lineNum">    2454 </span>            :         char szIndent[50];
<span class="lineNum">    2455 </span>            : 
<span class="lineNum">    2456 </span><span class="lineCov">          2 :         if (!root_odm) {</span>
<span class="lineNum">    2457 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;Currently loaded objects:\n&quot;);</span>
<span class="lineNum">    2458 </span><span class="lineCov">          2 :                 root_odm = gf_term_get_root_object(term);</span>
<span class="lineNum">    2459 </span>            :         }
<span class="lineNum">    2460 </span><span class="lineCov">          2 :         if (!root_odm) return;</span>
<span class="lineNum">    2461 </span>            : 
<span class="lineNum">    2462 </span><span class="lineCov">          2 :         count = gf_term_get_current_service_id(term);</span>
<span class="lineNum">    2463 </span><span class="lineCov">          2 :         if (count)</span>
<span class="lineNum">    2464 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Current service ID %d\n&quot;, count);</span>
<span class="lineNum">    2465 </span>            : 
<span class="lineNum">    2466 </span><span class="lineCov">          2 :         if (gf_term_get_object_info(term, root_odm, &amp;odi) != GF_OK) return;</span>
<span class="lineNum">    2467 </span><span class="lineCov">          2 :         if (!odi.ODID) {</span>
<span class="lineNum">    2468 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Service not attached\n&quot;);</span>
<span class="lineNum">    2469 </span>            :                 return;
<span class="lineNum">    2470 </span>            :         }
<span class="lineNum">    2471 </span>            : 
<span class="lineNum">    2472 </span><span class="lineNoCov">          0 :         for (i=0; i&lt;indent; i++) szIndent[i]=' ';</span>
<span class="lineNum">    2473 </span><span class="lineCov">          2 :         szIndent[indent]=0;</span>
<span class="lineNum">    2474 </span>            : 
<span class="lineNum">    2475 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;%s&quot;, szIndent);</span>
<span class="lineNum">    2476 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;#%d %s - &quot;, num, root_name);</span>
<span class="lineNum">    2477 </span><span class="lineCov">          2 :         if (odi.ServiceID) fprintf(stderr, &quot;Service ID %d &quot;, odi.ServiceID);</span>
<span class="lineNum">    2478 </span><span class="lineCov">          2 :         if (odi.media_url) {</span>
<span class="lineNum">    2479 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;%s\n&quot;, odi.media_url);</span>
<span class="lineNum">    2480 </span>            :         } else {
<span class="lineNum">    2481 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;OD ID %d\n&quot;, odi.ODID);</span>
<span class="lineNum">    2482 </span>            :         }
<span class="lineNum">    2483 </span>            : 
<span class="lineNum">    2484 </span><span class="lineCov">          2 :         szIndent[indent]=' ';</span>
<span class="lineNum">    2485 </span><span class="lineCov">          2 :         szIndent[indent+1]=0;</span>
<span class="lineNum">    2486 </span>            :         indent++;
<span class="lineNum">    2487 </span>            : 
<span class="lineNum">    2488 </span><span class="lineCov">          2 :         count = gf_term_get_object_count(term, root_odm);</span>
<span class="lineNum">    2489 </span><span class="lineCov">          2 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    2490 </span><span class="lineNoCov">          0 :                 GF_ObjectManager *odm = gf_term_get_object(term, root_odm, i);</span>
<span class="lineNum">    2491 </span><span class="lineNoCov">          0 :                 if (!odm) break;</span>
<span class="lineNum">    2492 </span><span class="lineNoCov">          0 :                 num++;</span>
<span class="lineNum">    2493 </span><span class="lineNoCov">          0 :                 if (gf_term_get_object_info(term, odm, &amp;odi) == GF_OK) {</span>
<span class="lineNum">    2494 </span><span class="lineNoCov">          0 :                         switch (gf_term_object_subscene_type(term, odm)) {</span>
<span class="lineNum">    2495 </span><span class="lineNoCov">          0 :                         case 1:</span>
<span class="lineNum">    2496 </span><span class="lineNoCov">          0 :                                 PrintODList(term, odm, num, indent, &quot;Root&quot;);</span>
<span class="lineNum">    2497 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    2498 </span><span class="lineNoCov">          0 :                         case 2:</span>
<span class="lineNum">    2499 </span><span class="lineNoCov">          0 :                                 PrintODList(term, odm, num, indent, &quot;Inline Scene&quot;);</span>
<span class="lineNum">    2500 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    2501 </span><span class="lineNoCov">          0 :                         case 3:</span>
<span class="lineNum">    2502 </span><span class="lineNoCov">          0 :                                 PrintODList(term, odm, num, indent, &quot;EXTERNPROTO Library&quot;);</span>
<span class="lineNum">    2503 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">    2504 </span><span class="lineNoCov">          0 :                         default:</span>
<span class="lineNum">    2505 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;%s&quot;, szIndent);</span>
<span class="lineNum">    2506 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;#%d - &quot;, num);</span>
<span class="lineNum">    2507 </span><span class="lineNoCov">          0 :                                 if (odi.media_url) {</span>
<span class="lineNum">    2508 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;%s&quot;, odi.media_url);</span>
<span class="lineNum">    2509 </span><span class="lineNoCov">          0 :                                 } else if (odi.service_url) {</span>
<span class="lineNum">    2510 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;%s&quot;, odi.service_url);</span>
<span class="lineNum">    2511 </span><span class="lineNoCov">          0 :                                 } else if (odi.remote_url) {</span>
<span class="lineNum">    2512 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;%s&quot;, odi.remote_url);</span>
<span class="lineNum">    2513 </span>            :                                 } else {
<span class="lineNum">    2514 </span><span class="lineNoCov">          0 :                                         fprintf(stderr, &quot;ID %d&quot;, odi.ODID);</span>
<span class="lineNum">    2515 </span>            :                                 }
<span class="lineNum">    2516 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot; - %s&quot;, (odi.od_type==GF_STREAM_VISUAL) ? &quot;Video&quot; : (odi.od_type==GF_STREAM_AUDIO) ? &quot;Audio&quot; : &quot;Systems&quot;);</span>
<span class="lineNum">    2517 </span><span class="lineNoCov">          0 :                                 if (odi.ServiceID) fprintf(stderr, &quot; - Service ID %d&quot;, odi.ServiceID);</span>
<span class="lineNum">    2518 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    2519 </span>            :                                 break;
<span class="lineNum">    2520 </span>            :                         }
<span class="lineNum">    2521 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">    2522 </span>            :         }
<a name="2523"><span class="lineNum">    2523 </span>            : }</a>
<span class="lineNum">    2524 </span>            : 
<span class="lineNum">    2525 </span><span class="lineCov">          4 : static void ViewOD(GF_Terminal *term, u32 OD_ID, u32 number, const char *szURL)</span>
<span class="lineNum">    2526 </span>            : {
<span class="lineNum">    2527 </span>            :         GF_MediaInfo odi;
<span class="lineNum">    2528 </span>            :         u32 i, count, d_enum, id;
<span class="lineNum">    2529 </span>            :         GF_TermNetStats stats;
<span class="lineNum">    2530 </span>            :         GF_Err e;
<span class="lineNum">    2531 </span><span class="lineCov">          4 :         GF_ObjectManager *odm, *root_odm = gf_term_get_root_object(term);</span>
<span class="lineNum">    2532 </span><span class="lineCov">          6 :         if (!root_odm) return;</span>
<span class="lineNum">    2533 </span>            : 
<span class="lineNum">    2534 </span>            :         odm = NULL;
<span class="lineNum">    2535 </span><span class="lineCov">          4 :         if (!szURL &amp;&amp; ((!OD_ID &amp;&amp; (number == (u32)-1)) || ((OD_ID == (u32)(-1)) &amp;&amp; !number))) {</span>
<span class="lineNum">    2536 </span>            :                 odm = root_odm;
<span class="lineNum">    2537 </span><span class="lineCov">          2 :                 if ((gf_term_get_object_info(term, odm, &amp;odi) != GF_OK)) odm=NULL;</span>
<span class="lineNum">    2538 </span>            :         } else {
<span class="lineNum">    2539 </span><span class="lineCov">          2 :                 count = gf_term_get_object_count(term, root_odm);</span>
<span class="lineNum">    2540 </span><span class="lineCov">          2 :                 for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    2541 </span><span class="lineNoCov">          0 :                         odm = gf_term_get_object(term, root_odm, i);</span>
<span class="lineNum">    2542 </span><span class="lineNoCov">          0 :                         if (!odm) break;</span>
<span class="lineNum">    2543 </span><span class="lineNoCov">          0 :                         if (gf_term_get_object_info(term, odm, &amp;odi) == GF_OK) {</span>
<span class="lineNum">    2544 </span><span class="lineNoCov">          0 :                                 if (szURL &amp;&amp; strstr(odi.service_url, szURL)) break;</span>
<span class="lineNum">    2545 </span><span class="lineNoCov">          0 :                                 if ((number == (u32)(-1)) &amp;&amp; (odi.ODID == OD_ID)) break;</span>
<span class="lineNum">    2546 </span><span class="lineNoCov">          0 :                                 else if (i == (u32)(number-1)) break;</span>
<span class="lineNum">    2547 </span>            :                         }
<span class="lineNum">    2548 </span>            :                         odm = NULL;
<span class="lineNum">    2549 </span>            :                 }
<span class="lineNum">    2550 </span>            :         }
<span class="lineNum">    2551 </span><span class="lineCov">          4 :         if (!odm) {</span>
<span class="lineNum">    2552 </span><span class="lineCov">          2 :                 if (szURL) fprintf(stderr, &quot;cannot find OD for URL %s\n&quot;, szURL);</span>
<span class="lineNum">    2553 </span><span class="lineCov">          2 :                 if (number == (u32)-1) fprintf(stderr, &quot;cannot find OD with ID %d\n&quot;, OD_ID);</span>
<span class="lineNum">    2554 </span><span class="lineCov">          2 :                 else fprintf(stderr, &quot;cannot find OD with number %d\n&quot;, number);</span>
<span class="lineNum">    2555 </span>            :                 return;
<span class="lineNum">    2556 </span>            :         }
<span class="lineNum">    2557 </span><span class="lineCov">          2 :         if (!odi.ODID) {</span>
<span class="lineNum">    2558 </span><span class="lineNoCov">          0 :                 if (number == (u32)-1) fprintf(stderr, &quot;Object %d not attached yet\n&quot;, OD_ID);</span>
<span class="lineNum">    2559 </span><span class="lineNoCov">          0 :                 else fprintf(stderr, &quot;Object #%d not attached yet\n&quot;, number);</span>
<span class="lineNum">    2560 </span>            :                 return;
<span class="lineNum">    2561 </span>            :         }
<span class="lineNum">    2562 </span>            : 
<span class="lineNum">    2563 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;Object Duration: &quot;);</span>
<span class="lineNum">    2564 </span><span class="lineCov">          2 :         if (odi.duration) {</span>
<span class="lineNum">    2565 </span><span class="lineNoCov">          0 :                 PrintTime((u32) (odi.duration*1000));</span>
<span class="lineNum">    2566 </span>            :         } else {
<span class="lineNum">    2567 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;unknown&quot;);</span>
<span class="lineNum">    2568 </span>            :         }
<span class="lineNum">    2569 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    2570 </span>            : 
<span class="lineNum">    2571 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;Service Handler: %s\n&quot;, odi.service_handler);</span>
<span class="lineNum">    2572 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;Service URL: %s\n&quot;, odi.service_url);</span>
<span class="lineNum">    2573 </span>            : 
<span class="lineNum">    2574 </span><span class="lineCov">          2 :         if (odi.codec_name) {</span>
<span class="lineNum">    2575 </span>            :                 Float avg_dec_time;
<span class="lineNum">    2576 </span><span class="lineNoCov">          0 :                 switch (odi.od_type) {</span>
<span class="lineNum">    2577 </span><span class="lineNoCov">          0 :                 case GF_STREAM_VISUAL:</span>
<span class="lineNum">    2578 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Video Object: Width %d - Height %d\r\n&quot;, odi.width, odi.height);</span>
<span class="lineNum">    2579 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Media Codec: %s\n&quot;, odi.codec_name);</span>
<span class="lineNum">    2580 </span><span class="lineNoCov">          0 :                         if (odi.par) fprintf(stderr, &quot;Pixel Aspect Ratio: %d:%d\n&quot;, (odi.par&gt;&gt;16)&amp;0xFF, (odi.par)&amp;0xFF);</span>
<span class="lineNum">    2581 </span>            :                         break;
<span class="lineNum">    2582 </span><span class="lineNoCov">          0 :                 case GF_STREAM_AUDIO:</span>
<span class="lineNum">    2583 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Audio Object: Sample Rate %d - %d channels\r\n&quot;, odi.sample_rate, odi.num_channels);</span>
<span class="lineNum">    2584 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Media Codec: %s\n&quot;, odi.codec_name);</span>
<span class="lineNum">    2585 </span>            :                         break;
<span class="lineNum">    2586 </span><span class="lineNoCov">          0 :                 case GF_STREAM_SCENE:</span>
<span class="lineNum">    2587 </span>            :                 case GF_STREAM_PRIVATE_SCENE:
<span class="lineNum">    2588 </span><span class="lineNoCov">          0 :                         if (odi.width &amp;&amp; odi.height) {</span>
<span class="lineNum">    2589 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Scene Description - Width %d - Height %d\n&quot;, odi.width, odi.height);</span>
<span class="lineNum">    2590 </span>            :                         } else {
<span class="lineNum">    2591 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Scene Description - no size specified\n&quot;);</span>
<span class="lineNum">    2592 </span>            :                         }
<span class="lineNum">    2593 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Scene Codec: %s\n&quot;, odi.codec_name);</span>
<span class="lineNum">    2594 </span>            :                         break;
<span class="lineNum">    2595 </span><span class="lineNoCov">          0 :                 case GF_STREAM_TEXT:</span>
<span class="lineNum">    2596 </span><span class="lineNoCov">          0 :                         if (odi.width &amp;&amp; odi.height) {</span>
<span class="lineNum">    2597 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Text Object: Width %d - Height %d\n&quot;, odi.width, odi.height);</span>
<span class="lineNum">    2598 </span>            :                         } else {
<span class="lineNum">    2599 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;Text Object: No size specified\n&quot;);</span>
<span class="lineNum">    2600 </span>            :                         }
<span class="lineNum">    2601 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Text Codec %s\n&quot;, odi.codec_name);</span>
<span class="lineNum">    2602 </span>            :                         break;
<span class="lineNum">    2603 </span>            :                 }
<span class="lineNum">    2604 </span>            : 
<span class="lineNum">    2605 </span>            :                 avg_dec_time = 0;
<span class="lineNum">    2606 </span><span class="lineNoCov">          0 :                 if (odi.nb_dec_frames) {</span>
<span class="lineNum">    2607 </span><span class="lineNoCov">          0 :                         avg_dec_time = (Float) odi.total_dec_time;</span>
<span class="lineNum">    2608 </span><span class="lineNoCov">          0 :                         avg_dec_time /= odi.nb_dec_frames;</span>
<span class="lineNum">    2609 </span>            :                 }
<span class="lineNum">    2610 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;\tBitrate over last second: %d kbps\n\tMax bitrate over one second: %d kbps\n\tAverage Decoding Time %.2f us %d max)\n\tTotal decoded frames %d\n&quot;,</span>
<span class="lineNum">    2611 </span><span class="lineNoCov">          0 :                         (u32) odi.avg_bitrate/1024, odi.max_bitrate/1024, avg_dec_time, odi.max_dec_time, odi.nb_dec_frames);</span>
<span class="lineNum">    2612 </span>            :         }
<span class="lineNum">    2613 </span><span class="lineCov">          2 :         if (odi.protection) fprintf(stderr, &quot;Encrypted Media%s\n&quot;, (odi.protection==2) ? &quot; NOT UNLOCKED&quot; : &quot;&quot;);</span>
<span class="lineNum">    2614 </span>            : 
<span class="lineNum">    2615 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;\nStream ID %d - %s - Clock ID %d\n&quot;, odi.pid_id, gf_stream_type_name(odi.od_type), odi.ocr_id);</span>
<span class="lineNum">    2616 </span>            : //      if (esd-&gt;dependsOnESID) fprintf(stderr, &quot;\tDepends on Stream ID %d for decoding\n&quot;, esd-&gt;dependsOnESID);
<span class="lineNum">    2617 </span>            : 
<span class="lineNum">    2618 </span><span class="lineCov">          2 :         if (odi.lang_code)</span>
<span class="lineNum">    2619 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;\tStream Language: %s\n&quot;, odi.lang_code);</span>
<span class="lineNum">    2620 </span>            : 
<span class="lineNum">    2621 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    2622 </span>            : 
<span class="lineNum">    2623 </span><span class="lineCov">          2 :         switch (odi.status) {</span>
<span class="lineNum">    2624 </span><span class="lineNoCov">          0 :         case 0:</span>
<span class="lineNum">    2625 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Stopped - &quot;);</span>
<span class="lineNum">    2626 </span>            :                 break;
<span class="lineNum">    2627 </span><span class="lineCov">          2 :         case 1:</span>
<span class="lineNum">    2628 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;Playing - &quot;);</span>
<span class="lineNum">    2629 </span>            :                 break;
<span class="lineNum">    2630 </span><span class="lineNoCov">          0 :         case 2:</span>
<span class="lineNum">    2631 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Paused - &quot;);</span>
<span class="lineNum">    2632 </span>            :                 break;
<span class="lineNum">    2633 </span><span class="lineNoCov">          0 :         case 3:</span>
<span class="lineNum">    2634 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Not setup yet\n&quot;);</span>
<span class="lineNum">    2635 </span>            :                 return;
<span class="lineNum">    2636 </span><span class="lineNoCov">          0 :         default:</span>
<span class="lineNum">    2637 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Setup Failed\n&quot;);</span>
<span class="lineNum">    2638 </span>            :                 return;
<span class="lineNum">    2639 </span>            :         }
<span class="lineNum">    2640 </span><span class="lineCov">          2 :         if (odi.buffer&gt;=0) fprintf(stderr, &quot;Buffer: %d ms - &quot;, odi.buffer);</span>
<span class="lineNum">    2641 </span><span class="lineCov">          2 :         else fprintf(stderr, &quot;Not buffering - &quot;);</span>
<span class="lineNum">    2642 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;Clock drift: %d ms\n&quot;, odi.clock_drift);</span>
<span class="lineNum">    2643 </span><span class="lineCov">          2 :         if (odi.db_unit_count) fprintf(stderr, &quot;%d AU in DB\n&quot;, odi.db_unit_count);</span>
<span class="lineNum">    2644 </span><span class="lineCov">          2 :         if (odi.cb_max_count) fprintf(stderr, &quot;Composition Buffer: %d CU (%d max)\n&quot;, odi.cb_unit_count, odi.cb_max_count);</span>
<span class="lineNum">    2645 </span><span class="lineCov">          2 :         fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    2646 </span>            : 
<span class="lineNum">    2647 </span><span class="lineCov">          2 :         if (odi.owns_service) {</span>
<span class="lineNum">    2648 </span>            :                 const char *url;
<span class="lineNum">    2649 </span>            :                 u32 done, total, bps;
<span class="lineNum">    2650 </span><span class="lineCov">          2 :                 d_enum = 0;</span>
<span class="lineNum">    2651 </span><span class="lineCov">          4 :                 while (gf_term_get_download_info(term, odm, &amp;d_enum, &amp;url, &amp;done, &amp;total, &amp;bps)) {</span>
<span class="lineNum">    2652 </span><span class="lineNoCov">          0 :                         if (d_enum==1) fprintf(stderr, &quot;Current Downloads in service:\n&quot;);</span>
<span class="lineNum">    2653 </span><span class="lineNoCov">          0 :                         if (done &amp;&amp; total) {</span>
<span class="lineNum">    2654 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;%s: %d / %d bytes (%.2f %%) - %.2f kBps\n&quot;, url, done, total, (100.0f*done)/total, ((Float)bps)/1024.0f);</span>
<span class="lineNum">    2655 </span>            :                         } else {
<span class="lineNum">    2656 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;%s: %.2f kbps\n&quot;, url, ((Float)8*bps)/1024.0f);</span>
<span class="lineNum">    2657 </span>            :                         }
<span class="lineNum">    2658 </span>            :                 }
<span class="lineNum">    2659 </span><span class="lineCov">          2 :                 if (!d_enum) fprintf(stderr, &quot;No Downloads in service\n&quot;);</span>
<span class="lineNum">    2660 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    2661 </span>            :         }
<span class="lineNum">    2662 </span>            : 
<span class="lineNum">    2663 </span><span class="lineCov">          2 :         d_enum = 0;</span>
<span class="lineNum">    2664 </span><span class="lineCov">          4 :         while (gf_term_get_channel_net_info(term, odm, &amp;d_enum, &amp;id, &amp;stats, &amp;e)) {</span>
<span class="lineNum">    2665 </span><span class="lineNoCov">          0 :                 if (e) continue;</span>
<span class="lineNum">    2666 </span><span class="lineNoCov">          0 :                 if (!stats.bw_down &amp;&amp; !stats.bw_up) continue;</span>
<span class="lineNum">    2667 </span>            : 
<span class="lineNum">    2668 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Stream ID %d statistics:\n&quot;, id);</span>
<span class="lineNum">    2669 </span><span class="lineNoCov">          0 :                 if (stats.multiplex_port) {</span>
<span class="lineNum">    2670 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;\tMultiplex Port %d - multiplex ID %d\n&quot;, stats.multiplex_port, stats.port);</span>
<span class="lineNum">    2671 </span>            :                 } else {
<span class="lineNum">    2672 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;\tPort %d\n&quot;, stats.port);</span>
<span class="lineNum">    2673 </span>            :                 }
<span class="lineNum">    2674 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;\tPacket Loss Percentage: %.4f\n&quot;, stats.pck_loss_percentage);</span>
<span class="lineNum">    2675 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;\tDown Bandwidth: %d bps\n&quot;, stats.bw_down);</span>
<span class="lineNum">    2676 </span><span class="lineNoCov">          0 :                 if (stats.bw_up) fprintf(stderr, &quot;\tUp Bandwidth: %d bps\n&quot;, stats.bw_up);</span>
<span class="lineNum">    2677 </span><span class="lineNoCov">          0 :                 if (stats.ctrl_port) {</span>
<span class="lineNum">    2678 </span><span class="lineNoCov">          0 :                         if (stats.multiplex_port) {</span>
<span class="lineNum">    2679 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;\tControl Multiplex Port: %d - Control Multiplex ID %d\n&quot;, stats.multiplex_port, stats.ctrl_port);</span>
<span class="lineNum">    2680 </span>            :                         } else {
<span class="lineNum">    2681 </span><span class="lineNoCov">          0 :                                 fprintf(stderr, &quot;\tControl Port: %d\n&quot;, stats.ctrl_port);</span>
<span class="lineNum">    2682 </span>            :                         }
<span class="lineNum">    2683 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;\tDown Bandwidth: %d bps\n&quot;, stats.ctrl_bw_down);</span>
<span class="lineNum">    2684 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;\tUp Bandwidth: %d bps\n&quot;, stats.ctrl_bw_up);</span>
<span class="lineNum">    2685 </span>            :                 }
<span class="lineNum">    2686 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    2687 </span>            :         }
<a name="2688"><span class="lineNum">    2688 </span>            : }</a>
<span class="lineNum">    2689 </span>            : 
<span class="lineNum">    2690 </span><span class="lineCov">          2 : static void PrintODTiming(GF_Terminal *term, GF_ObjectManager *odm, u32 indent)</span>
<span class="lineNum">    2691 </span>            : {
<span class="lineNum">    2692 </span>            :         GF_MediaInfo odi;
<span class="lineNum">    2693 </span>            :         u32 ind = indent;
<span class="lineNum">    2694 </span>            :         u32 i, count;
<span class="lineNum">    2695 </span><span class="lineCov">          2 :         if (!odm) return;</span>
<span class="lineNum">    2696 </span>            : 
<span class="lineNum">    2697 </span><span class="lineCov">          2 :         if (gf_term_get_object_info(term, odm, &amp;odi) != GF_OK) return;</span>
<span class="lineNum">    2698 </span><span class="lineCov">          2 :         if (!odi.ODID) {</span>
<span class="lineNum">    2699 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Service not attached\n&quot;);</span>
<span class="lineNum">    2700 </span>            :                 return;
<span class="lineNum">    2701 </span>            :         }
<span class="lineNum">    2702 </span><span class="lineCov">          2 :         while (ind) {</span>
<span class="lineNum">    2703 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot; &quot;);</span>
<span class="lineNum">    2704 </span><span class="lineNoCov">          0 :                 ind--;</span>
<span class="lineNum">    2705 </span>            :         }
<span class="lineNum">    2706 </span>            : 
<span class="lineNum">    2707 </span><span class="lineCov">          2 :         if (! odi.generated_scene) {</span>
<span class="lineNum">    2708 </span>            : 
<span class="lineNum">    2709 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;- OD %d: &quot;, odi.ODID);</span>
<span class="lineNum">    2710 </span><span class="lineCov">          2 :                 switch (odi.status) {</span>
<span class="lineNum">    2711 </span><span class="lineCov">          2 :                 case 1:</span>
<span class="lineNum">    2712 </span><span class="lineCov">          2 :                         fprintf(stderr, &quot;Playing - &quot;);</span>
<span class="lineNum">    2713 </span>            :                         break;
<span class="lineNum">    2714 </span><span class="lineNoCov">          0 :                 case 2:</span>
<span class="lineNum">    2715 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Paused - &quot;);</span>
<span class="lineNum">    2716 </span>            :                         break;
<span class="lineNum">    2717 </span><span class="lineNoCov">          0 :                 default:</span>
<span class="lineNum">    2718 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Stopped - &quot;);</span>
<span class="lineNum">    2719 </span>            :                         break;
<span class="lineNum">    2720 </span>            :                 }
<span class="lineNum">    2721 </span><span class="lineCov">          2 :                 if (odi.buffer&gt;=0) fprintf(stderr, &quot;Buffer: %d ms - &quot;, odi.buffer);</span>
<span class="lineNum">    2722 </span><span class="lineCov">          2 :                 else fprintf(stderr, &quot;Not buffering - &quot;);</span>
<span class="lineNum">    2723 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;Clock drift: %d ms&quot;, odi.clock_drift);</span>
<span class="lineNum">    2724 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot; - time: &quot;);</span>
<span class="lineNum">    2725 </span><span class="lineCov">          2 :                 PrintTime((u32) (odi.current_time*1000));</span>
<span class="lineNum">    2726 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    2727 </span>            : 
<span class="lineNum">    2728 </span>            :         } else {
<span class="lineNum">    2729 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;+ Service %s:\n&quot;, odi.service_url);</span>
<span class="lineNum">    2730 </span>            :         }
<span class="lineNum">    2731 </span>            : 
<span class="lineNum">    2732 </span><span class="lineCov">          2 :         count = gf_term_get_object_count(term, odm);</span>
<span class="lineNum">    2733 </span><span class="lineCov">          2 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    2734 </span><span class="lineNoCov">          0 :                 GF_ObjectManager *an_odm = gf_term_get_object(term, odm, i);</span>
<span class="lineNum">    2735 </span><span class="lineNoCov">          0 :                 PrintODTiming(term, an_odm, indent+1);</span>
<span class="lineNum">    2736 </span>            :         }
<span class="lineNum">    2737 </span>            :         return;
<span class="lineNum">    2738 </span>            : 
<a name="2739"><span class="lineNum">    2739 </span>            : }</a>
<span class="lineNum">    2740 </span>            : 
<span class="lineNum">    2741 </span><span class="lineCov">          2 : static void PrintODBuffer(GF_Terminal *term, GF_ObjectManager *odm, u32 indent)</span>
<span class="lineNum">    2742 </span>            : {
<span class="lineNum">    2743 </span>            :         Float avg_dec_time;
<span class="lineNum">    2744 </span>            :         GF_MediaInfo odi;
<span class="lineNum">    2745 </span>            :         u32 ind, i, count;
<span class="lineNum">    2746 </span><span class="lineCov">          2 :         if (!odm) return;</span>
<span class="lineNum">    2747 </span>            : 
<span class="lineNum">    2748 </span><span class="lineCov">          2 :         if (gf_term_get_object_info(term, odm, &amp;odi) != GF_OK) return;</span>
<span class="lineNum">    2749 </span><span class="lineCov">          2 :         if (!odi.ODID) {</span>
<span class="lineNum">    2750 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;Service not attached\n&quot;);</span>
<span class="lineNum">    2751 </span>            :                 return;
<span class="lineNum">    2752 </span>            :         }
<span class="lineNum">    2753 </span>            : 
<span class="lineNum">    2754 </span>            :         ind = indent;
<span class="lineNum">    2755 </span><span class="lineCov">          2 :         while (ind) {</span>
<span class="lineNum">    2756 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot; &quot;);</span>
<span class="lineNum">    2757 </span><span class="lineNoCov">          0 :                 ind--;</span>
<span class="lineNum">    2758 </span>            :         }
<span class="lineNum">    2759 </span>            : 
<span class="lineNum">    2760 </span><span class="lineCov">          2 :         if (odi.generated_scene) {</span>
<span class="lineNum">    2761 </span><span class="lineNoCov">          0 :                 fprintf(stderr, &quot;+ Service %s:\n&quot;, odi.service_url);</span>
<span class="lineNum">    2762 </span>            :         } else {
<span class="lineNum">    2763 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;- OD %d: &quot;, odi.ODID);</span>
<span class="lineNum">    2764 </span><span class="lineCov">          2 :                 switch (odi.status) {</span>
<span class="lineNum">    2765 </span><span class="lineCov">          2 :                 case 1:</span>
<span class="lineNum">    2766 </span><span class="lineCov">          2 :                         fprintf(stderr, &quot;Playing&quot;);</span>
<span class="lineNum">    2767 </span>            :                         break;
<span class="lineNum">    2768 </span><span class="lineNoCov">          0 :                 case 2:</span>
<span class="lineNum">    2769 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Paused&quot;);</span>
<span class="lineNum">    2770 </span>            :                         break;
<span class="lineNum">    2771 </span><span class="lineNoCov">          0 :                 default:</span>
<span class="lineNum">    2772 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot;Stopped&quot;);</span>
<span class="lineNum">    2773 </span>            :                         break;
<span class="lineNum">    2774 </span>            :                 }
<span class="lineNum">    2775 </span><span class="lineCov">          2 :                 if (odi.buffer&gt;=0) fprintf(stderr, &quot; - Buffer: %d ms&quot;, odi.buffer);</span>
<span class="lineNum">    2776 </span><span class="lineCov">          2 :                 if (odi.db_unit_count) fprintf(stderr, &quot; - DB: %d AU&quot;, odi.db_unit_count);</span>
<span class="lineNum">    2777 </span><span class="lineCov">          2 :                 if (odi.cb_max_count) fprintf(stderr, &quot; - CB: %d/%d CUs&quot;, odi.cb_unit_count, odi.cb_max_count);</span>
<span class="lineNum">    2778 </span>            : 
<span class="lineNum">    2779 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    2780 </span>            :                 ind = indent;
<span class="lineNum">    2781 </span><span class="lineCov">          4 :                 while (ind) {</span>
<span class="lineNum">    2782 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot; &quot;);</span>
<span class="lineNum">    2783 </span><span class="lineNoCov">          0 :                         ind--;</span>
<span class="lineNum">    2784 </span>            :                 }
<span class="lineNum">    2785 </span>            : 
<span class="lineNum">    2786 </span><span class="lineCov">          2 :                 fprintf(stderr, &quot; %d decoded frames - %d dropped frames\n&quot;, odi.nb_dec_frames, odi.nb_dropped);</span>
<span class="lineNum">    2787 </span>            : 
<span class="lineNum">    2788 </span>            :                 ind = indent;
<span class="lineNum">    2789 </span><span class="lineCov">          4 :                 while (ind) {</span>
<span class="lineNum">    2790 </span><span class="lineNoCov">          0 :                         fprintf(stderr, &quot; &quot;);</span>
<span class="lineNum">    2791 </span><span class="lineNoCov">          0 :                         ind--;</span>
<span class="lineNum">    2792 </span>            :                 }
<span class="lineNum">    2793 </span>            : 
<span class="lineNum">    2794 </span>            :                 avg_dec_time = 0;
<span class="lineNum">    2795 </span><span class="lineCov">          2 :                 if (odi.nb_dec_frames) {</span>
<span class="lineNum">    2796 </span><span class="lineNoCov">          0 :                         avg_dec_time = (Float) odi.total_dec_time;</span>
<span class="lineNum">    2797 </span><span class="lineNoCov">          0 :                         avg_dec_time /= odi.nb_dec_frames;</span>
<span class="lineNum">    2798 </span>            :                 }
<span class="lineNum">    2799 </span><span class="lineCov">          6 :                 fprintf(stderr, &quot; Avg Bitrate %d kbps (%d max) - Avg Decoding Time %.2f us (%d max)\n&quot;,</span>
<span class="lineNum">    2800 </span><span class="lineCov">          4 :                         (u32) odi.avg_bitrate/1024, odi.max_bitrate/1024, avg_dec_time, odi.max_dec_time);</span>
<span class="lineNum">    2801 </span>            :         }
<span class="lineNum">    2802 </span>            : 
<span class="lineNum">    2803 </span><span class="lineCov">          2 :         count = gf_term_get_object_count(term, odm);</span>
<span class="lineNum">    2804 </span><span class="lineCov">          2 :         for (i=0; i&lt;count; i++) {</span>
<span class="lineNum">    2805 </span><span class="lineNoCov">          0 :                 GF_ObjectManager *an_odm = gf_term_get_object(term, odm, i);</span>
<span class="lineNum">    2806 </span><span class="lineNoCov">          0 :                 PrintODBuffer(term, an_odm, indent+1);</span>
<span class="lineNum">    2807 </span>            :         }
<span class="lineNum">    2808 </span>            : 
<a name="2809"><span class="lineNum">    2809 </span>            : }</a>
<span class="lineNum">    2810 </span>            : 
<span class="lineNum">    2811 </span><span class="lineCov">          4 : static void ViewODs(GF_Terminal *term, Bool show_timing)</span>
<span class="lineNum">    2812 </span>            : {
<span class="lineNum">    2813 </span><span class="lineCov">          4 :         GF_ObjectManager *root_odm = gf_term_get_root_object(term);</span>
<span class="lineNum">    2814 </span><span class="lineCov">          4 :         if (!root_odm) return;</span>
<span class="lineNum">    2815 </span>            : 
<span class="lineNum">    2816 </span><span class="lineCov">          4 :         if (show_timing) {</span>
<span class="lineNum">    2817 </span><span class="lineCov">          2 :                 PrintODTiming(term, root_odm, 0);</span>
<span class="lineNum">    2818 </span>            :         } else {
<span class="lineNum">    2819 </span><span class="lineCov">          2 :                 PrintODBuffer(term, root_odm, 0);</span>
<span class="lineNum">    2820 </span>            :         }
<span class="lineNum">    2821 </span><span class="lineCov">          4 :         fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">    2822 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
